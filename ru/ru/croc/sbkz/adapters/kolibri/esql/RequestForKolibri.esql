BROKER SCHEMA ru.croc.sbkz.adapters.kolibri.esql

PATH ru.croc.sbrf.bp.common.esql, ru.croc.sbkz.utils;

-- Маршрутизация потока в соответствии с операцией
CREATE COMPUTE MODULE RequestForKolibri_DetectOperation
	CREATE FUNCTION Main() RETURNS BOOLEAN
	BEGIN		
		DECLARE Operation CHARACTER FIELDNAME(InputRoot.XMLNSC.*[<]);
		DECLARE labelName CHARACTER;
		
		CASE Operation
		WHEN 'KZSrvBLGetCodeRq' THEN
			SET labelName = 'KZSrvBLGetCodeRq';
		WHEN 'KZSrvBLCreateMoneyTransferRq' THEN
			SET labelName = 'KZSrvBLCreateMoneyTransferRq';
		WHEN 'KZSrvBLGetMoneyTransferRq' THEN
			SET labelName = 'KZSrvBLGetMoneyTransferRq';
		WHEN 'KZSrvBLReversalMoneyTransferRq' THEN
			SET labelName = 'KZSrvBLReversalMoneyTransferRq';
		WHEN 'KZSrvBLMoneyTransferAcknowledgmentRq' THEN
			SET labelName = 'KZSrvBLMoneyTransferAcknowledgmentRq';
		WHEN 'KZSrvBLMoneyTransferBlockingRq' THEN
			SET labelName = 'KZSrvBLMoneyTransferBlockingRq';
		WHEN 'KZSrvBLModifyMoneyTransferRq' THEN
			SET labelName = 'KZSrvBLModifyMoneyTransferRq';
		WHEN 'KZSrvBLCancelMoneyTransferGettingRq' THEN
			SET labelName = 'KZSrvBLCancelMoneyTransferGettingRq';
		WHEN 'KZSrvBLRecoverMoneyTransferRq' THEN
			SET labelName = 'KZSrvBLRecoverMoneyTransferRq';
		ELSE
			-- Неизвестный тип сообщения
			THROW USER EXCEPTION VALUES ('Unknown message format for KOLIBRI', Operation);
		END CASE;
		
		SET OutputLocalEnvironment.Destination.RouterList.DestinationData[1].labelName = labelName;
		
		RETURN TRUE;
	END;
END MODULE;

/* 6-ой сервис */
CREATE COMPUTE MODULE RequestForKolibri_ConvertMDO2CRM_KZSrvBLMoneyTransferBlockingRq
	CREATE FUNCTION Main() RETURNS BOOLEAN
	BEGIN
	    CALL CopyMessageHeaders(InputRoot,OutputRoot);
		
		DECLARE inRef REFERENCE TO InputRoot.XMLNSC.[<];
		DECLARE outRef REFERENCE TO OutputRoot.XMLNSC.*[<];
				
	    SET OutputRoot.MQMD.ReplyToQ	= 'ESB.QPRAGMA.OUT';
	    SET OutputRoot.MQMD.ReplyToQMgr	= 'IKAZ.ESB.OUT.GW1';				
				
		CREATE LASTCHILD OF OutputRoot DOMAIN('XMLNSC') NAME 'XMLNSC';
		CREATE LASTCHILD OF OutputRoot.XMLNSC AS outRef NAMESPACE mtblitz NAME 'FIXferModLockRq'; 
		
    	SET OutputRoot.XMLNSC.mtblitz:FIXferModLockRq.(XMLNSC.NamespaceDecl)xmlns:iam = iam;
		SET OutputRoot.XMLNSC.mtblitz:FIXferModLockRq.(XMLNSC.NamespaceDecl)xmlns:mt = mt;		
    	SET OutputRoot.XMLNSC.mtblitz:FIXferModLockRq.(XMLNSC.NamespaceDecl)xmlns:ca  = ca; 
		SET OutputRoot.XMLNSC.mtblitz:FIXferModLockRq.(XMLNSC.NamespaceDecl)xmlns:mtblitz = mtblitz; 	
    	SET OutputRoot.XMLNSC.mtblitz:FIXferModLockRq.(XMLNSC.NamespaceDecl)xmlns:ind = ind; 
    	SET OutputRoot.XMLNSC.mtblitz:FIXferModLockRq.(XMLNSC.NamespaceDecl)xmlns:orgs = orgs; 
		
		SET outRef.mt:RqUID			= inRef.RqUID;
		SET outRef.mt:RqTm			= convertFromQPtoKOLI(inRef.RqTm);
		SET outRef.mt:SPName		= 'urn:sbrfsystems:98-abs';
		SET outRef.mt:OperName		= 'SrvBLMoneyTransferBlocking';

		DECLARE varStartDt CHARACTER;
		DECLARE varEndDt   CHARACTER;
		DECLARE varPlaceCode CHARACTER;
       
		DECLARE userInfo REFERENCE TO outRef;
        
        CREATE LASTCHILD OF outRef AS userInfo NAMESPACE mtblitz NAME 'UserInfo'; 
        
        SET userInfo.iam:UserId			= inRef.FIXferModLockRq.UserInfo.UserId; -- обязательное поле
        SET userInfo.iam:RegionId		= inRef.FIXferModLockRq.UserInfo.RegionId; 
        SET userInfo.iam:FullName		= inRef.FIXferModLockRq.UserInfo.FullName;
        
        /* userInfo.iam:PersonName */
        DECLARE personName REFERENCE TO userInfo;                	                
        
        IF EXISTS(inRef.FIXferModLockRq.UserInfo.PersonName[]) THEN
        	CREATE LASTCHILD OF userInfo AS personName NAMESPACE iam NAME 'PersonName'; -- создаем PersonName с namespace iam внутри UserInfo            
        	CALL FillSomeField(inRef.FIXferModLockRq.UserInfo.PersonName, personName, 'ind', 'LastName');
        END IF;
        
        SET personName.ind:FirstName = inRef.FIXferModLockRq.UserInfo.PersonName.FirstName;
		
		IF EXISTS(inRef.FIXferModLockRq.UserInfo.PersonName[]) THEN
			CALL FillSomeField(inRef.FIXferModLockRq.UserInfo.PersonName, personName, 'ind', 'MiddleName');
		END IF;
        
        SET personName.ind:TitlePrefix 	= inRef.FIXferModLockRq.UserInfo.PersonName.TitlePrefix;
        SET personName.ind:NameSuffix 	= inRef.FIXferModLockRq.UserInfo.PersonName.NameSuffix;
        SET personName.ind:Nickname 	= inRef.FIXferModLockRq.UserInfo.PersonName.Nickname;
        SET personName.ind:LegalName    = inRef.FIXferModLockRq.UserInfo.PersonName.LegalName;
        /* userInfo.iam:PersonName */
              
		SET userInfo.iam:OrgId				= inRef.FIXferModLockRq.UserInfo.OrgId;
		SET userInfo.iam:OrgName			= inRef.FIXferModLockRq.UserInfo.OrgName;
		SET userInfo.iam:OrgUnitId			= inRef.FIXferModLockRq.UserInfo.OrgUnitId;
		SET userInfo.iam:OrgUnitName		= inRef.FIXferModLockRq.UserInfo.OrgUnitName;
		SET userInfo.iam:EmployeeId			= inRef.FIXferModLockRq.UserInfo.EmployeeId;
		SET userInfo.iam:IpAddr				= inRef.FIXferModLockRq.UserInfo.IpAddr;
		
		DECLARE COUNTER INTEGER 1;
		DECLARE ARRAY_USERINFO INTEGER CARDINALITY(inRef.FIXferModLockRq.UserInfo.*[]);		
		
		/* userInfo.iam:CertInfo */
		DECLARE certInfo REFERENCE TO userInfo;
		
		WHILE COUNTER <= ARRAY_USERINFO DO
		
			IF FIELDNAME(inRef.FIXferModLockRq.UserInfo.[COUNTER]) = 'CertInfo' THEN
				
				CREATE LASTCHILD OF userInfo AS certInfo NAMESPACE iam NAME 'CertInfo';
				
				SET certInfo.iam:X509SubjectName  =  FIELDVALUE(inRef.FIXferModLockRq.UserInfo.[COUNTER].X509SubjectName);
				SET certInfo.iam:KeyName		  =  FIELDVALUE(inRef.FIXferModLockRq.UserInfo.[COUNTER].KeyName);	
				SET certInfo.iam:RegionId		  =  FIELDVALUE(inRef.FIXferModLockRq.UserInfo.[COUNTER].RegionId);				
				      
        		CALL FillSomeField(inRef.FIXferModLockRq.UserInfo.[COUNTER], certInfo, 'iam', 'UserRole');
        		        		
        		SET certInfo.iam:Certificate		  =  FIELDVALUE(inRef.FIXferModLockRq.UserInfo.[COUNTER].Certificate);
        		SET certInfo.iam:KeyValue			  =  FIELDVALUE(inRef.FIXferModLockRq.UserInfo.[COUNTER].KeyValue); 
        		SET certInfo.iam:X509SerialNumber     =  FIELDVALUE(inRef.FIXferModLockRq.UserInfo.[COUNTER].X509SerialNumber);
        		SET certInfo.iam:X509IssuerNumber     =  FIELDVALUE(inRef.FIXferModLockRq.UserInfo.[COUNTER].X509IssuerNumber); 			
				SET certInfo.iam:X509IssuerSerial     =  FIELDVALUE(inRef.FIXferModLockRq.UserInfo.[COUNTER].X509IssuerSerial);
				SET certInfo.iam:Version		      =  FIELDVALUE(inRef.FIXferModLockRq.UserInfo.[COUNTER].Version);
				SET certInfo.iam:NotBefore		      =  FIELDVALUE(inRef.FIXferModLockRq.UserInfo.[COUNTER].NotBefore);
				SET certInfo.iam:NotAfter			  =  FIELDVALUE(inRef.FIXferModLockRq.UserInfo.[COUNTER].NotAfter);
				SET certInfo.iam:SigAlgName			  =  FIELDVALUE(inRef.FIXferModLockRq.UserInfo.[COUNTER].SigAlgName);
				SET certInfo.iam:SigValue			  =  FIELDVALUE(inRef.FIXferModLockRq.UserInfo.[COUNTER].SigValue);
				
				DECLARE COUNTER_CERTINFO INTEGER 1;
				DECLARE ARRAY_CERTINFO INTEGER CARDINALITY(inRef.FIXferModLockRq.UserInfo.[COUNTER].*[]);
				DECLARE extensionInfo REFERENCE TO certInfo;
				
				WHILE COUNTER_CERTINFO <= ARRAY_CERTINFO DO
					IF FIELDNAME(inRef.FIXferModLockRq.UserInfo.[COUNTER].[COUNTER_CERTINFO]) = 'Extension' THEN
						CREATE LASTCHILD OF certInfo AS extensionInfo NAMESPACE iam NAME 'Extension';
												
						SET extensionInfo.iam:ExtnId      = FIELDVALUE(inRef.FIXferModLockRq.UserInfo.[COUNTER].[COUNTER_CERTINFO].ExtnId);
						SET extensionInfo.iam:Critical    = FIELDVALUE(inRef.FIXferModLockRq.UserInfo.[COUNTER].[COUNTER_CERTINFO].Critical);
						SET extensionInfo.iam:ExtnValue   = FIELDVALUE(inRef.FIXferModLockRq.UserInfo.[COUNTER].[COUNTER_CERTINFO].ExtnValue);												
					END IF;					
					SET COUNTER_CERTINFO = COUNTER_CERTINFO + 1;						
				END WHILE;
						
			END IF;
			
			SET COUNTER = COUNTER + 1;
			
		END WHILE;		
		/* userInfo.iam:CertInfo */
		
		/* FIXferInfo */
		DECLARE fixferInfo REFERENCE TO outRef;		
		CREATE LASTCHILD OF outRef AS fixferInfo NAMESPACE mtblitz NAME 'FIXferInfo';
		
		/* SENDER */
		DECLARE sender REFERENCE TO fixferInfo;
		CREATE LASTCHILD OF fixferInfo AS sender NAMESPACE mtblitz NAME 'Sender';
		
		/* PersonInfo */
		DECLARE personInfo REFERENCE TO sender;
		CREATE LASTCHILD OF sender AS personInfo NAMESPACE mtblitz NAME 'PersonInfo';   
		
		SET personInfo.ind:NameAddrType  =  inRef.FIXferModLockRq.FIXferInfo.Sender.PersonInfo.NameAddrType;
		SET personInfo.ind:FullName     =  inRef.FIXferModLockRq.FIXferInfo.Sender.PersonInfo.FullName;
		
		IF EXISTS(inRef.FIXferModLockRq.FIXferInfo.Sender.PersonInfo.PersonName[]) THEN
        	-- создаем PersonName с namespace iam внутри UserInfo
        	CREATE LASTCHILD OF personInfo AS personName NAMESPACE ind NAME 'PersonName';             
        	CALL FillSomeField(inRef.FIXferModLockRq.FIXferInfo.Sender.PersonInfo.PersonName, personName, 'ind', 'LastName');
        	
        	SET personName.ind:FirstName	=	inRef.FIXferModLockRq.FIXferInfo.Sender.PersonInfo.PersonName.FirstName;	
        	
        	IF EXISTS(inRef.FIXferModLockRq.FIXferInfo.Sender.PersonInfo.PersonName[]) THEN
				CALL FillSomeField(inRef.FIXferModLockRq.FIXferInfo.Sender.PersonInfo.PersonName, personName, 'ind', 'MiddleName');
			END IF;
        	
        	SET personName.ind:TitlePrefix	=	inRef.FIXferModLockRq.FIXferInfo.Sender.PersonInfo.PersonName.TitlePrefix;	
        	SET personName.ind:NameSuffix	=	inRef.FIXferModLockRq.FIXferInfo.Sender.PersonInfo.PersonName.NameSuffix;
        	SET personName.ind:Nickname		=	inRef.FIXferModLockRq.FIXferInfo.Sender.PersonInfo.PersonName.Nickname;
        	SET personName.ind:LegalName	=	inRef.FIXferModLockRq.FIXferInfo.Sender.PersonInfo.PersonName.LegalName;
        	
        END IF;		
		
		DECLARE COUNT_CONTACTINFO INTEGER 1;
		DECLARE ARRAY_CONTACTINFO INTEGER CARDINALITY(inRef.FIXferModLockRq.FIXferInfo.Sender.PersonInfo.*[]);
		DECLARE contactInfo REFERENCE TO personInfo;
		
		/* ContactInfo */
		WHILE COUNT_CONTACTINFO <= ARRAY_CONTACTINFO DO
			IF FIELDNAME(inRef.FIXferModLockRq.FIXferInfo.Sender.PersonInfo.[COUNT_CONTACTINFO]) = 'ContactInfo' THEN
				CREATE LASTCHILD OF personInfo AS contactInfo NAMESPACE ind NAME 'ContactInfo';
				SET contactInfo.ca:ContactPref		=	FIELDVALUE(inRef.FIXferModLockRq.FIXferInfo.Sender.PersonInfo.[COUNT_CONTACTINFO].ContactPref);
				SET contactInfo.ca:PrefTimeStart	=	FIELDVALUE(inRef.FIXferModLockRq.FIXferInfo.Sender.PersonInfo.[COUNT_CONTACTINFO].PrefTimeStart);
				SET contactInfo.ca:PrefTimeEnd		=   FIELDVALUE(inRef.FIXferModLockRq.FIXferInfo.Sender.PersonInfo.[COUNT_CONTACTINFO].PrefTimeEnd);
				
				DECLARE COUNT_PHONENUM INTEGER 1;
				DECLARE ARRAY_PHONENUM INTEGER CARDINALITY(inRef.FIXferModLockRq.FIXferInfo.Sender.PersonInfo.[COUNT_CONTACTINFO].*[]);
 				DECLARE phoneNum REFERENCE TO contactInfo;
 				
 				WHILE COUNT_PHONENUM <= ARRAY_CONTACTINFO DO
 					IF FIELDNAME(inRef.FIXferModLockRq.FIXferInfo.Sender.PersonInfo.[COUNT_CONTACTINFO].[COUNT_PHONENUM]) = 'PhoneNum' THEN
 						CREATE LASTCHILD OF contactInfo AS phoneNum NAMESPACE ca NAME 'PhoneNum';
 						
 						SET phoneNum.ca:PhoneType		=	FIELDVALUE(inRef.FIXferModLockRq.FIXferInfo.Sender.PersonInfo.[COUNT_CONTACTINFO].[COUNT_PHONENUM].PhoneType);
 						SET phoneNum.ca:Phone			= 	FIELDVALUE(inRef.FIXferModLockRq.FIXferInfo.Sender.PersonInfo.[COUNT_CONTACTINFO].[COUNT_PHONENUM].Phone);
 						SET phoneNum.ca:PhoneCode   	=   FIELDVALUE(inRef.FIXferModLockRq.FIXferInfo.Sender.PersonInfo.[COUNT_CONTACTINFO].[COUNT_PHONENUM].PhoneCode);
 						SET phoneNum.ca:PhoneOperName   =   FIELDVALUE(inRef.FIXferModLockRq.FIXferInfo.Sender.PersonInfo.[COUNT_CONTACTINFO].[COUNT_PHONENUM].PhoneOperName);
 						
 					END IF;	
 					SET COUNT_PHONENUM = COUNT_PHONENUM + 1; 					
 				END WHILE;
 				
 				SET contactInfo.ca:ContactName	=	FIELDVALUE(inRef.FIXferModLockRq.FIXferInfo.Sender.PersonInfo.[COUNT_CONTACTINFO].ContactName);
 				SET contactInfo.ca:EmailAddr	=	FIELDVALUE(inRef.FIXferModLockRq.FIXferInfo.Sender.PersonInfo.[COUNT_CONTACTINFO].EmailAddr);
 				SET contactInfo.ca:URL			=	FIELDVALUE(inRef.FIXferModLockRq.FIXferInfo.Sender.PersonInfo.[COUNT_CONTACTINFO].URL);
 				
 				DECLARE COUNT_CONTACTDATA INTEGER 1;
 				DECLARE ARRAY_CONTACTDATA INTEGER CARDINALITY(inRef.FIXferModLockRq.FIXferInfo.Sender.PersonInfo.[COUNT_CONTACTINFO].*[]);
 				DECLARE contactData REFERENCE TO contactInfo;
 				
 				WHILE COUNT_CONTACTDATA <= ARRAY_CONTACTDATA DO
 					IF FIELDNAME(inRef.FIXferModLockRq.FIXferInfo.Sender.PersonInfo.[COUNT_CONTACTINFO].[COUNT_CONTACTDATA]) = 'ContactData' THEN
 						CREATE LASTCHILD OF contactInfo AS contactData NAMESPACE ca NAME 'ContactData';
 						
 						SET contactData.ca:ContactType		=  FIELDVALUE(inRef.FIXferModLockRq.FIXferInfo.Sender.PersonInfo.[COUNT_CONTACTINFO].[COUNT_CONTACTDATA].ContactType);
 						SET contactData.ca:ContactValue		=  FIELDVALUE(inRef.FIXferModLockRq.FIXferInfo.Sender.PersonInfo.[COUNT_CONTACTINFO].[COUNT_CONTACTDATA].ContactValue);
 						SET contactData.ca:PrefTimeStart	=  FIELDVALUE(inRef.FIXferModLockRq.FIXferInfo.Sender.PersonInfo.[COUNT_CONTACTINFO].[COUNT_CONTACTDATA].PrefTimeStart);
 						SET contactData.ca:PrefTimeEnd		=  FIELDVALUE(inRef.FIXferModLockRq.FIXferInfo.Sender.PersonInfo.[COUNT_CONTACTINFO].[COUNT_CONTACTDATA].PrefTimeEnd);
 							
 					END IF;	
 					SET COUNT_CONTACTDATA = COUNT_CONTACTDATA + 1;
 				END WHILE;
 				
 				DECLARE COUNT_POSTADDR INTEGER 1;
				DECLARE postAddr REFERENCE TO contactInfo;
				
				WHILE COUNT_POSTADDR <= ARRAY_CONTACTDATA DO
					IF FIELDNAME(inRef.FIXferModLockRq.FIXferInfo.Sender.PersonInfo.[COUNT_CONTACTINFO].[COUNT_POSTADDR]) = 'PostAddr' THEN
						CREATE LASTCHILD OF contactInfo AS postAddr NAMESPACE ca NAME 'PostAddr';
						
						SET postAddr.ca:Addr1			=	FIELDVALUE(inRef.FIXferModLockRq.FIXferInfo.Sender.PersonInfo.[COUNT_CONTACTINFO].[COUNT_POSTADDR].Addr1);  
						SET postAddr.ca:Addr2			=	FIELDVALUE(inRef.FIXferModLockRq.FIXferInfo.Sender.PersonInfo.[COUNT_CONTACTINFO].[COUNT_POSTADDR].Addr2);  
						SET postAddr.ca:Addr3			=	FIELDVALUE(inRef.FIXferModLockRq.FIXferInfo.Sender.PersonInfo.[COUNT_CONTACTINFO].[COUNT_POSTADDR].Addr3);  
						SET postAddr.ca:Addr4			=	FIELDVALUE(inRef.FIXferModLockRq.FIXferInfo.Sender.PersonInfo.[COUNT_CONTACTINFO].[COUNT_POSTADDR].Addr4);
						SET postAddr.ca:City			=	FIELDVALUE(inRef.FIXferModLockRq.FIXferInfo.Sender.PersonInfo.[COUNT_CONTACTINFO].[COUNT_POSTADDR].City);    
						SET postAddr.ca:CityCode		=	FIELDVALUE(inRef.FIXferModLockRq.FIXferInfo.Sender.PersonInfo.[COUNT_CONTACTINFO].[COUNT_POSTADDR].CityCode);
						SET postAddr.ca:StateProv		=	FIELDVALUE(inRef.FIXferModLockRq.FIXferInfo.Sender.PersonInfo.[COUNT_CONTACTINFO].[COUNT_POSTADDR].StateProv);
						SET postAddr.ca:StateProvCode	=	FIELDVALUE(inRef.FIXferModLockRq.FIXferInfo.Sender.PersonInfo.[COUNT_CONTACTINFO].[COUNT_POSTADDR].StateProvCode);
						SET postAddr.ca:Area			= 	FIELDVALUE(inRef.FIXferModLockRq.FIXferInfo.Sender.PersonInfo.[COUNT_CONTACTINFO].[COUNT_POSTADDR].Area);
						SET postAddr.ca:AreaCode		= 	FIELDVALUE(inRef.FIXferModLockRq.FIXferInfo.Sender.PersonInfo.[COUNT_CONTACTINFO].[COUNT_POSTADDR].AreaCode);
						SET postAddr.ca:PostalCode		= 	FIELDVALUE(inRef.FIXferModLockRq.FIXferInfo.Sender.PersonInfo.[COUNT_CONTACTINFO].[COUNT_POSTADDR].PostalCode);
						SET postAddr.ca:Country			= 	FIELDVALUE(inRef.FIXferModLockRq.FIXferInfo.Sender.PersonInfo.[COUNT_CONTACTINFO].[COUNT_POSTADDR].Country);
						SET postAddr.ca:CountryCode		= 	FIELDVALUE(inRef.FIXferModLockRq.FIXferInfo.Sender.PersonInfo.[COUNT_CONTACTINFO].[COUNT_POSTADDR].CountryCode);
						SET postAddr.ca:AddrType		= 	FIELDVALUE(inRef.FIXferModLockRq.FIXferInfo.Sender.PersonInfo.[COUNT_CONTACTINFO].[COUNT_POSTADDR].AddrType);      

--						SET postAddr.ca:StartDt			= 	FIELDVALUE(inRef.FIXferModLockRq.FIXferInfo.Sender.PersonInfo.[COUNT_CONTACTINFO].[COUNT_POSTADDR].StartDt);
--						SET postAddr.ca:EndDt			= 	FIELDVALUE(inRef.FIXferModLockRq.FIXferInfo.Sender.PersonInfo.[COUNT_CONTACTINFO].[COUNT_POSTADDR].EndDt);

						IF FIELDVALUE(inRef.FIXferModLockRq.FIXferInfo.Sender.PersonInfo.[COUNT_CONTACTINFO].[COUNT_POSTADDR].StartDt) <> '' THEN
 				            SET varStartDt			    = 	FIELDVALUE(inRef.FIXferModLockRq.FIXferInfo.Sender.PersonInfo.[COUNT_CONTACTINFO].[COUNT_POSTADDR].StartDt);
							SET postAddr.ca:StartDt		= 	SUBSTRING(varStartDt FROM 1 FOR 10);
						END IF;

						IF FIELDVALUE(inRef.FIXferModLockRq.FIXferInfo.Sender.PersonInfo.[COUNT_CONTACTINFO].[COUNT_POSTADDR].EndDt) <> '' THEN
							SET varEndDt		        = 	FIELDVALUE(inRef.FIXferModLockRq.FIXferInfo.Sender.PersonInfo.[COUNT_CONTACTINFO].[COUNT_POSTADDR].EndDt);
							SET postAddr.ca:EndDt		= 	SUBSTRING(varEndDt FROM 1 FOR 10);
						END IF;

						SET postAddr.ca:DistrictCode	= 	FIELDVALUE(inRef.FIXferModLockRq.FIXferInfo.Sender.PersonInfo.[COUNT_CONTACTINFO].[COUNT_POSTADDR].DistrictCode);
						SET postAddr.ca:District		= 	FIELDVALUE(inRef.FIXferModLockRq.FIXferInfo.Sender.PersonInfo.[COUNT_CONTACTINFO].[COUNT_POSTADDR].District);
						
						SET varPlaceCode		        = 	FIELDVALUE(inRef.FIXferModLockRq.FIXferInfo.Sender.PersonInfo.[COUNT_CONTACTINFO].[COUNT_POSTADDR].PlaceCode);
                        IF varPlaceCode <> '' THEN
				          SET postAddr.ca:PlaceCode       =   varPlaceCode;
                        END IF;   
						
						SET postAddr.ca:Place			= 	FIELDVALUE(inRef.FIXferModLockRq.FIXferInfo.Sender.PersonInfo.[COUNT_CONTACTINFO].[COUNT_POSTADDR].Place);
						SET postAddr.ca:StreetCode		= 	FIELDVALUE(inRef.FIXferModLockRq.FIXferInfo.Sender.PersonInfo.[COUNT_CONTACTINFO].[COUNT_POSTADDR].StreetCode);
						SET postAddr.ca:Street			= 	FIELDVALUE(inRef.FIXferModLockRq.FIXferInfo.Sender.PersonInfo.[COUNT_CONTACTINFO].[COUNT_POSTADDR].Street);
						SET postAddr.ca:House			= 	FIELDVALUE(inRef.FIXferModLockRq.FIXferInfo.Sender.PersonInfo.[COUNT_CONTACTINFO].[COUNT_POSTADDR].House);
						SET postAddr.ca:Corpus			= 	FIELDVALUE(inRef.FIXferModLockRq.FIXferInfo.Sender.PersonInfo.[COUNT_CONTACTINFO].[COUNT_POSTADDR].Corpus);
						SET postAddr.ca:Building		= 	FIELDVALUE(inRef.FIXferModLockRq.FIXferInfo.Sender.PersonInfo.[COUNT_CONTACTINFO].[COUNT_POSTADDR].Building);
						SET postAddr.ca:Flat			= 	FIELDVALUE(inRef.FIXferModLockRq.FIXferInfo.Sender.PersonInfo.[COUNT_CONTACTINFO].[COUNT_POSTADDR].Flat);
						SET postAddr.ca:Office			= 	FIELDVALUE(inRef.FIXferModLockRq.FIXferInfo.Sender.PersonInfo.[COUNT_CONTACTINFO].[COUNT_POSTADDR].Office);
						SET postAddr.ca:RusKLADR		= 	FIELDVALUE(inRef.FIXferModLockRq.FIXferInfo.Sender.PersonInfo.[COUNT_CONTACTINFO].[COUNT_POSTADDR].RusKLADR);
						SET postAddr.ca:AddrStatus		= 	FIELDVALUE(inRef.FIXferModLockRq.FIXferInfo.Sender.PersonInfo.[COUNT_CONTACTINFO].[COUNT_POSTADDR].AddrStatus);
						
					END IF;
					SET COUNT_POSTADDR = COUNT_POSTADDR + 1;	
				END WHILE;		
 				
 				SET contactInfo.ca:ProviderCode			=	FIELDVALUE(inRef.FIXferModLockRq.FIXferInfo.Sender.PersonInfo.[COUNT_CONTACTINFO].ProviderCode);
 				
			END IF;	
			SET COUNT_CONTACTINFO = COUNT_CONTACTINFO + 1;
		END WHILE;
		
		/* PersonInfo */
		SET personInfo.ind:TINInfo.ca:TINType   =  inRef.FIXferModLockRq.FIXferInfo.Sender.PersonInfo.TINInfo.TINType;
		SET personInfo.ind:TINInfo.ca:TaxId  	=  inRef.FIXferModLockRq.FIXferInfo.Sender.PersonInfo.TINInfo.TaxId;
		SET personInfo.ind:TINInfo.ca:CertCode  =  inRef.FIXferModLockRq.FIXferInfo.Sender.PersonInfo.TINInfo.CertCode;
		
		IF COALESCE(FIELDVALUE(inRef.FIXferModLockRq.FIXferInfo.Sender.PersonInfo.BirthDt),'') <> '' THEN
			SET personInfo.ind:BirthDt				=  SUBSTRING(FIELDVALUE(inRef.FIXferModLockRq.FIXferInfo.Sender.PersonInfo.BirthDt) FROM 1 FOR 10);
		END IF;
		
		IF EXISTS(inRef.FIXferModLockRq.FIXferInfo.Sender.PersonInfo.DriversLicense[]) THEN 
			SET personInfo.ind:DriversLicense.ind:LicenseNum		=  COALESCE(inRef.FIXferModLockRq.FIXferInfo.Sender.PersonInfo.DriversLicense.LicenseNum, NULL);
			SET personInfo.ind:DriversLicense.ind:StateProv			=  COALESCE(inRef.FIXferModLockRq.FIXferInfo.Sender.PersonInfo.DriversLicense.StateProv, NULL);
			SET personInfo.ind:DriversLicense.ind:Country			=  COALESCE(inRef.FIXferModLockRq.FIXferInfo.Sender.PersonInfo.DriversLicense.Country, NULL);
		END IF;
		
		SET personInfo.ind:MotherMaidenName						=  inRef.FIXferModLockRq.FIXferInfo.Sender.PersonInfo.MotherMaidenName;
		SET personInfo.ind:SpouseName							=  inRef.FIXferModLockRq.FIXferInfo.Sender.PersonInfo.SpouseName;
		
		DECLARE COUNTER_EMPLOYMENT INTEGER 1;
		DECLARE employment REFERENCE TO personInfo;
		
		WHILE COUNTER_EMPLOYMENT <= ARRAY_CONTACTINFO DO
			IF FIELDNAME(inRef.FIXferModLockRq.FIXferInfo.Sender.PersonInfo.[COUNTER_EMPLOYMENT]) = 'EmploymentHistory' THEN
				CREATE LASTCHILD OF personInfo AS employment NAMESPACE ind NAME 'EmploymentHistory';
				
				SET employment.ind:EmploymentStatus		=	inRef.FIXferModLockRq.FIXferInfo.Sender.PersonInfo.[COUNTER_EMPLOYMENT].EmploymentStatus;				

				DECLARE orgInfo REFERENCE TO employment;
				DECLARE industId REFERENCE TO employment;
				DECLARE composite REFERENCE TO employment;
				DECLARE general REFERENCE TO employment;
								
				FOR orgFor AS inRef.FIXferModLockRq.FIXferInfo.Sender.PersonInfo.[COUNTER_EMPLOYMENT].OrgInfo[] DO
					CREATE LASTCHILD OF employment AS orgInfo NAMESPACE ind NAME 'OrgInfo';
					
					FOR industFor AS inRef.FIXferModLockRq.FIXferInfo.Sender.PersonInfo.[COUNTER_EMPLOYMENT].OrgInfo.IndustId[] DO
						CREATE LASTCHILD OF orgInfo AS industId NAMESPACE orgs NAME 'IndustId';
						
						SET industId.orgs:Org			=	industFor.Org;
						SET industId.orgs:IndustNum		=	industFor.IndustNum;
						SET industId.orgs:SubIndustrNum =   industFor.SubIndustrNum;
						SET industId.orgs:IsPrimary	    =   industFor.IsPrimary;						
					END FOR;
					
					SET orgInfo.orgs:Name 			=	orgFor.Name;	
					SET orgInfo.orgs:LegalName 		=	orgFor.LegalName;
					SET orgInfo.orgs:LegalNameEn 	=	orgFor.LegalNameEn;
					SET orgInfo.orgs:FullNameEn 	=	orgFor.FullNameEn;
					SET orgInfo.orgs:MnemonicName 	=	orgFor.MnemonicName;
					
					FOR compositeFor AS inRef.FIXferModLockRq.FIXferInfo.Sender.PersonInfo.[COUNTER_EMPLOYMENT].OrgInfo.CompositeContactInfo[] DO
						CREATE LASTCHILD OF orgInfo AS composite NAMESPACE orgs NAME 'CompositeContactInfo';
						
						SET composite.ca:ContactInfoType	=  compositeFor.ContactInfoType;
						
						FOR contactFor AS inRef.FIXferModLockRq.FIXferInfo.Sender.PersonInfo.[COUNTER_EMPLOYMENT].OrgInfo.CompositeContactInfo.ContactInfo[] DO
							CREATE LASTCHILD OF composite AS contactInfo NAMESPACE ca NAME 'ContactInfo';
							
							SET contactInfo.ca:ContactPref		=	contactFor.ContactPref;
							SET contactInfo.ca:PrefTimeStart	=	contactFor.PrefTimeStart;
							SET contactInfo.ca:PrefTimeEnd		=	contactFor.PrefTimeEnd;
							
							FOR phoneFor AS inRef.FIXferModLockRq.FIXferInfo.Sender.PersonInfo.[COUNTER_EMPLOYMENT].OrgInfo.CompositeContactInfo.ContactInfo.PhoneNum[] DO		
								CREATE LASTCHILD OF contactInfo AS general NAMESPACE ca NAME 'PhoneNum';
								
								SET general.ca:PhoneType		=	phoneFor.PhoneType;
								SET general.ca:Phone			=	phoneFor.Phone;
								SET general.ca:PhoneCode		=	phoneFor.PhoneCode;
								SET general.ca:PhoneOperName	=	phoneFor.PhoneOperName;								
							END FOR;
							
							SET contactInfo.ca:ContactName		=	contactFor.ContactName;
							SET contactInfo.ca:EmailAddr		=	contactFor.EmailAddr;
							SET contactInfo.ca:URL				=	contactFor.URL;
							
							FOR contactDataFor AS inRef.FIXferModLockRq.FIXferInfo.Sender.PersonInfo.[COUNTER_EMPLOYMENT].OrgInfo.CompositeContactInfo.ContactInfo.ContactData[] DO
								CREATE LASTCHILD OF contactInfo AS general NAMESPACE ca NAME 'ContactData';
								
								SET general.ca:ContactType		=	contactDataFor.ContactType;
								SET general.ca:ContactValue		=	contactDataFor.ContactValue;
								SET general.ca:PrefTimeStart	=	contactDataFor.PrefTimeStart;
								SET general.ca:PrefTimeEnd		=	contactDataFor.PrefTimeEnd;
							END FOR;
							
							FOR postAddrFor AS inRef.FIXferModLockRq.FIXferInfo.Sender.PersonInfo.[COUNTER_EMPLOYMENT].OrgInfo.CompositeContactInfo.ContactInfo.PostAddr[] DO
								CREATE LASTCHILD OF contactInfo AS general NAMESPACE ca NAME 'PostAddr';
								
								SET general.ca:Addr1			=	postAddrFor.Addr1;
								SET general.ca:Addr2			=	postAddrFor.Addr2;
								SET general.ca:Addr3			=	postAddrFor.Addr3;
								SET general.ca:Addr4			=	postAddrFor.Addr4;
								SET general.ca:City				=	postAddrFor.City;
								SET general.ca:CityCode			=	postAddrFor.CityCode;
								SET general.ca:StateProv		=	postAddrFor.StateProv;
								SET general.ca:StateProvCode	=	postAddrFor.StateProvCode;
								SET general.ca:Area				=	postAddrFor.Area;
								SET general.ca:AreaCode			=	postAddrFor.AreaCode;
								SET general.ca:PostalCode		=	postAddrFor.PostalCode;
								SET general.ca:Country		    =	postAddrFor.Country;
								SET general.ca:CountryCode	    =	postAddrFor.CountryCode;
								SET general.ca:AddrType		    =	postAddrFor.AddrType;

---								SET general.ca:StartDt		    =	postAddrFor.StartDt;
---								SET general.ca:EndDt		    =	postAddrFor.EndDt;

								IF FIELDVALUE(postAddrFor.StartDt) <> '' THEN
		 				            SET varStartDt			    = 	FIELDVALUE(postAddrFor.StartDt);
									SET general.ca:StartDt		= 	SUBSTRING(varStartDt FROM 1 FOR 10);
								END IF;
		
								IF FIELDVALUE(postAddrFor.EndDt) <> '' THEN
									SET varEndDt		        = 	FIELDVALUE(postAddrFor.EndDt);
									SET general.ca:EndDt		= 	SUBSTRING(varEndDt FROM 1 FOR 10);
								END IF;

								SET general.ca:DistrictCode	    =	postAddrFor.DistrictCode;
								SET general.ca:District		    =	postAddrFor.District;
								
								SET varPlaceCode		        = 	FIELDVALUE(postAddrFor.PlaceCode);
		                        IF varPlaceCode <> '' THEN
						          SET general.ca:PlaceCode       =   varPlaceCode;
		                        END IF;   
								
								SET general.ca:Place		    =	postAddrFor.Place;
								SET general.ca:StreetCode	    =	postAddrFor.StreetCode;
								SET general.ca:Street		    =	postAddrFor.Street;
								SET general.ca:House		    =	postAddrFor.House;
								SET general.ca:Corpus		    =	postAddrFor.Corpus;
								SET general.ca:Building		    =	postAddrFor.Building;
								SET general.ca:Flat			    =	postAddrFor.Flat;
								SET general.ca:Office		    =	postAddrFor.Office;
								SET general.ca:RusKLADR	   	 	=	postAddrFor.RusKLADR;
								SET general.ca:AddrStatus	    =	postAddrFor.AddrStatus;
							END FOR;
							
							SET contactInfo.ca:ProviderCode				=	contactFor.ProviderCode;
							
						END FOR;						
												
					END FOR;
					
					DECLARE licensesInfo REFERENCE TO orgInfo;
					CREATE LASTCHILD OF orgInfo AS licensesInfo NAMESPACE orgs NAME 'Licenses';
					DECLARE licenseInfo REFERENCE TO orgInfo;
					
					FOR licenseFor AS inRef.FIXferModLockRq.FIXferInfo.Sender.PersonInfo.[COUNTER_EMPLOYMENT].OrgInfo.Licenses.LicenseInfo[] DO
						CREATE LASTCHILD OF licensesInfo AS licenseInfo NAMESPACE orgs NAME 'LicenseInfo';
						
						SET licenseInfo.orgs:LicenseType	=	licenseFor.LicenseType;
						SET licenseInfo.orgs:LicenseStatus	=	licenseFor.LicenseStatus;
						SET licenseInfo.orgs:LicenseSerie	=	licenseFor.LicenseSerie;
						SET licenseInfo.orgs:LicenseNum		=	licenseFor.LicenseNum;
						SET licenseInfo.orgs:LicenseIssueDt	=	licenseFor.LicenseIssueDt;
						SET licenseInfo.orgs:LicenseIssueBy	=	licenseFor.LicenseIssueBy;
						
					END FOR;
										
					SET orgInfo.orgs:TINInfo.ca:TINType 			=	orgFor.TINInfo.TINType;
					SET orgInfo.orgs:TINInfo.ca:TaxId	 			=	orgFor.TINInfo.TaxId;
					SET orgInfo.orgs:TINInfo.ca:CertCode 			=	orgFor.TINInfo.CertCode;	
					
					SET orgInfo.orgs:KIOInfo.ca:TINType 			=	orgFor.KIOInfo.TINType;
					SET orgInfo.orgs:KIOInfo.ca:TaxId	 			=	orgFor.KIOInfo.TaxId;
					SET orgInfo.orgs:KIOInfo.ca:CertCode 			=	orgFor.KIOInfo.CertCode;
					
					SET orgInfo.orgs:EstablishDt		 			=	orgFor.EstablishDt;
					SET orgInfo.orgs:NumEmployees		 			=	orgFor.NumEmployees;
					SET orgInfo.orgs:EmployerCode		 			=	orgFor.EmployerCode;
					
				END FOR;
				
				SET employment.ind:Occupation			=	inRef.FIXferModLockRq.FIXferInfo.Sender.PersonInfo.[COUNTER_EMPLOYMENT].Occupation;	 	
				
				SET employment.ind:Income.ca:Amt			=	inRef.FIXferModLockRq.FIXferInfo.Sender.PersonInfo.[COUNTER_EMPLOYMENT].Income.Amt;
				SET employment.ind:Income.ca:Reversal		=	inRef.FIXferModLockRq.FIXferInfo.Sender.PersonInfo.[COUNTER_EMPLOYMENT].Income.Reversal;
				SET employment.ind:Income.ca:CurCode		=	inRef.FIXferModLockRq.FIXferInfo.Sender.PersonInfo.[COUNTER_EMPLOYMENT].Income.CurCode;	
				SET employment.ind:Income.ca:CurRate		=	inRef.FIXferModLockRq.FIXferInfo.Sender.PersonInfo.[COUNTER_EMPLOYMENT].Income.CurRate;
				SET employment.ind:Income.ca:CurConvertRule	=	inRef.FIXferModLockRq.FIXferInfo.Sender.PersonInfo.[COUNTER_EMPLOYMENT].Income.CurConvertRule; 	
				
				SET employment.ind:JobTitle			=	inRef.FIXferModLockRq.FIXferInfo.Sender.PersonInfo.[COUNTER_EMPLOYMENT].JobTitle;	 
---				SET employment.ind:StartDt			=	inRef.FIXferModLockRq.FIXferInfo.Sender.PersonInfo.[COUNTER_EMPLOYMENT].StartDt;
---				SET employment.ind:EndDt			=	inRef.FIXferModLockRq.FIXferInfo.Sender.PersonInfo.[COUNTER_EMPLOYMENT].EndDt;
				
				IF FIELDVALUE(inRef.FIXferModLockRq.FIXferInfo.Sender.PersonInfo.[COUNTER_EMPLOYMENT].StartDt) <> '' THEN
					SET varStartDt			        = 	FIELDVALUE(inRef.FIXferModLockRq.FIXferInfo.Sender.PersonInfo.[COUNTER_EMPLOYMENT].StartDt);
					SET employment.ind:StartDt		= 	SUBSTRING(varStartDt FROM 1 FOR 10);
				END IF;
						
				IF FIELDVALUE(inRef.FIXferModLockRq.FIXferInfo.Sender.PersonInfo.[COUNTER_EMPLOYMENT].EndDt) <> '' THEN
					SET varEndDt		            =  	FIELDVALUE(inRef.FIXferModLockRq.FIXferInfo.Sender.PersonInfo.[COUNTER_EMPLOYMENT].EndDt);
					SET employment.ind:EndDt		= 	SUBSTRING(varEndDt FROM 1 FOR 10);
				END IF;
			END IF;
							
			SET COUNTER_EMPLOYMENT = COUNTER_EMPLOYMENT + 1;
		END WHILE;	
		
---		SET personInfo.ind:Gender							=  inRef.FIXferModLockRq.FIXferInfo.Sender.PersonInfo.Gender;
		
		IF COALESCE(FIELDVALUE(inRef.FIXferModLockRq.FIXferInfo.Sender.PersonInfo.Gender),'') <> '' THEN       
		   SET personInfo.ind:Gender       = inRef.FIXferModLockRq.FIXferInfo.Sender.PersonInfo.Gender;
		END IF;       
		
		SET personInfo.ind:MaritalStatus					=  inRef.FIXferModLockRq.FIXferInfo.Sender.PersonInfo.MaritalStatus;
		SET personInfo.ind:USAMilitaryRank					=  inRef.FIXferModLockRq.FIXferInfo.Sender.PersonInfo.USAMilitaryRank;
		SET personInfo.ind:Dependets						=  inRef.FIXferModLockRq.FIXferInfo.Sender.PersonInfo.Dependets;
		
		IF EXISTS(inRef.FIXferModLockRq.FIXferInfo.Sender.PersonInfo.Passport[]) THEN
			SET personInfo.ind:Passport.ind:PassportNumber		=  COALESCE(inRef.FIXferModLockRq.FIXferInfo.Sender.PersonInfo.Passport.PassportNumber,NULL);
			SET personInfo.ind:Passport.ind:DocSeries			=  COALESCE(inRef.FIXferModLockRq.FIXferInfo.Sender.PersonInfo.Passport.DocSeries, NULL);
			SET personInfo.ind:Passport.ind:PassportCountry		=  COALESCE(inRef.FIXferModLockRq.FIXferInfo.Sender.PersonInfo.Passport.PassportCountry, NULL);
			SET personInfo.ind:Passport.ind:IssueLoc			=  COALESCE(inRef.FIXferModLockRq.FIXferInfo.Sender.PersonInfo.Passport.IssueLoc, NULL);
			SET personInfo.ind:Passport.ind:IssDt				=  COALESCE(inRef.FIXferModLockRq.FIXferInfo.Sender.PersonInfo.Passport.IssDt, NULL);
---			SET personInfo.ind:Passport.ind:ExpDt				=  COALESCE(inRef.FIXferModLockRq.FIXferInfo.Sender.PersonInfo.Passport.ExpDt, NULL);

			IF COALESCE(FIELDVALUE(inRef.FIXferModLockRq.FIXferInfo.Sender.PersonInfo.Passport.ExpDt),'') <> '' THEN       
			   SET personInfo.ind:Passport.ind:ExpDt               = SUBSTRING(FIELDVALUE(inRef.FIXferModLockRq.FIXferInfo.Sender.PersonInfo.Passport.ExpDt) BEFORE 'T');
			END IF;       
		END IF;
		
		SET personInfo.ind:OEDCode							=  inRef.FIXferModLockRq.FIXferInfo.Sender.PersonInfo.OEDCode;
		SET personInfo.ind:"OEDInstitution_Type"			=  inRef.FIXferModLockRq.FIXferInfo.Sender.PersonInfo."OEDInstitution_Type";
		
		IF EXISTS(inRef.FIXferModLockRq.FIXferInfo.Sender.PersonInfo.GovIssueIdent[]) THEN
			SET personInfo.ind:GovIssueIdent.ind:GovIssueIdentType	=  COALESCE(inRef.FIXferModLockRq.FIXferInfo.Sender.PersonInfo.GovIssueIdent.GovIssueIdentType, NULL);
			SET personInfo.ind:GovIssueIdent.ind:IdentSerialNum  	=  COALESCE(inRef.FIXferModLockRq.FIXferInfo.Sender.PersonInfo.GovIssueIdent.IdentSerialNum, NULL);
			SET personInfo.ind:GovIssueIdent.ind:GovOrg			 	=  COALESCE(inRef.FIXferModLockRq.FIXferInfo.Sender.PersonInfo.GovIssueIdent.GovOrg, NULL);
			SET personInfo.ind:GovIssueIdent.ind:GovOrgName		 	=  COALESCE(inRef.FIXferModLockRq.FIXferInfo.Sender.PersonInfo.GovIssueIdent.GovOrgName, NULL);
			SET personInfo.ind:GovIssueIdent.ind:GovRank		  	=  COALESCE(inRef.FIXferModLockRq.FIXferInfo.Sender.PersonInfo.GovIssueIdent.GovRank, NULL);
			SET personInfo.ind:GovIssueIdent.ind:StateProv		 	=  COALESCE(inRef.FIXferModLockRq.FIXferInfo.Sender.PersonInfo.GovIssueIdent.StateProv, NULL);
			SET personInfo.ind:GovIssueIdent.ind:Country		 	=  COALESCE(inRef.FIXferModLockRq.FIXferInfo.Sender.PersonInfo.GovIssueIdent.Country, NULL);
			SET personInfo.ind:GovIssueIdent.ind:Desc			  	=  COALESCE(inRef.FIXferModLockRq.FIXferInfo.Sender.PersonInfo.GovIssueIdent.Desc, NULL);
			SET personInfo.ind:GovIssueIdent.ind:IssDt			  	=  COALESCE(inRef.FIXferModLockRq.FIXferInfo.Sender.PersonInfo.GovIssueIdent.IssDt, NULL);
--			SET personInfo.ind:GovIssueIdent.ind:ExpDt			  	=  COALESCE(inRef.FIXferModLockRq.FIXferInfo.Sender.PersonInfo.GovIssueIdent.ExpDt, NULL);

			IF COALESCE(FIELDVALUE(inRef.FIXferModLockRq.FIXferInfo.Sender.PersonInfo.GovIssueIdent.ExpDt),'') <> '' THEN       
			   SET personInfo.ind:GovIssueIdent.ind:ExpDt               = SUBSTRING(FIELDVALUE(inRef.FIXferModLockRq.FIXferInfo.Sender.PersonInfo.GovIssueIdent.ExpDt) BEFORE 'T');
			END IF;       
			
			SET personInfo.ind:GovIssueIdent.ind:IdentSerie		  	=  COALESCE(inRef.FIXferModLockRq.FIXferInfo.Sender.PersonInfo.GovIssueIdent.IdentSerie, NULL);
			SET personInfo.ind:GovIssueIdent.ind:GovOrgUnit		  	=  COALESCE(inRef.FIXferModLockRq.FIXferInfo.Sender.PersonInfo.GovIssueIdent.GovOrgUnit, NULL);
		END IF;
		
		IF EXISTS(inRef.FIXferModLockRq.FIXferInfo.Sender.PersonInfo.OtherIdentDoc[]) THEN
			SET personInfo.ind:OtherIdentDoc.ind:Desc			  	=  COALESCE(inRef.FIXferModLockRq.FIXferInfo.Sender.PersonInfo.OtherIdentDoc.Desc, NULL);
			SET personInfo.ind:OtherIdentDoc.ind:IdentSerialNum  	=  COALESCE(inRef.FIXferModLockRq.FIXferInfo.Sender.PersonInfo.OtherIdentDoc.IdentSerialNum, NULL);
			SET personInfo.ind:OtherIdentDoc.ind:Issuer			 	=  COALESCE(inRef.FIXferModLockRq.FIXferInfo.Sender.PersonInfo.OtherIdentDoc.Issuer, NULL);
			SET personInfo.ind:OtherIdentDoc.ind:IssueLoc		  	=  COALESCE(inRef.FIXferModLockRq.FIXferInfo.Sender.PersonInfo.OtherIdentDoc.IssueLoc, NULL);
			SET personInfo.ind:OtherIdentDoc.ind:IssDt			 	=  COALESCE(inRef.FIXferModLockRq.FIXferInfo.Sender.PersonInfo.OtherIdentDoc.IssDt, NULL);
---			SET personInfo.ind:OtherIdentDoc.ind:ExpDt			  	=  COALESCE(inRef.FIXferModLockRq.FIXferInfo.Sender.PersonInfo.OtherIdentDoc.ExpDt, NULL);

			IF COALESCE(FIELDVALUE(inRef.FIXferModLockRq.FIXferInfo.Sender.PersonInfo.OtherIdentDoc.ExpDt),'') <> '' THEN       
			   SET personInfo.ind:OtherIdentDoc.ind:ExpDt               = SUBSTRING(FIELDVALUE(inRef.FIXferModLockRq.FIXferInfo.Sender.PersonInfo.OtherIdentDoc.ExpDt) BEFORE 'T');
			END IF;       
		END IF;
		
		DECLARE identityCards REFERENCE TO personInfo;
		DECLARE identityCard REFERENCE TO identityCards;
		CREATE LASTCHILD OF personInfo AS identityCards NAMESPACE ind NAME 'IdentityCards';
		
		FOR identityFor AS inRef.FIXferModLockRq.FIXferInfo.Sender.PersonInfo.IdentityCards.IdentityCard[] DO
			
			CREATE LASTCHILD OF identityCards AS identityCard NAMESPACE ind NAME 'IdentityCard';
			
			SET identityCard.ind:IdType				=	identityFor.IdType;
			SET identityCard.ind:IdStatus			=	identityFor.IdStatus;
			SET identityCard.ind:IdSeries			=	identityFor.IdSeries;
			SET identityCard.ind:IdNum				=	identityFor.IdNum;
			SET identityCard.ind:IssueDt			=	identityFor.IssueDt;
			SET identityCard.ind:IssuedBy			=	identityFor.IssuedBy;
			SET identityCard.ind:Code				=	identityFor.Code;
			SET identityCard.ind:IssueLoc			=	identityFor.IssueLoc;
			SET identityCard.ind:IssuedCountry		=	identityFor.IssuedCountry;
--			SET identityCard.ind:IssuedRegionCode	=	identityFor.IssuedRegionCode;

			IF COALESCE(FIELDVALUE(identityFor.IssuedRegionCode),'') <> '' THEN       
			   SET identityCard.ind:IssuedRegionCode    = identityFor.IssuedRegionCode;       
			END IF;       
			
---			SET identityCard.ind:ExpDt				=	identityFor.ExpDt;

			IF COALESCE(FIELDVALUE(identityFor.ExpDt),'') <> '' THEN       
			   SET identityCard.ind:ExpDt               = SUBSTRING(FIELDVALUE(identityFor.ExpDt) BEFORE 'T');
			END IF;       
		END FOR;
		
		SET personInfo.ind:BirthPlace			  	=  inRef.FIXferModLockRq.FIXferInfo.Sender.PersonInfo.BirthPlace;
		SET personInfo.ind:Resident				  	=  inRef.FIXferModLockRq.FIXferInfo.Sender.PersonInfo.Resident;
		SET personInfo.ind:MilitaryDocFlag		  	=  inRef.FIXferModLockRq.FIXferInfo.Sender.PersonInfo.MilitaryDocFlag;
		SET personInfo.ind:Citizenship			  	=  inRef.FIXferModLockRq.FIXferInfo.Sender.PersonInfo.Citizenship;
		 
		/* OWNER */
		DECLARE owner REFERENCE TO fixferInfo;
		CREATE LASTCHILD OF fixferInfo AS owner NAMESPACE mtblitz NAME 'Owner';
		
		/* BankInfo */
		DECLARE bankInfo REFERENCE TO owner;
		CREATE LASTCHILD OF owner AS bankInfo NAMESPACE mtblitz NAME 'BankInfo';
		
		SET bankInfo.mtblitz:BankId  =  inRef.FIXferModLockRq.FIXferInfo.Owner.BankInfo.BankId;
		SET bankInfo.mtblitz:Country =  inRef.FIXferModLockRq.FIXferInfo.Owner.BankInfo.Country; 
		SET bankInfo.mtblitz:City    =  inRef.FIXferModLockRq.FIXferInfo.Owner.BankInfo.City;				
		
		/* RECEIVER */
		DECLARE receiver REFERENCE TO fixferInfo;
		CREATE LASTCHILD OF fixferInfo AS receiver NAMESPACE mtblitz NAME 'Receiver';
		
		/* PersonInfo */
		--DECLARE personInfo REFERENCE TO receiver;
		CREATE LASTCHILD OF receiver AS personInfo NAMESPACE mtblitz NAME 'PersonInfo';   
		
		SET personInfo.ind:NameAddrType  =  inRef.FIXferModLockRq.FIXferInfo.Receiver.PersonInfo.NameAddrType;
		SET personInfo.ind:FullName      =  inRef.FIXferModLockRq.FIXferInfo.Receiver.PersonInfo.FullName;
		
		
		IF EXISTS(inRef.FIXferModLockRq.FIXferInfo.Receiver.PersonInfo.PersonName[]) THEN
        	-- создаем PersonName с namespace iam внутри UserInfo
        	CREATE LASTCHILD OF personInfo AS personName NAMESPACE ind NAME 'PersonName';             
        	CALL FillSomeField(inRef.FIXferModLockRq.FIXferInfo.Receiver.PersonInfo.PersonName, personName, 'ind', 'LastName');
        	
        	SET personName.ind:FirstName	=	inRef.FIXferModLockRq.FIXferInfo.Receiver.PersonInfo.PersonName.FirstName;	
        	
        	IF EXISTS(inRef.FIXferModLockRq.FIXferInfo.Receiver.PersonInfo.PersonName[]) THEN
				CALL FillSomeField(inRef.FIXferModLockRq.FIXferInfo.Receiver.PersonInfo.PersonName, personName, 'ind', 'MiddleName');
			END IF;
        	
        	SET personName.ind:TitlePrefix	=	inRef.FIXferModLockRq.FIXferInfo.Receiver.PersonInfo.PersonName.TitlePrefix;	
        	SET personName.ind:NameSuffix	=	inRef.FIXferModLockRq.FIXferInfo.Receiver.PersonInfo.PersonName.NameSuffix;
        	SET personName.ind:Nickname		=	inRef.FIXferModLockRq.FIXferInfo.Receiver.PersonInfo.PersonName.Nickname;
        	SET personName.ind:LegalName	=	inRef.FIXferModLockRq.FIXferInfo.Receiver.PersonInfo.PersonName.LegalName;
        	
        END IF;		
		
		SET COUNT_CONTACTINFO = 1;
		--DECLARE ARRAY_CONTACTINFO INTEGER CARDINALITY(inRef.FIXferModLockRq.FIXferInfo.Receiver.PersonInfo.*[]);
		--DECLARE contactInfo REFERENCE TO personInfo;
		
		/* ContactInfo */
		WHILE COUNT_CONTACTINFO <= ARRAY_CONTACTINFO DO
			IF FIELDNAME(inRef.FIXferModLockRq.FIXferInfo.Receiver.PersonInfo.[COUNT_CONTACTINFO]) = 'ContactInfo' THEN
				CREATE LASTCHILD OF personInfo AS contactInfo NAMESPACE ind NAME 'ContactInfo';
				SET contactInfo.ca:ContactPref		=	FIELDVALUE(inRef.FIXferModLockRq.FIXferInfo.Receiver.PersonInfo.[COUNT_CONTACTINFO].ContactPref);
				SET contactInfo.ca:PrefTimeStart	=	FIELDVALUE(inRef.FIXferModLockRq.FIXferInfo.Receiver.PersonInfo.[COUNT_CONTACTINFO].PrefTimeStart);
				SET contactInfo.ca:PrefTimeEnd		=   FIELDVALUE(inRef.FIXferModLockRq.FIXferInfo.Receiver.PersonInfo.[COUNT_CONTACTINFO].PrefTimeEnd);
				
				DECLARE COUNT_PHONENUM INTEGER 1;
				DECLARE ARRAY_PHONENUM INTEGER CARDINALITY(inRef.FIXferModLockRq.FIXferInfo.Receiver.PersonInfo.[COUNT_CONTACTINFO].*[]);
 				DECLARE phoneNum REFERENCE TO contactInfo;
 				
 				WHILE COUNT_PHONENUM <= ARRAY_CONTACTINFO DO
 					IF FIELDNAME(inRef.FIXferModLockRq.FIXferInfo.Receiver.PersonInfo.[COUNT_CONTACTINFO].[COUNT_PHONENUM]) = 'PhoneNum' THEN
 						CREATE LASTCHILD OF contactInfo AS phoneNum NAMESPACE ca NAME 'PhoneNum';
 						
 						SET phoneNum.ca:PhoneType		=	FIELDVALUE(inRef.FIXferModLockRq.FIXferInfo.Receiver.PersonInfo.[COUNT_CONTACTINFO].[COUNT_PHONENUM].PhoneType);
 						SET phoneNum.ca:Phone			= 	FIELDVALUE(inRef.FIXferModLockRq.FIXferInfo.Receiver.PersonInfo.[COUNT_CONTACTINFO].[COUNT_PHONENUM].Phone);
 						SET phoneNum.ca:PhoneCode   	=   FIELDVALUE(inRef.FIXferModLockRq.FIXferInfo.Receiver.PersonInfo.[COUNT_CONTACTINFO].[COUNT_PHONENUM].PhoneCode);
 						SET phoneNum.ca:PhoneOperName   =   FIELDVALUE(inRef.FIXferModLockRq.FIXferInfo.Receiver.PersonInfo.[COUNT_CONTACTINFO].[COUNT_PHONENUM].PhoneOperName);
 						
 					END IF;	
 					SET COUNT_PHONENUM = COUNT_PHONENUM + 1; 					
 				END WHILE;
 				
 				SET contactInfo.ca:ContactName	=	FIELDVALUE(inRef.FIXferModLockRq.FIXferInfo.Receiver.PersonInfo.[COUNT_CONTACTINFO].ContactName);
 				SET contactInfo.ca:EmailAddr	=	FIELDVALUE(inRef.FIXferModLockRq.FIXferInfo.Receiver.PersonInfo.[COUNT_CONTACTINFO].EmailAddr);
 				SET contactInfo.ca:URL			=	FIELDVALUE(inRef.FIXferModLockRq.FIXferInfo.Receiver.PersonInfo.[COUNT_CONTACTINFO].URL);
 				
 				DECLARE COUNT_CONTACTDATA INTEGER 1;
 				DECLARE ARRAY_CONTACTDATA INTEGER CARDINALITY(inRef.FIXferModLockRq.FIXferInfo.Receiver.PersonInfo.[COUNT_CONTACTINFO].*[]);
 				DECLARE contactData REFERENCE TO contactInfo;
 				
 				WHILE COUNT_CONTACTDATA <= ARRAY_CONTACTDATA DO
 					IF FIELDNAME(inRef.FIXferModLockRq.FIXferInfo.Receiver.PersonInfo.[COUNT_CONTACTINFO].[COUNT_CONTACTDATA]) = 'ContactData' THEN
 						CREATE LASTCHILD OF contactInfo AS contactData NAMESPACE ca NAME 'ContactData';
 						
 						SET contactData.ca:ContactType		=  FIELDVALUE(inRef.FIXferModLockRq.FIXferInfo.Receiver.PersonInfo.[COUNT_CONTACTINFO].[COUNT_CONTACTDATA].ContactType);
 						SET contactData.ca:ContactValue		=  FIELDVALUE(inRef.FIXferModLockRq.FIXferInfo.Receiver.PersonInfo.[COUNT_CONTACTINFO].[COUNT_CONTACTDATA].ContactValue);
 						SET contactData.ca:PrefTimeStart	=  FIELDVALUE(inRef.FIXferModLockRq.FIXferInfo.Receiver.PersonInfo.[COUNT_CONTACTINFO].[COUNT_CONTACTDATA].PrefTimeStart);
 						SET contactData.ca:PrefTimeEnd		=  FIELDVALUE(inRef.FIXferModLockRq.FIXferInfo.Receiver.PersonInfo.[COUNT_CONTACTINFO].[COUNT_CONTACTDATA].PrefTimeEnd);
 							
 					END IF;	
 					SET COUNT_CONTACTDATA = COUNT_CONTACTDATA + 1;
 				END WHILE;
 				
 				DECLARE COUNT_POSTADDR INTEGER 1;
				DECLARE postAddr REFERENCE TO contactInfo;
				
				WHILE COUNT_POSTADDR <= ARRAY_CONTACTDATA DO
					IF FIELDNAME(inRef.FIXferModLockRq.FIXferInfo.Receiver.PersonInfo.[COUNT_CONTACTINFO].[COUNT_POSTADDR]) = 'PostAddr' THEN
						CREATE LASTCHILD OF contactInfo AS postAddr NAMESPACE ca NAME 'PostAddr';
						
						SET postAddr.ca:Addr1			=	FIELDVALUE(inRef.FIXferModLockRq.FIXferInfo.Receiver.PersonInfo.[COUNT_CONTACTINFO].[COUNT_POSTADDR].Addr1);  
						SET postAddr.ca:Addr2			=	FIELDVALUE(inRef.FIXferModLockRq.FIXferInfo.Receiver.PersonInfo.[COUNT_CONTACTINFO].[COUNT_POSTADDR].Addr2);  
						SET postAddr.ca:Addr3			=	FIELDVALUE(inRef.FIXferModLockRq.FIXferInfo.Receiver.PersonInfo.[COUNT_CONTACTINFO].[COUNT_POSTADDR].Addr3);  
						SET postAddr.ca:Addr4			=	FIELDVALUE(inRef.FIXferModLockRq.FIXferInfo.Receiver.PersonInfo.[COUNT_CONTACTINFO].[COUNT_POSTADDR].Addr4);
						SET postAddr.ca:City			=	FIELDVALUE(inRef.FIXferModLockRq.FIXferInfo.Receiver.PersonInfo.[COUNT_CONTACTINFO].[COUNT_POSTADDR].City);    
						SET postAddr.ca:CityCode		=	FIELDVALUE(inRef.FIXferModLockRq.FIXferInfo.Receiver.PersonInfo.[COUNT_CONTACTINFO].[COUNT_POSTADDR].CityCode);
						SET postAddr.ca:StateProv		=	FIELDVALUE(inRef.FIXferModLockRq.FIXferInfo.Receiver.PersonInfo.[COUNT_CONTACTINFO].[COUNT_POSTADDR].StateProv);
						SET postAddr.ca:StateProvCode	=	FIELDVALUE(inRef.FIXferModLockRq.FIXferInfo.Receiver.PersonInfo.[COUNT_CONTACTINFO].[COUNT_POSTADDR].StateProvCode);
						SET postAddr.ca:Area			= 	FIELDVALUE(inRef.FIXferModLockRq.FIXferInfo.Receiver.PersonInfo.[COUNT_CONTACTINFO].[COUNT_POSTADDR].Area);
						SET postAddr.ca:AreaCode		= 	FIELDVALUE(inRef.FIXferModLockRq.FIXferInfo.Receiver.PersonInfo.[COUNT_CONTACTINFO].[COUNT_POSTADDR].AreaCode);
						SET postAddr.ca:PostalCode		= 	FIELDVALUE(inRef.FIXferModLockRq.FIXferInfo.Receiver.PersonInfo.[COUNT_CONTACTINFO].[COUNT_POSTADDR].PostalCode);
						SET postAddr.ca:Country			= 	FIELDVALUE(inRef.FIXferModLockRq.FIXferInfo.Receiver.PersonInfo.[COUNT_CONTACTINFO].[COUNT_POSTADDR].Country);
						SET postAddr.ca:CountryCode		= 	FIELDVALUE(inRef.FIXferModLockRq.FIXferInfo.Receiver.PersonInfo.[COUNT_CONTACTINFO].[COUNT_POSTADDR].CountryCode);
						SET postAddr.ca:AddrType		= 	FIELDVALUE(inRef.FIXferModLockRq.FIXferInfo.Receiver.PersonInfo.[COUNT_CONTACTINFO].[COUNT_POSTADDR].AddrType);      

--						SET postAddr.ca:StartDt			= 	FIELDVALUE(inRef.FIXferModLockRq.FIXferInfo.Receiver.PersonInfo.[COUNT_CONTACTINFO].[COUNT_POSTADDR].StartDt);
---						SET postAddr.ca:EndDt			= 	FIELDVALUE(inRef.FIXferModLockRq.FIXferInfo.Receiver.PersonInfo.[COUNT_CONTACTINFO].[COUNT_POSTADDR].EndDt);

						IF FIELDVALUE(inRef.FIXferModLockRq.FIXferInfo.Receiver.PersonInfo.[COUNT_CONTACTINFO].[COUNT_POSTADDR].StartDt) <> '' THEN
							SET varStartDt			    = 	FIELDVALUE(inRef.FIXferModLockRq.FIXferInfo.Receiver.PersonInfo.[COUNT_CONTACTINFO].[COUNT_POSTADDR].StartDt);
							SET postAddr.ca:StartDt		= 	SUBSTRING(varStartDt FROM 1 FOR 10);
						END IF;
								
						IF FIELDVALUE(inRef.FIXferModLockRq.FIXferInfo.Receiver.PersonInfo.[COUNT_CONTACTINFO].[COUNT_POSTADDR].EndDt) <> '' THEN
							SET varEndDt		        =  	FIELDVALUE(inRef.FIXferModLockRq.FIXferInfo.Receiver.PersonInfo.[COUNT_CONTACTINFO].[COUNT_POSTADDR].EndDt);
							SET postAddr.ca:EndDt		= 	SUBSTRING(varEndDt FROM 1 FOR 10);
						END IF;

						SET postAddr.ca:DistrictCode	= 	FIELDVALUE(inRef.FIXferModLockRq.FIXferInfo.Receiver.PersonInfo.[COUNT_CONTACTINFO].[COUNT_POSTADDR].DistrictCode);
						SET postAddr.ca:District		= 	FIELDVALUE(inRef.FIXferModLockRq.FIXferInfo.Receiver.PersonInfo.[COUNT_CONTACTINFO].[COUNT_POSTADDR].District);
						---SET postAddr.ca:PlaceCode		= 	FIELDVALUE(inRef.FIXferModLockRq.FIXferInfo.Receiver.PersonInfo.[COUNT_CONTACTINFO].[COUNT_POSTADDR].PlaceCode);
						
						SET varPlaceCode		        = 	FIELDVALUE(inRef.FIXferModLockRq.FIXferInfo.Receiver.PersonInfo.[COUNT_CONTACTINFO].[COUNT_POSTADDR].PlaceCode);
						IF varPlaceCode <> '' THEN
							SET postAddr.ca:PlaceCode       =   varPlaceCode;
						END IF;   
						
						SET postAddr.ca:Place			= 	FIELDVALUE(inRef.FIXferModLockRq.FIXferInfo.Receiver.PersonInfo.[COUNT_CONTACTINFO].[COUNT_POSTADDR].Place);
						SET postAddr.ca:StreetCode		= 	FIELDVALUE(inRef.FIXferModLockRq.FIXferInfo.Receiver.PersonInfo.[COUNT_CONTACTINFO].[COUNT_POSTADDR].StreetCode);
						SET postAddr.ca:Street			= 	FIELDVALUE(inRef.FIXferModLockRq.FIXferInfo.Receiver.PersonInfo.[COUNT_CONTACTINFO].[COUNT_POSTADDR].Street);
						SET postAddr.ca:House			= 	FIELDVALUE(inRef.FIXferModLockRq.FIXferInfo.Receiver.PersonInfo.[COUNT_CONTACTINFO].[COUNT_POSTADDR].House);
						SET postAddr.ca:Corpus			= 	FIELDVALUE(inRef.FIXferModLockRq.FIXferInfo.Receiver.PersonInfo.[COUNT_CONTACTINFO].[COUNT_POSTADDR].Corpus);
						SET postAddr.ca:Building		= 	FIELDVALUE(inRef.FIXferModLockRq.FIXferInfo.Receiver.PersonInfo.[COUNT_CONTACTINFO].[COUNT_POSTADDR].Building);
						SET postAddr.ca:Flat			= 	FIELDVALUE(inRef.FIXferModLockRq.FIXferInfo.Receiver.PersonInfo.[COUNT_CONTACTINFO].[COUNT_POSTADDR].Flat);
						SET postAddr.ca:Office			= 	FIELDVALUE(inRef.FIXferModLockRq.FIXferInfo.Receiver.PersonInfo.[COUNT_CONTACTINFO].[COUNT_POSTADDR].Office);
						SET postAddr.ca:RusKLADR		= 	FIELDVALUE(inRef.FIXferModLockRq.FIXferInfo.Receiver.PersonInfo.[COUNT_CONTACTINFO].[COUNT_POSTADDR].RusKLADR);
						SET postAddr.ca:AddrStatus		= 	FIELDVALUE(inRef.FIXferModLockRq.FIXferInfo.Receiver.PersonInfo.[COUNT_CONTACTINFO].[COUNT_POSTADDR].AddrStatus);
						
					END IF;
					SET COUNT_POSTADDR = COUNT_POSTADDR + 1;	
				END WHILE;		
 				
 				SET contactInfo.ca:ProviderCode			=	FIELDVALUE(inRef.FIXferModLockRq.FIXferInfo.Receiver.PersonInfo.[COUNT_CONTACTINFO].ProviderCode);
 				
			END IF;	
			SET COUNT_CONTACTINFO = COUNT_CONTACTINFO + 1;
		END WHILE;
		
		/* PersonInfo */
		SET personInfo.ind:TINInfo.ca:TINType   =  inRef.FIXferModLockRq.FIXferInfo.Receiver.PersonInfo.TINInfo.TINType;
		SET personInfo.ind:TINInfo.ca:TaxId  	=  inRef.FIXferModLockRq.FIXferInfo.Receiver.PersonInfo.TINInfo.TaxId;
		SET personInfo.ind:TINInfo.ca:CertCode  =  inRef.FIXferModLockRq.FIXferInfo.Receiver.PersonInfo.TINInfo.CertCode;
		
		IF COALESCE(FIELDVALUE(inRef.FIXferModLockRq.FIXferInfo.Receiver.PersonInfo.BirthDt),'') <> '' THEN
			SET personInfo.ind:BirthDt				=  SUBSTRING(FIELDVALUE(inRef.FIXferModLockRq.FIXferInfo.Receiver.PersonInfo.BirthDt) FROM 1 FOR 10);
		END IF;
		
		IF EXISTS(inRef.FIXferModLockRq.FIXferInfo.Receiver.PersonInfo.DriversLicense[]) THEN 
			SET personInfo.ind:DriversLicense.ind:LicenseNum		=  COALESCE(inRef.FIXferModLockRq.FIXferInfo.Receiver.PersonInfo.DriversLicense.LicenseNum, NULL);
			SET personInfo.ind:DriversLicense.ind:StateProv			=  COALESCE(inRef.FIXferModLockRq.FIXferInfo.Receiver.PersonInfo.DriversLicense.StateProv, NULL);
			SET personInfo.ind:DriversLicense.ind:Country			=  COALESCE(inRef.FIXferModLockRq.FIXferInfo.Receiver.PersonInfo.DriversLicense.Country, NULL);
		END IF;
		
		SET personInfo.ind:MotherMaidenName						=  inRef.FIXferModLockRq.FIXferInfo.Receiver.PersonInfo.MotherMaidenName;
		SET personInfo.ind:SpouseName							=  inRef.FIXferModLockRq.FIXferInfo.Receiver.PersonInfo.SpouseName;
		
		SET COUNTER_EMPLOYMENT = 1;
		--DECLARE employment REFERENCE TO personInfo;
		
		WHILE COUNTER_EMPLOYMENT <= ARRAY_CONTACTINFO DO
			IF FIELDNAME(inRef.FIXferModLockRq.FIXferInfo.Receiver.PersonInfo.[COUNTER_EMPLOYMENT]) = 'EmploymentHistory' THEN
				CREATE LASTCHILD OF personInfo AS employment NAMESPACE ind NAME 'EmploymentHistory';
				
				SET employment.ind:EmploymentStatus		=	inRef.FIXferModLockRq.FIXferInfo.Receiver.PersonInfo.[COUNTER_EMPLOYMENT].EmploymentStatus;				

				DECLARE orgInfo REFERENCE TO employment;
				DECLARE industId REFERENCE TO employment;
				DECLARE composite REFERENCE TO employment;
				DECLARE general REFERENCE TO employment;
								
				FOR orgFor AS inRef.FIXferModLockRq.FIXferInfo.Receiver.PersonInfo.[COUNTER_EMPLOYMENT].OrgInfo[] DO
					CREATE LASTCHILD OF employment AS orgInfo NAMESPACE ind NAME 'OrgInfo';
					
					FOR industFor AS inRef.FIXferModLockRq.FIXferInfo.Receiver.PersonInfo.[COUNTER_EMPLOYMENT].OrgInfo.IndustId[] DO
						CREATE LASTCHILD OF orgInfo AS industId NAMESPACE orgs NAME 'IndustId';
						
						SET industId.orgs:Org			=	industFor.Org;
						SET industId.orgs:IndustNum		=	industFor.IndustNum;
						SET industId.orgs:SubIndustrNum =   industFor.SubIndustrNum;
						SET industId.orgs:IsPrimary	    =   industFor.IsPrimary;						
					END FOR;
					
					SET orgInfo.orgs:Name 			=	orgFor.Name;	
					SET orgInfo.orgs:LegalName 		=	orgFor.LegalName;
					SET orgInfo.orgs:LegalNameEn 	=	orgFor.LegalNameEn;
					SET orgInfo.orgs:FullNameEn 	=	orgFor.FullNameEn;
					SET orgInfo.orgs:MnemonicName 	=	orgFor.MnemonicName;
					
					FOR compositeFor AS inRef.FIXferModLockRq.FIXferInfo.Receiver.PersonInfo.[COUNTER_EMPLOYMENT].OrgInfo.CompositeContactInfo[] DO
						CREATE LASTCHILD OF orgInfo AS composite NAMESPACE orgs NAME 'CompositeContactInfo';
						
						SET composite.ca:ContactInfoType	=  compositeFor.ContactInfoType;
						
						FOR contactFor AS inRef.FIXferModLockRq.FIXferInfo.Receiver.PersonInfo.[COUNTER_EMPLOYMENT].OrgInfo.CompositeContactInfo.ContactInfo[] DO
							CREATE LASTCHILD OF composite AS contactInfo NAMESPACE ca NAME 'ContactInfo';
							
							SET contactInfo.ca:ContactPref		=	contactFor.ContactPref;
							SET contactInfo.ca:PrefTimeStart	=	contactFor.PrefTimeStart;
							SET contactInfo.ca:PrefTimeEnd		=	contactFor.PrefTimeEnd;
							
							FOR phoneFor AS inRef.FIXferModLockRq.FIXferInfo.Receiver.PersonInfo.[COUNTER_EMPLOYMENT].OrgInfo.CompositeContactInfo.ContactInfo.PhoneNum[] DO		
								CREATE LASTCHILD OF contactInfo AS general NAMESPACE ca NAME 'PhoneNum';
								
								SET general.ca:PhoneType		=	phoneFor.PhoneType;
								SET general.ca:Phone			=	phoneFor.Phone;
								SET general.ca:PhoneCode		=	phoneFor.PhoneCode;
								SET general.ca:PhoneOperName	=	phoneFor.PhoneOperName;								
							END FOR;
							
							SET contactInfo.ca:ContactName		=	contactFor.ContactName;
							SET contactInfo.ca:EmailAddr		=	contactFor.EmailAddr;
							SET contactInfo.ca:URL				=	contactFor.URL;
							
							FOR contactDataFor AS inRef.FIXferModLockRq.FIXferInfo.Receiver.PersonInfo.[COUNTER_EMPLOYMENT].OrgInfo.CompositeContactInfo.ContactInfo.ContactData[] DO
								CREATE LASTCHILD OF contactInfo AS general NAMESPACE ca NAME 'ContactData';
								
								SET general.ca:ContactType		=	contactDataFor.ContactType;
								SET general.ca:ContactValue		=	contactDataFor.ContactValue;
								SET general.ca:PrefTimeStart	=	contactDataFor.PrefTimeStart;
								SET general.ca:PrefTimeEnd		=	contactDataFor.PrefTimeEnd;
							END FOR;
							
							FOR postAddrFor AS inRef.FIXferModLockRq.FIXferInfo.Receiver.PersonInfo.[COUNTER_EMPLOYMENT].OrgInfo.CompositeContactInfo.ContactInfo.PostAddr[] DO
								CREATE LASTCHILD OF contactInfo AS general NAMESPACE ca NAME 'PostAddr';
								
								SET general.ca:Addr1			=	postAddrFor.Addr1;
								SET general.ca:Addr2			=	postAddrFor.Addr2;
								SET general.ca:Addr3			=	postAddrFor.Addr3;
								SET general.ca:Addr4			=	postAddrFor.Addr4;
								SET general.ca:City				=	postAddrFor.City;
								SET general.ca:CityCode			=	postAddrFor.CityCode;
								SET general.ca:StateProv		=	postAddrFor.StateProv;
								SET general.ca:StateProvCode	=	postAddrFor.StateProvCode;
								SET general.ca:Area				=	postAddrFor.Area;
								SET general.ca:AreaCode			=	postAddrFor.AreaCode;
								SET general.ca:PostalCode		=	postAddrFor.PostalCode;
								SET general.ca:Country		    =	postAddrFor.Country;
								SET general.ca:CountryCode	    =	postAddrFor.CountryCode;
								SET general.ca:AddrType		    =	postAddrFor.AddrType;

---								SET general.ca:StartDt		    =	postAddrFor.StartDt;
---  							SET general.ca:EndDt		    =	postAddrFor.EndDt;
								
								IF FIELDVALUE(postAddrFor.StartDt) <> '' THEN
									SET varStartDt			    = 	FIELDVALUE(postAddrFor.StartDt);
									SET general.ca:StartDt		= 	SUBSTRING(varStartDt FROM 1 FOR 10);
								END IF;
										
								IF FIELDVALUE(postAddrFor.EndDt) <> '' THEN
									SET varEndDt		        =  	FIELDVALUE(postAddrFor.EndDt);
									SET general.ca:EndDt		= 	SUBSTRING(varEndDt FROM 1 FOR 10);
								END IF;
								
								SET general.ca:DistrictCode	    =	postAddrFor.DistrictCode;
								SET general.ca:District		    =	postAddrFor.District;
--								SET general.ca:PlaceCode	    =	postAddrFor.PlaceCode;

								SET varPlaceCode		        = 	FIELDVALUE(postAddrFor.PlaceCode);
								IF varPlaceCode <> '' THEN
									SET general.ca:PlaceCode       =   varPlaceCode;
								END IF;   
								
								SET general.ca:Place		    =	postAddrFor.Place;
								SET general.ca:StreetCode	    =	postAddrFor.StreetCode;
								SET general.ca:Street		    =	postAddrFor.Street;
								SET general.ca:House		    =	postAddrFor.House;
								SET general.ca:Corpus		    =	postAddrFor.Corpus;
								SET general.ca:Building		    =	postAddrFor.Building;
								SET general.ca:Flat			    =	postAddrFor.Flat;
								SET general.ca:Office		    =	postAddrFor.Office;
								SET general.ca:RusKLADR	   	 	=	postAddrFor.RusKLADR;
								SET general.ca:AddrStatus	    =	postAddrFor.AddrStatus;
							END FOR;
							
							SET contactInfo.ca:ProviderCode				=	contactFor.ProviderCode;
							
						END FOR;						
												
					END FOR;
					
					DECLARE licensesInfo REFERENCE TO orgInfo;
					CREATE LASTCHILD OF orgInfo AS licensesInfo NAMESPACE orgs NAME 'Licenses';
					DECLARE licenseInfo REFERENCE TO orgInfo;
					
					FOR licenseFor AS inRef.FIXferModLockRq.FIXferInfo.Receiver.PersonInfo.[COUNTER_EMPLOYMENT].OrgInfo.Licenses.LicenseInfo[] DO
						CREATE LASTCHILD OF licensesInfo AS licenseInfo NAMESPACE orgs NAME 'LicenseInfo';
						
						SET licenseInfo.orgs:LicenseType	=	licenseFor.LicenseType;
						SET licenseInfo.orgs:LicenseStatus	=	licenseFor.LicenseStatus;
						SET licenseInfo.orgs:LicenseSerie	=	licenseFor.LicenseSerie;
						SET licenseInfo.orgs:LicenseNum		=	licenseFor.LicenseNum;
						SET licenseInfo.orgs:LicenseIssueDt	=	licenseFor.LicenseIssueDt;
						SET licenseInfo.orgs:LicenseIssueBy	=	licenseFor.LicenseIssueBy;
						
					END FOR;
										
					SET orgInfo.orgs:TINInfo.ca:TINType 			=	orgFor.TINInfo.TINType;
					SET orgInfo.orgs:TINInfo.ca:TaxId	 			=	orgFor.TINInfo.TaxId;
					SET orgInfo.orgs:TINInfo.ca:CertCode 			=	orgFor.TINInfo.CertCode;	
					
					SET orgInfo.orgs:KIOInfo.ca:TINType 			=	orgFor.KIOInfo.TINType;
					SET orgInfo.orgs:KIOInfo.ca:TaxId	 			=	orgFor.KIOInfo.TaxId;
					SET orgInfo.orgs:KIOInfo.ca:CertCode 			=	orgFor.KIOInfo.CertCode;
					
					SET orgInfo.orgs:EstablishDt		 			=	orgFor.EstablishDt;
					SET orgInfo.orgs:NumEmployees		 			=	orgFor.NumEmployees;
					SET orgInfo.orgs:EmployerCode		 			=	orgFor.EmployerCode;
					
				END FOR;
				
				SET employment.ind:Occupation			=	inRef.FIXferModLockRq.FIXferInfo.Receiver.PersonInfo.[COUNTER_EMPLOYMENT].Occupation;	 	
				
				SET employment.ind:Income.ca:Amt			=	inRef.FIXferModLockRq.FIXferInfo.Receiver.PersonInfo.[COUNTER_EMPLOYMENT].Income.Amt;
				SET employment.ind:Income.ca:Reversal		=	inRef.FIXferModLockRq.FIXferInfo.Receiver.PersonInfo.[COUNTER_EMPLOYMENT].Income.Reversal;
				SET employment.ind:Income.ca:CurCode		=	inRef.FIXferModLockRq.FIXferInfo.Receiver.PersonInfo.[COUNTER_EMPLOYMENT].Income.CurCode;	
				SET employment.ind:Income.ca:CurRate		=	inRef.FIXferModLockRq.FIXferInfo.Receiver.PersonInfo.[COUNTER_EMPLOYMENT].Income.CurRate;
				SET employment.ind:Income.ca:CurConvertRule	=	inRef.FIXferModLockRq.FIXferInfo.Receiver.PersonInfo.[COUNTER_EMPLOYMENT].Income.CurConvertRule; 	
				
				SET employment.ind:JobTitle			=	inRef.FIXferModLockRq.FIXferInfo.Receiver.PersonInfo.[COUNTER_EMPLOYMENT].JobTitle;	 
---				SET employment.ind:StartDt			=	inRef.FIXferModLockRq.FIXferInfo.Receiver.PersonInfo.[COUNTER_EMPLOYMENT].StartDt;
---				SET employment.ind:EndDt			=	inRef.FIXferModLockRq.FIXferInfo.Receiver.PersonInfo.[COUNTER_EMPLOYMENT].EndDt;
				
				IF FIELDVALUE(inRef.FIXferModLockRq.FIXferInfo.Receiver.PersonInfo.[COUNTER_EMPLOYMENT].StartDt) <> '' THEN
					SET varStartDt			        = 	FIELDVALUE(inRef.FIXferModLockRq.FIXferInfo.Receiver.PersonInfo.[COUNTER_EMPLOYMENT].StartDt);
					SET employment.ind:StartDt		= 	SUBSTRING(varStartDt FROM 1 FOR 10);
				END IF;
														
				IF FIELDVALUE(inRef.FIXferModLockRq.FIXferInfo.Receiver.PersonInfo.[COUNTER_EMPLOYMENT].EndDt) <> '' THEN
					SET varEndDt		            =  	FIELDVALUE(inRef.FIXferModLockRq.FIXferInfo.Receiver.PersonInfo.[COUNTER_EMPLOYMENT].EndDt);
					SET employment.ind:EndDt		= 	SUBSTRING(varEndDt FROM 1 FOR 10);
				END IF;
			END IF;
							
			SET COUNTER_EMPLOYMENT = COUNTER_EMPLOYMENT + 1;
		END WHILE;	
		
---		SET personInfo.ind:Gender							=  inRef.FIXferModLockRq.FIXferInfo.Receiver.PersonInfo.Gender;
		
		IF COALESCE(FIELDVALUE(inRef.FIXferModLockRq.FIXferInfo.Receiver.PersonInfo.Gender),'') <> '' THEN       
		   SET personInfo.ind:Gender       = inRef.FIXferModLockRq.FIXferInfo.Receiver.PersonInfo.Gender;
		END IF;       
		
		SET personInfo.ind:MaritalStatus					=  inRef.FIXferModLockRq.FIXferInfo.Receiver.PersonInfo.MaritalStatus;
		SET personInfo.ind:USAMilitaryRank					=  inRef.FIXferModLockRq.FIXferInfo.Receiver.PersonInfo.USAMilitaryRank;
		SET personInfo.ind:Dependets						=  inRef.FIXferModLockRq.FIXferInfo.Receiver.PersonInfo.Dependets;
		
		IF EXISTS(inRef.FIXferModLockRq.FIXferInfo.Receiver.PersonInfo.Passport[]) THEN
			SET personInfo.ind:Passport.ind:PassportNumber		=  COALESCE(inRef.FIXferModLockRq.FIXferInfo.Receiver.PersonInfo.Passport.PassportNumber,NULL);
			SET personInfo.ind:Passport.ind:DocSeries			=  COALESCE(inRef.FIXferModLockRq.FIXferInfo.Receiver.PersonInfo.Passport.DocSeries, NULL);
			SET personInfo.ind:Passport.ind:PassportCountry		=  COALESCE(inRef.FIXferModLockRq.FIXferInfo.Receiver.PersonInfo.Passport.PassportCountry, NULL);
			SET personInfo.ind:Passport.ind:IssueLoc			=  COALESCE(inRef.FIXferModLockRq.FIXferInfo.Receiver.PersonInfo.Passport.IssueLoc, NULL);
			SET personInfo.ind:Passport.ind:IssDt				=  COALESCE(inRef.FIXferModLockRq.FIXferInfo.Receiver.PersonInfo.Passport.IssDt, NULL);
---			SET personInfo.ind:Passport.ind:ExpDt				=  COALESCE(inRef.FIXferModLockRq.FIXferInfo.Receiver.PersonInfo.Passport.ExpDt, NULL);

			IF COALESCE(FIELDVALUE(inRef.FIXferModLockRq.FIXferInfo.Receiver.PersonInfo.Passport.ExpDt),'') <> '' THEN       
			   SET personInfo.ind:Passport.ind:ExpDt               = SUBSTRING(FIELDVALUE(inRef.FIXferModLockRq.FIXferInfo.Receiver.PersonInfo.Passport.ExpDt) BEFORE 'T');
			END IF;       
		END IF;
		
		SET personInfo.ind:OEDCode							=  inRef.FIXferModLockRq.FIXferInfo.Receiver.PersonInfo.OEDCode;
		SET personInfo.ind:"OEDInstitution_Type"			=  inRef.FIXferModLockRq.FIXferInfo.Receiver.PersonInfo."OEDInstitution_Type";
		
		IF EXISTS(inRef.FIXferModLockRq.FIXferInfo.Receiver.PersonInfo.GovIssueIdent[]) THEN
			SET personInfo.ind:GovIssueIdent.ind:GovIssueIdentType	=  COALESCE(inRef.FIXferModLockRq.FIXferInfo.Receiver.PersonInfo.GovIssueIdent.GovIssueIdentType, NULL);
			SET personInfo.ind:GovIssueIdent.ind:IdentSerialNum  	=  COALESCE(inRef.FIXferModLockRq.FIXferInfo.Receiver.PersonInfo.GovIssueIdent.IdentSerialNum, NULL);
			SET personInfo.ind:GovIssueIdent.ind:GovOrg			 	=  COALESCE(inRef.FIXferModLockRq.FIXferInfo.Receiver.PersonInfo.GovIssueIdent.GovOrg, NULL);
			SET personInfo.ind:GovIssueIdent.ind:GovOrgName		 	=  COALESCE(inRef.FIXferModLockRq.FIXferInfo.Receiver.PersonInfo.GovIssueIdent.GovOrgName, NULL);
			SET personInfo.ind:GovIssueIdent.ind:GovRank		  	=  COALESCE(inRef.FIXferModLockRq.FIXferInfo.Receiver.PersonInfo.GovIssueIdent.GovRank, NULL);
			SET personInfo.ind:GovIssueIdent.ind:StateProv		 	=  COALESCE(inRef.FIXferModLockRq.FIXferInfo.Receiver.PersonInfo.GovIssueIdent.StateProv, NULL);
			SET personInfo.ind:GovIssueIdent.ind:Country		 	=  COALESCE(inRef.FIXferModLockRq.FIXferInfo.Receiver.PersonInfo.GovIssueIdent.Country, NULL);
			SET personInfo.ind:GovIssueIdent.ind:Desc			  	=  COALESCE(inRef.FIXferModLockRq.FIXferInfo.Receiver.PersonInfo.GovIssueIdent.Desc, NULL);
			SET personInfo.ind:GovIssueIdent.ind:IssDt			  	=  COALESCE(inRef.FIXferModLockRq.FIXferInfo.Receiver.PersonInfo.GovIssueIdent.IssDt, NULL);
---			SET personInfo.ind:GovIssueIdent.ind:ExpDt			  	=  COALESCE(inRef.FIXferModLockRq.FIXferInfo.Receiver.PersonInfo.GovIssueIdent.ExpDt, NULL);

			IF COALESCE(FIELDVALUE(inRef.FIXferModLockRq.FIXferInfo.Receiver.PersonInfo.GovIssueIdent.ExpDt),'') <> '' THEN       
			   SET personInfo.ind:GovIssueIdent.ind:ExpDt               = SUBSTRING(FIELDVALUE(inRef.FIXferModLockRq.FIXferInfo.Receiver.PersonInfo.GovIssueIdent.ExpDt) BEFORE 'T');
			END IF;       
			
			SET personInfo.ind:GovIssueIdent.ind:IdentSerie		  	=  COALESCE(inRef.FIXferModLockRq.FIXferInfo.Receiver.PersonInfo.GovIssueIdent.IdentSerie, NULL);
			SET personInfo.ind:GovIssueIdent.ind:GovOrgUnit		  	=  COALESCE(inRef.FIXferModLockRq.FIXferInfo.Receiver.PersonInfo.GovIssueIdent.GovOrgUnit, NULL);
		END IF;
		
		IF EXISTS(inRef.FIXferModLockRq.FIXferInfo.Receiver.PersonInfo.OtherIdentDoc[]) THEN
			SET personInfo.ind:OtherIdentDoc.ind:Desc			  	=  COALESCE(inRef.FIXferModLockRq.FIXferInfo.Receiver.PersonInfo.OtherIdentDoc.Desc, NULL);
			SET personInfo.ind:OtherIdentDoc.ind:IdentSerialNum  	=  COALESCE(inRef.FIXferModLockRq.FIXferInfo.Receiver.PersonInfo.OtherIdentDoc.IdentSerialNum, NULL);
			SET personInfo.ind:OtherIdentDoc.ind:Issuer			 	=  COALESCE(inRef.FIXferModLockRq.FIXferInfo.Receiver.PersonInfo.OtherIdentDoc.Issuer, NULL);
			SET personInfo.ind:OtherIdentDoc.ind:IssueLoc		  	=  COALESCE(inRef.FIXferModLockRq.FIXferInfo.Receiver.PersonInfo.OtherIdentDoc.IssueLoc, NULL);
			SET personInfo.ind:OtherIdentDoc.ind:IssDt			 	=  COALESCE(inRef.FIXferModLockRq.FIXferInfo.Receiver.PersonInfo.OtherIdentDoc.IssDt, NULL);
---			SET personInfo.ind:OtherIdentDoc.ind:ExpDt			  	=  COALESCE(inRef.FIXferModLockRq.FIXferInfo.Receiver.PersonInfo.OtherIdentDoc.ExpDt, NULL);

			IF COALESCE(FIELDVALUE(inRef.FIXferModLockRq.FIXferInfo.Receiver.PersonInfo.OtherIdentDoc.ExpDt),'') <> '' THEN       
			   SET personInfo.ind:OtherIdentDoc.ind:ExpDt               = SUBSTRING(FIELDVALUE(inRef.FIXferModLockRq.FIXferInfo.Receiver.PersonInfo.OtherIdentDoc.ExpDt) BEFORE 'T');
			END IF;       
		END IF;
		
		--DECLARE identityCards REFERENCE TO personInfo;
		--DECLARE identityCard REFERENCE TO identityCards;
		CREATE LASTCHILD OF personInfo AS identityCards NAMESPACE ind NAME 'IdentityCards';
		
		FOR identityFor AS inRef.FIXferModLockRq.FIXferInfo.Receiver.PersonInfo.IdentityCards.IdentityCard[] DO
			
			CREATE LASTCHILD OF identityCards AS identityCard NAMESPACE ind NAME 'IdentityCard';
			
			SET identityCard.ind:IdType				=	identityFor.IdType;
			SET identityCard.ind:IdStatus			=	identityFor.IdStatus;
			SET identityCard.ind:IdSeries			=	identityFor.IdSeries;
			SET identityCard.ind:IdNum				=	identityFor.IdNum;
			SET identityCard.ind:IssueDt			=	identityFor.IssueDt;
			SET identityCard.ind:IssuedBy			=	identityFor.IssuedBy;
			SET identityCard.ind:Code				=	identityFor.Code;
			SET identityCard.ind:IssueLoc			=	identityFor.IssueLoc;
			SET identityCard.ind:IssuedCountry		=	identityFor.IssuedCountry;
---			SET identityCard.ind:IssuedRegionCode	=	identityFor.IssuedRegionCode;

			IF COALESCE(FIELDVALUE(identityFor.IssuedRegionCode),'') <> '' THEN       
			   SET identityCard.ind:IssuedRegionCode    = identityFor.IssuedRegionCode;       
			END IF;       
			
---			SET identityCard.ind:ExpDt				=	identityFor.ExpDt;	

			IF COALESCE(FIELDVALUE(identityFor.ExpDt),'') <> '' THEN       
			   SET identityCard.ind:ExpDt               = SUBSTRING(FIELDVALUE(identityFor.ExpDt) BEFORE 'T');
			END IF;       
		END FOR;
		
		SET personInfo.ind:BirthPlace			  	=  inRef.FIXferModLockRq.FIXferInfo.Receiver.PersonInfo.BirthPlace;
		SET personInfo.ind:Resident				  	=  inRef.FIXferModLockRq.FIXferInfo.Receiver.PersonInfo.Resident;
		SET personInfo.ind:MilitaryDocFlag		  	=  inRef.FIXferModLockRq.FIXferInfo.Receiver.PersonInfo.MilitaryDocFlag;
		SET personInfo.ind:Citizenship			  	=  inRef.FIXferModLockRq.FIXferInfo.Receiver.PersonInfo.Citizenship;
		
		SET fixferInfo.mtblitz:OrigDt				=  inRef.FIXferModLockRq.FIXferInfo.OrigDt;
		SET fixferInfo.mtblitz:FIXferId				=  inRef.FIXferModLockRq.FIXferInfo.FIXferId;
		
		DECLARE subFields REFERENCE TO fixferInfo;
		CREATE LASTCHILD OF fixferInfo AS subFields NAMESPACE mtblitz NAME 'SettlementInfo';
		
		SET subFields.mtblitz:ReceiveCurCode		=   inRef.FIXferModLockRq.FIXferInfo.SettlementInfo.ReceiveCurCode;
		SET subFields.mtblitz:ReceiveAmtEst 		=   inRef.FIXferModLockRq.FIXferInfo.SettlementInfo.ReceiveAmtEst;
		SET subFields.mtblitz:SendAmt				=   inRef.FIXferModLockRq.FIXferInfo.SettlementInfo.SendAmt;
		SET subFields.mtblitz:SendCurCode			=   inRef.FIXferModLockRq.FIXferInfo.SettlementInfo.SendCurCode;

		RETURN TRUE;
	END;			
END MODULE;
/* 6-ой сервис */


/* 7-ой сервис */
CREATE COMPUTE MODULE RequestForKolibri_ConvertMDO2CRM_KZSrvBLModifyMoneyTransferRq
	CREATE FUNCTION Main() RETURNS BOOLEAN
	BEGIN
	    CALL CopyMessageHeaders(InputRoot,OutputRoot);
		
		DECLARE inRef REFERENCE TO InputRoot.XMLNSC.[<];
		DECLARE outRef REFERENCE TO OutputRoot.XMLNSC.*[<];
				
	    SET OutputRoot.MQMD.ReplyToQ	= 'ESB.QPRAGMA.OUT';
	    SET OutputRoot.MQMD.ReplyToQMgr	= 'IKAZ.ESB.OUT.GW1';				
				
		CREATE LASTCHILD OF OutputRoot DOMAIN('XMLNSC') NAME 'XMLNSC';
		CREATE LASTCHILD OF OutputRoot.XMLNSC AS outRef NAMESPACE mtblitz NAME 'FIXferModRq'; 
		
		SET OutputRoot.XMLNSC.mtblitz:FIXferModRq.(XMLNSC.NamespaceDecl)xmlns:mtblitz = mtblitz; 	
    	SET OutputRoot.XMLNSC.mtblitz:FIXferModRq.(XMLNSC.NamespaceDecl)xmlns:ca  = ca; 
    	SET OutputRoot.XMLNSC.mtblitz:FIXferModRq.(XMLNSC.NamespaceDecl)xmlns:iam = iam;
    	SET OutputRoot.XMLNSC.mtblitz:FIXferModRq.(XMLNSC.NamespaceDecl)xmlns:ifxdt = ifxdt;
    	SET OutputRoot.XMLNSC.mtblitz:FIXferModRq.(XMLNSC.NamespaceDecl)xmlns:ifxst = ifxst;    	
    	SET OutputRoot.XMLNSC.mtblitz:FIXferModRq.(XMLNSC.NamespaceDecl)xmlns:ind = ind; 
		SET OutputRoot.XMLNSC.mtblitz:FIXferModRq.(XMLNSC.NamespaceDecl)xmlns:mt = mt;		
    	SET OutputRoot.XMLNSC.mtblitz:FIXferModRq.(XMLNSC.NamespaceDecl)xmlns:orgs = orgs; 
    	SET OutputRoot.XMLNSC.mtblitz:FIXferModRq.(XMLNSC.NamespaceDecl)xmlns:st = st; 
		
		SET outRef.mt:RqUID			= inRef.RqUID;
		SET outRef.mt:RqTm			= convertFromQPtoKOLI(inRef.RqTm);
		SET outRef.mt:SPName		= 'urn:sbrfsystems:98-abs';
		SET outRef.mt:OperName		= 'SrvBLModifyMoneyTransfer';
		                               
		DECLARE varStartDt CHARACTER;
		DECLARE varEndDt   CHARACTER;
		DECLARE varPlaceCode CHARACTER;
				
		DECLARE userInfo REFERENCE TO outRef;
        
        CREATE LASTCHILD OF outRef AS userInfo NAMESPACE mtblitz NAME 'UserInfo'; 
        
        SET userInfo.iam:UserId			= inRef.FIXferModRq.UserInfo.UserId; -- обязательное поле
        SET userInfo.iam:RegionId		= inRef.FIXferModRq.UserInfo.RegionId; 
        SET userInfo.iam:FullName		= inRef.FIXferModRq.UserInfo.FullName;
        
        /* userInfo.iam:PersonName */
        DECLARE personName REFERENCE TO userInfo;                	                
        
        IF EXISTS(inRef.FIXferModRq.UserInfo.PersonName[]) THEN
        	CREATE LASTCHILD OF userInfo AS personName NAMESPACE iam NAME 'PersonName'; -- создаем PersonName с namespace iam внутри UserInfo            
        	CALL FillSomeField(inRef.FIXferModRq.UserInfo.PersonName, personName, 'ind', 'LastName');
        END IF;
        
        SET personName.ind:FirstName = inRef.FIXferModRq.UserInfo.PersonName.FirstName;
		
		IF EXISTS(inRef.FIXferModRq.UserInfo.PersonName[]) THEN
			CALL FillSomeField(inRef.FIXferModRq.UserInfo.PersonName, personName, 'ind', 'MiddleName');
		END IF;
        
        SET personName.ind:TitlePrefix 	= inRef.FIXferModRq.UserInfo.PersonName.TitlePrefix;
        SET personName.ind:NameSuffix 	= inRef.FIXferModRq.UserInfo.PersonName.NameSuffix;
        SET personName.ind:Nickname 	= inRef.FIXferModRq.UserInfo.PersonName.Nickname;
        SET personName.ind:LegalName    = inRef.FIXferModRq.UserInfo.PersonName.LegalName;
        /* userInfo.iam:PersonName */
              
		SET userInfo.iam:OrgId				= inRef.FIXferModRq.UserInfo.OrgId;
		SET userInfo.iam:OrgName			= inRef.FIXferModRq.UserInfo.OrgName;
		SET userInfo.iam:OrgUnitId			= inRef.FIXferModRq.UserInfo.OrgUnitId;
		SET userInfo.iam:OrgUnitName		= inRef.FIXferModRq.UserInfo.OrgUnitName;
		SET userInfo.iam:EmployeeId			= inRef.FIXferModRq.UserInfo.EmployeeId;
		SET userInfo.iam:IpAddr				= inRef.FIXferModRq.UserInfo.IpAddr;
		
		DECLARE COUNTER INTEGER 1;
		DECLARE ARRAY_USERINFO INTEGER CARDINALITY(inRef.FIXferModRq.UserInfo.*[]);		
		
		/* userInfo.iam:CertInfo */
		DECLARE certInfo REFERENCE TO userInfo;
		
		WHILE COUNTER <= ARRAY_USERINFO DO
		
			IF FIELDNAME(inRef.FIXferModRq.UserInfo.[COUNTER]) = 'CertInfo' THEN
				
				CREATE LASTCHILD OF userInfo AS certInfo NAMESPACE iam NAME 'CertInfo';
				
				SET certInfo.iam:X509SubjectName  =  FIELDVALUE(inRef.FIXferModRq.UserInfo.[COUNTER].X509SubjectName);
				SET certInfo.iam:KeyName		  =  FIELDVALUE(inRef.FIXferModRq.UserInfo.[COUNTER].KeyName);	
				SET certInfo.iam:RegionId		  =  FIELDVALUE(inRef.FIXferModRq.UserInfo.[COUNTER].RegionId);				
				      
        		CALL FillSomeField(inRef.FIXferModRq.UserInfo.[COUNTER], certInfo, 'iam', 'UserRole');
        		        		
        		SET certInfo.iam:Certificate		  =  FIELDVALUE(inRef.FIXferModRq.UserInfo.[COUNTER].Certificate);
        		SET certInfo.iam:KeyValue			  =  FIELDVALUE(inRef.FIXferModRq.UserInfo.[COUNTER].KeyValue); 
        		SET certInfo.iam:X509SerialNumber     =  FIELDVALUE(inRef.FIXferModRq.UserInfo.[COUNTER].X509SerialNumber);
        		SET certInfo.iam:X509IssuerNumber     =  FIELDVALUE(inRef.FIXferModRq.UserInfo.[COUNTER].X509IssuerNumber); 			
				SET certInfo.iam:X509IssuerSerial     =  FIELDVALUE(inRef.FIXferModRq.UserInfo.[COUNTER].X509IssuerSerial);
				SET certInfo.iam:Version		      =  FIELDVALUE(inRef.FIXferModRq.UserInfo.[COUNTER].Version);
				SET certInfo.iam:NotBefore		      =  FIELDVALUE(inRef.FIXferModRq.UserInfo.[COUNTER].NotBefore);
				SET certInfo.iam:NotAfter			  =  FIELDVALUE(inRef.FIXferModRq.UserInfo.[COUNTER].NotAfter);
				SET certInfo.iam:SigAlgName			  =  FIELDVALUE(inRef.FIXferModRq.UserInfo.[COUNTER].SigAlgName);
				SET certInfo.iam:SigValue			  =  FIELDVALUE(inRef.FIXferModRq.UserInfo.[COUNTER].SigValue);
				
				DECLARE COUNTER_CERTINFO INTEGER 1;
				DECLARE ARRAY_CERTINFO INTEGER CARDINALITY(inRef.FIXferModRq.UserInfo.[COUNTER].*[]);
				DECLARE extensionInfo REFERENCE TO certInfo;
				
				WHILE COUNTER_CERTINFO <= ARRAY_CERTINFO DO
					IF FIELDNAME(inRef.FIXferModRq.UserInfo.[COUNTER].[COUNTER_CERTINFO]) = 'Extension' THEN
						CREATE LASTCHILD OF certInfo AS extensionInfo NAMESPACE iam NAME 'Extension';
												
						SET extensionInfo.iam:ExtnId      = FIELDVALUE(inRef.FIXferModRq.UserInfo.[COUNTER].[COUNTER_CERTINFO].ExtnId);
						SET extensionInfo.iam:Critical    = FIELDVALUE(inRef.FIXferModRq.UserInfo.[COUNTER].[COUNTER_CERTINFO].Critical);
						SET extensionInfo.iam:ExtnValue   = FIELDVALUE(inRef.FIXferModRq.UserInfo.[COUNTER].[COUNTER_CERTINFO].ExtnValue);												
					END IF;					
					SET COUNTER_CERTINFO = COUNTER_CERTINFO + 1;						
				END WHILE;
						
			END IF;
			
			SET COUNTER = COUNTER + 1;
			
		END WHILE;		
		/* userInfo.iam:CertInfo */		
		
		/* FIXferInfo */
		DECLARE fixferInfo REFERENCE TO outRef;		
		CREATE LASTCHILD OF outRef AS fixferInfo NAMESPACE mtblitz NAME 'FIXferInfo';
		
		/* SENDER */
		DECLARE sender REFERENCE TO fixferInfo;
		CREATE LASTCHILD OF fixferInfo AS sender NAMESPACE mtblitz NAME 'Sender';
		
		/* BankInfo */
		DECLARE bankInfo REFERENCE TO sender;
		CREATE LASTCHILD OF sender AS bankInfo NAMESPACE mtblitz NAME 'BankInfo';
		
		SET bankInfo.mtblitz:BankId  =  inRef.FIXferModRq.FIXferInfo.Sender.BankInfo.BankId;
		SET bankInfo.mtblitz:Country =  inRef.FIXferModRq.FIXferInfo.Sender.BankInfo.Country; 
		SET bankInfo.mtblitz:City    =  inRef.FIXferModRq.FIXferInfo.Sender.BankInfo.City;				
		
		/* PersonInfo */
		DECLARE personInfo REFERENCE TO sender;
		CREATE LASTCHILD OF sender AS personInfo NAMESPACE mtblitz NAME 'PersonInfo';   
		
		SET personInfo.ind:NameAddrType  =  inRef.FIXferModRq.FIXferInfo.Sender.PersonInfo.NameAddrType;
		SET personInfo.ind:FullName      =  inRef.FIXferModRq.FIXferInfo.Sender.PersonInfo.FullName;		
		
		IF EXISTS(inRef.FIXferModRq.FIXferInfo.Sender.PersonInfo.PersonName[]) THEN
        	-- создаем PersonName с namespace iam внутри UserInfo
        	CREATE LASTCHILD OF personInfo AS personName NAMESPACE ind NAME 'PersonName';             
        	CALL FillSomeField(inRef.FIXferModRq.FIXferInfo.Sender.PersonInfo.PersonName, personName, 'ind', 'LastName');
        	
        	SET personName.ind:FirstName	=	inRef.FIXferModRq.FIXferInfo.Sender.PersonInfo.PersonName.FirstName;	
        	
        	IF EXISTS(inRef.FIXferModRq.FIXferInfo.Sender.PersonInfo.PersonName[]) THEN
				CALL FillSomeField(inRef.FIXferModRq.FIXferInfo.Sender.PersonInfo.PersonName, personName, 'ind', 'MiddleName');
			END IF;
        	
        	SET personName.ind:TitlePrefix	=	inRef.FIXferModRq.FIXferInfo.Sender.PersonInfo.PersonName.TitlePrefix;	
        	SET personName.ind:NameSuffix	=	inRef.FIXferModRq.FIXferInfo.Sender.PersonInfo.PersonName.NameSuffix;
        	SET personName.ind:Nickname		=	inRef.FIXferModRq.FIXferInfo.Sender.PersonInfo.PersonName.Nickname;
        	SET personName.ind:LegalName	=	inRef.FIXferModRq.FIXferInfo.Sender.PersonInfo.PersonName.LegalName;
        	
        END IF;		
		
		DECLARE COUNT_CONTACTINFO INTEGER 1;
		DECLARE ARRAY_CONTACTINFO INTEGER CARDINALITY(inRef.FIXferModRq.FIXferInfo.Sender.PersonInfo.*[]);
		DECLARE contactInfo REFERENCE TO personInfo;
		
		/* ContactInfo */
		WHILE COUNT_CONTACTINFO <= ARRAY_CONTACTINFO DO
			IF FIELDNAME(inRef.FIXferModRq.FIXferInfo.Sender.PersonInfo.[COUNT_CONTACTINFO]) = 'ContactInfo' THEN
				CREATE LASTCHILD OF personInfo AS contactInfo NAMESPACE ind NAME 'ContactInfo';
				/*SET contactInfo.ca:ContactPref		=	FIELDVALUE(inRef.FIXferModRq.FIXferInfo.Sender.PersonInfo.[COUNT_CONTACTINFO].ContactPref);
				SET contactInfo.ca:PrefTimeStart	=	FIELDVALUE(inRef.FIXferModRq.FIXferInfo.Sender.PersonInfo.[COUNT_CONTACTINFO].PrefTimeStart);
				SET contactInfo.ca:PrefTimeEnd		=   FIELDVALUE(inRef.FIXferModRq.FIXferInfo.Sender.PersonInfo.[COUNT_CONTACTINFO].PrefTimeEnd);*/
				
				DECLARE COUNT_PHONENUM INTEGER 1;
				DECLARE ARRAY_PHONENUM INTEGER CARDINALITY(inRef.FIXferModRq.FIXferInfo.Sender.PersonInfo.[COUNT_CONTACTINFO].*[]);
 				DECLARE phoneNum REFERENCE TO contactInfo;
 				
 				WHILE COUNT_PHONENUM <= ARRAY_CONTACTINFO DO
 					IF FIELDNAME(inRef.FIXferModRq.FIXferInfo.Sender.PersonInfo.[COUNT_CONTACTINFO].[COUNT_PHONENUM]) = 'PhoneNum' THEN
 						CREATE LASTCHILD OF contactInfo AS phoneNum NAMESPACE ca NAME 'PhoneNum';
 						
 						--SET phoneNum.ca:PhoneType		=	FIELDVALUE(inRef.FIXferModRq.FIXferInfo.Sender.PersonInfo.[COUNT_CONTACTINFO].[COUNT_PHONENUM].PhoneType);
 						SET phoneNum.ca:Phone			= 	FIELDVALUE(inRef.FIXferModRq.FIXferInfo.Sender.PersonInfo.[COUNT_CONTACTINFO].[COUNT_PHONENUM].Phone);
 						--SET phoneNum.ca:PhoneCode   	=   FIELDVALUE(inRef.FIXferModRq.FIXferInfo.Sender.PersonInfo.[COUNT_CONTACTINFO].[COUNT_PHONENUM].PhoneCode);
 						--SET phoneNum.ca:PhoneOperName   =   FIELDVALUE(inRef.FIXferModRq.FIXferInfo.Sender.PersonInfo.[COUNT_CONTACTINFO].[COUNT_PHONENUM].PhoneOperName);
 						
 					END IF;	
 					SET COUNT_PHONENUM = COUNT_PHONENUM + 1; 					
 				END WHILE;
 				/*
 				SET contactInfo.ca:ContactName	=	FIELDVALUE(inRef.FIXferModRq.FIXferInfo.Sender.PersonInfo.[COUNT_CONTACTINFO].ContactName);
 				SET contactInfo.ca:EmailAddr	=	FIELDVALUE(inRef.FIXferModRq.FIXferInfo.Sender.PersonInfo.[COUNT_CONTACTINFO].EmailAddr);
 				SET contactInfo.ca:URL			=	FIELDVALUE(inRef.FIXferModRq.FIXferInfo.Sender.PersonInfo.[COUNT_CONTACTINFO].URL);*/
 				
 				DECLARE COUNT_CONTACTDATA INTEGER 1;
 				DECLARE ARRAY_CONTACTDATA INTEGER CARDINALITY(inRef.FIXferModRq.FIXferInfo.Sender.PersonInfo.[COUNT_CONTACTINFO].*[]);
 				DECLARE contactData REFERENCE TO contactInfo;
 				/*
 				WHILE COUNT_CONTACTDATA <= ARRAY_CONTACTDATA DO
 					IF FIELDNAME(inRef.FIXferModRq.FIXferInfo.Sender.PersonInfo.[COUNT_CONTACTINFO].[COUNT_CONTACTDATA]) = 'ContactData' THEN
 						CREATE LASTCHILD OF contactInfo AS contactData NAMESPACE ca NAME 'ContactData';
 						
 						SET contactData.ca:ContactType		=  FIELDVALUE(inRef.FIXferModRq.FIXferInfo.Sender.PersonInfo.[COUNT_CONTACTINFO].[COUNT_CONTACTDATA].ContactType);
 						SET contactData.ca:ContactValue		=  FIELDVALUE(inRef.FIXferModRq.FIXferInfo.Sender.PersonInfo.[COUNT_CONTACTINFO].[COUNT_CONTACTDATA].ContactValue);
 						SET contactData.ca:PrefTimeStart	=  FIELDVALUE(inRef.FIXferModRq.FIXferInfo.Sender.PersonInfo.[COUNT_CONTACTINFO].[COUNT_CONTACTDATA].PrefTimeStart);
 						SET contactData.ca:PrefTimeEnd		=  FIELDVALUE(inRef.FIXferModRq.FIXferInfo.Sender.PersonInfo.[COUNT_CONTACTINFO].[COUNT_CONTACTDATA].PrefTimeEnd);
 							
 					END IF;	
 					SET COUNT_CONTACTDATA = COUNT_CONTACTDATA + 1;
 				END WHILE;*/
 				
 				DECLARE COUNT_POSTADDR INTEGER 1;
				DECLARE postAddr REFERENCE TO contactInfo;
				
				WHILE COUNT_POSTADDR <= ARRAY_CONTACTDATA DO
					IF FIELDNAME(inRef.FIXferModRq.FIXferInfo.Sender.PersonInfo.[COUNT_CONTACTINFO].[COUNT_POSTADDR]) = 'PostAddr' THEN
						CREATE LASTCHILD OF contactInfo AS postAddr NAMESPACE ca NAME 'PostAddr';
						
						SET postAddr.ca:Addr1			=	FIELDVALUE(inRef.FIXferModRq.FIXferInfo.Sender.PersonInfo.[COUNT_CONTACTINFO].[COUNT_POSTADDR].Addr1);  
						/*SET postAddr.ca:Addr2			=	FIELDVALUE(inRef.FIXferModRq.FIXferInfo.Sender.PersonInfo.[COUNT_CONTACTINFO].[COUNT_POSTADDR].Addr2);  
						SET postAddr.ca:Addr3			=	FIELDVALUE(inRef.FIXferModRq.FIXferInfo.Sender.PersonInfo.[COUNT_CONTACTINFO].[COUNT_POSTADDR].Addr3);  
						SET postAddr.ca:Addr4			=	FIELDVALUE(inRef.FIXferModRq.FIXferInfo.Sender.PersonInfo.[COUNT_CONTACTINFO].[COUNT_POSTADDR].Addr4);
						SET postAddr.ca:City			=	FIELDVALUE(inRef.FIXferModRq.FIXferInfo.Sender.PersonInfo.[COUNT_CONTACTINFO].[COUNT_POSTADDR].City);    
						SET postAddr.ca:CityCode		=	FIELDVALUE(inRef.FIXferModRq.FIXferInfo.Sender.PersonInfo.[COUNT_CONTACTINFO].[COUNT_POSTADDR].CityCode);
						SET postAddr.ca:StateProv		=	FIELDVALUE(inRef.FIXferModRq.FIXferInfo.Sender.PersonInfo.[COUNT_CONTACTINFO].[COUNT_POSTADDR].StateProv);
						SET postAddr.ca:StateProvCode	=	FIELDVALUE(inRef.FIXferModRq.FIXferInfo.Sender.PersonInfo.[COUNT_CONTACTINFO].[COUNT_POSTADDR].StateProvCode);
						SET postAddr.ca:Area			= 	FIELDVALUE(inRef.FIXferModRq.FIXferInfo.Sender.PersonInfo.[COUNT_CONTACTINFO].[COUNT_POSTADDR].Area);
						SET postAddr.ca:AreaCode		= 	FIELDVALUE(inRef.FIXferModRq.FIXferInfo.Sender.PersonInfo.[COUNT_CONTACTINFO].[COUNT_POSTADDR].AreaCode);
						SET postAddr.ca:PostalCode		= 	FIELDVALUE(inRef.FIXferModRq.FIXferInfo.Sender.PersonInfo.[COUNT_CONTACTINFO].[COUNT_POSTADDR].PostalCode);
						SET postAddr.ca:Country			= 	FIELDVALUE(inRef.FIXferModRq.FIXferInfo.Sender.PersonInfo.[COUNT_CONTACTINFO].[COUNT_POSTADDR].Country);
						SET postAddr.ca:CountryCode		= 	FIELDVALUE(inRef.FIXferModRq.FIXferInfo.Sender.PersonInfo.[COUNT_CONTACTINFO].[COUNT_POSTADDR].CountryCode);
						SET postAddr.ca:AddrType		= 	FIELDVALUE(inRef.FIXferModRq.FIXferInfo.Sender.PersonInfo.[COUNT_CONTACTINFO].[COUNT_POSTADDR].AddrType);      

						IF FIELDVALUE(inRef.FIXferModRq.FIXferInfo.Sender.PersonInfo.[COUNT_CONTACTINFO].[COUNT_POSTADDR].StartDt) <> '' THEN
 				            SET varStartDt			    = 	FIELDVALUE(inRef.FIXferModRq.FIXferInfo.Sender.PersonInfo.[COUNT_CONTACTINFO].[COUNT_POSTADDR].StartDt);
							SET postAddr.ca:StartDt		= 	SUBSTRING(varStartDt FROM 1 FOR 10);
						END IF;

						IF FIELDVALUE(inRef.FIXferModRq.FIXferInfo.Sender.PersonInfo.[COUNT_CONTACTINFO].[COUNT_POSTADDR].EndDt) <> '' THEN
							SET varEndDt		        = 	FIELDVALUE(inRef.FIXferModRq.FIXferInfo.Sender.PersonInfo.[COUNT_CONTACTINFO].[COUNT_POSTADDR].EndDt);
							SET postAddr.ca:EndDt		= 	SUBSTRING(varEndDt FROM 1 FOR 10);
						END IF;

						SET postAddr.ca:DistrictCode	= 	FIELDVALUE(inRef.FIXferModRq.FIXferInfo.Sender.PersonInfo.[COUNT_CONTACTINFO].[COUNT_POSTADDR].DistrictCode);
						SET postAddr.ca:District		= 	FIELDVALUE(inRef.FIXferModRq.FIXferInfo.Sender.PersonInfo.[COUNT_CONTACTINFO].[COUNT_POSTADDR].District);

						SET varPlaceCode		        = 	FIELDVALUE(inRef.FIXferModRq.FIXferInfo.Sender.PersonInfo.[COUNT_CONTACTINFO].[COUNT_POSTADDR].PlaceCode);
                        IF varPlaceCode <> '' THEN
				          SET postAddr.ca:PlaсeCode       =   varPlaceCode;
                        END IF;   

						SET postAddr.ca:Place			= 	FIELDVALUE(inRef.FIXferModRq.FIXferInfo.Sender.PersonInfo.[COUNT_CONTACTINFO].[COUNT_POSTADDR].Place);
						SET postAddr.ca:StreetCode		= 	FIELDVALUE(inRef.FIXferModRq.FIXferInfo.Sender.PersonInfo.[COUNT_CONTACTINFO].[COUNT_POSTADDR].StreetCode);
						SET postAddr.ca:Street			= 	FIELDVALUE(inRef.FIXferModRq.FIXferInfo.Sender.PersonInfo.[COUNT_CONTACTINFO].[COUNT_POSTADDR].Street);
						SET postAddr.ca:House			= 	FIELDVALUE(inRef.FIXferModRq.FIXferInfo.Sender.PersonInfo.[COUNT_CONTACTINFO].[COUNT_POSTADDR].House);
						SET postAddr.ca:Corpus			= 	FIELDVALUE(inRef.FIXferModRq.FIXferInfo.Sender.PersonInfo.[COUNT_CONTACTINFO].[COUNT_POSTADDR].Corpus);
						SET postAddr.ca:Building		= 	FIELDVALUE(inRef.FIXferModRq.FIXferInfo.Sender.PersonInfo.[COUNT_CONTACTINFO].[COUNT_POSTADDR].Building);
						SET postAddr.ca:Flat			= 	FIELDVALUE(inRef.FIXferModRq.FIXferInfo.Sender.PersonInfo.[COUNT_CONTACTINFO].[COUNT_POSTADDR].Flat);
						SET postAddr.ca:Office			= 	FIELDVALUE(inRef.FIXferModRq.FIXferInfo.Sender.PersonInfo.[COUNT_CONTACTINFO].[COUNT_POSTADDR].Office);
						SET postAddr.ca:RusKLADR		= 	FIELDVALUE(inRef.FIXferModRq.FIXferInfo.Sender.PersonInfo.[COUNT_CONTACTINFO].[COUNT_POSTADDR].RusKLADR);
						SET postAddr.ca:AddrStatus		= 	FIELDVALUE(inRef.FIXferModRq.FIXferInfo.Sender.PersonInfo.[COUNT_CONTACTINFO].[COUNT_POSTADDR].AddrStatus);*/
						
					END IF;
					SET COUNT_POSTADDR = COUNT_POSTADDR + 1;	
				END WHILE;		
 				
 				--SET contactInfo.ca:ProviderCode			=	FIELDVALUE(inRef.FIXferModRq.FIXferInfo.Sender.PersonInfo.[COUNT_CONTACTINFO].ProviderCode);
 				
			END IF;	
			SET COUNT_CONTACTINFO = COUNT_CONTACTINFO + 1;
		END WHILE;
		
		/* PersonInfo */
		/*SET personInfo.ind:TINInfo.ca:TINType   =  inRef.FIXferModRq.FIXferInfo.Sender.PersonInfo.TINInfo.TINType;
		SET personInfo.ind:TINInfo.ca:TaxId  	=  inRef.FIXferModRq.FIXferInfo.Sender.PersonInfo.TINInfo.TaxId;
		SET personInfo.ind:TINInfo.ca:CertCode  =  inRef.FIXferModRq.FIXferInfo.Sender.PersonInfo.TINInfo.CertCode;*/
		
		/*IF COALESCE(FIELDVALUE(inRef.FIXferModRq.FIXferInfo.Sender.PersonInfo.BirthDt),'') <> '' THEN
			SET personInfo.ind:BirthDt				=  SUBSTRING(FIELDVALUE(inRef.FIXferModRq.FIXferInfo.Sender.PersonInfo.BirthDt) FROM 1 FOR 10);
		END IF;*/
		
		IF EXISTS(inRef.FIXferModRq.FIXferInfo.Sender.PersonInfo.DriversLicense[]) THEN 
			SET personInfo.ind:DriversLicense.ind:LicenseNum		=  COALESCE(inRef.FIXferModRq.FIXferInfo.Sender.PersonInfo.DriversLicense.LicenseNum, NULL);
			SET personInfo.ind:DriversLicense.ind:StateProv			=  COALESCE(inRef.FIXferModRq.FIXferInfo.Sender.PersonInfo.DriversLicense.StateProv, NULL);
			SET personInfo.ind:DriversLicense.ind:Country			=  COALESCE(inRef.FIXferModRq.FIXferInfo.Sender.PersonInfo.DriversLicense.Country, NULL);
		END IF;
		
		SET personInfo.ind:MotherMaidenName						=  inRef.FIXferModRq.FIXferInfo.Sender.PersonInfo.MotherMaidenName;
		SET personInfo.ind:SpouseName							=  inRef.FIXferModRq.FIXferInfo.Sender.PersonInfo.SpouseName;
		
		DECLARE COUNTER_EMPLOYMENT INTEGER 1;
		DECLARE employment REFERENCE TO personInfo;
		
		WHILE COUNTER_EMPLOYMENT <= ARRAY_CONTACTINFO DO
			IF FIELDNAME(inRef.FIXferModRq.FIXferInfo.Sender.PersonInfo.[COUNTER_EMPLOYMENT]) = 'EmploymentHistory' THEN
				CREATE LASTCHILD OF personInfo AS employment NAMESPACE ind NAME 'EmploymentHistory';
				
				SET employment.ind:EmploymentStatus		=	inRef.FIXferModRq.FIXferInfo.Sender.PersonInfo.[COUNTER_EMPLOYMENT].EmploymentStatus;				

				DECLARE orgInfo REFERENCE TO employment;
				DECLARE industId REFERENCE TO employment;
				DECLARE composite REFERENCE TO employment;
				DECLARE general REFERENCE TO employment;
								
				FOR orgFor AS inRef.FIXferModRq.FIXferInfo.Sender.PersonInfo.[COUNTER_EMPLOYMENT].OrgInfo[] DO
					CREATE LASTCHILD OF employment AS orgInfo NAMESPACE ind NAME 'OrgInfo';
					
					FOR industFor AS inRef.FIXferModRq.FIXferInfo.Sender.PersonInfo.[COUNTER_EMPLOYMENT].OrgInfo.IndustId[] DO
						CREATE LASTCHILD OF orgInfo AS industId NAMESPACE orgs NAME 'IndustId';
						
						SET industId.orgs:Org			=	industFor.Org;
						SET industId.orgs:IndustNum		=	industFor.IndustNum;
						SET industId.orgs:SubIndustrNum =   industFor.SubIndustrNum;
						SET industId.orgs:IsPrimary	    =   industFor.IsPrimary;						
					END FOR;
					
					SET orgInfo.orgs:Name 			=	orgFor.Name;	
					SET orgInfo.orgs:LegalName 		=	orgFor.LegalName;
					SET orgInfo.orgs:LegalNameEn 	=	orgFor.LegalNameEn;
					SET orgInfo.orgs:FullNameEn 	=	orgFor.FullNameEn;
					SET orgInfo.orgs:MnemonicName 	=	orgFor.MnemonicName;
					
					FOR compositeFor AS inRef.FIXferModRq.FIXferInfo.Sender.PersonInfo.[COUNTER_EMPLOYMENT].OrgInfo.CompositeContactInfo[] DO
						CREATE LASTCHILD OF orgInfo AS composite NAMESPACE orgs NAME 'CompositeContactInfo';
						
						SET composite.ca:ContactInfoType	=  compositeFor.ContactInfoType;
						
						FOR contactFor AS inRef.FIXferModRq.FIXferInfo.Sender.PersonInfo.[COUNTER_EMPLOYMENT].OrgInfo.CompositeContactInfo.ContactInfo[] DO
							CREATE LASTCHILD OF composite AS contactInfo NAMESPACE ca NAME 'ContactInfo';
							
							SET contactInfo.ca:ContactPref		=	contactFor.ContactPref;
							SET contactInfo.ca:PrefTimeStart	=	contactFor.PrefTimeStart;
							SET contactInfo.ca:PrefTimeEnd		=	contactFor.PrefTimeEnd;
							
							FOR phoneFor AS inRef.FIXferModRq.FIXferInfo.Sender.PersonInfo.[COUNTER_EMPLOYMENT].OrgInfo.CompositeContactInfo.ContactInfo.PhoneNum[] DO		
								CREATE LASTCHILD OF contactInfo AS general NAMESPACE ca NAME 'PhoneNum';
								
								SET general.ca:PhoneType		=	phoneFor.PhoneType;
								SET general.ca:Phone			=	phoneFor.Phone;
								SET general.ca:PhoneCode		=	phoneFor.PhoneCode;
								SET general.ca:PhoneOperName	=	phoneFor.PhoneOperName;								
							END FOR;
							
							SET contactInfo.ca:ContactName		=	contactFor.ContactName;
							SET contactInfo.ca:EmailAddr		=	contactFor.EmailAddr;
							SET contactInfo.ca:URL				=	contactFor.URL;
							
							FOR contactDataFor AS inRef.FIXferModRq.FIXferInfo.Sender.PersonInfo.[COUNTER_EMPLOYMENT].OrgInfo.CompositeContactInfo.ContactInfo.ContactData[] DO
								CREATE LASTCHILD OF contactInfo AS general NAMESPACE ca NAME 'ContactData';
								
								SET general.ca:ContactType		=	contactDataFor.ContactType;
								SET general.ca:ContactValue		=	contactDataFor.ContactValue;
								SET general.ca:PrefTimeStart	=	contactDataFor.PrefTimeStart;
								SET general.ca:PrefTimeEnd		=	contactDataFor.PrefTimeEnd;
							END FOR;
							
							FOR postAddrFor AS inRef.FIXferModRq.FIXferInfo.Sender.PersonInfo.[COUNTER_EMPLOYMENT].OrgInfo.CompositeContactInfo.ContactInfo.PostAddr[] DO
								CREATE LASTCHILD OF contactInfo AS general NAMESPACE ca NAME 'PostAddr';
								
								SET general.ca:Addr1			=	postAddrFor.Addr1;
								SET general.ca:Addr2			=	postAddrFor.Addr2;
								SET general.ca:Addr3			=	postAddrFor.Addr3;
								SET general.ca:Addr4			=	postAddrFor.Addr4;
								SET general.ca:City				=	postAddrFor.City;
								SET general.ca:CityCode			=	postAddrFor.CityCode;
								SET general.ca:StateProv		=	postAddrFor.StateProv;
								SET general.ca:StateProvCode	=	postAddrFor.StateProvCode;
								SET general.ca:Area				=	postAddrFor.Area;
								SET general.ca:AreaCode			=	postAddrFor.AreaCode;
								SET general.ca:PostalCode		=	postAddrFor.PostalCode;
								SET general.ca:Country		    =	postAddrFor.Country;
								SET general.ca:CountryCode	    =	postAddrFor.CountryCode;
								SET general.ca:AddrType		    =	postAddrFor.AddrType;

								IF FIELDVALUE(postAddrFor.StartDt) <> '' THEN
		 				            SET varStartDt			    = 	FIELDVALUE(postAddrFor.StartDt);
									SET general.ca:StartDt		= 	SUBSTRING(varStartDt FROM 1 FOR 10);
								END IF;
		
								IF FIELDVALUE(postAddrFor.EndDt) <> '' THEN
									SET varEndDt		        = 	FIELDVALUE(postAddrFor.EndDt);
									SET general.ca:EndDt		= 	SUBSTRING(varEndDt FROM 1 FOR 10);
								END IF;

---								SET general.ca:StartDt		    =	postAddrFor.StartDt;
---								SET general.ca:EndDt		    =	postAddrFor.EndDt;
								
								SET general.ca:DistrictCode	    =	postAddrFor.DistrictCode;
								SET general.ca:District		    =	postAddrFor.District;

								SET varPlaceCode		        = 	FIELDVALUE(postAddrFor.PlaceCode);
		                        IF varPlaceCode <> '' THEN
						          SET general.ca:PlaceCode       =   varPlaceCode;
		                        END IF;   

								---SET general.ca:PlaceCode	    =	postAddrFor.PlaceCode;

								SET general.ca:Place		    =	postAddrFor.Place;
								SET general.ca:StreetCode	    =	postAddrFor.StreetCode;
								SET general.ca:Street		    =	postAddrFor.Street;
								SET general.ca:House		    =	postAddrFor.House;
								SET general.ca:Corpus		    =	postAddrFor.Corpus;
								SET general.ca:Building		    =	postAddrFor.Building;
								SET general.ca:Flat			    =	postAddrFor.Flat;
								SET general.ca:Office		    =	postAddrFor.Office;
								SET general.ca:RusKLADR	   	 	=	postAddrFor.RusKLADR;
								SET general.ca:AddrStatus	    =	postAddrFor.AddrStatus;
							END FOR;
							
							SET contactInfo.ca:ProviderCode				=	contactFor.ProviderCode;
							
						END FOR;						
												
					END FOR;
					
					DECLARE licensesInfo REFERENCE TO orgInfo;
					CREATE LASTCHILD OF orgInfo AS licensesInfo NAMESPACE orgs NAME 'Licenses';
					DECLARE licenseInfo REFERENCE TO orgInfo;
					
					FOR licenseFor AS inRef.FIXferModRq.FIXferInfo.Sender.PersonInfo.[COUNTER_EMPLOYMENT].OrgInfo.Licenses.LicenseInfo[] DO
						CREATE LASTCHILD OF licensesInfo AS licenseInfo NAMESPACE orgs NAME 'LicenseInfo';
						
						SET licenseInfo.orgs:LicenseType	=	licenseFor.LicenseType;
						SET licenseInfo.orgs:LicenseStatus	=	licenseFor.LicenseStatus;
						SET licenseInfo.orgs:LicenseSerie	=	licenseFor.LicenseSerie;
						SET licenseInfo.orgs:LicenseNum		=	licenseFor.LicenseNum;

						IF COALESCE(FIELDVALUE(licenseFor.LicenseIssueDt),'') <> '' THEN       
						   SET licenseInfo.orgs:LicenseIssueDt             = licenseFor.LicenseIssueDt;       
						END IF;       
						
						SET licenseInfo.orgs:LicenseIssueBy	=	licenseFor.LicenseIssueBy;
						
					END FOR;
										
					SET orgInfo.orgs:TINInfo.ca:TINType 			=	orgFor.TINInfo.TINType;
					SET orgInfo.orgs:TINInfo.ca:TaxId	 			=	orgFor.TINInfo.TaxId;
					SET orgInfo.orgs:TINInfo.ca:CertCode 			=	orgFor.TINInfo.CertCode;	
					
					SET orgInfo.orgs:KIOInfo.ca:TINType 			=	orgFor.KIOInfo.TINType;
					SET orgInfo.orgs:KIOInfo.ca:TaxId	 			=	orgFor.KIOInfo.TaxId;
					SET orgInfo.orgs:KIOInfo.ca:CertCode 			=	orgFor.KIOInfo.CertCode;
					
					SET orgInfo.orgs:EstablishDt		 			=	orgFor.EstablishDt;
					SET orgInfo.orgs:NumEmployees		 			=	orgFor.NumEmployees;
					SET orgInfo.orgs:EmployerCode		 			=	orgFor.EmployerCode;
					
				END FOR;
				
				SET employment.ind:Occupation			=	inRef.FIXferModRq.FIXferInfo.Sender.PersonInfo.[COUNTER_EMPLOYMENT].Occupation;	 	
				
				SET employment.ind:Income.ca:Amt			=	inRef.FIXferModRq.FIXferInfo.Sender.PersonInfo.[COUNTER_EMPLOYMENT].Income.Amt;
				SET employment.ind:Income.ca:Reversal		=	inRef.FIXferModRq.FIXferInfo.Sender.PersonInfo.[COUNTER_EMPLOYMENT].Income.Reversal;
				SET employment.ind:Income.ca:CurCode		=	inRef.FIXferModRq.FIXferInfo.Sender.PersonInfo.[COUNTER_EMPLOYMENT].Income.CurCode;	
				SET employment.ind:Income.ca:CurRate		=	inRef.FIXferModRq.FIXferInfo.Sender.PersonInfo.[COUNTER_EMPLOYMENT].Income.CurRate;
				SET employment.ind:Income.ca:CurConvertRule	=	inRef.FIXferModRq.FIXferInfo.Sender.PersonInfo.[COUNTER_EMPLOYMENT].Income.CurConvertRule; 	
				
				SET employment.ind:JobTitle			=	inRef.FIXferModRq.FIXferInfo.Sender.PersonInfo.[COUNTER_EMPLOYMENT].JobTitle;	 

				IF FIELDVALUE(inRef.FIXferModRq.FIXferInfo.Sender.PersonInfo.[COUNTER_EMPLOYMENT].StartDt) <> '' THEN
					SET varStartDt			        = 	FIELDVALUE(inRef.FIXferModRq.FIXferInfo.Sender.PersonInfo.[COUNTER_EMPLOYMENT].StartDt);
					SET employment.ind:StartDt		= 	SUBSTRING(varStartDt FROM 1 FOR 10);
				END IF;
						
				IF FIELDVALUE(inRef.FIXferModRq.FIXferInfo.Sender.PersonInfo.[COUNTER_EMPLOYMENT].EndDt) <> '' THEN
					SET varEndDt		            = 	FIELDVALUE(inRef.FIXferModRq.FIXferInfo.Sender.PersonInfo.[COUNTER_EMPLOYMENT].EndDt);
					SET employment.ind:EndDt		= 	SUBSTRING(varEndDt FROM 1 FOR 10);
				END IF;

				---SET employment.ind:StartDt			=	inRef.FIXferModRq.FIXferInfo.Sender.PersonInfo.[COUNTER_EMPLOYMENT].StartDt;
				---SET employment.ind:EndDt			=	inRef.FIXferModRq.FIXferInfo.Sender.PersonInfo.[COUNTER_EMPLOYMENT].EndDt;			
			END IF;
							
			SET COUNTER_EMPLOYMENT = COUNTER_EMPLOYMENT + 1;
		END WHILE;	
		
		/*IF COALESCE(FIELDVALUE(inRef.FIXferModRq.FIXferInfo.Sender.PersonInfo.Gender),'') <> '' THEN       
		   SET personInfo.ind:Gender       = inRef.FIXferModRq.FIXferInfo.Sender.PersonInfo.Gender;
		END IF;     */  
		
		SET personInfo.ind:MaritalStatus					=  inRef.FIXferModRq.FIXferInfo.Sender.PersonInfo.MaritalStatus;
		SET personInfo.ind:USAMilitaryRank					=  inRef.FIXferModRq.FIXferInfo.Sender.PersonInfo.USAMilitaryRank;
		SET personInfo.ind:Dependets						=  inRef.FIXferModRq.FIXferInfo.Sender.PersonInfo.Dependets;
		
		IF EXISTS(inRef.FIXferModRq.FIXferInfo.Sender.PersonInfo.Passport[]) THEN
			SET personInfo.ind:Passport.ind:PassportNumber		=  COALESCE(inRef.FIXferModRq.FIXferInfo.Sender.PersonInfo.Passport.PassportNumber,NULL);
			SET personInfo.ind:Passport.ind:DocSeries			=  COALESCE(inRef.FIXferModRq.FIXferInfo.Sender.PersonInfo.Passport.DocSeries, NULL);
			SET personInfo.ind:Passport.ind:PassportCountry		=  COALESCE(inRef.FIXferModRq.FIXferInfo.Sender.PersonInfo.Passport.PassportCountry, NULL);
			SET personInfo.ind:Passport.ind:IssueLoc			=  COALESCE(inRef.FIXferModRq.FIXferInfo.Sender.PersonInfo.Passport.IssueLoc, NULL);
			SET personInfo.ind:Passport.ind:IssDt				=  COALESCE(inRef.FIXferModRq.FIXferInfo.Sender.PersonInfo.Passport.IssDt, NULL);
			SET personInfo.ind:Passport.ind:ExpDt				=  COALESCE(inRef.FIXferModRq.FIXferInfo.Sender.PersonInfo.Passport.ExpDt, NULL);
		END IF;
		
		SET personInfo.ind:OEDCode							=  inRef.FIXferModRq.FIXferInfo.Sender.PersonInfo.OEDCode;
		SET personInfo.ind:"OEDInstitution_Type"			=  inRef.FIXferModRq.FIXferInfo.Sender.PersonInfo."OEDInstitution_Type";
		
		IF EXISTS(inRef.FIXferModRq.FIXferInfo.Sender.PersonInfo.GovIssueIdent[]) THEN
			SET personInfo.ind:GovIssueIdent.ind:GovIssueIdentType	=  COALESCE(inRef.FIXferModRq.FIXferInfo.Sender.PersonInfo.GovIssueIdent.GovIssueIdentType, NULL);
			SET personInfo.ind:GovIssueIdent.ind:IdentSerialNum  	=  COALESCE(inRef.FIXferModRq.FIXferInfo.Sender.PersonInfo.GovIssueIdent.IdentSerialNum, NULL);
			SET personInfo.ind:GovIssueIdent.ind:GovOrg			 	=  COALESCE(inRef.FIXferModRq.FIXferInfo.Sender.PersonInfo.GovIssueIdent.GovOrg, NULL);
			SET personInfo.ind:GovIssueIdent.ind:GovOrgName		 	=  COALESCE(inRef.FIXferModRq.FIXferInfo.Sender.PersonInfo.GovIssueIdent.GovOrgName, NULL);
			SET personInfo.ind:GovIssueIdent.ind:GovRank		  	=  COALESCE(inRef.FIXferModRq.FIXferInfo.Sender.PersonInfo.GovIssueIdent.GovRank, NULL);
			SET personInfo.ind:GovIssueIdent.ind:StateProv		 	=  COALESCE(inRef.FIXferModRq.FIXferInfo.Sender.PersonInfo.GovIssueIdent.StateProv, NULL);
			SET personInfo.ind:GovIssueIdent.ind:Country		 	=  COALESCE(inRef.FIXferModRq.FIXferInfo.Sender.PersonInfo.GovIssueIdent.Country, NULL);
			SET personInfo.ind:GovIssueIdent.ind:Desc			  	=  COALESCE(inRef.FIXferModRq.FIXferInfo.Sender.PersonInfo.GovIssueIdent.Desc, NULL);
			SET personInfo.ind:GovIssueIdent.ind:IssDt			  	=  COALESCE(inRef.FIXferModRq.FIXferInfo.Sender.PersonInfo.GovIssueIdent.IssDt, NULL);
			SET personInfo.ind:GovIssueIdent.ind:ExpDt			  	=  COALESCE(inRef.FIXferModRq.FIXferInfo.Sender.PersonInfo.GovIssueIdent.ExpDt, NULL);
			SET personInfo.ind:GovIssueIdent.ind:IdentSerie		  	=  COALESCE(inRef.FIXferModRq.FIXferInfo.Sender.PersonInfo.GovIssueIdent.IdentSerie, NULL);
			SET personInfo.ind:GovIssueIdent.ind:GovOrgUnit		  	=  COALESCE(inRef.FIXferModRq.FIXferInfo.Sender.PersonInfo.GovIssueIdent.GovOrgUnit, NULL);
		END IF;
		
		IF EXISTS(inRef.FIXferModRq.FIXferInfo.Sender.PersonInfo.OtherIdentDoc[]) THEN
			SET personInfo.ind:OtherIdentDoc.ind:Desc			  	=  COALESCE(inRef.FIXferModRq.FIXferInfo.Sender.PersonInfo.OtherIdentDoc.Desc, NULL);
			SET personInfo.ind:OtherIdentDoc.ind:IdentSerialNum  	=  COALESCE(inRef.FIXferModRq.FIXferInfo.Sender.PersonInfo.OtherIdentDoc.IdentSerialNum, NULL);
			SET personInfo.ind:OtherIdentDoc.ind:Issuer			 	=  COALESCE(inRef.FIXferModRq.FIXferInfo.Sender.PersonInfo.OtherIdentDoc.Issuer, NULL);
			SET personInfo.ind:OtherIdentDoc.ind:IssueLoc		  	=  COALESCE(inRef.FIXferModRq.FIXferInfo.Sender.PersonInfo.OtherIdentDoc.IssueLoc, NULL);
			SET personInfo.ind:OtherIdentDoc.ind:IssDt			 	=  COALESCE(inRef.FIXferModRq.FIXferInfo.Sender.PersonInfo.OtherIdentDoc.IssDt, NULL);
			SET personInfo.ind:OtherIdentDoc.ind:ExpDt			  	=  COALESCE(inRef.FIXferModRq.FIXferInfo.Sender.PersonInfo.OtherIdentDoc.ExpDt, NULL);
		END IF;
		
		DECLARE identityCards REFERENCE TO personInfo;
		DECLARE identityCard REFERENCE TO identityCards;
		CREATE LASTCHILD OF personInfo AS identityCards NAMESPACE ind NAME 'IdentityCards';
		
		FOR identityFor AS inRef.FIXferModRq.FIXferInfo.Sender.PersonInfo.IdentityCards.IdentityCard[] DO
			
			CREATE LASTCHILD OF identityCards AS identityCard NAMESPACE ind NAME 'IdentityCard';
			
			SET identityCard.ind:IdType				=	identityFor.IdType;
			/*SET identityCard.ind:IdStatus			=	identityFor.IdStatus;
			SET identityCard.ind:IdSeries			=	identityFor.IdSeries;*/
			SET identityCard.ind:IdNum				=	identityFor.IdNum;
			
			IF COALESCE(FIELDVALUE(identityFor.IssueDt),'') <> '' THEN       
			   SET identityCard.ind:IssueDt             = identityFor.IssueDt;       
			END IF;       
			
			SET identityCard.ind:IssuedBy			=	identityFor.IssuedBy;
			/*SET identityCard.ind:Code				=	identityFor.Code;
			SET identityCard.ind:IssueLoc			=	identityFor.IssueLoc;
			SET identityCard.ind:IssuedCountry		=	identityFor.IssuedCountry;

			IF COALESCE(FIELDVALUE(identityFor.IssuedRegionCode),'') <> '' THEN       
			   SET identityCard.ind:IssuedRegionCode    = identityFor.IssuedRegionCode;       
			END IF;       
			
			IF COALESCE(FIELDVALUE(identityFor.ExpDt),'') <> '' THEN       
			   SET identityCard.ind:ExpDt               = SUBSTRING(FIELDVALUE(identityFor.ExpDt) BEFORE 'T');
			END IF;*/       
		END FOR;
		
		SET personInfo.ind:BirthPlace			  	=  inRef.FIXferModRq.FIXferInfo.Sender.PersonInfo.BirthPlace;
		--SET personInfo.ind:Resident				  	=  inRef.FIXferModRq.FIXferInfo.Sender.PersonInfo.Resident;
		SET personInfo.ind:MilitaryDocFlag		  	=  inRef.FIXferModRq.FIXferInfo.Sender.PersonInfo.MilitaryDocFlag;
		SET personInfo.ind:Citizenship			  	=  inRef.FIXferModRq.FIXferInfo.Sender.PersonInfo.Citizenship;
		
		/* OWNER */
		DECLARE owner REFERENCE TO fixferInfo;
		CREATE LASTCHILD OF fixferInfo AS owner NAMESPACE mtblitz NAME 'Owner';
		
		/* BankInfo */
		CREATE LASTCHILD OF owner AS bankInfo NAMESPACE mtblitz NAME 'BankInfo';
		
		SET bankInfo.mtblitz:BankId  =  inRef.FIXferModRq.FIXferInfo.Owner.BankInfo.BankId;
		SET bankInfo.mtblitz:Country =  inRef.FIXferModRq.FIXferInfo.Owner.BankInfo.Country; 
		SET bankInfo.mtblitz:City    =  inRef.FIXferModRq.FIXferInfo.Owner.BankInfo.City;
		
		/* RECEIVER */
		DECLARE receiver REFERENCE TO fixferInfo;
		CREATE LASTCHILD OF fixferInfo AS receiver NAMESPACE mtblitz NAME 'Receiver';
		
		/* BankInfo */
		CREATE LASTCHILD OF receiver AS bankInfo NAMESPACE mtblitz NAME 'BankInfo';
		
		SET bankInfo.mtblitz:BankId  =  inRef.FIXferModRq.FIXferInfo.Receiver.BankInfo.BankId;
		SET bankInfo.mtblitz:Country =  inRef.FIXferModRq.FIXferInfo.Receiver.BankInfo.Country; 
		SET bankInfo.mtblitz:City    =  inRef.FIXferModRq.FIXferInfo.Receiver.BankInfo.City;
		
		/* PersonInfo */ 
		CREATE LASTCHILD OF receiver AS personInfo NAMESPACE mtblitz NAME 'PersonInfo';   
		
		SET personInfo.ind:NameAddrType  =  inRef.FIXferModRq.FIXferInfo.Receiver.PersonInfo.NameAddrType;
		SET personInfo.ind:FullName    	 =  inRef.FIXferModRq.FIXferInfo.Receiver.PersonInfo.FullName;
		
		
		IF EXISTS(inRef.FIXferModRq.FIXferInfo.Receiver.PersonInfo.PersonName[]) THEN
        	-- создаем PersonName с namespace iam внутри UserInfo
        	CREATE LASTCHILD OF personInfo AS personName NAMESPACE ind NAME 'PersonName';             
        	CALL FillSomeField(inRef.FIXferModRq.FIXferInfo.Receiver.PersonInfo.PersonName, personName, 'ind', 'LastName');
        	
        	SET personName.ind:FirstName	=	inRef.FIXferModRq.FIXferInfo.Receiver.PersonInfo.PersonName.FirstName;	
        	
        	IF EXISTS(inRef.FIXferModRq.FIXferInfo.Sender.PersonInfo.PersonName[]) THEN
				CALL FillSomeField(inRef.FIXferModRq.FIXferInfo.Receiver.PersonInfo.PersonName, personName, 'ind', 'MiddleName');
			END IF;
        	
        	SET personName.ind:TitlePrefix	=	inRef.FIXferModRq.FIXferInfo.Receiver.PersonInfo.PersonName.TitlePrefix;	
        	SET personName.ind:NameSuffix	=	inRef.FIXferModRq.FIXferInfo.Receiver.PersonInfo.PersonName.NameSuffix;
        	SET personName.ind:Nickname		=	inRef.FIXferModRq.FIXferInfo.Receiver.PersonInfo.PersonName.Nickname;
        	SET personName.ind:LegalName	=	inRef.FIXferModRq.FIXferInfo.Receiver.PersonInfo.PersonName.LegalName;
        	
        END IF;		
		
		SET COUNT_CONTACTINFO = 1;
		
		/* ContactInfo */
		WHILE COUNT_CONTACTINFO <= ARRAY_CONTACTINFO DO
			IF FIELDNAME(inRef.FIXferModRq.FIXferInfo.Receiver.PersonInfo.[COUNT_CONTACTINFO]) = 'ContactInfo' THEN
				CREATE LASTCHILD OF personInfo AS contactInfo NAMESPACE ind NAME 'ContactInfo';
				/*SET contactInfo.ca:ContactPref		=	FIELDVALUE(inRef.FIXferModRq.FIXferInfo.Receiver.PersonInfo.[COUNT_CONTACTINFO].ContactPref);
				SET contactInfo.ca:PrefTimeStart	=	FIELDVALUE(inRef.FIXferModRq.FIXferInfo.Receiver.PersonInfo.[COUNT_CONTACTINFO].PrefTimeStart);
				SET contactInfo.ca:PrefTimeEnd		=   FIELDVALUE(inRef.FIXferModRq.FIXferInfo.Receiver.PersonInfo.[COUNT_CONTACTINFO].PrefTimeEnd);*/
				
				DECLARE COUNT_PHONENUM INTEGER 1;
				DECLARE ARRAY_PHONENUM INTEGER CARDINALITY(inRef.FIXferModRq.FIXferInfo.Receiver.PersonInfo.[COUNT_CONTACTINFO].*[]);
 				DECLARE phoneNum REFERENCE TO contactInfo;
 				
 				WHILE COUNT_PHONENUM <= ARRAY_CONTACTINFO DO
 					IF FIELDNAME(inRef.FIXferModRq.FIXferInfo.Receiver.PersonInfo.[COUNT_CONTACTINFO].[COUNT_PHONENUM]) = 'PhoneNum' THEN
 						CREATE LASTCHILD OF contactInfo AS phoneNum NAMESPACE ca NAME 'PhoneNum';
 						
 						--SET phoneNum.ca:PhoneType		=	FIELDVALUE(inRef.FIXferModRq.FIXferInfo.Receiver.PersonInfo.[COUNT_CONTACTINFO].[COUNT_PHONENUM].PhoneType);
 						SET phoneNum.ca:Phone			= 	FIELDVALUE(inRef.FIXferModRq.FIXferInfo.Receiver.PersonInfo.[COUNT_CONTACTINFO].[COUNT_PHONENUM].Phone);
 						--SET phoneNum.ca:PhoneCode   	=   FIELDVALUE(inRef.FIXferModRq.FIXferInfo.Receiver.PersonInfo.[COUNT_CONTACTINFO].[COUNT_PHONENUM].PhoneCode);
 						--SET phoneNum.ca:PhoneOperName   =   FIELDVALUE(inRef.FIXferModRq.FIXferInfo.Receiver.PersonInfo.[COUNT_CONTACTINFO].[COUNT_PHONENUM].PhoneOperName);
 						
 					END IF;	
 					SET COUNT_PHONENUM = COUNT_PHONENUM + 1; 					
 				END WHILE;
 				
 				/*SET contactInfo.ca:ContactName	=	FIELDVALUE(inRef.FIXferModRq.FIXferInfo.Receiver.PersonInfo.[COUNT_CONTACTINFO].ContactName);
 				SET contactInfo.ca:EmailAddr	=	FIELDVALUE(inRef.FIXferModRq.FIXferInfo.Receiver.PersonInfo.[COUNT_CONTACTINFO].EmailAddr);
 				SET contactInfo.ca:URL			=	FIELDVALUE(inRef.FIXferModRq.FIXferInfo.Receiver.PersonInfo.[COUNT_CONTACTINFO].URL);*/
 				
 				DECLARE COUNT_CONTACTDATA INTEGER 1;
 				DECLARE ARRAY_CONTACTDATA INTEGER CARDINALITY(inRef.FIXferModRq.FIXferInfo.Receiver.PersonInfo.[COUNT_CONTACTINFO].*[]);
 				DECLARE contactData REFERENCE TO contactInfo;
 				/*
 				WHILE COUNT_CONTACTDATA <= ARRAY_CONTACTDATA DO
 					IF FIELDNAME(inRef.FIXferModRq.FIXferInfo.Receiver.PersonInfo.[COUNT_CONTACTINFO].[COUNT_CONTACTDATA]) = 'ContactData' THEN
 						CREATE LASTCHILD OF contactInfo AS contactData NAMESPACE ca NAME 'ContactData';
 						
 						SET contactData.ca:ContactType		=  FIELDVALUE(inRef.FIXferModRq.FIXferInfo.Receiver.PersonInfo.[COUNT_CONTACTINFO].[COUNT_CONTACTDATA].ContactType);
 						SET contactData.ca:ContactValue		=  FIELDVALUE(inRef.FIXferModRq.FIXferInfo.Receiver.PersonInfo.[COUNT_CONTACTINFO].[COUNT_CONTACTDATA].ContactValue);
 						SET contactData.ca:PrefTimeStart	=  FIELDVALUE(inRef.FIXferModRq.FIXferInfo.Receiver.PersonInfo.[COUNT_CONTACTINFO].[COUNT_CONTACTDATA].PrefTimeStart);
 						SET contactData.ca:PrefTimeEnd		=  FIELDVALUE(inRef.FIXferModRq.FIXferInfo.Receiver.PersonInfo.[COUNT_CONTACTINFO].[COUNT_CONTACTDATA].PrefTimeEnd);
 							
 					END IF;	
 					SET COUNT_CONTACTDATA = COUNT_CONTACTDATA + 1;
 				END WHILE;*/
 				
 				DECLARE COUNT_POSTADDR INTEGER 1;
				DECLARE postAddr REFERENCE TO contactInfo;
				
				WHILE COUNT_POSTADDR <= ARRAY_CONTACTDATA DO
					IF FIELDNAME(inRef.FIXferModRq.FIXferInfo.Receiver.PersonInfo.[COUNT_CONTACTINFO].[COUNT_POSTADDR]) = 'PostAddr' THEN
						CREATE LASTCHILD OF contactInfo AS postAddr NAMESPACE ca NAME 'PostAddr';
						
						SET postAddr.ca:Addr1			=	FIELDVALUE(inRef.FIXferModRq.FIXferInfo.Receiver.PersonInfo.[COUNT_CONTACTINFO].[COUNT_POSTADDR].Addr1);  
						/*SET postAddr.ca:Addr2			=	FIELDVALUE(inRef.FIXferModRq.FIXferInfo.Receiver.PersonInfo.[COUNT_CONTACTINFO].[COUNT_POSTADDR].Addr2);  
						SET postAddr.ca:Addr3			=	FIELDVALUE(inRef.FIXferModRq.FIXferInfo.Receiver.PersonInfo.[COUNT_CONTACTINFO].[COUNT_POSTADDR].Addr3);  
						SET postAddr.ca:Addr4			=	FIELDVALUE(inRef.FIXferModRq.FIXferInfo.Receiver.PersonInfo.[COUNT_CONTACTINFO].[COUNT_POSTADDR].Addr4);
						SET postAddr.ca:City			=	FIELDVALUE(inRef.FIXferModRq.FIXferInfo.Receiver.PersonInfo.[COUNT_CONTACTINFO].[COUNT_POSTADDR].City);    
						SET postAddr.ca:CityCode		=	FIELDVALUE(inRef.FIXferModRq.FIXferInfo.Receiver.PersonInfo.[COUNT_CONTACTINFO].[COUNT_POSTADDR].CityCode);
						SET postAddr.ca:StateProv		=	FIELDVALUE(inRef.FIXferModRq.FIXferInfo.Receiver.PersonInfo.[COUNT_CONTACTINFO].[COUNT_POSTADDR].StateProv);
						SET postAddr.ca:StateProvCode	=	FIELDVALUE(inRef.FIXferModRq.FIXferInfo.Receiver.PersonInfo.[COUNT_CONTACTINFO].[COUNT_POSTADDR].StateProvCode);
						SET postAddr.ca:Area			= 	FIELDVALUE(inRef.FIXferModRq.FIXferInfo.Receiver.PersonInfo.[COUNT_CONTACTINFO].[COUNT_POSTADDR].Area);
						SET postAddr.ca:AreaCode		= 	FIELDVALUE(inRef.FIXferModRq.FIXferInfo.Receiver.PersonInfo.[COUNT_CONTACTINFO].[COUNT_POSTADDR].AreaCode);
						SET postAddr.ca:PostalCode		= 	FIELDVALUE(inRef.FIXferModRq.FIXferInfo.Receiver.PersonInfo.[COUNT_CONTACTINFO].[COUNT_POSTADDR].PostalCode);
						SET postAddr.ca:Country			= 	FIELDVALUE(inRef.FIXferModRq.FIXferInfo.Receiver.PersonInfo.[COUNT_CONTACTINFO].[COUNT_POSTADDR].Country);
						SET postAddr.ca:CountryCode		= 	FIELDVALUE(inRef.FIXferModRq.FIXferInfo.Receiver.PersonInfo.[COUNT_CONTACTINFO].[COUNT_POSTADDR].CountryCode);
						SET postAddr.ca:AddrType		= 	FIELDVALUE(inRef.FIXferModRq.FIXferInfo.Receiver.PersonInfo.[COUNT_CONTACTINFO].[COUNT_POSTADDR].AddrType);*/      

						---SET postAddr.ca:StartDt			= 	FIELDVALUE(inRef.FIXferModRq.FIXferInfo.Receiver.PersonInfo.[COUNT_CONTACTINFO].[COUNT_POSTADDR].StartDt);
						---SET postAddr.ca:EndDt			= 	FIELDVALUE(inRef.FIXferModRq.FIXferInfo.Receiver.PersonInfo.[COUNT_CONTACTINFO].[COUNT_POSTADDR].EndDt);

						/*IF FIELDVALUE(inRef.FIXferModRq.FIXferInfo.Receiver.PersonInfo.[COUNT_CONTACTINFO].[COUNT_POSTADDR].StartDt) <> '' THEN
 				            SET varStartDt			    = 	FIELDVALUE(inRef.FIXferModRq.FIXferInfo.Receiver.PersonInfo.[COUNT_CONTACTINFO].[COUNT_POSTADDR].StartDt);
							SET postAddr.ca:StartDt		= 	SUBSTRING(varStartDt FROM 1 FOR 10);
						END IF;

						IF FIELDVALUE(inRef.FIXferModRq.FIXferInfo.Receiver.PersonInfo.[COUNT_CONTACTINFO].[COUNT_POSTADDR].EndDt) <> '' THEN
 				            SET varEndDt			    = 	FIELDVALUE(inRef.FIXferModRq.FIXferInfo.Receiver.PersonInfo.[COUNT_CONTACTINFO].[COUNT_POSTADDR].EndDt);
							SET postAddr.ca:EndDt		= 	SUBSTRING(varEndDt FROM 1 FOR 10);
						END IF;

						SET postAddr.ca:DistrictCode	= 	FIELDVALUE(inRef.FIXferModRq.FIXferInfo.Receiver.PersonInfo.[COUNT_CONTACTINFO].[COUNT_POSTADDR].DistrictCode);
						SET postAddr.ca:District		= 	FIELDVALUE(inRef.FIXferModRq.FIXferInfo.Receiver.PersonInfo.[COUNT_CONTACTINFO].[COUNT_POSTADDR].District);*/

---						SET postAddr.ca:PlaceCode		= 	FIELDVALUE(inRef.FIXferModRq.FIXferInfo.Receiver.PersonInfo.[COUNT_CONTACTINFO].[COUNT_POSTADDR].PlaceCode);

						/*SET varPlaceCode		        = 	FIELDVALUE(inRef.FIXferModRq.FIXferInfo.Receiver.PersonInfo.[COUNT_CONTACTINFO].[COUNT_POSTADDR].PlaceCode);
						IF varPlaceCode <> '' THEN
							SET postAddr.ca:PlaceCode       =   varPlaceCode;
						END IF;   

						SET postAddr.ca:Place			= 	FIELDVALUE(inRef.FIXferModRq.FIXferInfo.Receiver.PersonInfo.[COUNT_CONTACTINFO].[COUNT_POSTADDR].Place);
						SET postAddr.ca:StreetCode		= 	FIELDVALUE(inRef.FIXferModRq.FIXferInfo.Receiver.PersonInfo.[COUNT_CONTACTINFO].[COUNT_POSTADDR].StreetCode);
						SET postAddr.ca:Street			= 	FIELDVALUE(inRef.FIXferModRq.FIXferInfo.Receiver.PersonInfo.[COUNT_CONTACTINFO].[COUNT_POSTADDR].Street);
						SET postAddr.ca:House			= 	FIELDVALUE(inRef.FIXferModRq.FIXferInfo.Receiver.PersonInfo.[COUNT_CONTACTINFO].[COUNT_POSTADDR].House);
						SET postAddr.ca:Corpus			= 	FIELDVALUE(inRef.FIXferModRq.FIXferInfo.Receiver.PersonInfo.[COUNT_CONTACTINFO].[COUNT_POSTADDR].Corpus);
						SET postAddr.ca:Building		= 	FIELDVALUE(inRef.FIXferModRq.FIXferInfo.Receiver.PersonInfo.[COUNT_CONTACTINFO].[COUNT_POSTADDR].Building);
						SET postAddr.ca:Flat			= 	FIELDVALUE(inRef.FIXferModRq.FIXferInfo.Receiver.PersonInfo.[COUNT_CONTACTINFO].[COUNT_POSTADDR].Flat);
						SET postAddr.ca:Office			= 	FIELDVALUE(inRef.FIXferModRq.FIXferInfo.Receiver.PersonInfo.[COUNT_CONTACTINFO].[COUNT_POSTADDR].Office);
						SET postAddr.ca:RusKLADR		= 	FIELDVALUE(inRef.FIXferModRq.FIXferInfo.Receiver.PersonInfo.[COUNT_CONTACTINFO].[COUNT_POSTADDR].RusKLADR);
						SET postAddr.ca:AddrStatus		= 	FIELDVALUE(inRef.FIXferModRq.FIXferInfo.Receiver.PersonInfo.[COUNT_CONTACTINFO].[COUNT_POSTADDR].AddrStatus);*/
						
					END IF;
					SET COUNT_POSTADDR = COUNT_POSTADDR + 1;	
				END WHILE;		
 				
 				--SET contactInfo.ca:ProviderCode			=	FIELDVALUE(inRef.FIXferModRq.FIXferInfo.Receiver.PersonInfo.[COUNT_CONTACTINFO].ProviderCode);
 				
			END IF;	
			SET COUNT_CONTACTINFO = COUNT_CONTACTINFO + 1;
		END WHILE;
		
		/* PersonInfo */
		/*SET personInfo.ind:TINInfo.ca:TINType   =  inRef.FIXferModRq.FIXferInfo.Receiver.PersonInfo.TINInfo.TINType;
		SET personInfo.ind:TINInfo.ca:TaxId  	=  inRef.FIXferModRq.FIXferInfo.Receiver.PersonInfo.TINInfo.TaxId;
		SET personInfo.ind:TINInfo.ca:CertCode  =  inRef.FIXferModRq.FIXferInfo.Receiver.PersonInfo.TINInfo.CertCode;*/
		
		/*IF COALESCE(FIELDVALUE(inRef.FIXferModRq.FIXferInfo.Sender.PersonInfo.BirthDt),'') <> '' THEN
			SET personInfo.ind:BirthDt				=  SUBSTRING(FIELDVALUE(inRef.FIXferModRq.FIXferInfo.Sender.PersonInfo.BirthDt) FROM 1 FOR 10);
		END IF;*/
		
		IF EXISTS(inRef.FIXferModRq.FIXferInfo.Receiver.PersonInfo.DriversLicense[]) THEN
			SET personInfo.ind:DriversLicense.ind:LicenseNum		=  COALESCE(inRef.FIXferModRq.FIXferInfo.Receiver.PersonInfo.DriversLicense.LicenseNum, NULL);
			SET personInfo.ind:DriversLicense.ind:StateProv			=  COALESCE(inRef.FIXferModRq.FIXferInfo.Receiver.PersonInfo.DriversLicense.StateProv, NULL);
			SET personInfo.ind:DriversLicense.ind:Country			=  COALESCE(inRef.FIXferModRq.FIXferInfo.Receiver.PersonInfo.DriversLicense.Country, NULL);
		END IF;
		
		SET personInfo.ind:MotherMaidenName						=  inRef.FIXferModRq.FIXferInfo.Receiver.PersonInfo.MotherMaidenName;
		SET personInfo.ind:SpouseName							=  inRef.FIXferModRq.FIXferInfo.Receiver.PersonInfo.SpouseName;
		
		SET COUNTER_EMPLOYMENT = 1;
		--DECLARE employment REFERENCE TO personInfo;
		
		WHILE COUNTER_EMPLOYMENT <= ARRAY_CONTACTINFO DO
			IF FIELDNAME(inRef.FIXferModRq.FIXferInfo.Receiver.PersonInfo.[COUNTER_EMPLOYMENT]) = 'EmploymentHistory' THEN
				CREATE LASTCHILD OF personInfo AS employment NAMESPACE ind NAME 'EmploymentHistory';
				
				SET employment.ind:EmploymentStatus		=	inRef.FIXferModRq.FIXferInfo.Receiver.PersonInfo.[COUNTER_EMPLOYMENT].EmploymentStatus;				

				DECLARE orgInfo REFERENCE TO employment;
				DECLARE industId REFERENCE TO employment;
				DECLARE composite REFERENCE TO employment;
				DECLARE general REFERENCE TO employment;
								
				FOR orgFor AS inRef.FIXferModRq.FIXferInfo.Receiver.PersonInfo.[COUNTER_EMPLOYMENT].OrgInfo[] DO
					CREATE LASTCHILD OF employment AS orgInfo NAMESPACE ind NAME 'OrgInfo';
					
					FOR industFor AS inRef.FIXferModRq.FIXferInfo.Receiver.PersonInfo.[COUNTER_EMPLOYMENT].OrgInfo.IndustId[] DO
						CREATE LASTCHILD OF orgInfo AS industId NAMESPACE orgs NAME 'IndustId';
						
						SET industId.orgs:Org			=	industFor.Org;
						SET industId.orgs:IndustNum		=	industFor.IndustNum;
						SET industId.orgs:SubIndustrNum =   industFor.SubIndustrNum;
						SET industId.orgs:IsPrimary	    =   industFor.IsPrimary;						
					END FOR;
					
					SET orgInfo.orgs:Name 			=	orgFor.Name;	
					SET orgInfo.orgs:LegalName 		=	orgFor.LegalName;
					SET orgInfo.orgs:LegalNameEn 	=	orgFor.LegalNameEn;
					SET orgInfo.orgs:FullNameEn 	=	orgFor.FullNameEn;
					SET orgInfo.orgs:MnemonicName 	=	orgFor.MnemonicName;
					
					FOR compositeFor AS inRef.FIXferModRq.FIXferInfo.Receiver.PersonInfo.[COUNTER_EMPLOYMENT].OrgInfo.CompositeContactInfo[] DO
						CREATE LASTCHILD OF orgInfo AS composite NAMESPACE orgs NAME 'CompositeContactInfo';
						
						SET composite.ca:ContactInfoType	=  compositeFor.ContactInfoType;
						
						FOR contactFor AS inRef.FIXferModRq.FIXferInfo.Receiver.PersonInfo.[COUNTER_EMPLOYMENT].OrgInfo.CompositeContactInfo.ContactInfo[] DO
							CREATE LASTCHILD OF composite AS contactInfo NAMESPACE ca NAME 'ContactInfo';
							
							SET contactInfo.ca:ContactPref		=	contactFor.ContactPref;
							SET contactInfo.ca:PrefTimeStart	=	contactFor.PrefTimeStart;
							SET contactInfo.ca:PrefTimeEnd		=	contactFor.PrefTimeEnd;
							
							FOR phoneFor AS inRef.FIXferModRq.FIXferInfo.Receiver.PersonInfo.[COUNTER_EMPLOYMENT].OrgInfo.CompositeContactInfo.ContactInfo.PhoneNum[] DO		
								CREATE LASTCHILD OF contactInfo AS general NAMESPACE ca NAME 'PhoneNum';
								
								SET general.ca:PhoneType		=	phoneFor.PhoneType;
								SET general.ca:Phone			=	phoneFor.Phone;
								SET general.ca:PhoneCode		=	phoneFor.PhoneCode;
								SET general.ca:PhoneOperName	=	phoneFor.PhoneOperName;								
							END FOR;
							
							SET contactInfo.ca:ContactName		=	contactFor.ContactName;
							SET contactInfo.ca:EmailAddr		=	contactFor.EmailAddr;
							SET contactInfo.ca:URL				=	contactFor.URL;
							
							FOR contactDataFor AS inRef.FIXferModRq.FIXferInfo.Receiver.PersonInfo.[COUNTER_EMPLOYMENT].OrgInfo.CompositeContactInfo.ContactInfo.ContactData[] DO
								CREATE LASTCHILD OF contactInfo AS general NAMESPACE ca NAME 'ContactData';
								
								SET general.ca:ContactType		=	contactDataFor.ContactType;
								SET general.ca:ContactValue		=	contactDataFor.ContactValue;
								SET general.ca:PrefTimeStart	=	contactDataFor.PrefTimeStart;
								SET general.ca:PrefTimeEnd		=	contactDataFor.PrefTimeEnd;
							END FOR;
							
							FOR postAddrFor AS inRef.FIXferModRq.FIXferInfo.Receiver.PersonInfo.[COUNTER_EMPLOYMENT].OrgInfo.CompositeContactInfo.ContactInfo.PostAddr[] DO
								CREATE LASTCHILD OF contactInfo AS general NAMESPACE ca NAME 'PostAddr';
								
								SET general.ca:Addr1			=	postAddrFor.Addr1;
								SET general.ca:Addr2			=	postAddrFor.Addr2;
								SET general.ca:Addr3			=	postAddrFor.Addr3;
								SET general.ca:Addr4			=	postAddrFor.Addr4;
								SET general.ca:City				=	postAddrFor.City;
								SET general.ca:CityCode			=	postAddrFor.CityCode;
								SET general.ca:StateProv		=	postAddrFor.StateProv;
								SET general.ca:StateProvCode	=	postAddrFor.StateProvCode;
								SET general.ca:Area				=	postAddrFor.Area;
								SET general.ca:AreaCode			=	postAddrFor.AreaCode;
								SET general.ca:PostalCode		=	postAddrFor.PostalCode;
								SET general.ca:Country		    =	postAddrFor.Country;
								SET general.ca:CountryCode	    =	postAddrFor.CountryCode;
								SET general.ca:AddrType		    =	postAddrFor.AddrType;

--								SET general.ca:StartDt		    =	postAddrFor.StartDt;
---								SET general.ca:EndDt		    =	postAddrFor.EndDt;
								
								IF FIELDVALUE(postAddrFor.StartDt) <> '' THEN
		 				            SET varStartDt			    = 	FIELDVALUE(postAddrFor.StartDt);
									SET general.ca:StartDt		= 	SUBSTRING(varStartDt FROM 1 FOR 10);
								END IF;
		
								IF FIELDVALUE(postAddrFor.EndDt) <> '' THEN
		 				            SET varEndDt			    = 	FIELDVALUE(postAddrFor.EndDt);
									SET general.ca:EndDt		= 	SUBSTRING(varEndDt FROM 1 FOR 10);
								END IF;
								
								SET general.ca:DistrictCode	    =	postAddrFor.DistrictCode;
								SET general.ca:District		    =	postAddrFor.District;
---								SET general.ca:PlaceCode	    =	postAddrFor.PlaceCode;
								
								SET varPlaceCode		        = 	FIELDVALUE(postAddrFor.PlaceCode);
								IF varPlaceCode <> '' THEN
									SET general.ca:PlaceCode       =   varPlaceCode;
								END IF;   
								
								SET general.ca:Place		    =	postAddrFor.Place;
								SET general.ca:StreetCode	    =	postAddrFor.StreetCode;
								SET general.ca:Street		    =	postAddrFor.Street;
								SET general.ca:House		    =	postAddrFor.House;
								SET general.ca:Corpus		    =	postAddrFor.Corpus;
								SET general.ca:Building		    =	postAddrFor.Building;
								SET general.ca:Flat			    =	postAddrFor.Flat;
								SET general.ca:Office		    =	postAddrFor.Office;
								SET general.ca:RusKLADR	   	 	=	postAddrFor.RusKLADR;
								SET general.ca:AddrStatus	    =	postAddrFor.AddrStatus;
							END FOR;
							
							SET contactInfo.ca:ProviderCode				=	contactFor.ProviderCode;
						END FOR;						
												
					END FOR;
					
					DECLARE licensesInfo REFERENCE TO orgInfo;
					CREATE LASTCHILD OF orgInfo AS licensesInfo NAMESPACE orgs NAME 'Licenses';
					DECLARE licenseInfo REFERENCE TO orgInfo;
					
					FOR licenseFor AS inRef.FIXferModRq.FIXferInfo.Receiver.PersonInfo.[COUNTER_EMPLOYMENT].OrgInfo.Licenses.LicenseInfo[] DO
						CREATE LASTCHILD OF licensesInfo AS licenseInfo NAMESPACE orgs NAME 'LicenseInfo';
						
						SET licenseInfo.orgs:LicenseType	=	licenseFor.LicenseType;
						SET licenseInfo.orgs:LicenseStatus	=	licenseFor.LicenseStatus;
						SET licenseInfo.orgs:LicenseSerie	=	licenseFor.LicenseSerie;
						SET licenseInfo.orgs:LicenseNum		=	licenseFor.LicenseNum;
						
						IF COALESCE(FIELDVALUE(licenseFor.LicenseIssueDt),'') <> '' THEN       
						   SET licenseInfo.orgs:LicenseIssueDt             = licenseFor.LicenseIssueDt;       
						END IF;       
						
						SET licenseInfo.orgs:LicenseIssueBy	=	licenseFor.LicenseIssueBy;
					END FOR;
										
					SET orgInfo.orgs:TINInfo.ca:TINType 			=	orgFor.TINInfo.TINType;
					SET orgInfo.orgs:TINInfo.ca:TaxId	 			=	orgFor.TINInfo.TaxId;
					SET orgInfo.orgs:TINInfo.ca:CertCode 			=	orgFor.TINInfo.CertCode;	
					
					SET orgInfo.orgs:KIOInfo.ca:TINType 			=	orgFor.KIOInfo.TINType;
					SET orgInfo.orgs:KIOInfo.ca:TaxId	 			=	orgFor.KIOInfo.TaxId;
					SET orgInfo.orgs:KIOInfo.ca:CertCode 			=	orgFor.KIOInfo.CertCode;
					
					SET orgInfo.orgs:EstablishDt		 			=	orgFor.EstablishDt;
					SET orgInfo.orgs:NumEmployees		 			=	orgFor.NumEmployees;
					SET orgInfo.orgs:EmployerCode		 			=	orgFor.EmployerCode;
					
				END FOR;
				
				SET employment.ind:Occupation			=	inRef.FIXferModRq.FIXferInfo.Receiver.PersonInfo.[COUNTER_EMPLOYMENT].Occupation;	 	
				
				SET employment.ind:Income.ca:Amt			=	inRef.FIXferModRq.FIXferInfo.Receiver.PersonInfo.[COUNTER_EMPLOYMENT].Income.Amt;
				SET employment.ind:Income.ca:Reversal		=	inRef.FIXferModRq.FIXferInfo.Receiver.PersonInfo.[COUNTER_EMPLOYMENT].Income.Reversal;
				SET employment.ind:Income.ca:CurCode		=	inRef.FIXferModRq.FIXferInfo.Receiver.PersonInfo.[COUNTER_EMPLOYMENT].Income.CurCode;	
				SET employment.ind:Income.ca:CurRate		=	inRef.FIXferModRq.FIXferInfo.Receiver.PersonInfo.[COUNTER_EMPLOYMENT].Income.CurRate;
				SET employment.ind:Income.ca:CurConvertRule	=	inRef.FIXferModRq.FIXferInfo.Receiver.PersonInfo.[COUNTER_EMPLOYMENT].Income.CurConvertRule; 	
				
				SET employment.ind:JobTitle			=	inRef.FIXferModRq.FIXferInfo.Receiver.PersonInfo.[COUNTER_EMPLOYMENT].JobTitle;	 
				SET employment.ind:StartDt			=	inRef.FIXferModRq.FIXferInfo.Receiver.PersonInfo.[COUNTER_EMPLOYMENT].StartDt;
				SET employment.ind:EndDt			=	inRef.FIXferModRq.FIXferInfo.Receiver.PersonInfo.[COUNTER_EMPLOYMENT].EndDt;			

			END IF;
							
			SET COUNTER_EMPLOYMENT = COUNTER_EMPLOYMENT + 1;
		END WHILE;	
		
		/*IF COALESCE(FIELDVALUE(inRef.FIXferModRq.FIXferInfo.Receiver.PersonInfo.Gender),'') <> '' THEN       
		   SET personInfo.ind:Gender       = inRef.FIXferModRq.FIXferInfo.Receiver.PersonInfo.Gender;
		END IF;  */     
		
		SET personInfo.ind:MaritalStatus					=  inRef.FIXferModRq.FIXferInfo.Receiver.PersonInfo.MaritalStatus;
		SET personInfo.ind:USAMilitaryRank					=  inRef.FIXferModRq.FIXferInfo.Receiver.PersonInfo.USAMilitaryRank;
		SET personInfo.ind:Dependets						=  inRef.FIXferModRq.FIXferInfo.Receiver.PersonInfo.Dependets;
		
		IF EXISTS(inRef.FIXferModRq.FIXferInfo.Receiver.PersonInfo.Passport[]) THEN
			SET personInfo.ind:Passport.ind:PassportNumber		=  COALESCE(inRef.FIXferModRq.FIXferInfo.Receiver.PersonInfo.Passport.PassportNumber, NULL);
			SET personInfo.ind:Passport.ind:DocSeries			=  COALESCE(inRef.FIXferModRq.FIXferInfo.Receiver.PersonInfo.Passport.DocSeries, NULL);
			SET personInfo.ind:Passport.ind:PassportCountry		=  COALESCE(inRef.FIXferModRq.FIXferInfo.Receiver.PersonInfo.Passport.PassportCountry, NULL);
			SET personInfo.ind:Passport.ind:IssueLoc			=  COALESCE(inRef.FIXferModRq.FIXferInfo.Receiver.PersonInfo.Passport.IssueLoc, NULL);
			SET personInfo.ind:Passport.ind:IssDt				=  COALESCE(inRef.FIXferModRq.FIXferInfo.Receiver.PersonInfo.Passport.IssDt, NULL);
			SET personInfo.ind:Passport.ind:ExpDt				=  COALESCE(inRef.FIXferModRq.FIXferInfo.Receiver.PersonInfo.Passport.ExpDt, NULL);
		END IF;
		
		SET personInfo.ind:OEDCode							=  inRef.FIXferModRq.FIXferInfo.Receiver.PersonInfo.OEDCode;
		SET personInfo.ind:"OEDInstitution_Type"			=  inRef.FIXferModRq.FIXferInfo.Receiver.PersonInfo."OEDInstitution_Type";
		
		IF EXISTS(inRef.FIXferModRq.FIXferInfo.Receiver.PersonInfo.GovIssueIdent[]) THEN
			SET personInfo.ind:GovIssueIdent.ind:GovIssueIdentType	=  COALESCE(inRef.FIXferModRq.FIXferInfo.Receiver.PersonInfo.GovIssueIdent.GovIssueIdentType, NULL);
			SET personInfo.ind:GovIssueIdent.ind:IdentSerialNum  	=  COALESCE(inRef.FIXferModRq.FIXferInfo.Receiver.PersonInfo.GovIssueIdent.IdentSerialNum, NULL);
			SET personInfo.ind:GovIssueIdent.ind:GovOrg			 	=  COALESCE(inRef.FIXferModRq.FIXferInfo.Receiver.PersonInfo.GovIssueIdent.GovOrg, NULL);
			SET personInfo.ind:GovIssueIdent.ind:GovOrgName		 	=  COALESCE(inRef.FIXferModRq.FIXferInfo.Receiver.PersonInfo.GovIssueIdent.GovOrgName, NULL);
			SET personInfo.ind:GovIssueIdent.ind:GovRank		  	=  COALESCE(inRef.FIXferModRq.FIXferInfo.Receiver.PersonInfo.GovIssueIdent.GovRank, NULL);
			SET personInfo.ind:GovIssueIdent.ind:StateProv		 	=  COALESCE(inRef.FIXferModRq.FIXferInfo.Receiver.PersonInfo.GovIssueIdent.StateProv, NULL);
			SET personInfo.ind:GovIssueIdent.ind:Country		 	=  COALESCE(inRef.FIXferModRq.FIXferInfo.Receiver.PersonInfo.GovIssueIdent.Country, NULL);
			SET personInfo.ind:GovIssueIdent.ind:Desc			  	=  COALESCE(inRef.FIXferModRq.FIXferInfo.Receiver.PersonInfo.GovIssueIdent.Desc, NULL);
			SET personInfo.ind:GovIssueIdent.ind:IssDt			  	=  COALESCE(inRef.FIXferModRq.FIXferInfo.Receiver.PersonInfo.GovIssueIdent.IssDt, NULL);
			SET personInfo.ind:GovIssueIdent.ind:ExpDt			  	=  COALESCE(inRef.FIXferModRq.FIXferInfo.Receiver.PersonInfo.GovIssueIdent.ExpDt, NULL);
			SET personInfo.ind:GovIssueIdent.ind:IdentSerie		  	=  COALESCE(inRef.FIXferModRq.FIXferInfo.Receiver.PersonInfo.GovIssueIdent.IdentSerie, NULL);
			SET personInfo.ind:GovIssueIdent.ind:GovOrgUnit		  	=  COALESCE(inRef.FIXferModRq.FIXferInfo.Receiver.PersonInfo.GovIssueIdent.GovOrgUnit, NULL);
		END IF;
		
		IF EXISTS(inRef.FIXferModRq.FIXferInfo.Receiver.PersonInfo.OtherIdentDoc[]) THEN
			SET personInfo.ind:OtherIdentDoc.ind:Desc			  	=  COALESCE(inRef.FIXferModRq.FIXferInfo.Receiver.PersonInfo.OtherIdentDoc.Desc, NULL);
			SET personInfo.ind:OtherIdentDoc.ind:IdentSerialNum  	=  COALESCE(inRef.FIXferModRq.FIXferInfo.Receiver.PersonInfo.OtherIdentDoc.IdentSerialNum, NULL);
			SET personInfo.ind:OtherIdentDoc.ind:Issuer			 	=  COALESCE(inRef.FIXferModRq.FIXferInfo.Receiver.PersonInfo.OtherIdentDoc.Issuer, NULL);
			SET personInfo.ind:OtherIdentDoc.ind:IssueLoc		  	=  COALESCE(inRef.FIXferModRq.FIXferInfo.Receiver.PersonInfo.OtherIdentDoc.IssueLoc, NULL);
			SET personInfo.ind:OtherIdentDoc.ind:IssDt			 	=  COALESCE(inRef.FIXferModRq.FIXferInfo.Receiver.PersonInfo.OtherIdentDoc.IssDt, NULL);
			SET personInfo.ind:OtherIdentDoc.ind:ExpDt			  	=  COALESCE(inRef.FIXferModRq.FIXferInfo.Receiver.PersonInfo.OtherIdentDoc.ExpDt, NULL);
		END IF;
		
		--DECLARE identityCard REFERENCE TO personInfo;
		CREATE LASTCHILD OF personInfo AS identityCards NAMESPACE ind NAME 'IdentityCards';
		
		FOR identityFor AS inRef.FIXferModRq.FIXferInfo.Receiver.PersonInfo.IdentityCards.IdentityCard[] DO
			
			CREATE LASTCHILD OF identityCards AS identityCard NAMESPACE ind NAME 'IdentityCard';
			
			SET identityCard.ind:IdType				=	identityFor.IdType;
			/*SET identityCard.ind:IdStatus			=	identityFor.IdStatus;
			SET identityCard.ind:IdSeries			=	identityFor.IdSeries;*/
			SET identityCard.ind:IdNum				=	identityFor.IdNum;
			
			IF COALESCE(FIELDVALUE(identityFor.IssueDt),'') <> '' THEN       
			   SET identityCard.ind:IssueDt             = identityFor.IssueDt;       
			END IF;       
			
			SET identityCard.ind:IssuedBy			=	identityFor.IssuedBy;
			/*SET identityCard.ind:Code				=	identityFor.Code;
			SET identityCard.ind:IssueLoc			=	identityFor.IssueLoc;
			SET identityCard.ind:IssuedCountry		=	identityFor.IssuedCountry;

			IF COALESCE(FIELDVALUE(identityFor.IssuedRegionCode),'') <> '' THEN       
			  SET identityCard.ind:IssuedRegionCode	=	identityFor.IssuedRegionCode;
			END IF;       
			
			IF FIELDVALUE(identityFor.ExpDt) <> '' THEN
				SET identityCard.ind:ExpDt			=  SUBSTRING(COALESCE(identityFor.ExpDt, NULL) BEFORE 'T');
			END IF;*/
	END FOR;
		
		SET personInfo.ind:BirthPlace			  	=  inRef.FIXferModRq.FIXferInfo.Receiver.PersonInfo.BirthPlace;
		--SET personInfo.ind:Resident				  	=  inRef.FIXferModRq.FIXferInfo.Receiver.PersonInfo.Resident;
		SET personInfo.ind:MilitaryDocFlag		  	=  inRef.FIXferModRq.FIXferInfo.Receiver.PersonInfo.MilitaryDocFlag;
		SET personInfo.ind:Citizenship			  	=  inRef.FIXferModRq.FIXferInfo.Receiver.PersonInfo.Citizenship;
		
		SET fixferInfo.mtblitz:OrigDt				=  inRef.FIXferModRq.FIXferInfo.OrigDt;
		
		IF COALESCE(FIELDVALUE(inRef.FIXferModRq.FIXferInfo.RegDt),'') <> '' THEN
			SET fixferInfo.mtblitz:RegDt			=  SUBSTRING(COALESCE(inRef.FIXferModRq.FIXferInfo.RegDt, NULL) BEFORE 'T');
		END IF;
		
		SET fixferInfo.mtblitz:AdvNum				=  inRef.FIXferModRq.FIXferInfo.AdvNum;
		SET fixferInfo.mtblitz:FIXferId				=  inRef.FIXferModRq.FIXferInfo.FIXferId;
		SET fixferInfo.mtblitz:FIXferMethod			=  inRef.FIXferModRq.FIXferInfo.FIXferMethod;
		SET fixferInfo.mtblitz:Purpose				=  inRef.FIXferModRq.FIXferInfo.Purpose;
--		SET fixferInfo.mtblitz:Memo					=  inRef.FIXferModRq.FIXferInfo.Memo;

		SET fixferInfo.mtblitz:Memo					=  REPLACE(inRef.FIXferModRq.FIXferInfo.Memo, '"', '&#34');
		
		DECLARE subFields REFERENCE TO fixferInfo;
		CREATE LASTCHILD OF fixferInfo AS subFields NAMESPACE mtblitz NAME 'SecretPrompt';
		
		SET subFields.mt:Prompt						=   inRef.FIXferModRq.FIXferInfo.SecretPrompt.Prompt;
--		SET subFields.mt:Memo						=   inRef.FIXferModRq.FIXferInfo.SecretPrompt.Memo;
		
		SET subFields.mt:Memo						=   REPLACE(inRef.FIXferModRq.FIXferInfo.SecretPrompt.Memo, '"', '&#34');

		CREATE LASTCHILD OF fixferInfo AS subFields NAMESPACE mtblitz NAME 'SettlementInfo';
		
		SET subFields.mtblitz:ReceiveCurCode		=   inRef.FIXferModRq.FIXferInfo.SettlementInfo.ReceiveCurCode;
		SET subFields.mtblitz:ReceiveAmtEst 		=   inRef.FIXferModRq.FIXferInfo.SettlementInfo.ReceiveAmtEst;
		SET subFields.mtblitz:SendAmt				=   inRef.FIXferModRq.FIXferInfo.SettlementInfo.SendAmt;
		SET subFields.mtblitz:SendCurCode			=   inRef.FIXferModRq.FIXferInfo.SettlementInfo.SendCurCode;
		
		CREATE LASTCHILD OF fixferInfo AS subFields NAMESPACE mtblitz NAME 'FeeChargeAlloc';
		
		SET subFields.mtblitz:Fee.ca:FeeType					=	inRef.FIXferModRq.FIXferInfo.FeeChargeAlloc.Fee.FeeType;
		
		SET subFields.mtblitz:Fee.ca:CurAmt.ca:Amt 						=	inRef.FIXferModRq.FIXferInfo.FeeChargeAlloc.Fee.CurAmt.Amt;
		SET subFields.mtblitz:Fee.ca:CurAmt.ca:Reversal 				=	inRef.FIXferModRq.FIXferInfo.FeeChargeAlloc.Fee.CurAmt.Reversal;
		SET subFields.mtblitz:Fee.ca:CurAmt.ca:CurCode					=	inRef.FIXferModRq.FIXferInfo.FeeChargeAlloc.Fee.CurAmt.CurCode;
		SET subFields.mtblitz:Fee.ca:CurAmt.ca:CurRate	 				=	inRef.FIXferModRq.FIXferInfo.FeeChargeAlloc.Fee.CurAmt.CurRate;
		SET subFields.mtblitz:Fee.ca:CurAmt.ca:CurConvertRule	 		=	inRef.FIXferModRq.FIXferInfo.FeeChargeAlloc.Fee.CurAmt.CurConvertRule;
		
		SET subFields.mtblitz:Fee.ca:Rate								=	inRef.FIXferModRq.FIXferInfo.FeeChargeAlloc.Fee.Rate;
		
		IF EXISTS(inRef.FIXferModRq.FIXferInfo.FeeChargeAlloc.Fee.MinCurAmt[]) THEN
			SET subFields.mtblitz:Fee.ca:MinCurAmt.ca:Amt 					=	COALESCE(inRef.FIXferModRq.FIXferInfo.FeeChargeAlloc.Fee.MinCurAmt.Amt, NULL);
			SET subFields.mtblitz:Fee.ca:MinCurAmt.ca:Reversal 				=	COALESCE(inRef.FIXferModRq.FIXferInfo.FeeChargeAlloc.Fee.MinCurAmt.Reversal, NULL);
			SET subFields.mtblitz:Fee.ca:MinCurAmt.ca:CurCode				=	COALESCE(inRef.FIXferModRq.FIXferInfo.FeeChargeAlloc.Fee.MinCurAmt.CurCode, NULL);
			SET subFields.mtblitz:Fee.ca:MinCurAmt.ca:CurRate	 			=	COALESCE(inRef.FIXferModRq.FIXferInfo.FeeChargeAlloc.Fee.MinCurAmt.CurRate, NULL);
			SET subFields.mtblitz:Fee.ca:MinCurAmt.ca:CurConvertRule	 	=	COALESCE(inRef.FIXferModRq.FIXferInfo.FeeChargeAlloc.Fee.MinCurAmt.CurConvertRule, NULL);
		END IF;
		
		IF EXISTS(inRef.FIXferModRq.FIXferInfo.FeeChargeAlloc.Fee.MaxCurAmt[]) THEN
			SET subFields.mtblitz:Fee.ca:MaxCurAmt.ca:Amt 					=	COALESCE(inRef.FIXferModRq.FIXferInfo.FeeChargeAlloc.Fee.MaxCurAmt.Amt, NULL);
			SET subFields.mtblitz:Fee.ca:MaxCurAmt.ca:Reversal 				=	COALESCE(inRef.FIXferModRq.FIXferInfo.FeeChargeAlloc.Fee.MaxCurAmt.Reversal, NULL);
			SET subFields.mtblitz:Fee.ca:MaxCurAmt.ca:CurCode				=	COALESCE(inRef.FIXferModRq.FIXferInfo.FeeChargeAlloc.Fee.MaxCurAmt.CurCode, NULL);
			SET subFields.mtblitz:Fee.ca:MaxCurAmt.ca:CurRate	 			=	COALESCE(inRef.FIXferModRq.FIXferInfo.FeeChargeAlloc.Fee.MaxCurAmt.CurRate, NULL);
			SET subFields.mtblitz:Fee.ca:MaxCurAmt.ca:CurConvertRule	 	=	COALESCE(inRef.FIXferModRq.FIXferInfo.FeeChargeAlloc.Fee.MaxCurAmt.CurConvertRule, NULL);
		END IF;
		
		SET subFields.mtblitz:Fee.ca:RateType							=	inRef.FIXferModRq.FIXferInfo.FeeChargeAlloc.Fee.RateType;
		
		IF EXISTS(inRef.FIXferModRq.FIXferInfo.Confirmation[]) THEN
			CREATE LASTCHILD OF fixferInfo AS subFields NAMESPACE mtblitz NAME 'Confirmation';
		
			SET subFields.mtblitz:Confirmed					=	inRef.FIXferModRq.FIXferInfo.Confirmation.Confirmed;	
			--SET subFields.mtblitz:ConfDt					=	inRef.FIXferModRq.FIXferInfo.Confirmation.ConfDt;
			
			IF FIELDVALUE(inRef.FIXferModRq.FIXferInfo.Confirmation.ConfDt) <> '' THEN
				SET subFields.mtblitz:ConfDt			=  SUBSTRING(COALESCE(inRef.FIXferModRq.FIXferInfo.Confirmation.ConfDt, NULL) BEFORE 'T');
			END IF;
			
---			SET subFields.mtblitz:Memo						=	inRef.FIXferModRq.FIXferInfo.Confirmation.Memo;

			SET subFields.mtblitz:Memo						=	REPLACE(inRef.FIXferModRq.FIXferInfo.Confirmation.Memo, '"', '&#34');
		END IF;
		
		IF EXISTS(inRef.FIXferModRq.FIXferInfo.Checksum[]) THEN
			CREATE LASTCHILD OF fixferInfo AS subFields NAMESPACE mtblitz NAME 'Checksum';
		
			SET subFields.mt:ChecksumType				=	inRef.FIXferModRq.FIXferInfo.Checksum.ChecksumType;	
			SET subFields.mt:ChksumValue				=	inRef.FIXferModRq.FIXferInfo.Checksum.ChksumValue;
		END IF;
		
		/* SIGNATURE */
		DECLARE signature REFERENCE TO outRef;
		DECLARE keyInfo REFERENCE TO signature;		
		DECLARE userRole REFERENCE TO keyInfo;
				
		FOR signatureFor AS inRef.FIXferModRq.Signature[] DO					
			CREATE LASTCHILD OF outRef AS signature NAMESPACE mtblitz NAME 'Signature';
			
			SET signature.mt:SignatureValue				=  signatureFor.SignatureValue;
			---SET signature.mt:SignedData					=  REPLACE(signatureFor.SignedData, '"', '&#34');
			
			FOR keyFor AS inRef.FIXferModRq.Signature.KeyInfo[] DO	
				
				CREATE LASTCHILD OF signature AS keyInfo NAMESPACE mt NAME 'KeyInfo';
				
				SET keyInfo.iam:X509SubjectName		=  keyFor.X509SubjectName;	
				SET keyInfo.iam:KeyName				=  keyFor.KeyName;
				SET keyInfo.iam:RegionId			=  keyFor.RegionId;
				
				CALL FillSomeField(keyFor, keyInfo, 'iam', 'UserRole');				
				
			END FOR;
			
			FOR userFor AS inRef.FIXferModRq.Signature.UserInfo[] DO
				
				CREATE LASTCHILD OF signature AS userInfo NAMESPACE mt NAME 'UserInfo';
				
				SET userInfo.iam:UserId			=	userFor.UserId;
				SET userInfo.iam:RegionId		=	userFor.RegionId;
				SET userInfo.iam:FullName		=	userFor.FullName;
				SET userInfo.iam:OrgId			=	userFor.OrgId;
				SET userInfo.iam:OrgName		=	userFor.OrgName;
				SET userInfo.iam:OrgUnitId		=	userFor.OrgUnitId;
				SET userInfo.iam:OrgUnitName	=	userFor.OrgUnitNam;
				SET userInfo.iam:EmployeeId		=	userFor.EmployeeId;
				SET userInfo.iam:IpAddr			=	userFor.IpAddr;
				
				FOR certFor AS inRef.FIXferModRq.Signature.UserInfo.CertInfo[] DO
					
					CREATE LASTCHILD OF userInfo AS certInfo NAMESPACE iam NAME 'CertInfo';
					
					SET certInfo.iam:X509SubjectName	=	certFor.X509SubjectName;
					SET certInfo.iam:KeyName			=	certFor.KeyName;
					SET certInfo.iam:RegionId			=	certFor.RegionId;
					
					CALL FillSomeField(certFor, certInfo, 'iam', 'UserRole');
					
					SET certInfo.iam:Certificate		=	certFor.Certificate;
				END FOR;	
			END FOR;
		END FOR;      

		RETURN TRUE;
	END;			
END MODULE;
/* 7-ой сервис */

/* 8-ой сервис */
CREATE COMPUTE MODULE RequestForKolibri_ConvertMDO2CRM_KZSrvBLCancelMoneyTransferGettingRq
	CREATE FUNCTION Main() RETURNS BOOLEAN
	BEGIN
	    CALL CopyMessageHeaders(InputRoot,OutputRoot);
		
		DECLARE inRef REFERENCE TO InputRoot.XMLNSC.[<];
		DECLARE outRef REFERENCE TO OutputRoot.XMLNSC.*[<];
				
	    SET OutputRoot.MQMD.ReplyToQ	= 'ESB.QPRAGMA.OUT';
	    SET OutputRoot.MQMD.ReplyToQMgr	= 'IKAZ.ESB.OUT.GW1';				
				
		CREATE LASTCHILD OF OutputRoot DOMAIN('XMLNSC') NAME 'XMLNSC';
		CREATE LASTCHILD OF OutputRoot.XMLNSC AS outRef NAMESPACE mtblitz NAME 'FIXferLockCanRq'; 
		
    	SET OutputRoot.XMLNSC.mtblitz:FIXferLockCanRq.(XMLNSC.NamespaceDecl)xmlns:iam     = iam;
		SET OutputRoot.XMLNSC.mtblitz:FIXferLockCanRq.(XMLNSC.NamespaceDecl)xmlns:mt      = mt;		
    	SET OutputRoot.XMLNSC.mtblitz:FIXferLockCanRq.(XMLNSC.NamespaceDecl)xmlns:ca      = ca; 
		SET OutputRoot.XMLNSC.mtblitz:FIXferLockCanRq.(XMLNSC.NamespaceDecl)xmlns:mtblitz = mtblitz; 	
    	SET OutputRoot.XMLNSC.mtblitz:FIXferLockCanRq.(XMLNSC.NamespaceDecl)xmlns:ind     = ind; 
		
		SET outRef.mt:RqUID			= inRef.RqUID;
		SET outRef.mt:RqTm			= convertFromQPtoKOLI(inRef.RqTm);
		SET outRef.mt:SPName		= 'urn:sbrfsystems:98-abs';
		SET outRef.mt:OperName		= 'SrvBLCancelMoneyTransferGetting';

/*		Verion 1.0                               
		SET outRef.mtblitz:UserInfo		    = inRef.FIXferLockCanRq.mtblitz:UserInfo;       
		SET outRef.mtblitz:FIXferInfo	    = inRef.FIXferLockCanRq.mtblitz:FIXferInfo;       
		SET outRef.mtblitz:FIXferOperInfo	= inRef.FIXferLockCanRq.mtblitz:FIXferOperInfo;       
*/

/*		Verion 2.0  */                             
/*		mtblitz:UserInfo ------------------------------------------------------------------------------------------------ */       

		SET outRef.mtblitz:UserInfo.iam:UserId         = inRef.FIXferLockCanRq.UserInfo.UserId;       
		SET outRef.mtblitz:UserInfo.iam:RegionId       = inRef.FIXferLockCanRq.UserInfo.RegionId;       
		SET outRef.mtblitz:UserInfo.iam:FullName       = inRef.FIXferLockCanRq.UserInfo.FullName;       
		SET outRef.mtblitz:UserInfo.iam:OrgId          = inRef.FIXferLockCanRq.UserInfo.OrgId;       
		SET outRef.mtblitz:UserInfo.iam:OrgName        = inRef.FIXferLockCanRq.UserInfo.OrgName;       
		SET outRef.mtblitz:UserInfo.iam:OrgUnitId      = inRef.FIXferLockCanRq.UserInfo.OrgUnitId;       
		SET outRef.mtblitz:UserInfo.iam:OrgUnitName    = inRef.FIXferLockCanRq.UserInfo.OrgUnitName;       
		SET outRef.mtblitz:UserInfo.iam:EmployeeId     = inRef.FIXferLockCanRq.UserInfo.EmployeeId;       
		SET outRef.mtblitz:UserInfo.iam:IpAddr         = inRef.FIXferLockCanRq.UserInfo.IpAddr;       

		DECLARE outUserInfo REFERENCE TO outRef.mtblitz:UserInfo;
		DECLARE outCertInfo REFERENCE TO outUserInfo;

		FOR inCertInfo AS inRef.FIXferLockCanRq.UserInfo.CertInfo[] DO			
		    CREATE LASTCHILD OF outUserInfo AS outCertInfo NAME 'iam:CertInfo';
		    
			SET outCertInfo.iam:X509SubjectName         = inCertInfo.X509SubjectName;       
			SET outCertInfo.iam:KeyName                 = inCertInfo.KeyName;       
			SET outCertInfo.iam:RegionId                = inCertInfo.RegionId;       

			CALL FillSomeField(inCertInfo, outCertInfo, 'iam', 'UserRole');				

			SET outCertInfo.iam:Certificate             = inCertInfo.Certificate;       
		END FOR;

/*		mtblitz:FIXferInfo ------------------------------------------------------------------------------------------------ */       

		SET outRef.mtblitz:FIXferInfo.mtblitz:Owner.mtblitz:BankInfo.mtblitz:BankId         = inRef.FIXferLockCanRq.FIXferInfo.Owner.BankInfo.BankId;       
		SET outRef.mtblitz:FIXferInfo.mtblitz:Owner.mtblitz:BankInfo.mtblitz:Country        = inRef.FIXferLockCanRq.FIXferInfo.Owner.BankInfo.Country;       
		SET outRef.mtblitz:FIXferInfo.mtblitz:Owner.mtblitz:BankInfo.mtblitz:City           = inRef.FIXferLockCanRq.FIXferInfo.Owner.BankInfo.City;
		       
		SET outRef.mtblitz:FIXferInfo.mtblitz:Receiver.mtblitz:PersonInfo.ind:NameAddrType  = inRef.FIXferLockCanRq.FIXferInfo.Receiver.PersonInfo.NameAddrType;
		SET outRef.mtblitz:FIXferInfo.mtblitz:Receiver.mtblitz:PersonInfo.ind:FullName      = inRef.FIXferLockCanRq.FIXferInfo.Receiver.PersonInfo.FullName;

		DECLARE outPersonInfo    REFERENCE TO outRef.mtblitz:FIXferInfo.mtblitz:Receiver.mtblitz:PersonInfo;
		DECLARE outContactInfo   REFERENCE TO outPersonInfo;
		DECLARE outIdentityCard  REFERENCE TO outPersonInfo;

		DECLARE outPhoneNum    REFERENCE TO outContactInfo;
		DECLARE outContactData REFERENCE TO outContactInfo;
		DECLARE outPostAddr    REFERENCE TO outContactInfo;

		FOR inContactInfo AS inRef.FIXferLockCanRq.FIXferInfo.Receiver.PersonInfo.ContactInfo[] DO			
		    CREATE LASTCHILD OF outPersonInfo AS outContactInfo NAME 'ind:ContactInfo';
		    
			SET outContactInfo.ca:ContactPref         = inContactInfo.ContactPref;       

			IF COALESCE(FIELDVALUE(inContactInfo.PrefTimeStart),'') <> '' THEN       
			   SET outContactInfo.ca:PrefTimeStart       = inContactInfo.PrefTimeStart;
			END IF;       
			
			IF COALESCE(FIELDVALUE(inContactInfo.PrefTimeEnd),'') <> '' THEN       
			   SET outContactInfo.ca:PrefTimeEnd         = inContactInfo.PrefTimeEnd;       
			END IF;       
			
		    FOR inPhoneNum AS inContactInfo.PhoneNum[] DO			
		        CREATE LASTCHILD OF outContactInfo AS outPhoneNum NAME 'ca:PhoneNum';
				SET outPhoneNum.ca:PhoneType                = inPhoneNum.PhoneType;
				SET outPhoneNum.ca:Phone                    = inPhoneNum.Phone;
				SET outPhoneNum.ca:PhoneCode                = inPhoneNum.PhoneCode;
				SET outPhoneNum.ca:PhoneOperName            = inPhoneNum.PhoneOperName;
		    END FOR;
			       
			SET outContactInfo.ca:ContactName         = inContactInfo.ContactName;       
			SET outContactInfo.ca:EmailAddr           = inContactInfo.EmailAddr;       
			SET outContactInfo.ca:URL                 = inContactInfo.URL;
			
		    FOR inContactData AS inContactInfo.ContactData[] DO			
		        CREATE LASTCHILD OF outContactInfo AS outContactData NAME 'ca:ContactData';
				SET outContactData.ca:ContactType                  = inContactData.ContactType;
				SET outContactData.ca:ContactValue                 = inContactData.ContactValue;
				
				IF COALESCE(FIELDVALUE(inContactData.PrefTimeStart),'') <> '' THEN       
				   SET outContactData.ca:PrefTimeStart                = inContactData.PrefTimeStart;
				END IF;       
				
				IF COALESCE(FIELDVALUE(inContactData.PrefTimeEnd),'') <> '' THEN       
				   SET outContactData.ca:PrefTimeEnd                  = inContactData.PrefTimeEnd;
				END IF;       
		    END FOR;

		    FOR inPostAddr AS inContactInfo.PostAddr[] DO			
		        CREATE LASTCHILD OF outContactInfo AS outPostAddr NAME 'ca:PostAddr';
				SET outPostAddr.ca:Addr1                        = inPostAddr.Addr1;
				SET outPostAddr.ca:Addr2                        = inPostAddr.Addr2;
				SET outPostAddr.ca:Addr3                        = inPostAddr.Addr3;
				SET outPostAddr.ca:Addr4                        = inPostAddr.Addr4;
				SET outPostAddr.ca:City                         = inPostAddr.City;
				SET outPostAddr.ca:CityCode                     = inPostAddr.CityCode;
				SET outPostAddr.ca:StateProv                    = inPostAddr.StateProv;
				SET outPostAddr.ca:StateProvCode                = inPostAddr.StateProvCode;
				SET outPostAddr.ca:Area                         = inPostAddr.Area;
				SET outPostAddr.ca:AreaCode                     = inPostAddr.AreaCode;
				SET outPostAddr.ca:PostalCode                   = inPostAddr.PostalCode;
				SET outPostAddr.ca:Country                      = inPostAddr.Country;
				SET outPostAddr.ca:CountryCode                  = inPostAddr.CountryCode;
				SET outPostAddr.ca:AddrType                     = inPostAddr.AddrType;
				SET outPostAddr.ca:StartDt                      = SUBSTRING(FIELDVALUE(inPostAddr.StartDt) FROM 1 FOR 10);
				SET outPostAddr.ca:EndDt                        = SUBSTRING(FIELDVALUE(inPostAddr.EndDt) FROM 1 FOR 10);
				SET outPostAddr.ca:DistrictCode                 = inPostAddr.DistrictCode;
				SET outPostAddr.ca:District                     = inPostAddr.District;

---				SET outPostAddr.ca:PlaceCode                    = inPostAddr.PlaceCode;
--						<ca:PlaсeCode>z</ca:PlaсeCode>
				SET outPostAddr.ca:PlaсeCode                    = inPostAddr.PlaсeCode;

				SET outPostAddr.ca:Place                        = inPostAddr.Place;
				SET outPostAddr.ca:StreetCode                   = inPostAddr.StreetCode;
				SET outPostAddr.ca:Street                       = inPostAddr.Street;
				SET outPostAddr.ca:House                        = inPostAddr.House;
				SET outPostAddr.ca:Corpus                       = inPostAddr.Corpus;
				SET outPostAddr.ca:Building                     = inPostAddr.Building;
				SET outPostAddr.ca:Flat                         = inPostAddr.Flat;
				SET outPostAddr.ca:Office                       = inPostAddr.Office;
				SET outPostAddr.ca:RusKLADR                     = inPostAddr.RusKLADR;
				SET outPostAddr.ca:AddrStatus                   = inPostAddr.AddrStatus;
		    END FOR;

			SET outContactInfo.ca:ProviderCode                  = inContactInfo.ProviderCode;
		END FOR;

		SET outRef.mtblitz:FIXferInfo.mtblitz:Receiver.mtblitz:PersonInfo.ind:TINInfo.ca:TINType          = inRef.FIXferLockCanRq.FIXferInfo.Receiver.PersonInfo.TINInfo.TINType;       
		SET outRef.mtblitz:FIXferInfo.mtblitz:Receiver.mtblitz:PersonInfo.ind:TINInfo.ca:TaxId            = inRef.FIXferLockCanRq.FIXferInfo.Receiver.PersonInfo.TINInfo.TaxId;       
		SET outRef.mtblitz:FIXferInfo.mtblitz:Receiver.mtblitz:PersonInfo.ind:TINInfo.ca:CertCode         = inRef.FIXferLockCanRq.FIXferInfo.Receiver.PersonInfo.TINInfo.CertCode;       
		
		IF COALESCE(FIELDVALUE(inRef.FIXferLockCanRq.FIXferInfo.Receiver.PersonInfo.BirthDt),'') <> '' THEN
			SET outRef.mtblitz:FIXferInfo.mtblitz:Receiver.mtblitz:PersonInfo.ind:BirthDt				=  SUBSTRING(FIELDVALUE(inRef.FIXferLockCanRq.FIXferInfo.Receiver.PersonInfo.BirthDt) FROM 1 FOR 10);
		END IF;

		IF EXISTS(inRef.FIXferLockCanRq.FIXferInfo.Receiver.PersonInfo.DriversLicense[]) THEN 
			SET outRef.mtblitz:FIXferInfo.mtblitz:Receiver.mtblitz:PersonInfo.ind:DriversLicense.ind:LicenseNum          = COALESCE(inRef.FIXferLockCanRq.FIXferInfo.Receiver.PersonInfo.DriversLicense.LicenseNum, NULL);       
			SET outRef.mtblitz:FIXferInfo.mtblitz:Receiver.mtblitz:PersonInfo.ind:DriversLicense.ind:StateProv           = COALESCE(inRef.FIXferLockCanRq.FIXferInfo.Receiver.PersonInfo.DriversLicense.StateProv, NULL);       
			SET outRef.mtblitz:FIXferInfo.mtblitz:Receiver.mtblitz:PersonInfo.ind:DriversLicense.ind:Country             = COALESCE(inRef.FIXferLockCanRq.FIXferInfo.Receiver.PersonInfo.DriversLicense.Country, NULL);       
		END IF;

		SET outRef.mtblitz:FIXferInfo.mtblitz:Receiver.mtblitz:PersonInfo.ind:MotherMaidenName           = inRef.FIXferLockCanRq.FIXferInfo.Receiver.PersonInfo.MotherMaidenName;       
		SET outRef.mtblitz:FIXferInfo.mtblitz:Receiver.mtblitz:PersonInfo.ind:SpouseName                 = inRef.FIXferLockCanRq.FIXferInfo.Receiver.PersonInfo.SpouseName;       

		IF COALESCE(FIELDVALUE(inRef.FIXferLockCanRq.FIXferInfo.Receiver.PersonInfo.Gender),'') <> '' THEN       
		   SET outRef.mtblitz:FIXferInfo.mtblitz:Receiver.mtblitz:PersonInfo.ind:Gender       = inRef.FIXferLockCanRq.FIXferInfo.Receiver.PersonInfo.Gender;
		END IF;       
		       
		SET outRef.mtblitz:FIXferInfo.mtblitz:Receiver.mtblitz:PersonInfo.ind:MaritalStatus              = inRef.FIXferLockCanRq.FIXferInfo.Receiver.PersonInfo.MaritalStatus;       
		SET outRef.mtblitz:FIXferInfo.mtblitz:Receiver.mtblitz:PersonInfo.ind:USAMilitaryRank            = inRef.FIXferLockCanRq.FIXferInfo.Receiver.PersonInfo.USAMilitaryRank;       
		SET outRef.mtblitz:FIXferInfo.mtblitz:Receiver.mtblitz:PersonInfo.ind:Dependents                 = inRef.FIXferLockCanRq.FIXferInfo.Receiver.PersonInfo.Dependents;
		       
		IF EXISTS(inRef.FIXferLockCanRq.FIXferInfo.Receiver.PersonInfo.Passport[]) THEN
		    SET outRef.mtblitz:FIXferInfo.mtblitz:Receiver.mtblitz:PersonInfo.ind:Passport.ind:PassportNumber      = COALESCE(inRef.FIXferLockCanRq.FIXferInfo.Receiver.PersonInfo.Passport.PassportNumber, NULL);       
		    SET outRef.mtblitz:FIXferInfo.mtblitz:Receiver.mtblitz:PersonInfo.ind:Passport.ind:DocSeries           = COALESCE(inRef.FIXferLockCanRq.FIXferInfo.Receiver.PersonInfo.Passport.DocSeries, NULL);       
			SET outRef.mtblitz:FIXferInfo.mtblitz:Receiver.mtblitz:PersonInfo.ind:Passport.ind:PassportCountry     = COALESCE(inRef.FIXferLockCanRq.FIXferInfo.Receiver.PersonInfo.Passport.PassportCountry, NULL);       
			SET outRef.mtblitz:FIXferInfo.mtblitz:Receiver.mtblitz:PersonInfo.ind:Passport.ind:IssueLoc            = COALESCE(inRef.FIXferLockCanRq.FIXferInfo.Receiver.PersonInfo.Passport.IssueLoc, NULL);       
			SET outRef.mtblitz:FIXferInfo.mtblitz:Receiver.mtblitz:PersonInfo.ind:Passport.ind:IssDt               = COALESCE(inRef.FIXferLockCanRq.FIXferInfo.Receiver.PersonInfo.Passport.IssDt, NULL);       
			SET outRef.mtblitz:FIXferInfo.mtblitz:Receiver.mtblitz:PersonInfo.ind:Passport.ind:ExpDt               = COALESCE(inRef.FIXferLockCanRq.FIXferInfo.Receiver.PersonInfo.Passport.ExpDt, NULL);       
		END IF;
		       
		SET outRef.mtblitz:FIXferInfo.mtblitz:Receiver.mtblitz:PersonInfo.ind:OEDCode                    = inRef.FIXferLockCanRq.FIXferInfo.Receiver.PersonInfo.OEDCode;       
		SET outRef.mtblitz:FIXferInfo.mtblitz:Receiver.mtblitz:PersonInfo.ind:OEDInstitution_Type        = inRef.FIXferLockCanRq.FIXferInfo.Receiver.PersonInfo.OEDInstitution_Type;

		IF EXISTS(inRef.FIXferLockCanRq.FIXferInfo.Receiver.PersonInfo.GovIssueIdent[]) THEN
 		    SET outRef.mtblitz:FIXferInfo.mtblitz:Receiver.mtblitz:PersonInfo.ind:GovIssueIdent.ind:GovIssueIdentType       = COALESCE(inRef.FIXferLockCanRq.FIXferInfo.Receiver.PersonInfo.GovIssueIdent.GovIssueIdentType, NULL);       
			SET outRef.mtblitz:FIXferInfo.mtblitz:Receiver.mtblitz:PersonInfo.ind:GovIssueIdent.ind:IdentSerialNum          = COALESCE(inRef.FIXferLockCanRq.FIXferInfo.Receiver.PersonInfo.GovIssueIdent.IdentSerialNum, NULL);       
			SET outRef.mtblitz:FIXferInfo.mtblitz:Receiver.mtblitz:PersonInfo.ind:GovIssueIdent.ind:GovOrg                  = COALESCE(inRef.FIXferLockCanRq.FIXferInfo.Receiver.PersonInfo.GovIssueIdent.GovOrg, NULL);       
			SET outRef.mtblitz:FIXferInfo.mtblitz:Receiver.mtblitz:PersonInfo.ind:GovIssueIdent.ind:GovOrgName              = COALESCE(inRef.FIXferLockCanRq.FIXferInfo.Receiver.PersonInfo.GovIssueIdent.GovOrgName, NULL);       
			SET outRef.mtblitz:FIXferInfo.mtblitz:Receiver.mtblitz:PersonInfo.ind:GovIssueIdent.ind:GovRank                 = COALESCE(inRef.FIXferLockCanRq.FIXferInfo.Receiver.PersonInfo.GovIssueIdent.GovRank, NULL);       
			SET outRef.mtblitz:FIXferInfo.mtblitz:Receiver.mtblitz:PersonInfo.ind:GovIssueIdent.ind:StateProv               = COALESCE(inRef.FIXferLockCanRq.FIXferInfo.Receiver.PersonInfo.GovIssueIdent.StateProv, NULL);       
			SET outRef.mtblitz:FIXferInfo.mtblitz:Receiver.mtblitz:PersonInfo.ind:GovIssueIdent.ind:Country                 = COALESCE(inRef.FIXferLockCanRq.FIXferInfo.Receiver.PersonInfo.GovIssueIdent.Country, NULL);       
			SET outRef.mtblitz:FIXferInfo.mtblitz:Receiver.mtblitz:PersonInfo.ind:GovIssueIdent.ind:Desc                    = COALESCE(inRef.FIXferLockCanRq.FIXferInfo.Receiver.PersonInfo.GovIssueIdent.Desc, NULL);       
			SET outRef.mtblitz:FIXferInfo.mtblitz:Receiver.mtblitz:PersonInfo.ind:GovIssueIdent.ind:IssDt                   = COALESCE(inRef.FIXferLockCanRq.FIXferInfo.Receiver.PersonInfo.GovIssueIdent.IssDt, NULL);       
			SET outRef.mtblitz:FIXferInfo.mtblitz:Receiver.mtblitz:PersonInfo.ind:GovIssueIdent.ind:ExpDt                   = COALESCE(inRef.FIXferLockCanRq.FIXferInfo.Receiver.PersonInfo.GovIssueIdent.ExpDt, NULL);       
			SET outRef.mtblitz:FIXferInfo.mtblitz:Receiver.mtblitz:PersonInfo.ind:GovIssueIdent.ind:IdentSerie              = COALESCE(inRef.FIXferLockCanRq.FIXferInfo.Receiver.PersonInfo.GovIssueIdent.IdentSerie, NULL);       
			SET outRef.mtblitz:FIXferInfo.mtblitz:Receiver.mtblitz:PersonInfo.ind:GovIssueIdent.ind:GovOrgUnit              = COALESCE(inRef.FIXferLockCanRq.FIXferInfo.Receiver.PersonInfo.GovIssueIdent.GovOrgUnit, NULL);       
		END IF;

		IF EXISTS(inRef.FIXferLockCanRq.FIXferInfo.Receiver.PersonInfo.OtherIdentDoc[]) THEN
		    SET outRef.mtblitz:FIXferInfo.mtblitz:Receiver.mtblitz:PersonInfo.ind:OtherIdentDoc.ind:Desc                    = COALESCE(inRef.FIXferLockCanRq.FIXferInfo.Receiver.PersonInfo.OtherIdentDoc.Desc, NULL);       
			SET outRef.mtblitz:FIXferInfo.mtblitz:Receiver.mtblitz:PersonInfo.ind:OtherIdentDoc.ind:IdentSerialNum          = COALESCE(inRef.FIXferLockCanRq.FIXferInfo.Receiver.PersonInfo.OtherIdentDoc.IdentSerialNum, NULL);       
			SET outRef.mtblitz:FIXferInfo.mtblitz:Receiver.mtblitz:PersonInfo.ind:OtherIdentDoc.ind:Issuer                  = COALESCE(inRef.FIXferLockCanRq.FIXferInfo.Receiver.PersonInfo.OtherIdentDoc.Issuer, NULL);       
			SET outRef.mtblitz:FIXferInfo.mtblitz:Receiver.mtblitz:PersonInfo.ind:OtherIdentDoc.ind:IssueLoc                = COALESCE(inRef.FIXferLockCanRq.FIXferInfo.Receiver.PersonInfo.OtherIdentDoc.IssueLoc, NULL);       
			SET outRef.mtblitz:FIXferInfo.mtblitz:Receiver.mtblitz:PersonInfo.ind:OtherIdentDoc.ind:IssDt                   = COALESCE(inRef.FIXferLockCanRq.FIXferInfo.Receiver.PersonInfo.OtherIdentDoc.IssDt, NULL);       
			SET outRef.mtblitz:FIXferInfo.mtblitz:Receiver.mtblitz:PersonInfo.ind:OtherIdentDoc.ind:ExpDt                   = COALESCE(inRef.FIXferLockCanRq.FIXferInfo.Receiver.PersonInfo.OtherIdentDoc.ExpDt, NULL);       
		END IF;

		CREATE FIELD outRef.mtblitz:FIXferInfo.mtblitz:Receiver.mtblitz:PersonInfo.ind:IdentityCards;
		FOR inIdentityCard AS inRef.FIXferLockCanRq.FIXferInfo.Receiver.PersonInfo.IdentityCards.IdentityCard[] DO			
		    CREATE LASTCHILD OF outRef.mtblitz:FIXferInfo.mtblitz:Receiver.mtblitz:PersonInfo.ind:IdentityCards AS outIdentityCard NAME 'ind:IdentityCard';
		    
			SET outIdentityCard.ind:IdType              = inIdentityCard.IdType;       
			SET outIdentityCard.ind:IdStatus            = inIdentityCard.IdStatus;       
			SET outIdentityCard.ind:IdSeries            = inIdentityCard.IdSeries;       
			SET outIdentityCard.ind:IdNum               = inIdentityCard.IdNum;       
			
			IF COALESCE(FIELDVALUE(inIdentityCard.IssueDt),'') <> '' THEN       
			   SET outIdentityCard.ind:IssueDt             = inIdentityCard.IssueDt;       
			END IF;       
       
			SET outIdentityCard.ind:IssuedBy            = inIdentityCard.IssuedBy;
					       
			SET outIdentityCard.ind:Code                = inIdentityCard.Code;       
			SET outIdentityCard.ind:IssueLoc            = inIdentityCard.IssueLoc;       
			SET outIdentityCard.ind:IssuedCountry       = inIdentityCard.IssuedCountry;       

			IF COALESCE(FIELDVALUE(inIdentityCard.IssuedRegionCode),'') <> '' THEN       
			   SET outIdentityCard.ind:IssuedRegionCode    = inIdentityCard.IssuedRegionCode;       
			END IF;       

			SET outIdentityCard.ind:ExpDt               = SUBSTRING(FIELDVALUE(inIdentityCard.ExpDt) BEFORE 'T');
		END FOR;

		SET outRef.mtblitz:FIXferInfo.mtblitz:Receiver.mtblitz:PersonInfo.ind:BirthPlace                 = inRef.FIXferLockCanRq.FIXferInfo.Receiver.PersonInfo.BirthPlace;       
		SET outRef.mtblitz:FIXferInfo.mtblitz:Receiver.mtblitz:PersonInfo.ind:Resident                   = inRef.FIXferLockCanRq.FIXferInfo.Receiver.PersonInfo.Resident;       
		SET outRef.mtblitz:FIXferInfo.mtblitz:Receiver.mtblitz:PersonInfo.ind:MilitaryDocFlag            = inRef.FIXferLockCanRq.FIXferInfo.Receiver.PersonInfo.MilitaryDocFlag;       
		SET outRef.mtblitz:FIXferInfo.mtblitz:Receiver.mtblitz:PersonInfo.ind:Citizenship                = inRef.FIXferLockCanRq.FIXferInfo.Receiver.PersonInfo.Citizenship;       

		IF COALESCE(FIELDVALUE(inRef.FIXferLockCanRq.FIXferInfo.OrigDt),'') <> '' THEN       
		   SET outRef.mtblitz:FIXferInfo.mtblitz:OrigDt    = inRef.FIXferLockCanRq.FIXferInfo.OrigDt;
		END IF;       
		
		SET outRef.mtblitz:FIXferInfo.mtblitz:FIXferId  = inRef.FIXferLockCanRq.FIXferInfo.FIXferId;

		SET outRef.mtblitz:FIXferInfo.mtblitz:SettlementInfo.mtblitz:ReceiveCurCode  = inRef.FIXferLockCanRq.FIXferInfo.SettlementInfo.ReceiveCurCode;
		SET outRef.mtblitz:FIXferInfo.mtblitz:SettlementInfo.mtblitz:ReceiveAmtEst   = inRef.FIXferLockCanRq.FIXferInfo.SettlementInfo.ReceiveAmtEst;

/*		mtblitz:FIXferOperInfo ------------------------------------------------------------------------------------------------ */       

		IF COALESCE(FIELDVALUE(inRef.FIXferLockCanRq.FIXferOperInfo.OperType),'') <> '' THEN       
		   SET outRef.mtblitz:FIXferOperInfo.mtblitz:OperType           = inRef.FIXferLockCanRq.FIXferOperInfo.OperType;       
		END IF;       

		SET outRef.mtblitz:FIXferOperInfo.mtblitz:OperDt             = SUBSTRING(FIELDVALUE(inRef.FIXferLockCanRq.FIXferOperInfo.OperDt) BEFORE 'T');       
		SET outRef.mtblitz:FIXferOperInfo.mtblitz:OperId             = inRef.FIXferLockCanRq.FIXferOperInfo.OperId;       
		SET outRef.mtblitz:FIXferOperInfo.mtblitz:OperUID            = inRef.FIXferLockCanRq.FIXferOperInfo.OperUID;       
		SET outRef.mtblitz:FIXferOperInfo.mtblitz:OperStatus         = inRef.FIXferLockCanRq.FIXferOperInfo.OperStatus;       
--		SET outRef.mtblitz:FIXferOperInfo.mtblitz:Memo               = inRef.FIXferLockCanRq.FIXferOperInfo.Memo;
		
		SET outRef.mtblitz:FIXferOperInfo.mtblitz:Memo               = REPLACE(inRef.FIXferLockCanRq.FIXferOperInfo.Memo, '"', '&#34');

		SET outRef.mtblitz:FIXferOperInfo.mtblitz:OperatorInfo.iam:UserId           = inRef.FIXferLockCanRq.FIXferOperInfo.OperatorInfo.UserId;       
		SET outRef.mtblitz:FIXferOperInfo.mtblitz:OperatorInfo.iam:RegionId         = inRef.FIXferLockCanRq.FIXferOperInfo.OperatorInfo.RegionId;       
		SET outRef.mtblitz:FIXferOperInfo.mtblitz:OperatorInfo.iam:FullName         = inRef.FIXferLockCanRq.FIXferOperInfo.OperatorInfo.FullName;       
		SET outRef.mtblitz:FIXferOperInfo.mtblitz:OperatorInfo.iam:OrgId            = inRef.FIXferLockCanRq.FIXferOperInfo.OperatorInfo.OrgId;       
		SET outRef.mtblitz:FIXferOperInfo.mtblitz:OperatorInfo.iam:OrgName          = inRef.FIXferLockCanRq.FIXferOperInfo.OperatorInfo.OrgName;       
		SET outRef.mtblitz:FIXferOperInfo.mtblitz:OperatorInfo.iam:OrgUnitId        = inRef.FIXferLockCanRq.FIXferOperInfo.OperatorInfo.OrgUnitId;       
		SET outRef.mtblitz:FIXferOperInfo.mtblitz:OperatorInfo.iam:OrgUnitName      = inRef.FIXferLockCanRq.FIXferOperInfo.OperatorInfo.OrgUnitName;       
		SET outRef.mtblitz:FIXferOperInfo.mtblitz:OperatorInfo.iam:EmployeeId       = inRef.FIXferLockCanRq.FIXferOperInfo.OperatorInfo.EmployeeId;       
		SET outRef.mtblitz:FIXferOperInfo.mtblitz:OperatorInfo.iam:IpAddr           = inRef.FIXferLockCanRq.FIXferOperInfo.OperatorInfo.IpAddr;       

		DECLARE outOperatorInfo  REFERENCE TO outRef.mtblitz:FIXferOperInfo.mtblitz:OperatorInfo;
		DECLARE outCertInfo2      REFERENCE TO outOperatorInfo;

		FOR inCertInfo AS inRef.FIXferLockCanRq.FIXferOperInfo.OperatorInfo.CertInfo[] DO			
		    CREATE LASTCHILD OF outOperatorInfo AS outCertInfo2 NAME 'iam:CertInfo';
		    
			SET outCertInfo2.iam:X509SubjectName         = inCertInfo.X509SubjectName;       
			SET outCertInfo2.iam:KeyName                 = inCertInfo.KeyName;       
			SET outCertInfo2.iam:RegionId                = inCertInfo.RegionId;       

			CALL FillSomeField(inCertInfo, outCertInfo2, 'iam', 'UserRole');				
       
			SET outCertInfo2.iam:Certificate             = inCertInfo.Certificate;       
		END FOR;

		------------------------------------
        IF EXISTS(inRef.FIXferLockCanRq.FIXferOperInfo.ControllerInfo.CertInfo[]) THEN        	
			SET outRef.mtblitz:FIXferOperInfo.mtblitz:ControllerInfo.iam:UserId           = inRef.FIXferLockCanRq.FIXferOperInfo.ControllerInfo.UserId;       
			SET outRef.mtblitz:FIXferOperInfo.mtblitz:ControllerInfo.iam:RegionId         = inRef.FIXferLockCanRq.FIXferOperInfo.ControllerInfo.RegionId;       
			SET outRef.mtblitz:FIXferOperInfo.mtblitz:ControllerInfo.iam:FullName         = inRef.FIXferLockCanRq.FIXferOperInfo.ControllerInfo.FullName;       
			SET outRef.mtblitz:FIXferOperInfo.mtblitz:ControllerInfo.iam:OrgId            = inRef.FIXferLockCanRq.FIXferOperInfo.ControllerInfo.OrgId;       
			SET outRef.mtblitz:FIXferOperInfo.mtblitz:ControllerInfo.iam:OrgName          = inRef.FIXferLockCanRq.FIXferOperInfo.ControllerInfo.OrgName;       
			SET outRef.mtblitz:FIXferOperInfo.mtblitz:ControllerInfo.iam:OrgUnitId        = inRef.FIXferLockCanRq.FIXferOperInfo.ControllerInfo.OrgUnitId;       
			SET outRef.mtblitz:FIXferOperInfo.mtblitz:ControllerInfo.iam:OrgUnitName      = inRef.FIXferLockCanRq.FIXferOperInfo.ControllerInfo.OrgUnitName;       
			SET outRef.mtblitz:FIXferOperInfo.mtblitz:ControllerInfo.iam:EmployeeId       = inRef.FIXferLockCanRq.FIXferOperInfo.ControllerInfo.EmployeeId;       
			SET outRef.mtblitz:FIXferOperInfo.mtblitz:ControllerInfo.iam:IpAddr           = inRef.FIXferLockCanRq.FIXferOperInfo.ControllerInfo.IpAddr;       
	
			DECLARE outControllerInfo  REFERENCE TO outRef.mtblitz:FIXferOperInfo.mtblitz:ControllerInfo;
			DECLARE outCertInfo3       REFERENCE TO outControllerInfo; --- !!! можно не объявлять как 3
	
			FOR inCertInfo AS inRef.FIXferLockCanRq.FIXferOperInfo.ControllerInfo.CertInfo[] DO			
			    CREATE LASTCHILD OF outControllerInfo AS outCertInfo3 NAME 'iam:CertInfo';
			    
				SET outCertInfo3.iam:X509SubjectName         = inCertInfo.X509SubjectName;       
				SET outCertInfo3.iam:KeyName                 = inCertInfo.KeyName;       
				SET outCertInfo3.iam:RegionId                = inCertInfo.RegionId;       
	
				CALL FillSomeField(inCertInfo, outCertInfo3, 'iam', 'UserRole');				
	
				SET outCertInfo3.iam:Certificate             = inCertInfo.Certificate;       
			END FOR;
        END IF;        	
		------------------------------------

		SET outRef.mtblitz:FIXferOperInfo.mtblitz:Confirmation.mtblitz:Confirmed       = inRef.FIXferLockCanRq.FIXferOperInfo.Confirmation.Confirmed;       
		SET outRef.mtblitz:FIXferOperInfo.mtblitz:Confirmation.mtblitz:ConfDt          = SUBSTRING(FIELDVALUE(inRef.FIXferLockCanRq.FIXferOperInfo.Confirmation.ConfDt) BEFORE 'T');       
--		SET outRef.mtblitz:FIXferOperInfo.mtblitz:Confirmation.mtblitz:Memo            = inRef.FIXferLockCanRq.FIXferOperInfo.Confirmation.Memo;
		
		SET outRef.mtblitz:FIXferOperInfo.mtblitz:Confirmation.mtblitz:Memo            = REPLACE(inRef.FIXferLockCanRq.FIXferOperInfo.Confirmation.Memo, '"', '&#34');

		---SET outRef.mtblitz:FIXferOperInfo.mtblitz:SignedData                           = REPLACE(inRef.FIXferLockCanRq.FIXferOperInfo.SignedData, '"', '&#34');      

		RETURN TRUE;
	END;			
END MODULE;
/* 8-ой сервис */

/* 9-ый сервис */
CREATE COMPUTE MODULE RequestForKolibri_ConvertMDO2CRM_KZSrvBLRecoverMoneyTransferRq
	CREATE FUNCTION Main() RETURNS BOOLEAN
	BEGIN
	    CALL CopyMessageHeaders(InputRoot,OutputRoot);
		
		DECLARE inRef REFERENCE TO InputRoot.XMLNSC.[<];
		DECLARE outRef REFERENCE TO OutputRoot.XMLNSC.*[<];
				
	    SET OutputRoot.MQMD.ReplyToQ	= 'ESB.QPRAGMA.OUT';
	    SET OutputRoot.MQMD.ReplyToQMgr	= 'IKAZ.ESB.OUT.GW1';				
				
		CREATE LASTCHILD OF OutputRoot DOMAIN('XMLNSC') NAME 'XMLNSC';
		CREATE LASTCHILD OF OutputRoot.XMLNSC AS outRef NAMESPACE mtblitz NAME 'FIXferAdviseCanRq'; 
		
    	SET OutputRoot.XMLNSC.mtblitz:FIXferAdviseCanRq.(XMLNSC.NamespaceDecl)xmlns:iam = iam;
		SET OutputRoot.XMLNSC.mtblitz:FIXferAdviseCanRq.(XMLNSC.NamespaceDecl)xmlns:mt = mt;
		SET OutputRoot.XMLNSC.mtblitz:FIXferAdviseCanRq.(XMLNSC.NamespaceDecl)xmlns:mtblitz = mtblitz;
    	SET OutputRoot.XMLNSC.mtblitz:FIXferAdviseCanRq.(XMLNSC.NamespaceDecl)xmlns:ca  = ca; 
    	SET OutputRoot.XMLNSC.mtblitz:FIXferAdviseCanRq.(XMLNSC.NamespaceDecl)xmlns:ind = ind; 
		
		SET outRef.mt:RqUID			= inRef.RqUID;
		SET outRef.mt:RqTm			= convertFromQPtoKOLI(inRef.RqTm);
		SET outRef.mt:SPName		= 'urn:sbrfsystems:98-abs';
		SET outRef.mt:OperName		= 'SrvBLRecoverMoneyTransfer';

		DECLARE userInfo REFERENCE TO outRef;
		DECLARE certInfo REFERENCE TO userInfo;
		                               
/*		Verion 1.0                               
		SET outRef.mtblitz:UserInfo		    = inRef.FIXferAdviseCanRq.mtblitz:UserInfo;       
		SET outRef.mtblitz:FIXferInfo	    = inRef.FIXferAdviseCanRq.mtblitz:FIXferInfo;       
		SET outRef.mtblitz:FIXferOperInfo	= inRef.FIXferAdviseCanRq.mtblitz:FIXferOperInfo;       
		SET outRef.mtblitz:Signature	    = inRef.FIXferAdviseCanRq.mtblitz:Signature;       
*/

/*		Verion 2.0  */                             
/*		mtblitz:UserInfo ------------------------------------------------------------------------------------------------ */       

		SET outRef.mtblitz:UserInfo.iam:UserId         = inRef.FIXferAdviseCanRq.UserInfo.UserId;       
		SET outRef.mtblitz:UserInfo.iam:RegionId       = inRef.FIXferAdviseCanRq.UserInfo.RegionId;       
		SET outRef.mtblitz:UserInfo.iam:FullName       = inRef.FIXferAdviseCanRq.UserInfo.FullName;       
		SET outRef.mtblitz:UserInfo.iam:OrgId          = inRef.FIXferAdviseCanRq.UserInfo.OrgId;       
		SET outRef.mtblitz:UserInfo.iam:OrgName        = inRef.FIXferAdviseCanRq.UserInfo.OrgName;       
		SET outRef.mtblitz:UserInfo.iam:OrgUnitId      = inRef.FIXferAdviseCanRq.UserInfo.OrgUnitId;       
		SET outRef.mtblitz:UserInfo.iam:OrgUnitName    = inRef.FIXferAdviseCanRq.UserInfo.OrgUnitName;       
		SET outRef.mtblitz:UserInfo.iam:EmployeeId     = inRef.FIXferAdviseCanRq.UserInfo.EmployeeId;       
		SET outRef.mtblitz:UserInfo.iam:IpAddr         = inRef.FIXferAdviseCanRq.UserInfo.IpAddr;       

		DECLARE outUserInfo REFERENCE TO outRef.mtblitz:UserInfo;
		DECLARE outCertInfo REFERENCE TO outUserInfo;

		FOR inCertInfo AS inRef.FIXferAdviseCanRq.UserInfo.CertInfo[] DO			
		    CREATE LASTCHILD OF outUserInfo AS outCertInfo NAME 'iam:CertInfo';
		    
			SET outCertInfo.iam:X509SubjectName         = inCertInfo.X509SubjectName;       
			SET outCertInfo.iam:KeyName                 = inCertInfo.KeyName;       
			SET outCertInfo.iam:RegionId                = inCertInfo.RegionId;       

			CALL FillSomeField(inCertInfo, outCertInfo, 'iam', 'UserRole');				

			SET outCertInfo.iam:Certificate             = inCertInfo.Certificate;       
		END FOR;

/*		mtblitz:FIXferInfo ------------------------------------------------------------------------------------------------ */       

		SET outRef.mtblitz:FIXferInfo.mtblitz:Receiver.mtblitz:BankInfo.mtblitz:BankId         = inRef.FIXferAdviseCanRq.FIXferInfo.Receiver.BankInfo.BankId;       
		SET outRef.mtblitz:FIXferInfo.mtblitz:Receiver.mtblitz:BankInfo.mtblitz:Country        = inRef.FIXferAdviseCanRq.FIXferInfo.Receiver.BankInfo.Country;       
		SET outRef.mtblitz:FIXferInfo.mtblitz:Receiver.mtblitz:BankInfo.mtblitz:City           = inRef.FIXferAdviseCanRq.FIXferInfo.Receiver.BankInfo.City;
		       
		SET outRef.mtblitz:FIXferInfo.mtblitz:OrigDt     = inRef.FIXferAdviseCanRq.FIXferInfo.OrigDt;

		IF COALESCE(FIELDVALUE(inRef.FIXferAdviseCanRq.FIXferInfo.RegDt),'') <> '' THEN
			SET outRef.mtblitz:FIXferInfo.mtblitz:RegDt				=  SUBSTRING(FIELDVALUE(inRef.FIXferAdviseCanRq.FIXferInfo.RegDt) BEFORE 'T');
		END IF;

		SET outRef.mtblitz:FIXferInfo.mtblitz:FIXferId   = inRef.FIXferAdviseCanRq.FIXferInfo.FIXferId;

		SET outRef.mtblitz:FIXferInfo.mtblitz:SettlementInfo.mtblitz:ReceiveCurCode   = inRef.FIXferAdviseCanRq.FIXferInfo.SettlementInfo.ReceiveCurCode;
		SET outRef.mtblitz:FIXferInfo.mtblitz:SettlementInfo.mtblitz:ReceiveAmtEst    = inRef.FIXferAdviseCanRq.FIXferInfo.SettlementInfo.ReceiveAmtEst;

		SET outRef.mtblitz:FIXferInfo.mtblitz:FeeChargeAlloc.mtblitz:Fee.ca:FeeType   = inRef.FIXferAdviseCanRq.FIXferInfo.FeeChargeAlloc.Fee.FeeType;

		SET outRef.mtblitz:FIXferInfo.mtblitz:FeeChargeAlloc.mtblitz:Fee.ca:CurAmt.ca:Amt               = inRef.FIXferAdviseCanRq.FIXferInfo.FeeChargeAlloc.Fee.CurAmt.Amt;
		SET outRef.mtblitz:FIXferInfo.mtblitz:FeeChargeAlloc.mtblitz:Fee.ca:CurAmt.ca:Reversal          = inRef.FIXferAdviseCanRq.FIXferInfo.FeeChargeAlloc.Fee.CurAmt.Reversal;
		SET outRef.mtblitz:FIXferInfo.mtblitz:FeeChargeAlloc.mtblitz:Fee.ca:CurAmt.ca:CurCode           = inRef.FIXferAdviseCanRq.FIXferInfo.FeeChargeAlloc.Fee.CurAmt.CurCode;
		SET outRef.mtblitz:FIXferInfo.mtblitz:FeeChargeAlloc.mtblitz:Fee.ca:CurAmt.ca:CurRate           = inRef.FIXferAdviseCanRq.FIXferInfo.FeeChargeAlloc.Fee.CurAmt.CurRate;
		SET outRef.mtblitz:FIXferInfo.mtblitz:FeeChargeAlloc.mtblitz:Fee.ca:CurAmt.ca:CurConvertRule    = inRef.FIXferAdviseCanRq.FIXferInfo.FeeChargeAlloc.Fee.CurAmt.CurConvertRule;
		
		SET outRef.mtblitz:FIXferInfo.mtblitz:FeeChargeAlloc.mtblitz:Fee.ca:Rate    = inRef.FIXferAdviseCanRq.FIXferInfo.FeeChargeAlloc.Fee.Rate;

		SET outRef.mtblitz:FIXferInfo.mtblitz:FeeChargeAlloc.mtblitz:Fee.ca:MinCurAmt.ca:Amt               = inRef.FIXferAdviseCanRq.FIXferInfo.FeeChargeAlloc.Fee.MinCurAmt.Amt;
		SET outRef.mtblitz:FIXferInfo.mtblitz:FeeChargeAlloc.mtblitz:Fee.ca:MinCurAmt.ca:Reversal          = inRef.FIXferAdviseCanRq.FIXferInfo.FeeChargeAlloc.Fee.MinCurAmt.Reversal;
		SET outRef.mtblitz:FIXferInfo.mtblitz:FeeChargeAlloc.mtblitz:Fee.ca:MinCurAmt.ca:CurCode           = inRef.FIXferAdviseCanRq.FIXferInfo.FeeChargeAlloc.Fee.MinCurAmt.CurCode;
		SET outRef.mtblitz:FIXferInfo.mtblitz:FeeChargeAlloc.mtblitz:Fee.ca:MinCurAmt.ca:CurRate           = inRef.FIXferAdviseCanRq.FIXferInfo.FeeChargeAlloc.Fee.MinCurAmt.CurRate;
		SET outRef.mtblitz:FIXferInfo.mtblitz:FeeChargeAlloc.mtblitz:Fee.ca:MinCurAmt.ca:CurConvertRule    = inRef.FIXferAdviseCanRq.FIXferInfo.FeeChargeAlloc.Fee.MinCurAmt.CurConvertRule;

		SET outRef.mtblitz:FIXferInfo.mtblitz:FeeChargeAlloc.mtblitz:Fee.ca:MaxCurAmt.ca:Amt               = inRef.FIXferAdviseCanRq.FIXferInfo.FeeChargeAlloc.Fee.MaxCurAmt.Amt;
		SET outRef.mtblitz:FIXferInfo.mtblitz:FeeChargeAlloc.mtblitz:Fee.ca:MinCurAmt.ca:Reversal          = inRef.FIXferAdviseCanRq.FIXferInfo.FeeChargeAlloc.Fee.MaxCurAmt.Reversal;
		SET outRef.mtblitz:FIXferInfo.mtblitz:FeeChargeAlloc.mtblitz:Fee.ca:MaxCurAmt.ca:CurCode           = inRef.FIXferAdviseCanRq.FIXferInfo.FeeChargeAlloc.Fee.MaxCurAmt.CurCode;
		SET outRef.mtblitz:FIXferInfo.mtblitz:FeeChargeAlloc.mtblitz:Fee.ca:MaxCurAmt.ca:CurRate           = inRef.FIXferAdviseCanRq.FIXferInfo.FeeChargeAlloc.Fee.MaxCurAmt.CurRate;
		SET outRef.mtblitz:FIXferInfo.mtblitz:FeeChargeAlloc.mtblitz:Fee.ca:MaxCurAmt.ca:CurConvertRule    = inRef.FIXferAdviseCanRq.FIXferInfo.FeeChargeAlloc.Fee.MaxCurAmt.CurConvertRule;

		SET outRef.mtblitz:FIXferInfo.mtblitz:FeeChargeAlloc.mtblitz:Fee.ca:RateType    = inRef.FIXferAdviseCanRq.FIXferInfo.FeeChargeAlloc.Fee.RateType;

		SET outRef.mtblitz:FIXferInfo.mtblitz:Confirmation.mtblitz:Confirmed    = inRef.FIXferAdviseCanRq.FIXferInfo.Confirmation.Confirmed;

		IF COALESCE(FIELDVALUE(inRef.FIXferAdviseCanRq.FIXferInfo.Confirmation.ConfDt),'') <> '' THEN
		   SET outRef.mtblitz:FIXferInfo.mtblitz:Confirmation.mtblitz:ConfDt				=  SUBSTRING(FIELDVALUE(inRef.FIXferAdviseCanRq.FIXferInfo.Confirmation.ConfDt) FROM 1 FOR 19);
		END IF;
		--SET outRef.mtblitz:FIXferInfo.mtblitz:Confirmation.mtblitz:ConfDt				=  inRef.FIXferAdviseCanRq.FIXferInfo.Confirmation.ConfDt || '000+04:00';
		--SET outRef.mtblitz:FIXferInfo.mtblitz:Confirmation.mtblitz:ConfDt				=  inRef.FIXferAdviseCanRq.FIXferInfo.Confirmation.ConfDt;
		
--		SET outRef.mtblitz:FIXferInfo.mtblitz:Confirmation.mtblitz:Memo         = inRef.FIXferAdviseCanRq.FIXferInfo.Confirmation.Memo;		
		SET outRef.mtblitz:FIXferInfo.mtblitz:Confirmation.mtblitz:Memo         = REPLACE(inRef.FIXferAdviseCanRq.FIXferInfo.Confirmation.Memo, '"', '&#34');

/*		mtblitz:FIXferOperInfo ------------------------------------------------------------------------------------------------ */       

		SET outRef.mtblitz:FIXferOperInfo.mtblitz:OperType      = inRef.FIXferAdviseCanRq.FIXferOperInfo.OperType;

		IF COALESCE(FIELDVALUE(inRef.FIXferAdviseCanRq.FIXferOperInfo.OperDt),'') <> '' THEN
			SET outRef.mtblitz:FIXferOperInfo.mtblitz:OperDt				=  SUBSTRING(FIELDVALUE(inRef.FIXferAdviseCanRq.FIXferOperInfo.OperDt) BEFORE 'T');
		END IF;
		
		SET outRef.mtblitz:FIXferOperInfo.mtblitz:OperId        = inRef.FIXferAdviseCanRq.FIXferOperInfo.OperId;
		SET outRef.mtblitz:FIXferOperInfo.mtblitz:OperUID       = inRef.FIXferAdviseCanRq.FIXferOperInfo.OperUID;
		SET outRef.mtblitz:FIXferOperInfo.mtblitz:OperStatus    = inRef.FIXferAdviseCanRq.FIXferOperInfo.OperStatus;
--		SET outRef.mtblitz:FIXferOperInfo.mtblitz:Memo          = inRef.FIXferAdviseCanRq.FIXferOperInfo.Memo;
		SET outRef.mtblitz:FIXferOperInfo.mtblitz:Memo          = REPLACE(inRef.FIXferAdviseCanRq.FIXferOperInfo.Memo, '"', '&#34');

		SET outRef.mtblitz:FIXferOperInfo.mtblitz:OperatorInfo.iam:UserId        = inRef.FIXferAdviseCanRq.FIXferOperInfo.OperatorInfo.UserId;
		SET outRef.mtblitz:FIXferOperInfo.mtblitz:OperatorInfo.iam:RegionId      = inRef.FIXferAdviseCanRq.FIXferOperInfo.OperatorInfo.RegionId;
		SET outRef.mtblitz:FIXferOperInfo.mtblitz:OperatorInfo.iam:FullName      = inRef.FIXferAdviseCanRq.FIXferOperInfo.OperatorInfo.FullName;
		SET outRef.mtblitz:FIXferOperInfo.mtblitz:OperatorInfo.iam:OrgId         = inRef.FIXferAdviseCanRq.FIXferOperInfo.OperatorInfo.OrgId;
		SET outRef.mtblitz:FIXferOperInfo.mtblitz:OperatorInfo.iam:OrgName       = inRef.FIXferAdviseCanRq.FIXferOperInfo.OperatorInfo.OrgName;
		SET outRef.mtblitz:FIXferOperInfo.mtblitz:OperatorInfo.iam:OrgUnitId     = inRef.FIXferAdviseCanRq.FIXferOperInfo.OperatorInfo.OrgUnitId;
		SET outRef.mtblitz:FIXferOperInfo.mtblitz:OperatorInfo.iam:OrgUnitName   = inRef.FIXferAdviseCanRq.FIXferOperInfo.OperatorInfo.OrgUnitName;
		SET outRef.mtblitz:FIXferOperInfo.mtblitz:OperatorInfo.iam:EmployeeId    = inRef.FIXferAdviseCanRq.FIXferOperInfo.OperatorInfo.EmployeeId;
		SET outRef.mtblitz:FIXferOperInfo.mtblitz:OperatorInfo.iam:IpAddr        = inRef.FIXferAdviseCanRq.FIXferOperInfo.OperatorInfo.IpAddr;

		DECLARE outOperatorInfo  REFERENCE TO outRef.mtblitz:FIXferOperInfo.mtblitz:OperatorInfo;
		DECLARE outCertInfo2      REFERENCE TO outOperatorInfo;

		FOR inCertInfo AS inRef.FIXferAdviseCanRq.FIXferOperInfo.OperatorInfo.CertInfo[] DO			
		    CREATE LASTCHILD OF outOperatorInfo AS outCertInfo2 NAME 'iam:CertInfo';
		    
			SET outCertInfo2.iam:X509SubjectName         = inCertInfo.X509SubjectName;       
			SET outCertInfo2.iam:KeyName                 = inCertInfo.KeyName;       
			SET outCertInfo2.iam:RegionId                = inCertInfo.RegionId;       

			CALL FillSomeField(inCertInfo, outCertInfo2, 'iam', 'UserRole');				
       
			SET outCertInfo2.iam:Certificate             = inCertInfo.Certificate;       
		END FOR;

		------------------------------------
        IF EXISTS(inRef.FIXferAdviseCanRq.FIXferOperInfo.ControllerInfo.CertInfo[]) THEN        	
			SET outRef.mtblitz:FIXferOperInfo.mtblitz:ControllerInfo.iam:UserId           = inRef.FIXferAdviseCanRq.FIXferOperInfo.ControllerInfo.UserId;       
			SET outRef.mtblitz:FIXferOperInfo.mtblitz:ControllerInfo.iam:RegionId         = inRef.FIXferAdviseCanRq.FIXferOperInfo.ControllerInfo.RegionId;       
			SET outRef.mtblitz:FIXferOperInfo.mtblitz:ControllerInfo.iam:FullName         = inRef.FIXferAdviseCanRq.FIXferOperInfo.ControllerInfo.FullName;       
			SET outRef.mtblitz:FIXferOperInfo.mtblitz:ControllerInfo.iam:OrgId            = inRef.FIXferAdviseCanRq.FIXferOperInfo.ControllerInfo.OrgId;       
			SET outRef.mtblitz:FIXferOperInfo.mtblitz:ControllerInfo.iam:OrgName          = inRef.FIXferAdviseCanRq.FIXferOperInfo.ControllerInfo.OrgName;       
			SET outRef.mtblitz:FIXferOperInfo.mtblitz:ControllerInfo.iam:OrgUnitId        = inRef.FIXferAdviseCanRq.FIXferOperInfo.ControllerInfo.OrgUnitId;       
			SET outRef.mtblitz:FIXferOperInfo.mtblitz:ControllerInfo.iam:OrgUnitName      = inRef.FIXferAdviseCanRq.FIXferOperInfo.ControllerInfo.OrgUnitName;       
			SET outRef.mtblitz:FIXferOperInfo.mtblitz:ControllerInfo.iam:EmployeeId       = inRef.FIXferAdviseCanRq.FIXferOperInfo.ControllerInfo.EmployeeId;       
			SET outRef.mtblitz:FIXferOperInfo.mtblitz:ControllerInfo.iam:IpAddr           = inRef.FIXferAdviseCanRq.FIXferOperInfo.ControllerInfo.IpAddr;       

			DECLARE outControllerInfo  REFERENCE TO outRef.mtblitz:FIXferOperInfo.mtblitz:ControllerInfo;
			DECLARE outCertInfo3       REFERENCE TO outControllerInfo;

			FOR inCertInfo AS inRef.FIXferAdviseCanRq.FIXferOperInfo.ControllerInfo.CertInfo[] DO			
			    CREATE LASTCHILD OF outControllerInfo AS outCertInfo3 NAME 'iam:CertInfo';
			    
				SET outCertInfo3.iam:X509SubjectName         = inCertInfo.X509SubjectName;       
				SET outCertInfo3.iam:KeyName                 = inCertInfo.KeyName;       
				SET outCertInfo3.iam:RegionId                = inCertInfo.RegionId;       
	
				CALL FillSomeField(inCertInfo, outCertInfo3, 'iam', 'UserRole');				
	
				SET outCertInfo3.iam:Certificate             = inCertInfo.Certificate;       
			END FOR;
        END IF;
		------------------------------------

		SET outRef.mtblitz:FIXferOperInfo.mtblitz:Confirmation.mtblitz:Confirmed       = inRef.FIXferAdviseCanRq.FIXferOperInfo.Confirmation.Confirmed;       

		IF COALESCE(FIELDVALUE(inRef.FIXferAdviseCanRq.FIXferOperInfo.Confirmation.ConfDt),'') <> '' THEN
		   SET outRef.mtblitz:FIXferOperInfo.mtblitz:Confirmation.mtblitz:ConfDt			=  SUBSTRING(FIELDVALUE(inRef.FIXferAdviseCanRq.FIXferOperInfo.Confirmation.ConfDt) FROM 1 FOR 19);
		END IF;
--		SET outRef.mtblitz:FIXferOperInfo.mtblitz:Confirmation.mtblitz:ConfDt			=  inRef.FIXferAdviseCanRq.FIXferOperInfo.Confirmation.ConfDt || '000+04:00';
--		SET outRef.mtblitz:FIXferOperInfo.mtblitz:Confirmation.mtblitz:ConfDt			=  inRef.FIXferAdviseCanRq.FIXferOperInfo.Confirmation.ConfDt;

--		SET outRef.mtblitz:FIXferOperInfo.mtblitz:Confirmation.mtblitz:Memo            = inRef.FIXferAdviseCanRq.FIXferOperInfo.Confirmation.Memo;
		SET outRef.mtblitz:FIXferOperInfo.mtblitz:Confirmation.mtblitz:Memo            = REPLACE(inRef.FIXferAdviseCanRq.FIXferOperInfo.Confirmation.Memo, '"', '&#34');

--	    SET outRef.mtblitz:FIXferOperInfo.mtblitz:SignedData                           = inRef.FIXferAdviseCanRq.FIXferOperInfo.SignedData;
--		SET outRef.mtblitz:FIXferOperInfo.mtblitz:SignedData                           = REPLACE(inRef.FIXferAdviseCanRq.FIXferOperInfo.SignedData, '"', '&#34');
		
		/* SIGNATURE */
		DECLARE signature REFERENCE TO outRef;
		DECLARE keyInfo REFERENCE TO signature;		
		DECLARE userRole REFERENCE TO keyInfo;
				
		FOR signatureFor AS inRef.FIXferAdviseCanRq.Signature[] DO					
			CREATE LASTCHILD OF outRef AS signature NAMESPACE mtblitz NAME 'Signature';
			
			SET signature.mt:SignatureValue				=  signatureFor.SignatureValue;
			--SET signature.mt:SignedData					=  signatureFor.SignedData;
			---SET signature.mt:SignedData					=  REPLACE(signatureFor.SignedData, '"', '&#34');
			
			FOR keyFor AS inRef.FIXferAdviseCanRq.Signature.KeyInfo[] DO	
				
				CREATE LASTCHILD OF signature AS keyInfo NAMESPACE mt NAME 'KeyInfo';
				
				SET keyInfo.iam:X509SubjectName		=  keyFor.X509SubjectName;	
				SET keyInfo.iam:KeyName				=  keyFor.KeyName;
				SET keyInfo.iam:RegionId			=  keyFor.RegionId;
				
				CALL FillSomeField(keyFor, keyInfo, 'iam', 'UserRole');				
				
			END FOR;
			
			FOR userFor AS inRef.FIXferAdviseCanRq.Signature.UserInfo[] DO
				
				CREATE LASTCHILD OF signature AS userInfo NAMESPACE mt NAME 'UserInfo';
				
				SET userInfo.iam:UserId			=	userFor.UserId;
				SET userInfo.iam:RegionId		=	userFor.RegionId;
				SET userInfo.iam:FullName		=	userFor.FullName;
				SET userInfo.iam:OrgId			=	userFor.OrgId;
				SET userInfo.iam:OrgName		=	userFor.OrgName;
				SET userInfo.iam:OrgUnitId		=	userFor.OrgUnitId;
				SET userInfo.iam:OrgUnitName	=	userFor.OrgUnitNam;
				SET userInfo.iam:EmployeeId		=	userFor.EmployeeId;
				SET userInfo.iam:IpAddr			=	userFor.IpAddr;
				
				FOR certFor AS inRef.FIXferAdviseCanRq.Signature.UserInfo.CertInfo[] DO
					
					CREATE LASTCHILD OF userInfo AS certInfo NAMESPACE iam NAME 'CertInfo';
					
					SET certInfo.iam:X509SubjectName	=	certFor.X509SubjectName;
					SET certInfo.iam:KeyName			=	certFor.KeyName;
					SET certInfo.iam:RegionId			=	certFor.RegionId;
					
					CALL FillSomeField(certFor, certInfo, 'iam', 'UserRole');
					
					SET certInfo.iam:Certificate		=	certFor.Certificate;
				END FOR;	
			END FOR;
		END FOR;      

		RETURN TRUE;
	END;			
END MODULE;
/* 9-ый сервис */

CREATE COMPUTE MODULE RequestForKolibri_ConvertMDO2CRM_KZSrvBLGetCodeRq
	CREATE FUNCTION Main() RETURNS BOOLEAN
	BEGIN
	    CALL CopyMessageHeaders(InputRoot,OutputRoot);
		
		DECLARE inRef REFERENCE TO InputRoot.XMLNSC.[<];
		DECLARE outRef REFERENCE TO OutputRoot.XMLNSC.*[<];
				
	    SET OutputRoot.MQMD.ReplyToQ	= 'ESB.QPRAGMA.OUT';
	    SET OutputRoot.MQMD.ReplyToQMgr	= 'IKAZ.ESB.OUT.GW1'; 
				
		CREATE LASTCHILD OF OutputRoot DOMAIN('XMLNSC') NAME 'XMLNSC';
		CREATE LASTCHILD OF OutputRoot.XMLNSC AS outRef NAMESPACE mtblitz NAME 'SvcCodeInqRq'; 
		
		SET OutputRoot.XMLNSC.mtblitz:SvcCodeInqRq.(XMLNSC.NamespaceDecl)xmlns:mt = mt;
		SET OutputRoot.XMLNSC.mtblitz:SvcCodeInqRq.(XMLNSC.NamespaceDecl)xmlns:mtblitz = mtblitz;
		
		SET outRef.mt:RqUID			= inRef.RqUID;
		SET outRef.mt:RqTm			= convertFromQPtoKOLI(inRef.RqTm);
		SET outRef.mt:SPName		= 'urn:sbrfsystems:98-abs';
		SET outRef.mt:OperName		= 'SrvBLGetCode';
		                               
		SET outRef.mtblitz:BankInfo.mtblitz:BankId	= inRef.SvcCodeInqRq.BankInfo.BankId;       
		SET outRef.mtblitz:BankInfo.mtblitz:Country	= inRef.SvcCodeInqRq.BankInfo.Country;
		SET outRef.mtblitz:BankInfo.mtblitz:City	= inRef.SvcCodeInqRq.BankInfo.City;  
		
		RETURN TRUE;
	END;			
END MODULE;

/* 2-ой сервис */
CREATE COMPUTE MODULE RequestForKolibri_ConvertMDO2CRM_KZSrvBLCreateMoneyTransferRq
	CREATE FUNCTION Main() RETURNS BOOLEAN
	BEGIN
	    CALL CopyMessageHeaders(InputRoot,OutputRoot);
		
		DECLARE inRef REFERENCE TO InputRoot.XMLNSC.[<];
		DECLARE outRef REFERENCE TO OutputRoot.XMLNSC.*[<];
				
	    SET OutputRoot.MQMD.ReplyToQ	= 'ESB.QPRAGMA.OUT';
	    SET OutputRoot.MQMD.ReplyToQMgr	= 'IKAZ.ESB.OUT.GW1';				
				
		CREATE LASTCHILD OF OutputRoot DOMAIN('XMLNSC') NAME 'XMLNSC';
		CREATE LASTCHILD OF OutputRoot.XMLNSC AS outRef NAMESPACE mtblitz NAME 'FIXferAddRq'; 
		
    	SET OutputRoot.XMLNSC.mtblitz:FIXferAddRq.(XMLNSC.NamespaceDecl)xmlns:iam = iam;
		SET OutputRoot.XMLNSC.mtblitz:FIXferAddRq.(XMLNSC.NamespaceDecl)xmlns:mt = mt;		
    	SET OutputRoot.XMLNSC.mtblitz:FIXferAddRq.(XMLNSC.NamespaceDecl)xmlns:ca  = ca; 
		SET OutputRoot.XMLNSC.mtblitz:FIXferAddRq.(XMLNSC.NamespaceDecl)xmlns:mtblitz = mtblitz; 	
    	SET OutputRoot.XMLNSC.mtblitz:FIXferAddRq.(XMLNSC.NamespaceDecl)xmlns:ind = ind; 
		SET OutputRoot.XMLNSC.mtblitz:FIXferAddRq.(XMLNSC.NamespaceDecl)xmlns:orgs = orgs; 
		
		SET outRef.mt:RqUID			= inRef.RqUID;
		SET outRef.mt:RqTm			= convertFromQPtoKOLI(inRef.RqTm);
		SET outRef.mt:SPName		= 'urn:sbrfsystems:98-abs';
		SET outRef.mt:OperName		= 'SrvBLCreateMoneyTransfer';
        
        DECLARE userInfo REFERENCE TO outRef;
        
        CREATE LASTCHILD OF outRef AS userInfo NAMESPACE mtblitz NAME 'UserInfo'; 
        
        SET userInfo.iam:UserId			= inRef.FIXferAddRq.UserInfo.UserId; -- обязательное поле
        SET userInfo.iam:RegionId		= COALESCE(inRef.FIXferAddRq.UserInfo.RegionId, ''); 
        SET userInfo.iam:FullName		= inRef.FIXferAddRq.UserInfo.FullName;
        
        /* userInfo.iam:PersonName */
        DECLARE personName REFERENCE TO userInfo;                	                
        
        IF EXISTS(inRef.FIXferAddRq.UserInfo.PersonName[]) THEN
        	CREATE LASTCHILD OF userInfo AS personName NAMESPACE iam NAME 'PersonName'; -- создаем PersonName с namespace iam внутри UserInfo            
        	CALL FillSomeField(inRef.FIXferAddRq.UserInfo.PersonName, personName, 'ind', 'LastName');
        END IF;
        
        IF inRef.FIXferAddRq.UserInfo.PersonName.FirstName <> '' THEN
        	SET personName.ind:FirstName = inRef.FIXferAddRq.UserInfo.PersonName.FirstName;
        END IF;
		
		IF EXISTS(inRef.FIXferAddRq.UserInfo.PersonName[]) THEN
			CALL FillSomeField(inRef.FIXferAddRq.UserInfo.PersonName, personName, 'ind', 'MiddleName');
		END IF;
        
        IF inRef.FIXferAddRq.UserInfo.PersonName.TitlePrefix <> '' THEN
        	SET personName.ind:TitlePrefix 	= inRef.FIXferAddRq.UserInfo.PersonName.TitlePrefix;
        END IF;
        
        IF inRef.FIXferAddRq.UserInfo.PersonName.NameSuffix <> '' THEN
        	SET personName.ind:NameSuffix 	= inRef.FIXferAddRq.UserInfo.PersonName.NameSuffix;
        END IF;
        
        IF inRef.FIXferAddRq.UserInfo.PersonName.Nickname <> '' THEN
        	SET personName.ind:Nickname 	= inRef.FIXferAddRq.UserInfo.PersonName.Nickname;
        END IF;
        
        IF inRef.FIXferAddRq.UserInfo.PersonName.LegalName <> '' THEN	
        	SET personName.ind:LegalName    = inRef.FIXferAddRq.UserInfo.PersonName.LegalName;
        END IF;	
        /* userInfo.iam:PersonName */
              
		SET userInfo.iam:OrgId				= inRef.FIXferAddRq.UserInfo.OrgId;
		SET userInfo.iam:OrgName			= inRef.FIXferAddRq.UserInfo.OrgName;
		SET userInfo.iam:OrgUnitId			= inRef.FIXferAddRq.UserInfo.OrgUnitId;
		SET userInfo.iam:OrgUnitName		= inRef.FIXferAddRq.UserInfo.OrgUnitName;
		SET userInfo.iam:EmployeeId			= inRef.FIXferAddRq.UserInfo.EmployeeId;
		SET userInfo.iam:IpAddr				= inRef.FIXferAddRq.UserInfo.IpAddr;
		
		DECLARE COUNTER INTEGER 1;
		DECLARE ARRAY_USERINFO INTEGER CARDINALITY(inRef.FIXferAddRq.UserInfo.*[]);		
		
		/* userInfo.iam:CertInfo */
		DECLARE certInfo REFERENCE TO userInfo;
		
		WHILE COUNTER <= ARRAY_USERINFO DO
		
			IF FIELDNAME(inRef.FIXferAddRq.UserInfo.[COUNTER]) = 'CertInfo' THEN
				
				CREATE LASTCHILD OF userInfo AS certInfo NAMESPACE iam NAME 'CertInfo';
				
				SET certInfo.iam:X509SubjectName  =  FIELDVALUE(inRef.FIXferAddRq.UserInfo.[COUNTER].X509SubjectName);
				SET certInfo.iam:KeyName		  =  FIELDVALUE(inRef.FIXferAddRq.UserInfo.[COUNTER].KeyName);	
				SET certInfo.iam:RegionId		  =  FIELDVALUE(inRef.FIXferAddRq.UserInfo.[COUNTER].RegionId);				
				      
        		CALL FillSomeField(inRef.FIXferAddRq.UserInfo.[COUNTER], certInfo, 'iam', 'UserRole');
        		        		
        		SET certInfo.iam:Certificate		  =  FIELDVALUE(inRef.FIXferAddRq.UserInfo.[COUNTER].Certificate);
        		SET certInfo.iam:KeyValue			  =  FIELDVALUE(inRef.FIXferAddRq.UserInfo.[COUNTER].KeyValue); 
        		SET certInfo.iam:X509SerialNumber     =  FIELDVALUE(inRef.FIXferAddRq.UserInfo.[COUNTER].X509SerialNumber);
        		SET certInfo.iam:X509IssuerNumber     =  FIELDVALUE(inRef.FIXferAddRq.UserInfo.[COUNTER].X509IssuerNumber); 			
				SET certInfo.iam:X509IssuerSerial     =  FIELDVALUE(inRef.FIXferAddRq.UserInfo.[COUNTER].X509IssuerSerial);
				SET certInfo.iam:Version		      =  FIELDVALUE(inRef.FIXferAddRq.UserInfo.[COUNTER].Version);
				SET certInfo.iam:NotBefore		      =  FIELDVALUE(inRef.FIXferAddRq.UserInfo.[COUNTER].NotBefore);
				SET certInfo.iam:NotAfter			  =  FIELDVALUE(inRef.FIXferAddRq.UserInfo.[COUNTER].NotAfter);
				SET certInfo.iam:SigAlgName			  =  FIELDVALUE(inRef.FIXferAddRq.UserInfo.[COUNTER].SigAlgName);
				SET certInfo.iam:SigValue			  =  FIELDVALUE(inRef.FIXferAddRq.UserInfo.[COUNTER].SigValue);
				
				DECLARE COUNTER_CERTINFO INTEGER 1;
				DECLARE ARRAY_CERTINFO INTEGER CARDINALITY(inRef.FIXferAddRq.UserInfo.[COUNTER].*[]);
				DECLARE extensionInfo REFERENCE TO certInfo;
				
				WHILE COUNTER_CERTINFO <= ARRAY_CERTINFO DO
					IF FIELDNAME(inRef.FIXferAddRq.UserInfo.[COUNTER].[COUNTER_CERTINFO]) = 'Extension' THEN
						CREATE LASTCHILD OF certInfo AS extensionInfo NAMESPACE iam NAME 'Extension';
												
						SET extensionInfo.iam:ExtnId      = FIELDVALUE(inRef.FIXferAddRq.UserInfo.[COUNTER].[COUNTER_CERTINFO].ExtnId);
						SET extensionInfo.iam:Critical    = FIELDVALUE(inRef.FIXferAddRq.UserInfo.[COUNTER].[COUNTER_CERTINFO].Critical);
						SET extensionInfo.iam:ExtnValue   = FIELDVALUE(inRef.FIXferAddRq.UserInfo.[COUNTER].[COUNTER_CERTINFO].ExtnValue);												
					END IF;					
					SET COUNTER_CERTINFO = COUNTER_CERTINFO + 1;						
				END WHILE;
						
			END IF;
			
			SET COUNTER = COUNTER + 1;
			
		END WHILE;		
		/* userInfo.iam:CertInfo */		
		
		/* FIXferInfo */
		DECLARE fixferInfo REFERENCE TO outRef;		
		CREATE LASTCHILD OF outRef AS fixferInfo NAMESPACE mtblitz NAME 'FIXferInfo';
		
		/* SENDER */
		DECLARE sender REFERENCE TO fixferInfo;
		CREATE LASTCHILD OF fixferInfo AS sender NAMESPACE mtblitz NAME 'Sender';
		
		/* BankInfo */
		DECLARE bankInfo REFERENCE TO sender;
		CREATE LASTCHILD OF sender AS bankInfo NAMESPACE mtblitz NAME 'BankInfo';
		
		SET bankInfo.mtblitz:BankId  =  inRef.FIXferAddRq.FIXferInfo.Sender.BankInfo.BankId;
		SET bankInfo.mtblitz:Country =  inRef.FIXferAddRq.FIXferInfo.Sender.BankInfo.Country; 
		SET bankInfo.mtblitz:City    =  inRef.FIXferAddRq.FIXferInfo.Sender.BankInfo.City;				
		
		/* PersonInfo */
		DECLARE personInfo REFERENCE TO sender;
		CREATE LASTCHILD OF sender AS personInfo NAMESPACE mtblitz NAME 'PersonInfo';   
		
		SET personInfo.ind:NameAddrType  =  inRef.FIXferAddRq.FIXferInfo.Sender.PersonInfo.NameAddrType;
		SET personInfo.ind:FullName     =  inRef.FIXferAddRq.FIXferInfo.Sender.PersonInfo.FullName;		
		
		IF EXISTS(inRef.FIXferAddRq.FIXferInfo.Sender.PersonInfo.PersonName[]) THEN
        	-- создаем PersonName с namespace iam внутри UserInfo
        	CREATE LASTCHILD OF personInfo AS personName NAMESPACE ind NAME 'PersonName';             
        	CALL FillSomeField(inRef.FIXferAddRq.FIXferInfo.Sender.PersonInfo.PersonName, personName, 'ind', 'LastName');
        	
        	SET personName.ind:FirstName	=	inRef.FIXferAddRq.FIXferInfo.Sender.PersonInfo.PersonName.FirstName;	
        	
        	IF EXISTS(inRef.FIXferAddRq.FIXferInfo.Sender.PersonInfo.PersonName[]) THEN
				CALL FillSomeField(inRef.FIXferAddRq.FIXferInfo.Sender.PersonInfo.PersonName, personName, 'ind', 'MiddleName');
			END IF;
        	
        	SET personName.ind:TitlePrefix	=	inRef.FIXferAddRq.FIXferInfo.Sender.PersonInfo.PersonName.TitlePrefix;	
        	SET personName.ind:NameSuffix	=	inRef.FIXferAddRq.FIXferInfo.Sender.PersonInfo.PersonName.NameSuffix;
        	SET personName.ind:Nickname		=	inRef.FIXferAddRq.FIXferInfo.Sender.PersonInfo.PersonName.Nickname;
        	SET personName.ind:LegalName	=	inRef.FIXferAddRq.FIXferInfo.Sender.PersonInfo.PersonName.LegalName;
        	
        END IF;		
		
		DECLARE COUNT_CONTACTINFO INTEGER 1;
		DECLARE ARRAY_CONTACTINFO INTEGER CARDINALITY(inRef.FIXferAddRq.FIXferInfo.Sender.PersonInfo.*[]);
		DECLARE contactInfo REFERENCE TO personInfo;
		
		/* ContactInfo */
		WHILE COUNT_CONTACTINFO <= ARRAY_CONTACTINFO DO
			IF FIELDNAME(inRef.FIXferAddRq.FIXferInfo.Sender.PersonInfo.[COUNT_CONTACTINFO]) = 'ContactInfo' THEN
				CREATE LASTCHILD OF personInfo AS contactInfo NAMESPACE ind NAME 'ContactInfo';
				/*
				IF FIELDVALUE(inRef.FIXferAddRq.FIXferInfo.Sender.PersonInfo.[COUNT_CONTACTINFO].ContactPref) <> '' THEN
					SET contactInfo.ca:ContactPref		=	FIELDVALUE(inRef.FIXferAddRq.FIXferInfo.Sender.PersonInfo.[COUNT_CONTACTINFO].ContactPref);
				END IF;
				
				IF FIELDVALUE(inRef.FIXferAddRq.FIXferInfo.Sender.PersonInfo.[COUNT_CONTACTINFO].PrefTimeStart) <> '' THEN
					SET contactInfo.ca:PrefTimeStart	=	FIELDVALUE(inRef.FIXferAddRq.FIXferInfo.Sender.PersonInfo.[COUNT_CONTACTINFO].PrefTimeStart);
				END IF;
				
				IF FIELDVALUE(inRef.FIXferAddRq.FIXferInfo.Sender.PersonInfo.[COUNT_CONTACTINFO].PrefTimeEnd) <> '' THEN
					SET contactInfo.ca:PrefTimeEnd		=   FIELDVALUE(inRef.FIXferAddRq.FIXferInfo.Sender.PersonInfo.[COUNT_CONTACTINFO].PrefTimeEnd);
				END IF;
				*/
				DECLARE COUNT_PHONENUM INTEGER 1;
				DECLARE ARRAY_PHONENUM INTEGER CARDINALITY(inRef.FIXferAddRq.FIXferInfo.Sender.PersonInfo.[COUNT_CONTACTINFO].*[]);
 				DECLARE phoneNum REFERENCE TO contactInfo;
 				
 				WHILE COUNT_PHONENUM <= ARRAY_CONTACTINFO DO
 					IF FIELDNAME(inRef.FIXferAddRq.FIXferInfo.Sender.PersonInfo.[COUNT_CONTACTINFO].[COUNT_PHONENUM]) = 'PhoneNum' THEN
 						CREATE LASTCHILD OF contactInfo AS phoneNum NAMESPACE ca NAME 'PhoneNum';
 						
 						/*IF FIELDVALUE(inRef.FIXferAddRq.FIXferInfo.Sender.PersonInfo.[COUNT_CONTACTINFO].[COUNT_PHONENUM].PhoneType) <> '' THEN
 							SET phoneNum.ca:PhoneType		=	FIELDVALUE(inRef.FIXferAddRq.FIXferInfo.Sender.PersonInfo.[COUNT_CONTACTINFO].[COUNT_PHONENUM].PhoneType);
 						END IF;*/
 						 						
 						SET phoneNum.ca:Phone			= 	FIELDVALUE(inRef.FIXferAddRq.FIXferInfo.Sender.PersonInfo.[COUNT_CONTACTINFO].[COUNT_PHONENUM].Phone);
 						
 						/*IF FIELDVALUE(inRef.FIXferAddRq.FIXferInfo.Sender.PersonInfo.[COUNT_CONTACTINFO].[COUNT_PHONENUM].PhoneCode) <> '' THEN
 							SET phoneNum.ca:PhoneCode   	=   FIELDVALUE(inRef.FIXferAddRq.FIXferInfo.Sender.PersonInfo.[COUNT_CONTACTINFO].[COUNT_PHONENUM].PhoneCode);
 						END IF;*/
 						
 						/*IF FIELDVALUE(inRef.FIXferAddRq.FIXferInfo.Sender.PersonInfo.[COUNT_CONTACTINFO].[COUNT_PHONENUM].PhoneOperName) <> '' THEN
 							SET phoneNum.ca:PhoneOperName   =   FIELDVALUE(inRef.FIXferAddRq.FIXferInfo.Sender.PersonInfo.[COUNT_CONTACTINFO].[COUNT_PHONENUM].PhoneOperName);
 						END IF;*/
 						
 					END IF;	
 					SET COUNT_PHONENUM = COUNT_PHONENUM + 1; 					
 				END WHILE;
 				
 				/*IF FIELDVALUE(inRef.FIXferAddRq.FIXferInfo.Sender.PersonInfo.[COUNT_CONTACTINFO].ContactName) <> '' THEN
 					SET contactInfo.ca:ContactName	=	FIELDVALUE(inRef.FIXferAddRq.FIXferInfo.Sender.PersonInfo.[COUNT_CONTACTINFO].ContactName);
 				END IF;
 				
 				IF FIELDVALUE(inRef.FIXferAddRq.FIXferInfo.Sender.PersonInfo.[COUNT_CONTACTINFO].EmailAddr) <> '' THEN	
 					SET contactInfo.ca:EmailAddr	=	FIELDVALUE(inRef.FIXferAddRq.FIXferInfo.Sender.PersonInfo.[COUNT_CONTACTINFO].EmailAddr);
 				END IF;
 				
 				IF FIELDVALUE(inRef.FIXferAddRq.FIXferInfo.Sender.PersonInfo.[COUNT_CONTACTINFO].URL) <> '' THEN 
 					SET contactInfo.ca:URL			=	FIELDVALUE(inRef.FIXferAddRq.FIXferInfo.Sender.PersonInfo.[COUNT_CONTACTINFO].URL);
 				END IF;*/
 				
 				DECLARE COUNT_CONTACTDATA INTEGER 1;
 				DECLARE ARRAY_CONTACTDATA INTEGER CARDINALITY(inRef.FIXferAddRq.FIXferInfo.Sender.PersonInfo.[COUNT_CONTACTINFO].*[]);
 				DECLARE contactData REFERENCE TO contactInfo;
 				/*
 				WHILE COUNT_CONTACTDATA <= ARRAY_CONTACTDATA DO
 					IF FIELDNAME(inRef.FIXferAddRq.FIXferInfo.Sender.PersonInfo.[COUNT_CONTACTINFO].[COUNT_CONTACTDATA]) = 'ContactData' THEN
 						CREATE LASTCHILD OF contactInfo AS contactData NAMESPACE ca NAME 'ContactData';
 						
 						IF FIELDVALUE(inRef.FIXferAddRq.FIXferInfo.Sender.PersonInfo.[COUNT_CONTACTINFO].[COUNT_CONTACTDATA].ContactType) <> '' THEN
 							SET contactData.ca:ContactType		=  FIELDVALUE(inRef.FIXferAddRq.FIXferInfo.Sender.PersonInfo.[COUNT_CONTACTINFO].[COUNT_CONTACTDATA].ContactType);
 						END IF;
 						
 						IF FIELDVALUE(inRef.FIXferAddRq.FIXferInfo.Sender.PersonInfo.[COUNT_CONTACTINFO].[COUNT_CONTACTDATA].ContactValue) <> '' THEN	
 							SET contactData.ca:ContactValue		=  FIELDVALUE(inRef.FIXferAddRq.FIXferInfo.Sender.PersonInfo.[COUNT_CONTACTINFO].[COUNT_CONTACTDATA].ContactValue);
 						END IF;
 						
 						IF FIELDVALUE(inRef.FIXferAddRq.FIXferInfo.Sender.PersonInfo.[COUNT_CONTACTINFO].[COUNT_CONTACTDATA].PrefTimeStart) <> '' THEN
 							SET contactData.ca:PrefTimeStart	=  FIELDVALUE(inRef.FIXferAddRq.FIXferInfo.Sender.PersonInfo.[COUNT_CONTACTINFO].[COUNT_CONTACTDATA].PrefTimeStart);
 						END IF;
 						
 						IF FIELDVALUE(inRef.FIXferAddRq.FIXferInfo.Sender.PersonInfo.[COUNT_CONTACTINFO].[COUNT_CONTACTDATA].PrefTimeEnd) <> '' THEN
 							SET contactData.ca:PrefTimeEnd		=  FIELDVALUE(inRef.FIXferAddRq.FIXferInfo.Sender.PersonInfo.[COUNT_CONTACTINFO].[COUNT_CONTACTDATA].PrefTimeEnd);
 						END IF;
 							
 					END IF;	
 					SET COUNT_CONTACTDATA = COUNT_CONTACTDATA + 1;
 				END WHILE;
 				*/
 				DECLARE COUNT_POSTADDR INTEGER 1;
				DECLARE postAddr REFERENCE TO contactInfo;
				
				WHILE COUNT_POSTADDR <= ARRAY_CONTACTDATA DO
					IF FIELDNAME(inRef.FIXferAddRq.FIXferInfo.Sender.PersonInfo.[COUNT_CONTACTINFO].[COUNT_POSTADDR]) = 'PostAddr' THEN
						CREATE LASTCHILD OF contactInfo AS postAddr NAMESPACE ca NAME 'PostAddr';
						
						SET postAddr.ca:Addr1			=	FIELDVALUE(inRef.FIXferAddRq.FIXferInfo.Sender.PersonInfo.[COUNT_CONTACTINFO].[COUNT_POSTADDR].Addr1);  
						/*SET postAddr.ca:Addr2			=	FIELDVALUE(inRef.FIXferAddRq.FIXferInfo.Sender.PersonInfo.[COUNT_CONTACTINFO].[COUNT_POSTADDR].Addr2);  
						SET postAddr.ca:Addr3			=	FIELDVALUE(inRef.FIXferAddRq.FIXferInfo.Sender.PersonInfo.[COUNT_CONTACTINFO].[COUNT_POSTADDR].Addr3);  
						SET postAddr.ca:Addr4			=	FIELDVALUE(inRef.FIXferAddRq.FIXferInfo.Sender.PersonInfo.[COUNT_CONTACTINFO].[COUNT_POSTADDR].Addr4);
						SET postAddr.ca:City			=	FIELDVALUE(inRef.FIXferAddRq.FIXferInfo.Sender.PersonInfo.[COUNT_CONTACTINFO].[COUNT_POSTADDR].City);    
						SET postAddr.ca:CityCode		=	FIELDVALUE(inRef.FIXferAddRq.FIXferInfo.Sender.PersonInfo.[COUNT_CONTACTINFO].[COUNT_POSTADDR].CityCode);
						SET postAddr.ca:StateProv		=	FIELDVALUE(inRef.FIXferAddRq.FIXferInfo.Sender.PersonInfo.[COUNT_CONTACTINFO].[COUNT_POSTADDR].StateProv);
						SET postAddr.ca:StateProvCode	=	FIELDVALUE(inRef.FIXferAddRq.FIXferInfo.Sender.PersonInfo.[COUNT_CONTACTINFO].[COUNT_POSTADDR].StateProvCode);
						SET postAddr.ca:Area			= 	FIELDVALUE(inRef.FIXferAddRq.FIXferInfo.Sender.PersonInfo.[COUNT_CONTACTINFO].[COUNT_POSTADDR].Area);
						SET postAddr.ca:AreaCode		= 	FIELDVALUE(inRef.FIXferAddRq.FIXferInfo.Sender.PersonInfo.[COUNT_CONTACTINFO].[COUNT_POSTADDR].AreaCode);
						SET postAddr.ca:PostalCode		= 	FIELDVALUE(inRef.FIXferAddRq.FIXferInfo.Sender.PersonInfo.[COUNT_CONTACTINFO].[COUNT_POSTADDR].PostalCode);
						SET postAddr.ca:Country			= 	FIELDVALUE(inRef.FIXferAddRq.FIXferInfo.Sender.PersonInfo.[COUNT_CONTACTINFO].[COUNT_POSTADDR].Country);
						SET postAddr.ca:CountryCode		= 	FIELDVALUE(inRef.FIXferAddRq.FIXferInfo.Sender.PersonInfo.[COUNT_CONTACTINFO].[COUNT_POSTADDR].CountryCode);
						SET postAddr.ca:AddrType		= 	FIELDVALUE(inRef.FIXferAddRq.FIXferInfo.Sender.PersonInfo.[COUNT_CONTACTINFO].[COUNT_POSTADDR].AddrType);      
						IF FIELDVALUE(inRef.FIXferAddRq.FIXferInfo.Sender.PersonInfo.[COUNT_CONTACTINFO].[COUNT_POSTADDR].StartDt) <> '' THEN
							SET postAddr.ca:StartDt		= 	SUBSTRING(FIELDVALUE(inRef.FIXferAddRq.FIXferInfo.Sender.PersonInfo.[COUNT_CONTACTINFO].[COUNT_POSTADDR].StartDt) BEFORE 'T');
						END IF;
						IF FIELDVALUE(inRef.FIXferAddRq.FIXferInfo.Sender.PersonInfo.[COUNT_CONTACTINFO].[COUNT_POSTADDR].EndDt) <> '' THEN
							SET postAddr.ca:EndDt		= 	SUBSTRING(FIELDVALUE(inRef.FIXferAddRq.FIXferInfo.Sender.PersonInfo.[COUNT_CONTACTINFO].[COUNT_POSTADDR].EndDt) BEFORE 'T');
						END IF;
						SET postAddr.ca:DistrictCode	= 	FIELDVALUE(inRef.FIXferAddRq.FIXferInfo.Sender.PersonInfo.[COUNT_CONTACTINFO].[COUNT_POSTADDR].DistrictCode);
						SET postAddr.ca:District		= 	FIELDVALUE(inRef.FIXferAddRq.FIXferInfo.Sender.PersonInfo.[COUNT_CONTACTINFO].[COUNT_POSTADDR].District);
						SET postAddr.ca:PlaсeCode		= 	FIELDVALUE(inRef.FIXferAddRq.FIXferInfo.Sender.PersonInfo.[COUNT_CONTACTINFO].[COUNT_POSTADDR].PlaсeCode);
						SET postAddr.ca:Place			= 	FIELDVALUE(inRef.FIXferAddRq.FIXferInfo.Sender.PersonInfo.[COUNT_CONTACTINFO].[COUNT_POSTADDR].Place);
						SET postAddr.ca:StreetCode		= 	FIELDVALUE(inRef.FIXferAddRq.FIXferInfo.Sender.PersonInfo.[COUNT_CONTACTINFO].[COUNT_POSTADDR].StreetCode);
						SET postAddr.ca:Street			= 	FIELDVALUE(inRef.FIXferAddRq.FIXferInfo.Sender.PersonInfo.[COUNT_CONTACTINFO].[COUNT_POSTADDR].Street);
						SET postAddr.ca:House			= 	FIELDVALUE(inRef.FIXferAddRq.FIXferInfo.Sender.PersonInfo.[COUNT_CONTACTINFO].[COUNT_POSTADDR].House);
						SET postAddr.ca:Corpus			= 	FIELDVALUE(inRef.FIXferAddRq.FIXferInfo.Sender.PersonInfo.[COUNT_CONTACTINFO].[COUNT_POSTADDR].Corpus);
						SET postAddr.ca:Building		= 	FIELDVALUE(inRef.FIXferAddRq.FIXferInfo.Sender.PersonInfo.[COUNT_CONTACTINFO].[COUNT_POSTADDR].Building);
						SET postAddr.ca:Flat			= 	FIELDVALUE(inRef.FIXferAddRq.FIXferInfo.Sender.PersonInfo.[COUNT_CONTACTINFO].[COUNT_POSTADDR].Flat);
						SET postAddr.ca:Office			= 	FIELDVALUE(inRef.FIXferAddRq.FIXferInfo.Sender.PersonInfo.[COUNT_CONTACTINFO].[COUNT_POSTADDR].Office);
						SET postAddr.ca:RusKLADR		= 	FIELDVALUE(inRef.FIXferAddRq.FIXferInfo.Sender.PersonInfo.[COUNT_CONTACTINFO].[COUNT_POSTADDR].RusKLADR);
						SET postAddr.ca:AddrStatus		= 	FIELDVALUE(inRef.FIXferAddRq.FIXferInfo.Sender.PersonInfo.[COUNT_CONTACTINFO].[COUNT_POSTADDR].AddrStatus);*/
						
					END IF;
					SET COUNT_POSTADDR = COUNT_POSTADDR + 1;	
				END WHILE;		
 				
 				--SET contactInfo.ca:ProviderCode			=	FIELDVALUE(inRef.FIXferAddRq.FIXferInfo.Sender.PersonInfo.[COUNT_CONTACTINFO].ProviderCode);
 				
			END IF;	
			SET COUNT_CONTACTINFO = COUNT_CONTACTINFO + 1;
		END WHILE;
		
		/* PersonInfo */
		
		IF EXISTS(inRef.FIXferAddRq.FIXferInfo.Sender.PersonInfo.TINInfo[]) THEN
		
		SET personInfo.ind:TINInfo.ca:TINType   =  inRef.FIXferAddRq.FIXferInfo.Sender.PersonInfo.TINInfo.TINType;
		SET personInfo.ind:TINInfo.ca:TaxId  	=  inRef.FIXferAddRq.FIXferInfo.Sender.PersonInfo.TINInfo.TaxId;
		SET personInfo.ind:TINInfo.ca:CertCode  =  inRef.FIXferAddRq.FIXferInfo.Sender.PersonInfo.TINInfo.CertCode;
		
		END IF;
		/*IF COALESCE(FIELDVALUE(inRef.FIXferAddRq.FIXferInfo.Sender.PersonInfo.BirthDt),'') <> '' THEN
			SET personInfo.ind:BirthDt				=  SUBSTRING(FIELDVALUE(inRef.FIXferAddRq.FIXferInfo.Sender.PersonInfo.BirthDt) FROM 1 FOR 10);
		END IF;*/
		
		IF EXISTS(inRef.FIXferAddRq.FIXferInfo.Sender.PersonInfo.DriversLicense[]) THEN 
			SET personInfo.ind:DriversLicense.ind:LicenseNum		=  COALESCE(inRef.FIXferAddRq.FIXferInfo.Sender.PersonInfo.DriversLicense.LicenseNum, NULL);
			SET personInfo.ind:DriversLicense.ind:StateProv			=  COALESCE(inRef.FIXferAddRq.FIXferInfo.Sender.PersonInfo.DriversLicense.StateProv, NULL);
			SET personInfo.ind:DriversLicense.ind:Country			=  COALESCE(inRef.FIXferAddRq.FIXferInfo.Sender.PersonInfo.DriversLicense.Country, NULL);
		END IF;
		
		SET personInfo.ind:MotherMaidenName						=  inRef.FIXferAddRq.FIXferInfo.Sender.PersonInfo.MotherMaidenName;
		SET personInfo.ind:SpouseName							=  inRef.FIXferAddRq.FIXferInfo.Sender.PersonInfo.SpouseName;
		
		DECLARE COUNTER_EMPLOYMENT INTEGER 1;
		DECLARE employment REFERENCE TO personInfo;
		
		WHILE COUNTER_EMPLOYMENT <= ARRAY_CONTACTINFO DO
			IF FIELDNAME(inRef.FIXferAddRq.FIXferInfo.Sender.PersonInfo.[COUNTER_EMPLOYMENT]) = 'EmploymentHistory' THEN
				CREATE LASTCHILD OF personInfo AS employment NAMESPACE ind NAME 'EmploymentHistory';
				
				SET employment.ind:EmploymentStatus		=	inRef.FIXferAddRq.FIXferInfo.Sender.PersonInfo.[COUNTER_EMPLOYMENT].EmploymentStatus;				

				DECLARE orgInfo REFERENCE TO employment;
				DECLARE industId REFERENCE TO employment;
				DECLARE composite REFERENCE TO employment;
				DECLARE general REFERENCE TO employment;
								
				FOR orgFor AS inRef.FIXferAddRq.FIXferInfo.Sender.PersonInfo.[COUNTER_EMPLOYMENT].OrgInfo[] DO
					CREATE LASTCHILD OF employment AS orgInfo NAMESPACE ind NAME 'OrgInfo';
					
					FOR industFor AS inRef.FIXferAddRq.FIXferInfo.Sender.PersonInfo.[COUNTER_EMPLOYMENT].OrgInfo.IndustId[] DO
						CREATE LASTCHILD OF orgInfo AS industId NAMESPACE orgs NAME 'IndustId';
						
						SET industId.orgs:Org			=	industFor.Org;
						SET industId.orgs:IndustNum		=	industFor.IndustNum;
						SET industId.orgs:SubIndustrNum =   industFor.SubIndustrNum;
						SET industId.orgs:IsPrimary	    =   industFor.IsPrimary;						
					END FOR;
					
					SET orgInfo.orgs:Name 			=	orgFor.Name;	
					SET orgInfo.orgs:LegalName 		=	orgFor.LegalName;
					SET orgInfo.orgs:LegalNameEn 	=	orgFor.LegalNameEn;
					SET orgInfo.orgs:FullNameEn 	=	orgFor.FullNameEn;
					SET orgInfo.orgs:MnemonicName 	=	orgFor.MnemonicName;
					
					FOR compositeFor AS inRef.FIXferAddRq.FIXferInfo.Sender.PersonInfo.[COUNTER_EMPLOYMENT].OrgInfo.CompositeContactInfo[] DO
						CREATE LASTCHILD OF orgInfo AS composite NAMESPACE orgs NAME 'CompositeContactInfo';
						
						SET composite.ca:ContactInfoType	=  compositeFor.ContactInfoType;
						
						FOR contactFor AS inRef.FIXferAddRq.FIXferInfo.Sender.PersonInfo.[COUNTER_EMPLOYMENT].OrgInfo.CompositeContactInfo.ContactInfo[] DO
							CREATE LASTCHILD OF composite AS contactInfo NAMESPACE ca NAME 'ContactInfo';
							
							SET contactInfo.ca:ContactPref		=	contactFor.ContactPref;
							
							IF FIELDVALUE(contactFor.PrefTimeStart) <> '' THEN
								SET contactInfo.ca:PrefTimeStart	=	FIELDVALUE(contactFor.PrefTimeStart);
							END IF;
							
							IF FIELDVALUE(contactFor.PrefTimeEnd) <> '' THEN	
								SET contactInfo.ca:PrefTimeEnd		=	FIELDVALUE(contactFor.PrefTimeEnd);
							END IF;
							
							FOR phoneFor AS inRef.FIXferAddRq.FIXferInfo.Sender.PersonInfo.[COUNTER_EMPLOYMENT].OrgInfo.CompositeContactInfo.ContactInfo.PhoneNum[] DO		
								CREATE LASTCHILD OF contactInfo AS general NAMESPACE ca NAME 'PhoneNum';
								
								SET general.ca:PhoneType		=	phoneFor.PhoneType;
								SET general.ca:Phone			=	phoneFor.Phone;
								SET general.ca:PhoneCode		=	phoneFor.PhoneCode;
								SET general.ca:PhoneOperName	=	phoneFor.PhoneOperName;								
							END FOR;
							
							SET contactInfo.ca:ContactName		=	contactFor.ContactName;
							SET contactInfo.ca:EmailAddr		=	contactFor.EmailAddr;
							SET contactInfo.ca:URL				=	contactFor.URL;
							
							FOR contactDataFor AS inRef.FIXferAddRq.FIXferInfo.Sender.PersonInfo.[COUNTER_EMPLOYMENT].OrgInfo.CompositeContactInfo.ContactInfo.ContactData[] DO
								CREATE LASTCHILD OF contactInfo AS general NAMESPACE ca NAME 'ContactData';
								
								SET general.ca:ContactType		=	contactDataFor.ContactType;
								SET general.ca:ContactValue		=	contactDataFor.ContactValue;
								
								IF FIELDVALUE(contactDataFor.PrefTimeStart) <> '' THEN 
									SET general.ca:PrefTimeStart	=	FIELDVALUE(contactDataFor.PrefTimeStart);
								END IF;
								
								IF FIELDVALUE(contactDataFor.PrefTimeEnd) <> '' THEN	
									SET general.ca:PrefTimeEnd		=	FIELDVALUE(contactDataFor.PrefTimeEnd);
								END IF;	
							END FOR;
							
							FOR postAddrFor AS inRef.FIXferAddRq.FIXferInfo.Sender.PersonInfo.[COUNTER_EMPLOYMENT].OrgInfo.CompositeContactInfo.ContactInfo.PostAddr[] DO
								CREATE LASTCHILD OF contactInfo AS general NAMESPACE ca NAME 'PostAddr';
								
								SET general.ca:Addr1			=	postAddrFor.Addr1;
								SET general.ca:Addr2			=	postAddrFor.Addr2;
								SET general.ca:Addr3			=	postAddrFor.Addr3;
								SET general.ca:Addr4			=	postAddrFor.Addr4;
								SET general.ca:City				=	postAddrFor.City;
								SET general.ca:CityCode			=	postAddrFor.CityCode;
								SET general.ca:StateProv		=	postAddrFor.StateProv;
								SET general.ca:StateProvCode	=	postAddrFor.StateProvCode;
								SET general.ca:Area				=	postAddrFor.Area;
								SET general.ca:AreaCode			=	postAddrFor.AreaCode;
								SET general.ca:PostalCode		=	postAddrFor.PostalCode;
								SET general.ca:Country		    =	postAddrFor.Country;
								SET general.ca:CountryCode	    =	postAddrFor.CountryCode;
								SET general.ca:AddrType		    =	postAddrFor.AddrType;
								
								IF FIELDVALUE(postAddrFor.StartDt) <> '' THEN
									SET general.ca:StartDt		    =	SUBSTRING(postAddrFor.StartDt BEFORE 'T');
								END IF;
								
								IF FIELDVALUE(postAddrFor.EndDt) <> '' THEN		
									SET general.ca:EndDt		    =	SUBSTRING(postAddrFor.EndDt BEFORE 'T');
								END IF;
										 	
								SET general.ca:DistrictCode	    =	postAddrFor.DistrictCode;
								SET general.ca:District		    =	postAddrFor.District;
								SET general.ca:PlaceCode	    =	postAddrFor.PlaceCode;
								SET general.ca:Place		    =	postAddrFor.Place;
								SET general.ca:StreetCode	    =	postAddrFor.StreetCode;
								SET general.ca:Street		    =	postAddrFor.Street;
								SET general.ca:House		    =	postAddrFor.House;
								SET general.ca:Corpus		    =	postAddrFor.Corpus;
								SET general.ca:Building		    =	postAddrFor.Building;
								SET general.ca:Flat			    =	postAddrFor.Flat;
								SET general.ca:Office		    =	postAddrFor.Office;
								SET general.ca:RusKLADR	   	 	=	postAddrFor.RusKLADR;
								SET general.ca:AddrStatus	    =	postAddrFor.AddrStatus;
							END FOR;
							
							SET contactInfo.ca:ProviderCode				=	contactFor.ProviderCode;
							
						END FOR;						
												
					END FOR;
					
					DECLARE licensesInfo REFERENCE TO orgInfo;
					CREATE LASTCHILD OF orgInfo AS licensesInfo NAMESPACE orgs NAME 'Licenses';
					DECLARE licenseInfo REFERENCE TO orgInfo;
					
					FOR licenseFor AS inRef.FIXferAddRq.FIXferInfo.Sender.PersonInfo.[COUNTER_EMPLOYMENT].OrgInfo.Licenses.LicenseInfo[] DO
						CREATE LASTCHILD OF licensesInfo AS licenseInfo NAMESPACE orgs NAME 'LicenseInfo';
						
						SET licenseInfo.orgs:LicenseType	=	licenseFor.LicenseType;
						SET licenseInfo.orgs:LicenseStatus	=	licenseFor.LicenseStatus;
						SET licenseInfo.orgs:LicenseSerie	=	licenseFor.LicenseSerie;
						SET licenseInfo.orgs:LicenseNum		=	licenseFor.LicenseNum;
						SET licenseInfo.orgs:LicenseIssueDt	=	FIELDVALUE(licenseFor.LicenseIssueDt);
						SET licenseInfo.orgs:LicenseIssueBy	=	FIELDVALUE(licenseFor.LicenseIssueBy);
						
					END FOR;
										
					SET orgInfo.orgs:TINInfo.ca:TINType 			=	orgFor.TINInfo.TINType;
					SET orgInfo.orgs:TINInfo.ca:TaxId	 			=	orgFor.TINInfo.TaxId;
					SET orgInfo.orgs:TINInfo.ca:CertCode 			=	orgFor.TINInfo.CertCode;	
					
					SET orgInfo.orgs:KIOInfo.ca:TINType 			=	orgFor.KIOInfo.TINType;
					SET orgInfo.orgs:KIOInfo.ca:TaxId	 			=	orgFor.KIOInfo.TaxId;
					SET orgInfo.orgs:KIOInfo.ca:CertCode 			=	orgFor.KIOInfo.CertCode;
					
					SET orgInfo.orgs:EstablishDt		 			=	orgFor.EstablishDt;
					SET orgInfo.orgs:NumEmployees		 			=	orgFor.NumEmployees;
					SET orgInfo.orgs:EmployerCode		 			=	orgFor.EmployerCode;
					
				END FOR;
				
				SET employment.ind:Occupation			=	inRef.FIXferAddRq.FIXferInfo.Sender.PersonInfo.[COUNTER_EMPLOYMENT].Occupation;	 	
				
				SET employment.ind:Income.ca:Amt			=	inRef.FIXferAddRq.FIXferInfo.Sender.PersonInfo.[COUNTER_EMPLOYMENT].Income.Amt;
				SET employment.ind:Income.ca:Reversal		=	inRef.FIXferAddRq.FIXferInfo.Sender.PersonInfo.[COUNTER_EMPLOYMENT].Income.Reversal;
				SET employment.ind:Income.ca:CurCode		=	inRef.FIXferAddRq.FIXferInfo.Sender.PersonInfo.[COUNTER_EMPLOYMENT].Income.CurCode;	
				SET employment.ind:Income.ca:CurRate		=	inRef.FIXferAddRq.FIXferInfo.Sender.PersonInfo.[COUNTER_EMPLOYMENT].Income.CurRate;
				SET employment.ind:Income.ca:CurConvertRule	=	inRef.FIXferAddRq.FIXferInfo.Sender.PersonInfo.[COUNTER_EMPLOYMENT].Income.CurConvertRule; 	
				
				SET employment.ind:JobTitle			=	inRef.FIXferAddRq.FIXferInfo.Sender.PersonInfo.[COUNTER_EMPLOYMENT].JobTitle;	 
				
				IF FIELDVALUE(inRef.FIXferAddRq.FIXferInfo.Sender.PersonInfo.[COUNTER_EMPLOYMENT].StartDt) <> '' THEN
					SET employment.ind:StartDt			=	SUBSTRING(inRef.FIXferAddRq.FIXferInfo.Sender.PersonInfo.[COUNTER_EMPLOYMENT].StartDt BEFORE 'T');
				END IF;
				
				IF FIELDVALUE(inRef.FIXferAddRq.FIXferInfo.Sender.PersonInfo.[COUNTER_EMPLOYMENT].EndDt) <> '' THEN	
					SET employment.ind:EndDt			=	SUBSTRING(inRef.FIXferAddRq.FIXferInfo.Sender.PersonInfo.[COUNTER_EMPLOYMENT].EndDt BEFORE 'T');			
				END IF;
				
			END IF;
							
			SET COUNTER_EMPLOYMENT = COUNTER_EMPLOYMENT + 1;
		END WHILE;	
		/*
		IF FIELDVALUE(inRef.FIXferAddRq.FIXferInfo.Sender.PersonInfo.Gender) <> '' THEN
			SET personInfo.ind:Gender						=  inRef.FIXferAddRq.FIXferInfo.Sender.PersonInfo.Gender;			
		ELSE 
			SET personInfo.ind:Gender						=  'U';	
		END IF;*/
		SET personInfo.ind:MaritalStatus					=  inRef.FIXferAddRq.FIXferInfo.Sender.PersonInfo.MaritalStatus;
		SET personInfo.ind:USAMilitaryRank					=  inRef.FIXferAddRq.FIXferInfo.Sender.PersonInfo.USAMilitaryRank;
		SET personInfo.ind:Dependets						=  inRef.FIXferAddRq.FIXferInfo.Sender.PersonInfo.Dependets;
		
		IF EXISTS(inRef.FIXferAddRq.FIXferInfo.Sender.PersonInfo.Passport[]) THEN
			SET personInfo.ind:Passport.ind:PassportNumber		=  COALESCE(inRef.FIXferAddRq.FIXferInfo.Sender.PersonInfo.Passport.PassportNumber,NULL);
			SET personInfo.ind:Passport.ind:DocSeries			=  COALESCE(inRef.FIXferAddRq.FIXferInfo.Sender.PersonInfo.Passport.DocSeries, NULL);
			SET personInfo.ind:Passport.ind:PassportCountry		=  COALESCE(inRef.FIXferAddRq.FIXferInfo.Sender.PersonInfo.Passport.PassportCountry, NULL);
			SET personInfo.ind:Passport.ind:IssueLoc			=  COALESCE(inRef.FIXferAddRq.FIXferInfo.Sender.PersonInfo.Passport.IssueLoc, NULL);
			
			IF FIELDVALUE(inRef.FIXferAddRq.FIXferInfo.Sender.PersonInfo.Passport.IssDt) <> '' THEN 
				SET personInfo.ind:Passport.ind:IssDt			=  SUBSTRING(COALESCE(inRef.FIXferAddRq.FIXferInfo.Sender.PersonInfo.Passport.IssDt, NULL) BEFORE 'T');   
			END IF;
			
			IF FIELDVALUE(inRef.FIXferAddRq.FIXferInfo.Sender.PersonInfo.Passport.ExpDt) <> '' THEN
				SET personInfo.ind:Passport.ind:ExpDt			=  SUBSTRING(COALESCE(inRef.FIXferAddRq.FIXferInfo.Sender.PersonInfo.Passport.ExpDt, NULL) BEFORE 'T');
			END IF;
					
		END IF;
		
		SET personInfo.ind:OEDCode							=  inRef.FIXferAddRq.FIXferInfo.Sender.PersonInfo.OEDCode;
		SET personInfo.ind:"OEDInstitution_Type"			=  inRef.FIXferAddRq.FIXferInfo.Sender.PersonInfo."OEDInstitution_Type";
		
		IF EXISTS(inRef.FIXferAddRq.FIXferInfo.Sender.PersonInfo.GovIssueIdent[]) THEN
			SET personInfo.ind:GovIssueIdent.ind:GovIssueIdentType	=  COALESCE(inRef.FIXferAddRq.FIXferInfo.Sender.PersonInfo.GovIssueIdent.GovIssueIdentType, NULL);
			SET personInfo.ind:GovIssueIdent.ind:IdentSerialNum  	=  COALESCE(inRef.FIXferAddRq.FIXferInfo.Sender.PersonInfo.GovIssueIdent.IdentSerialNum, NULL);
			SET personInfo.ind:GovIssueIdent.ind:GovOrg			 	=  COALESCE(inRef.FIXferAddRq.FIXferInfo.Sender.PersonInfo.GovIssueIdent.GovOrg, NULL);
			SET personInfo.ind:GovIssueIdent.ind:GovOrgName		 	=  COALESCE(inRef.FIXferAddRq.FIXferInfo.Sender.PersonInfo.GovIssueIdent.GovOrgName, NULL);
			SET personInfo.ind:GovIssueIdent.ind:GovRank		  	=  COALESCE(inRef.FIXferAddRq.FIXferInfo.Sender.PersonInfo.GovIssueIdent.GovRank, NULL);
			SET personInfo.ind:GovIssueIdent.ind:StateProv		 	=  COALESCE(inRef.FIXferAddRq.FIXferInfo.Sender.PersonInfo.GovIssueIdent.StateProv, NULL);
			SET personInfo.ind:GovIssueIdent.ind:Country		 	=  COALESCE(inRef.FIXferAddRq.FIXferInfo.Sender.PersonInfo.GovIssueIdent.Country, NULL);
			SET personInfo.ind:GovIssueIdent.ind:Desc			  	=  COALESCE(inRef.FIXferAddRq.FIXferInfo.Sender.PersonInfo.GovIssueIdent.Desc, NULL);
			
			IF FIELDVALUE(inRef.FIXferAddRq.FIXferInfo.Sender.PersonInfo.GovIssueIdent.IssDt) <> '' THEN 
				SET personInfo.ind:GovIssueIdent.ind:IssDt			=  SUBSTRING(COALESCE(inRef.FIXferAddRq.FIXferInfo.Sender.PersonInfo.GovIssueIdent.IssDt, NULL) BEFORE 'T');
			END IF;	
			
			IF FIELDVALUE(inRef.FIXferAddRq.FIXferInfo.Sender.PersonInfo.GovIssueIdent.ExpDt) <> '' THEN 
				SET personInfo.ind:GovIssueIdent.ind:ExpDt		  	=  SUBSTRING(COALESCE(inRef.FIXferAddRq.FIXferInfo.Sender.PersonInfo.GovIssueIdent.ExpDt, NULL) BEFORE 'T');
			END IF;
				
			SET personInfo.ind:GovIssueIdent.ind:IdentSerie		  	=  COALESCE(inRef.FIXferAddRq.FIXferInfo.Sender.PersonInfo.GovIssueIdent.IdentSerie, NULL);
			SET personInfo.ind:GovIssueIdent.ind:GovOrgUnit		  	=  COALESCE(inRef.FIXferAddRq.FIXferInfo.Sender.PersonInfo.GovIssueIdent.GovOrgUnit, NULL);
		END IF;
		
		IF EXISTS(inRef.FIXferAddRq.FIXferInfo.Sender.PersonInfo.OtherIdentDoc[]) THEN
			SET personInfo.ind:OtherIdentDoc.ind:Desc			  	=  COALESCE(inRef.FIXferAddRq.FIXferInfo.Sender.PersonInfo.OtherIdentDoc.Desc, NULL);
			SET personInfo.ind:OtherIdentDoc.ind:IdentSerialNum  	=  COALESCE(inRef.FIXferAddRq.FIXferInfo.Sender.PersonInfo.OtherIdentDoc.IdentSerialNum, NULL);
			SET personInfo.ind:OtherIdentDoc.ind:Issuer			 	=  COALESCE(inRef.FIXferAddRq.FIXferInfo.Sender.PersonInfo.OtherIdentDoc.Issuer, NULL);
			SET personInfo.ind:OtherIdentDoc.ind:IssueLoc		  	=  COALESCE(inRef.FIXferAddRq.FIXferInfo.Sender.PersonInfo.OtherIdentDoc.IssueLoc, NULL);
			
			IF FIELDVALUE(inRef.FIXferAddRq.FIXferInfo.Sender.PersonInfo.OtherIdentDoc.IssDt) <> '' THEN 
				SET personInfo.ind:OtherIdentDoc.ind:IssDt		 	=  SUBSTRING(COALESCE(inRef.FIXferAddRq.FIXferInfo.Sender.PersonInfo.OtherIdentDoc.IssDt, NULL) BEFORE 'T');
			END IF;
			
			IF FIELDVALUE(inRef.FIXferAddRq.FIXferInfo.Sender.PersonInfo.OtherIdentDoc.ExpDt) <> '' THEN 
				SET personInfo.ind:OtherIdentDoc.ind:ExpDt			=  SUBSTRING(COALESCE(inRef.FIXferAddRq.FIXferInfo.Sender.PersonInfo.OtherIdentDoc.ExpDt, NULL) BEFORE 'T');
			END IF;		
		END IF;
		
		DECLARE identityCards REFERENCE TO personInfo;
		DECLARE identityCard REFERENCE TO identityCards;
		
		IF EXISTS(inRef.FIXferAddRq.FIXferInfo.Sender.PersonInfo.IdentityCards.*[]) THEN
		
		CREATE LASTCHILD OF personInfo AS identityCards NAMESPACE ind NAME 'IdentityCards';
		
			FOR identityFor AS inRef.FIXferAddRq.FIXferInfo.Sender.PersonInfo.IdentityCards.IdentityCard[] DO
				
				CREATE LASTCHILD OF identityCards AS identityCard NAMESPACE ind NAME 'IdentityCard';
				
				SET identityCard.ind:IdType				=	identityFor.IdType;
				/*SET identityCard.ind:IdStatus			=	identityFor.IdStatus;
				SET identityCard.ind:IdSeries			=	identityFor.IdSeries;*/
				SET identityCard.ind:IdNum				=	identityFor.IdNum;
				IF FIELDVALUE(identityFor.IssueDt) <> '' THEN
					SET identityCard.ind:IssueDt			=	FIELDVALUE(identityFor.IssueDt);
				END IF;	
				SET identityCard.ind:IssuedBy			=	identityFor.IssuedBy;
				/*SET identityCard.ind:Code				=	identityFor.Code;
				SET identityCard.ind:IssueLoc			=	identityFor.IssueLoc;
				SET identityCard.ind:IssuedCountry		=	identityFor.IssuedCountry;
				
				IF FIELDVALUE(identityFor.IssuedRegionCode) <> '' THEN 
					SET identityCard.ind:IssuedRegionCode	=	identityFor.IssuedRegionCode;
				END IF;
				
				IF FIELDVALUE(identityFor.ExpDt) <> '' THEN
					SET identityCard.ind:ExpDt				=	SUBSTRING(identityFor.ExpDt BEFORE 'T');
				END IF;*/
					
			END FOR;
		
		END IF;
		
		SET personInfo.ind:BirthPlace			  	=  inRef.FIXferAddRq.FIXferInfo.Sender.PersonInfo.BirthPlace;
		--SET personInfo.ind:Resident				  	=  inRef.FIXferAddRq.FIXferInfo.Sender.PersonInfo.Resident;
		SET personInfo.ind:MilitaryDocFlag		  	=  inRef.FIXferAddRq.FIXferInfo.Sender.PersonInfo.MilitaryDocFlag;
		SET personInfo.ind:Citizenship			  	=  inRef.FIXferAddRq.FIXferInfo.Sender.PersonInfo.Citizenship;
		
		/* OWNER */
		DECLARE owner REFERENCE TO fixferInfo;
		CREATE LASTCHILD OF fixferInfo AS owner NAMESPACE mtblitz NAME 'Owner';
		
		/* BankInfo */
		CREATE LASTCHILD OF owner AS bankInfo NAMESPACE mtblitz NAME 'BankInfo';
		
		SET bankInfo.mtblitz:BankId  =  inRef.FIXferAddRq.FIXferInfo.Owner.BankInfo.BankId;
		SET bankInfo.mtblitz:Country =  inRef.FIXferAddRq.FIXferInfo.Owner.BankInfo.Country; 
		SET bankInfo.mtblitz:City    =  inRef.FIXferAddRq.FIXferInfo.Owner.BankInfo.City;
		
		/* RECEIVER */
		DECLARE receiver REFERENCE TO fixferInfo;
		CREATE LASTCHILD OF fixferInfo AS receiver NAMESPACE mtblitz NAME 'Receiver';
		
		/* BankInfo */
		CREATE LASTCHILD OF receiver AS bankInfo NAMESPACE mtblitz NAME 'BankInfo';
		
		SET bankInfo.mtblitz:BankId  =  inRef.FIXferAddRq.FIXferInfo.Receiver.BankInfo.BankId;
		SET bankInfo.mtblitz:Country =  inRef.FIXferAddRq.FIXferInfo.Receiver.BankInfo.Country; 
		SET bankInfo.mtblitz:City    =  inRef.FIXferAddRq.FIXferInfo.Receiver.BankInfo.City;
		
		/* PersonInfo */ 
		CREATE LASTCHILD OF receiver AS personInfo NAMESPACE mtblitz NAME 'PersonInfo';   
		
		SET personInfo.ind:NameAddrType  =  inRef.FIXferAddRq.FIXferInfo.Receiver.PersonInfo.NameAddrType;
		SET personInfo.ind:FullName     =  inRef.FIXferAddRq.FIXferInfo.Receiver.PersonInfo.FullName;		
		
		IF EXISTS(inRef.FIXferAddRq.FIXferInfo.Receiver.PersonInfo.PersonName[]) THEN
        	-- создаем PersonName с namespace iam внутри UserInfo
        	CREATE LASTCHILD OF personInfo AS personName NAMESPACE ind NAME 'PersonName';             
        	CALL FillSomeField(inRef.FIXferAddRq.FIXferInfo.Receiver.PersonInfo.PersonName, personName, 'ind', 'LastName');
        	
        	SET personName.ind:FirstName	=	inRef.FIXferAddRq.FIXferInfo.Receiver.PersonInfo.PersonName.FirstName;	
        	
        	IF EXISTS(inRef.FIXferAddRq.FIXferInfo.Sender.PersonInfo.PersonName[]) THEN
				CALL FillSomeField(inRef.FIXferAddRq.FIXferInfo.Receiver.PersonInfo.PersonName, personName, 'ind', 'MiddleName');
			END IF;
        	
        	SET personName.ind:TitlePrefix	=	inRef.FIXferAddRq.FIXferInfo.Receiver.PersonInfo.PersonName.TitlePrefix;	
        	SET personName.ind:NameSuffix	=	inRef.FIXferAddRq.FIXferInfo.Receiver.PersonInfo.PersonName.NameSuffix;
        	SET personName.ind:Nickname		=	inRef.FIXferAddRq.FIXferInfo.Receiver.PersonInfo.PersonName.Nickname;
        	SET personName.ind:LegalName	=	inRef.FIXferAddRq.FIXferInfo.Receiver.PersonInfo.PersonName.LegalName;
        	
        END IF;		
		
		SET COUNT_CONTACTINFO = 1;
		/*DECLARE ARRAY_CONTACTINFO INTEGER CARDINALITY(inRef.FIXferAddRq.FIXferInfo.Sender.PersonInfo.*[]);
		DECLARE contactInfo REFERENCE TO personInfo;*/
		
		/* ContactInfo */
		WHILE COUNT_CONTACTINFO <= ARRAY_CONTACTINFO DO
			IF FIELDNAME(inRef.FIXferAddRq.FIXferInfo.Receiver.PersonInfo.[COUNT_CONTACTINFO]) = 'ContactInfo' THEN
				CREATE LASTCHILD OF personInfo AS contactInfo NAMESPACE ind NAME 'ContactInfo';
				/*SET contactInfo.ca:ContactPref		=	FIELDVALUE(inRef.FIXferAddRq.FIXferInfo.Receiver.PersonInfo.[COUNT_CONTACTINFO].ContactPref);
				
				IF FIELDVALUE(inRef.FIXferAddRq.FIXferInfo.Receiver.PersonInfo.[COUNT_CONTACTINFO].PrefTimeStart) <> '' THEN
					SET contactInfo.ca:PrefTimeStart	=	FIELDVALUE(inRef.FIXferAddRq.FIXferInfo.Receiver.PersonInfo.[COUNT_CONTACTINFO].PrefTimeStart);
				END IF;
				
				IF FIELDVALUE(inRef.FIXferAddRq.FIXferInfo.Receiver.PersonInfo.[COUNT_CONTACTINFO].PrefTimeEnd) <> '' THEN
					SET contactInfo.ca:PrefTimeEnd		=   FIELDVALUE(inRef.FIXferAddRq.FIXferInfo.Receiver.PersonInfo.[COUNT_CONTACTINFO].PrefTimeEnd);
				END IF;*/
					
				DECLARE COUNT_PHONENUM INTEGER 1;
				DECLARE ARRAY_PHONENUM INTEGER CARDINALITY(inRef.FIXferAddRq.FIXferInfo.Receiver.PersonInfo.[COUNT_CONTACTINFO].*[]);
 				DECLARE phoneNum REFERENCE TO contactInfo;
 				
 				WHILE COUNT_PHONENUM <= ARRAY_CONTACTINFO DO
 					IF FIELDNAME(inRef.FIXferAddRq.FIXferInfo.Receiver.PersonInfo.[COUNT_CONTACTINFO].[COUNT_PHONENUM]) = 'PhoneNum' THEN
 						CREATE LASTCHILD OF contactInfo AS phoneNum NAMESPACE ca NAME 'PhoneNum';
 						
 						--SET phoneNum.ca:PhoneType		=	FIELDVALUE(inRef.FIXferAddRq.FIXferInfo.Receiver.PersonInfo.[COUNT_CONTACTINFO].[COUNT_PHONENUM].PhoneType);
 						SET phoneNum.ca:Phone			= 	FIELDVALUE(inRef.FIXferAddRq.FIXferInfo.Receiver.PersonInfo.[COUNT_CONTACTINFO].[COUNT_PHONENUM].Phone);
 						--SET phoneNum.ca:PhoneCode   	=   FIELDVALUE(inRef.FIXferAddRq.FIXferInfo.Receiver.PersonInfo.[COUNT_CONTACTINFO].[COUNT_PHONENUM].PhoneCode);
 						--SET phoneNum.ca:PhoneOperName   =   FIELDVALUE(inRef.FIXferAddRq.FIXferInfo.Receiver.PersonInfo.[COUNT_CONTACTINFO].[COUNT_PHONENUM].PhoneOperName);
 						
 					END IF;	
 					SET COUNT_PHONENUM = COUNT_PHONENUM + 1; 					
 				END WHILE;
 				
 				/*SET contactInfo.ca:ContactName	=	FIELDVALUE(inRef.FIXferAddRq.FIXferInfo.Receiver.PersonInfo.[COUNT_CONTACTINFO].ContactName);
 				SET contactInfo.ca:EmailAddr	=	FIELDVALUE(inRef.FIXferAddRq.FIXferInfo.Receiver.PersonInfo.[COUNT_CONTACTINFO].EmailAddr);
 				SET contactInfo.ca:URL			=	FIELDVALUE(inRef.FIXferAddRq.FIXferInfo.Receiver.PersonInfo.[COUNT_CONTACTINFO].URL);*/
 				
 				DECLARE COUNT_CONTACTDATA INTEGER 1;
 				DECLARE ARRAY_CONTACTDATA INTEGER CARDINALITY(inRef.FIXferAddRq.FIXferInfo.Receiver.PersonInfo.[COUNT_CONTACTINFO].*[]);
 				DECLARE contactData REFERENCE TO contactInfo;
 				/*
 				WHILE COUNT_CONTACTDATA <= ARRAY_CONTACTDATA DO
 					IF FIELDNAME(inRef.FIXferAddRq.FIXferInfo.Receiver.PersonInfo.[COUNT_CONTACTINFO].[COUNT_CONTACTDATA]) = 'ContactData' THEN
 						CREATE LASTCHILD OF contactInfo AS contactData NAMESPACE ca NAME 'ContactData';
 						
 						SET contactData.ca:ContactType		=  FIELDVALUE(inRef.FIXferAddRq.FIXferInfo.Receiver.PersonInfo.[COUNT_CONTACTINFO].[COUNT_CONTACTDATA].ContactType);
 						SET contactData.ca:ContactValue		=  FIELDVALUE(inRef.FIXferAddRq.FIXferInfo.Receiver.PersonInfo.[COUNT_CONTACTINFO].[COUNT_CONTACTDATA].ContactValue);
 						
 						IF FIELDVALUE(inRef.FIXferAddRq.FIXferInfo.Receiver.PersonInfo.[COUNT_CONTACTINFO].[COUNT_CONTACTDATA].PrefTimeStart) <> '' THEN
 							SET contactData.ca:PrefTimeStart	= FIELDVALUE(inRef.FIXferAddRq.FIXferInfo.Receiver.PersonInfo.[COUNT_CONTACTINFO].[COUNT_CONTACTDATA].PrefTimeStart);
 						END IF;	
 						
 						IF FIELDVALUE(inRef.FIXferAddRq.FIXferInfo.Receiver.PersonInfo.[COUNT_CONTACTINFO].[COUNT_CONTACTDATA].PrefTimeEnd) <> '' THEN
 							SET contactData.ca:PrefTimeEnd		= FIELDVALUE(inRef.FIXferAddRq.FIXferInfo.Receiver.PersonInfo.[COUNT_CONTACTINFO].[COUNT_CONTACTDATA].PrefTimeEnd);
 						END IF;	
 							
 					END IF;	
 					SET COUNT_CONTACTDATA = COUNT_CONTACTDATA + 1;
 				END WHILE;*/
 				
 				DECLARE COUNT_POSTADDR INTEGER 1;
				DECLARE postAddr REFERENCE TO contactInfo;
				
				WHILE COUNT_POSTADDR <= ARRAY_CONTACTDATA DO
					IF FIELDNAME(inRef.FIXferAddRq.FIXferInfo.Receiver.PersonInfo.[COUNT_CONTACTINFO].[COUNT_POSTADDR]) = 'PostAddr' THEN
						CREATE LASTCHILD OF contactInfo AS postAddr NAMESPACE ca NAME 'PostAddr';
						
						SET postAddr.ca:Addr1			=	FIELDVALUE(inRef.FIXferAddRq.FIXferInfo.Receiver.PersonInfo.[COUNT_CONTACTINFO].[COUNT_POSTADDR].Addr1);  
						/*SET postAddr.ca:Addr2			=	FIELDVALUE(inRef.FIXferAddRq.FIXferInfo.Receiver.PersonInfo.[COUNT_CONTACTINFO].[COUNT_POSTADDR].Addr2);  
						SET postAddr.ca:Addr3			=	FIELDVALUE(inRef.FIXferAddRq.FIXferInfo.Receiver.PersonInfo.[COUNT_CONTACTINFO].[COUNT_POSTADDR].Addr3);  
						SET postAddr.ca:Addr4			=	FIELDVALUE(inRef.FIXferAddRq.FIXferInfo.Receiver.PersonInfo.[COUNT_CONTACTINFO].[COUNT_POSTADDR].Addr4);
						SET postAddr.ca:City			=	FIELDVALUE(inRef.FIXferAddRq.FIXferInfo.Receiver.PersonInfo.[COUNT_CONTACTINFO].[COUNT_POSTADDR].City);    
						SET postAddr.ca:CityCode		=	FIELDVALUE(inRef.FIXferAddRq.FIXferInfo.Receiver.PersonInfo.[COUNT_CONTACTINFO].[COUNT_POSTADDR].CityCode);
						SET postAddr.ca:StateProv		=	FIELDVALUE(inRef.FIXferAddRq.FIXferInfo.Receiver.PersonInfo.[COUNT_CONTACTINFO].[COUNT_POSTADDR].StateProv);
						SET postAddr.ca:StateProvCode	=	FIELDVALUE(inRef.FIXferAddRq.FIXferInfo.Receiver.PersonInfo.[COUNT_CONTACTINFO].[COUNT_POSTADDR].StateProvCode);
						SET postAddr.ca:Area			= 	FIELDVALUE(inRef.FIXferAddRq.FIXferInfo.Receiver.PersonInfo.[COUNT_CONTACTINFO].[COUNT_POSTADDR].Area);
						SET postAddr.ca:AreaCode		= 	FIELDVALUE(inRef.FIXferAddRq.FIXferInfo.Receiver.PersonInfo.[COUNT_CONTACTINFO].[COUNT_POSTADDR].AreaCode);
						SET postAddr.ca:PostalCode		= 	FIELDVALUE(inRef.FIXferAddRq.FIXferInfo.Receiver.PersonInfo.[COUNT_CONTACTINFO].[COUNT_POSTADDR].PostalCode);
						SET postAddr.ca:Country			= 	FIELDVALUE(inRef.FIXferAddRq.FIXferInfo.Receiver.PersonInfo.[COUNT_CONTACTINFO].[COUNT_POSTADDR].Country);
						SET postAddr.ca:CountryCode		= 	FIELDVALUE(inRef.FIXferAddRq.FIXferInfo.Receiver.PersonInfo.[COUNT_CONTACTINFO].[COUNT_POSTADDR].CountryCode);
						SET postAddr.ca:AddrType		= 	FIELDVALUE(inRef.FIXferAddRq.FIXferInfo.Receiver.PersonInfo.[COUNT_CONTACTINFO].[COUNT_POSTADDR].AddrType);      
						IF FIELDVALUE(inRef.FIXferAddRq.FIXferInfo.Sender.PersonInfo.[COUNT_CONTACTINFO].[COUNT_POSTADDR].StartDt) <> '' THEN
							SET postAddr.ca:StartDt		= 	SUBSTRING(FIELDVALUE(inRef.FIXferAddRq.FIXferInfo.Sender.PersonInfo.[COUNT_CONTACTINFO].[COUNT_POSTADDR].StartDt) BEFORE 'T');
						END IF;
						IF FIELDVALUE(inRef.FIXferAddRq.FIXferInfo.Sender.PersonInfo.[COUNT_CONTACTINFO].[COUNT_POSTADDR].EndDt) <> '' THEN
							SET postAddr.ca:EndDt		= 	SUBSTRING(FIELDVALUE(inRef.FIXferAddRq.FIXferInfo.Sender.PersonInfo.[COUNT_CONTACTINFO].[COUNT_POSTADDR].EndDt) BEFORE 'T');
						END IF;
						
						SET postAddr.ca:DistrictCode	= 	FIELDVALUE(inRef.FIXferAddRq.FIXferInfo.Receiver.PersonInfo.[COUNT_CONTACTINFO].[COUNT_POSTADDR].DistrictCode);
						SET postAddr.ca:District		= 	FIELDVALUE(inRef.FIXferAddRq.FIXferInfo.Receiver.PersonInfo.[COUNT_CONTACTINFO].[COUNT_POSTADDR].District);
						SET postAddr.ca:PlaсeCode		= 	FIELDVALUE(inRef.FIXferAddRq.FIXferInfo.Receiver.PersonInfo.[COUNT_CONTACTINFO].[COUNT_POSTADDR].PlaсeCode);
						SET postAddr.ca:Place			= 	FIELDVALUE(inRef.FIXferAddRq.FIXferInfo.Receiver.PersonInfo.[COUNT_CONTACTINFO].[COUNT_POSTADDR].Place);
						SET postAddr.ca:StreetCode		= 	FIELDVALUE(inRef.FIXferAddRq.FIXferInfo.Receiver.PersonInfo.[COUNT_CONTACTINFO].[COUNT_POSTADDR].StreetCode);
						SET postAddr.ca:Street			= 	FIELDVALUE(inRef.FIXferAddRq.FIXferInfo.Receiver.PersonInfo.[COUNT_CONTACTINFO].[COUNT_POSTADDR].Street);
						SET postAddr.ca:House			= 	FIELDVALUE(inRef.FIXferAddRq.FIXferInfo.Receiver.PersonInfo.[COUNT_CONTACTINFO].[COUNT_POSTADDR].House);
						SET postAddr.ca:Corpus			= 	FIELDVALUE(inRef.FIXferAddRq.FIXferInfo.Receiver.PersonInfo.[COUNT_CONTACTINFO].[COUNT_POSTADDR].Corpus);
						SET postAddr.ca:Building		= 	FIELDVALUE(inRef.FIXferAddRq.FIXferInfo.Receiver.PersonInfo.[COUNT_CONTACTINFO].[COUNT_POSTADDR].Building);
						SET postAddr.ca:Flat			= 	FIELDVALUE(inRef.FIXferAddRq.FIXferInfo.Receiver.PersonInfo.[COUNT_CONTACTINFO].[COUNT_POSTADDR].Flat);
						SET postAddr.ca:Office			= 	FIELDVALUE(inRef.FIXferAddRq.FIXferInfo.Receiver.PersonInfo.[COUNT_CONTACTINFO].[COUNT_POSTADDR].Office);
						SET postAddr.ca:RusKLADR		= 	FIELDVALUE(inRef.FIXferAddRq.FIXferInfo.Receiver.PersonInfo.[COUNT_CONTACTINFO].[COUNT_POSTADDR].RusKLADR);
						SET postAddr.ca:AddrStatus		= 	FIELDVALUE(inRef.FIXferAddRq.FIXferInfo.Receiver.PersonInfo.[COUNT_CONTACTINFO].[COUNT_POSTADDR].AddrStatus);*/
						
					END IF;
					SET COUNT_POSTADDR = COUNT_POSTADDR + 1;	
				END WHILE;		
 				
 				--SET contactInfo.ca:ProviderCode			=	FIELDVALUE(inRef.FIXferAddRq.FIXferInfo.Receiver.PersonInfo.[COUNT_CONTACTINFO].ProviderCode);
 				
			END IF;	
			SET COUNT_CONTACTINFO = COUNT_CONTACTINFO + 1;
		END WHILE;
		
		/* PersonInfo */
		IF EXISTS(inRef.FIXferAddRq.FIXferInfo.Receiver.PersonInfo.TINInfo[]) THEN
		
		SET personInfo.ind:TINInfo.ca:TINType   =  inRef.FIXferAddRq.FIXferInfo.Receiver.PersonInfo.TINInfo.TINType;
		SET personInfo.ind:TINInfo.ca:TaxId  	=  inRef.FIXferAddRq.FIXferInfo.Receiver.PersonInfo.TINInfo.TaxId;
		SET personInfo.ind:TINInfo.ca:CertCode  =  inRef.FIXferAddRq.FIXferInfo.Receiver.PersonInfo.TINInfo.CertCode;
		
		END IF;
		/*IF COALESCE(FIELDVALUE(inRef.FIXferAddRq.FIXferInfo.Sender.PersonInfo.BirthDt),'') <> '' THEN
			SET personInfo.ind:BirthDt				=  SUBSTRING(FIELDVALUE(inRef.FIXferAddRq.FIXferInfo.Sender.PersonInfo.BirthDt) FROM 1 FOR 10);
		END IF;*/
		
		IF EXISTS(inRef.FIXferAddRq.FIXferInfo.Receiver.PersonInfo.DriversLicense[]) THEN
			SET personInfo.ind:DriversLicense.ind:LicenseNum		=  COALESCE(inRef.FIXferAddRq.FIXferInfo.Receiver.PersonInfo.DriversLicense.LicenseNum, NULL);
			SET personInfo.ind:DriversLicense.ind:StateProv			=  COALESCE(inRef.FIXferAddRq.FIXferInfo.Receiver.PersonInfo.DriversLicense.StateProv, NULL);
			SET personInfo.ind:DriversLicense.ind:Country			=  COALESCE(inRef.FIXferAddRq.FIXferInfo.Receiver.PersonInfo.DriversLicense.Country, NULL);
		END IF;
		
		SET personInfo.ind:MotherMaidenName						=  inRef.FIXferAddRq.FIXferInfo.Receiver.PersonInfo.MotherMaidenName;
		SET personInfo.ind:SpouseName							=  inRef.FIXferAddRq.FIXferInfo.Receiver.PersonInfo.SpouseName;
		
		SET COUNTER_EMPLOYMENT = 1;
		
		WHILE COUNTER_EMPLOYMENT <= ARRAY_CONTACTINFO DO
			IF FIELDNAME(inRef.FIXferAddRq.FIXferInfo.Receiver.PersonInfo.[COUNTER_EMPLOYMENT]) = 'EmploymentHistory' THEN
				CREATE LASTCHILD OF personInfo AS employment NAMESPACE ind NAME 'EmploymentHistory';
				
				SET employment.ind:EmploymentStatus		=	inRef.FIXferAddRq.FIXferInfo.Receiver.PersonInfo.[COUNTER_EMPLOYMENT].EmploymentStatus;				

				DECLARE orgInfo REFERENCE TO employment;
				DECLARE industId REFERENCE TO employment;
				DECLARE composite REFERENCE TO employment;
				DECLARE general REFERENCE TO employment;
								
				FOR orgFor AS inRef.FIXferAddRq.FIXferInfo.Receiver.PersonInfo.[COUNTER_EMPLOYMENT].OrgInfo[] DO
					CREATE LASTCHILD OF employment AS orgInfo NAMESPACE ind NAME 'OrgInfo';
					
					FOR industFor AS inRef.FIXferAddRq.FIXferInfo.Receiver.PersonInfo.[COUNTER_EMPLOYMENT].OrgInfo.IndustId[] DO
						CREATE LASTCHILD OF orgInfo AS industId NAMESPACE orgs NAME 'IndustId';
						
						SET industId.orgs:Org			=	industFor.Org;
						SET industId.orgs:IndustNum		=	industFor.IndustNum;
						SET industId.orgs:SubIndustrNum =   industFor.SubIndustrNum;
						SET industId.orgs:IsPrimary	    =   industFor.IsPrimary;						
					END FOR;
					
					SET orgInfo.orgs:Name 			=	orgFor.Name;	
					SET orgInfo.orgs:LegalName 		=	orgFor.LegalName;
					SET orgInfo.orgs:LegalNameEn 	=	orgFor.LegalNameEn;
					SET orgInfo.orgs:FullNameEn 	=	orgFor.FullNameEn;
					SET orgInfo.orgs:MnemonicName 	=	orgFor.MnemonicName;
					
					FOR compositeFor AS inRef.FIXferAddRq.FIXferInfo.Receiver.PersonInfo.[COUNTER_EMPLOYMENT].OrgInfo.CompositeContactInfo[] DO
						CREATE LASTCHILD OF orgInfo AS composite NAMESPACE orgs NAME 'CompositeContactInfo';
						
						SET composite.ca:ContactInfoType	=  compositeFor.ContactInfoType;
						
						FOR contactFor AS inRef.FIXferAddRq.FIXferInfo.Receiver.PersonInfo.[COUNTER_EMPLOYMENT].OrgInfo.CompositeContactInfo.ContactInfo[] DO
							CREATE LASTCHILD OF composite AS contactInfo NAMESPACE ca NAME 'ContactInfo';
							
							SET contactInfo.ca:ContactPref		=	contactFor.ContactPref;
							
							IF FIELDVALUE(contactFor.PrefTimeStart) <> '' THEN
								SET contactInfo.ca:PrefTimeStart	=	FIELDVALUE(contactFor.PrefTimeStart);
							END IF;
							
							IF FIELDVALUE(contactFor.PrefTimeEnd) <> '' THEN
								SET contactInfo.ca:PrefTimeEnd		=	FIELDVALUE(contactFor.PrefTimeEnd);
							END IF;
							FOR phoneFor AS inRef.FIXferAddRq.FIXferInfo.Receiver.PersonInfo.[COUNTER_EMPLOYMENT].OrgInfo.CompositeContactInfo.ContactInfo.PhoneNum[] DO		
								CREATE LASTCHILD OF contactInfo AS general NAMESPACE ca NAME 'PhoneNum';
								
								SET general.ca:PhoneType		=	phoneFor.PhoneType;
								SET general.ca:Phone			=	phoneFor.Phone;
								SET general.ca:PhoneCode		=	phoneFor.PhoneCode;
								SET general.ca:PhoneOperName	=	phoneFor.PhoneOperName;								
							END FOR;
							
							SET contactInfo.ca:ContactName		=	contactFor.ContactName;
							SET contactInfo.ca:EmailAddr		=	contactFor.EmailAddr;
							SET contactInfo.ca:URL				=	contactFor.URL;
							
							FOR contactDataFor AS inRef.FIXferAddRq.FIXferInfo.Receiver.PersonInfo.[COUNTER_EMPLOYMENT].OrgInfo.CompositeContactInfo.ContactInfo.ContactData[] DO
								CREATE LASTCHILD OF contactInfo AS general NAMESPACE ca NAME 'ContactData';
								
								SET general.ca:ContactType		=	contactDataFor.ContactType;
								SET general.ca:ContactValue		=	contactDataFor.ContactValue;
								
								IF FIELDVALUE(contactDataFor.PrefTimeStart) <> '' THEN
									SET general.ca:PrefTimeStart	=	FIELDVALUE(contactDataFor.PrefTimeStart);
								END IF;
								
								IF FIELDVALUE(contactDataFor.PrefTimeEnd) <> '' THEN
									SET general.ca:PrefTimeEnd		=	FIELDVALUE(contactDataFor.PrefTimeEnd);
								END IF;	
							END FOR;
							
							FOR postAddrFor AS inRef.FIXferAddRq.FIXferInfo.Receiver.PersonInfo.[COUNTER_EMPLOYMENT].OrgInfo.CompositeContactInfo.ContactInfo.PostAddr[] DO
								CREATE LASTCHILD OF contactInfo AS general NAMESPACE ca NAME 'PostAddr';
								
								SET general.ca:Addr1			=	postAddrFor.Addr1;
								SET general.ca:Addr2			=	postAddrFor.Addr2;
								SET general.ca:Addr3			=	postAddrFor.Addr3;
								SET general.ca:Addr4			=	postAddrFor.Addr4;
								SET general.ca:City				=	postAddrFor.City;
								SET general.ca:CityCode			=	postAddrFor.CityCode;
								SET general.ca:StateProv		=	postAddrFor.StateProv;
								SET general.ca:StateProvCode	=	postAddrFor.StateProvCode;
								SET general.ca:Area				=	postAddrFor.Area;
								SET general.ca:AreaCode			=	postAddrFor.AreaCode;
								SET general.ca:PostalCode		=	postAddrFor.PostalCode;
								SET general.ca:Country		    =	postAddrFor.Country;
								SET general.ca:CountryCode	    =	postAddrFor.CountryCode;
								SET general.ca:AddrType		    =	postAddrFor.AddrType;
								
								IF FIELDVALUE(postAddrFor.StartDt) <> '' THEN
									SET general.ca:StartDt	    =	SUBSTRING(FIELDVALUE(postAddrFor.StartDt) BEFORE 'T');
								END IF;
								
								IF FIELDVALUE(postAddrFor.EndDt) <> '' THEN	
									SET general.ca:EndDt		    =	SUBSTRING(postAddrFor.EndDt BEFORE 'T');
								END IF;
										
								SET general.ca:DistrictCode	    =	postAddrFor.DistrictCode;
								SET general.ca:District		    =	postAddrFor.District;
								SET general.ca:PlaceCode	    =	postAddrFor.PlaceCode;
								SET general.ca:Place		    =	postAddrFor.Place;
								SET general.ca:StreetCode	    =	postAddrFor.StreetCode;
								SET general.ca:Street		    =	postAddrFor.Street;
								SET general.ca:House		    =	postAddrFor.House;
								SET general.ca:Corpus		    =	postAddrFor.Corpus;
								SET general.ca:Building		    =	postAddrFor.Building;
								SET general.ca:Flat			    =	postAddrFor.Flat;
								SET general.ca:Office		    =	postAddrFor.Office;
								SET general.ca:RusKLADR	   	 	=	postAddrFor.RusKLADR;
								SET general.ca:AddrStatus	    =	postAddrFor.AddrStatus;
							END FOR;
							
							SET contactInfo.ca:ProviderCode				=	contactFor.ProviderCode;
							
						END FOR;						
												
					END FOR;
					
					DECLARE licensesInfo REFERENCE TO orgInfo;
					CREATE LASTCHILD OF orgInfo AS licensesInfo NAMESPACE orgs NAME 'Licenses';
					DECLARE licenseInfo REFERENCE TO orgInfo;
					
					FOR licenseFor AS inRef.FIXferAddRq.FIXferInfo.Receiver.PersonInfo.[COUNTER_EMPLOYMENT].OrgInfo.Licenses.LicenseInfo[] DO
						CREATE LASTCHILD OF licensesInfo AS licenseInfo NAMESPACE orgs NAME 'LicenseInfo';
						
						SET licenseInfo.orgs:LicenseType	=	licenseFor.LicenseType;
						SET licenseInfo.orgs:LicenseStatus	=	licenseFor.LicenseStatus;
						SET licenseInfo.orgs:LicenseSerie	=	licenseFor.LicenseSerie;
						SET licenseInfo.orgs:LicenseNum		=	licenseFor.LicenseNum;
						SET licenseInfo.orgs:LicenseIssueDt	=	licenseFor.LicenseIssueDt;
						SET licenseInfo.orgs:LicenseIssueBy	=	licenseFor.LicenseIssueBy;
						
					END FOR;
										
					SET orgInfo.orgs:TINInfo.ca:TINType 			=	orgFor.TINInfo.TINType;
					SET orgInfo.orgs:TINInfo.ca:TaxId	 			=	orgFor.TINInfo.TaxId;
					SET orgInfo.orgs:TINInfo.ca:CertCode 			=	orgFor.TINInfo.CertCode;	
					
					SET orgInfo.orgs:KIOInfo.ca:TINType 			=	orgFor.KIOInfo.TINType;
					SET orgInfo.orgs:KIOInfo.ca:TaxId	 			=	orgFor.KIOInfo.TaxId;
					SET orgInfo.orgs:KIOInfo.ca:CertCode 			=	orgFor.KIOInfo.CertCode;
					
					SET orgInfo.orgs:EstablishDt		 			=	orgFor.EstablishDt;
					SET orgInfo.orgs:NumEmployees		 			=	orgFor.NumEmployees;
					SET orgInfo.orgs:EmployerCode		 			=	orgFor.EmployerCode;
					
				END FOR;
				
				SET employment.ind:Occupation			=	inRef.FIXferAddRq.FIXferInfo.Receiver.PersonInfo.[COUNTER_EMPLOYMENT].Occupation;	 	
				
				SET employment.ind:Income.ca:Amt			=	inRef.FIXferAddRq.FIXferInfo.Receiver.PersonInfo.[COUNTER_EMPLOYMENT].Income.Amt;
				SET employment.ind:Income.ca:Reversal		=	inRef.FIXferAddRq.FIXferInfo.Receiver.PersonInfo.[COUNTER_EMPLOYMENT].Income.Reversal;
				SET employment.ind:Income.ca:CurCode		=	inRef.FIXferAddRq.FIXferInfo.Receiver.PersonInfo.[COUNTER_EMPLOYMENT].Income.CurCode;	
				SET employment.ind:Income.ca:CurRate		=	inRef.FIXferAddRq.FIXferInfo.Receiver.PersonInfo.[COUNTER_EMPLOYMENT].Income.CurRate;
				SET employment.ind:Income.ca:CurConvertRule	=	inRef.FIXferAddRq.FIXferInfo.Receiver.PersonInfo.[COUNTER_EMPLOYMENT].Income.CurConvertRule; 	
				
				SET employment.ind:JobTitle			=	inRef.FIXferAddRq.FIXferInfo.Receiver.PersonInfo.[COUNTER_EMPLOYMENT].JobTitle;	 
				
				IF FIELDVALUE(inRef.FIXferAddRq.FIXferInfo.Receiver.PersonInfo.[COUNTER_EMPLOYMENT].StartDt) <> '' THEN	
					SET employment.ind:StartDt			=	SUBSTRING(FIELDVALUE(inRef.FIXferAddRq.FIXferInfo.Receiver.PersonInfo.[COUNTER_EMPLOYMENT].StartDt) BEFORE 'T');
				END IF;
				
				IF FIELDVALUE(inRef.FIXferAddRq.FIXferInfo.Receiver.PersonInfo.[COUNTER_EMPLOYMENT].EndDt) <> '' THEN	
					SET employment.ind:EndDt			=	SUBSTRING(FIELDVALUE(inRef.FIXferAddRq.FIXferInfo.Receiver.PersonInfo.[COUNTER_EMPLOYMENT].EndDt) BEFORE 'T');			
				END IF;
				
			END IF;
							
			SET COUNTER_EMPLOYMENT = COUNTER_EMPLOYMENT + 1;
		END WHILE;	
		/*
		IF FIELDVALUE(inRef.FIXferAddRq.FIXferInfo.Receiver.PersonInfo.Gender) <> '' THEN
			SET personInfo.ind:Gender						=  inRef.FIXferAddRq.FIXferInfo.Receiver.PersonInfo.Gender;
		END IF;*/
		
		IF FIELDVALUE(inRef.FIXferAddRq.FIXferInfo.Receiver.PersonInfo.MaritalStatus) <> '' THEN
			SET personInfo.ind:MaritalStatus					=  inRef.FIXferAddRq.FIXferInfo.Receiver.PersonInfo.MaritalStatus;
		END IF;	
		SET personInfo.ind:USAMilitaryRank					=  inRef.FIXferAddRq.FIXferInfo.Receiver.PersonInfo.USAMilitaryRank;
		SET personInfo.ind:Dependets						=  inRef.FIXferAddRq.FIXferInfo.Receiver.PersonInfo.Dependets;
		
		IF EXISTS(inRef.FIXferAddRq.FIXferInfo.Receiver.PersonInfo.Passport[]) THEN
			SET personInfo.ind:Passport.ind:PassportNumber		=  COALESCE(inRef.FIXferAddRq.FIXferInfo.Receiver.PersonInfo.Passport.PassportNumber, NULL);
			SET personInfo.ind:Passport.ind:DocSeries			=  COALESCE(inRef.FIXferAddRq.FIXferInfo.Receiver.PersonInfo.Passport.DocSeries, NULL);
			SET personInfo.ind:Passport.ind:PassportCountry		=  COALESCE(inRef.FIXferAddRq.FIXferInfo.Receiver.PersonInfo.Passport.PassportCountry, NULL);
			SET personInfo.ind:Passport.ind:IssueLoc			=  COALESCE(inRef.FIXferAddRq.FIXferInfo.Receiver.PersonInfo.Passport.IssueLoc, NULL);
			
			IF FIELDVALUE(inRef.FIXferAddRq.FIXferInfo.Receiver.PersonInfo.Passport.IssDt) <> '' THEN
				SET personInfo.ind:Passport.ind:IssDt				=  SUBSTRING(FIELDVALUE(inRef.FIXferAddRq.FIXferInfo.Receiver.PersonInfo.Passport.IssDt) BEFORE 'T');
			END IF;
			
			IF FIELDVALUE(inRef.FIXferAddRq.FIXferInfo.Receiver.PersonInfo.Passport.ExpDt) <> '' THEN
				SET personInfo.ind:Passport.ind:ExpDt				=  SUBSTRING(FIELDVALUE(inRef.FIXferAddRq.FIXferInfo.Receiver.PersonInfo.Passport.ExpDt) BEFORE 'T');
			END IF;		
		END IF;
		
		SET personInfo.ind:OEDCode							=  inRef.FIXferAddRq.FIXferInfo.Receiver.PersonInfo.OEDCode;
		SET personInfo.ind:"OEDInstitution_Type"			=  inRef.FIXferAddRq.FIXferInfo.Receiver.PersonInfo."OEDInstitution_Type";
		
		IF EXISTS(inRef.FIXferAddRq.FIXferInfo.Receiver.PersonInfo.GovIssueIdent[]) THEN
			SET personInfo.ind:GovIssueIdent.ind:GovIssueIdentType	=  COALESCE(inRef.FIXferAddRq.FIXferInfo.Receiver.PersonInfo.GovIssueIdent.GovIssueIdentType, NULL);
			SET personInfo.ind:GovIssueIdent.ind:IdentSerialNum  	=  COALESCE(inRef.FIXferAddRq.FIXferInfo.Receiver.PersonInfo.GovIssueIdent.IdentSerialNum, NULL);
			SET personInfo.ind:GovIssueIdent.ind:GovOrg			 	=  COALESCE(inRef.FIXferAddRq.FIXferInfo.Receiver.PersonInfo.GovIssueIdent.GovOrg, NULL);
			SET personInfo.ind:GovIssueIdent.ind:GovOrgName		 	=  COALESCE(inRef.FIXferAddRq.FIXferInfo.Receiver.PersonInfo.GovIssueIdent.GovOrgName, NULL);
			SET personInfo.ind:GovIssueIdent.ind:GovRank		  	=  COALESCE(inRef.FIXferAddRq.FIXferInfo.Receiver.PersonInfo.GovIssueIdent.GovRank, NULL);
			SET personInfo.ind:GovIssueIdent.ind:StateProv		 	=  COALESCE(inRef.FIXferAddRq.FIXferInfo.Receiver.PersonInfo.GovIssueIdent.StateProv, NULL);
			SET personInfo.ind:GovIssueIdent.ind:Country		 	=  COALESCE(inRef.FIXferAddRq.FIXferInfo.Receiver.PersonInfo.GovIssueIdent.Country, NULL);
			SET personInfo.ind:GovIssueIdent.ind:Desc			  	=  COALESCE(inRef.FIXferAddRq.FIXferInfo.Receiver.PersonInfo.GovIssueIdent.Desc, NULL);
			
			IF FIELDVALUE(inRef.FIXferAddRq.FIXferInfo.Receiver.PersonInfo.GovIssueIdent.IssDt) <> '' THEN
				SET personInfo.ind:GovIssueIdent.ind:IssDt		  	=  SUBSTRING(FIELDVALUE(inRef.FIXferAddRq.FIXferInfo.Receiver.PersonInfo.GovIssueIdent.IssDt) BEFORE 'T');
			END IF;
			
			IF FIELDVALUE(inRef.FIXferAddRq.FIXferInfo.Receiver.PersonInfo.GovIssueIdent.ExpDt) <> '' THEN
				SET personInfo.ind:GovIssueIdent.ind:ExpDt		  	=  SUBSTRING(FIELDVALUE(inRef.FIXferAddRq.FIXferInfo.Receiver.PersonInfo.GovIssueIdent.ExpDt) BEFORE 'T');
			END IF;				
			
			SET personInfo.ind:GovIssueIdent.ind:IdentSerie		  	=  COALESCE(inRef.FIXferAddRq.FIXferInfo.Receiver.PersonInfo.GovIssueIdent.IdentSerie, NULL);
			SET personInfo.ind:GovIssueIdent.ind:GovOrgUnit		  	=  COALESCE(inRef.FIXferAddRq.FIXferInfo.Receiver.PersonInfo.GovIssueIdent.GovOrgUnit, NULL);
		END IF;
		
		IF EXISTS(inRef.FIXferAddRq.FIXferInfo.Receiver.PersonInfo.OtherIdentDoc[]) THEN
			SET personInfo.ind:OtherIdentDoc.ind:Desc			  	=  COALESCE(inRef.FIXferAddRq.FIXferInfo.Receiver.PersonInfo.OtherIdentDoc.Desc, NULL);
			SET personInfo.ind:OtherIdentDoc.ind:IdentSerialNum  	=  COALESCE(inRef.FIXferAddRq.FIXferInfo.Receiver.PersonInfo.OtherIdentDoc.IdentSerialNum, NULL);
			SET personInfo.ind:OtherIdentDoc.ind:Issuer			 	=  COALESCE(inRef.FIXferAddRq.FIXferInfo.Receiver.PersonInfo.OtherIdentDoc.Issuer, NULL);
			SET personInfo.ind:OtherIdentDoc.ind:IssueLoc		  	=  COALESCE(inRef.FIXferAddRq.FIXferInfo.Receiver.PersonInfo.OtherIdentDoc.IssueLoc, NULL);
			
			IF FIELDVALUE(inRef.FIXferAddRq.FIXferInfo.Receiver.PersonInfo.OtherIdentDoc.IssDt) <> '' THEN
				SET personInfo.ind:OtherIdentDoc.ind:IssDt		 	=  SUBSTRING(FIELDVALUE(inRef.FIXferAddRq.FIXferInfo.Receiver.PersonInfo.OtherIdentDoc.IssDt) BEFORE 'T');
			END IF;
			
			IF FIELDVALUE(inRef.FIXferAddRq.FIXferInfo.Receiver.PersonInfo.OtherIdentDoc.ExpDt) <> '' THEN
				SET personInfo.ind:OtherIdentDoc.ind:ExpDt		  	=  SUBSTRING(FIELDVALUE(inRef.FIXferAddRq.FIXferInfo.Receiver.PersonInfo.OtherIdentDoc.ExpDt) BEFORE 'T');
			END IF;
				
		END IF;
		
		--DECLARE identityCard REFERENCE TO personInfo;
		CREATE LASTCHILD OF personInfo AS identityCards NAMESPACE ind NAME 'IdentityCards';
		
		FOR identityFor AS inRef.FIXferAddRq.FIXferInfo.Receiver.PersonInfo.IdentityCards.IdentityCard[] DO
			
			CREATE LASTCHILD OF identityCards AS identityCard NAMESPACE ind NAME 'IdentityCard';
			
			SET identityCard.ind:IdType				=	identityFor.IdType;
			/*SET identityCard.ind:IdStatus			=	identityFor.IdStatus;
			SET identityCard.ind:IdSeries			=	identityFor.IdSeries;*/
			SET identityCard.ind:IdNum				=	identityFor.IdNum;
			IF FIELDVALUE(identityFor.IssueDt) <> '' THEN
				SET identityCard.ind:IssueDt			=	FIELDVALUE(identityFor.IssueDt);
			END IF;	
			SET identityCard.ind:IssuedBy			=	identityFor.IssuedBy;
			/*SET identityCard.ind:Code				=	identityFor.Code;
			SET identityCard.ind:IssueLoc			=	identityFor.IssueLoc;
			SET identityCard.ind:IssuedCountry		=	identityFor.IssuedCountry;
			
			IF FIELDVALUE(identityFor.IssuedRegionCode) <> '' THEN
				SET identityCard.ind:IssuedRegionCode	=	identityFor.IssuedRegionCode;
			END IF;
			
			IF	FIELDVALUE(identityFor.ExpDt) <> '' THEN	
				SET identityCard.ind:ExpDt				=	SUBSTRING(identityFor.ExpDt BEFORE 'T');
			END IF;	*/	
		END FOR;
		
		SET personInfo.ind:BirthPlace			  	=  inRef.FIXferAddRq.FIXferInfo.Receiver.PersonInfo.BirthPlace;
		--SET personInfo.ind:Resident				  	=  inRef.FIXferAddRq.FIXferInfo.Receiver.PersonInfo.Resident;
		SET personInfo.ind:MilitaryDocFlag		  	=  inRef.FIXferAddRq.FIXferInfo.Receiver.PersonInfo.MilitaryDocFlag;
		SET personInfo.ind:Citizenship			  	=  inRef.FIXferAddRq.FIXferInfo.Receiver.PersonInfo.Citizenship;
		
		IF COALESCE(FIELDVALUE(inRef.FIXferAddRq.FIXferInfo.OrigDt),'') <> '' THEN
			SET fixferInfo.mtblitz:OrigDt				=  FIELDVALUE(inRef.FIXferAddRq.FIXferInfo.OrigDt);
		END IF;
		
		IF COALESCE(FIELDVALUE(inRef.FIXferAddRq.FIXferInfo.RegDt),'') <> '' THEN
			SET fixferInfo.mtblitz:RegDt				=  SUBSTRING(FIELDVALUE(inRef.FIXferAddRq.FIXferInfo.RegDt) BEFORE 'T');
		END IF;
		
		SET fixferInfo.mtblitz:AdvNum				=  inRef.FIXferAddRq.FIXferInfo.AdvNum;
		SET fixferInfo.mtblitz:FIXferId				=  inRef.FIXferAddRq.FIXferInfo.FIXferId;
		SET fixferInfo.mtblitz:FIXferMethod			=  inRef.FIXferAddRq.FIXferInfo.FIXferMethod;
		SET fixferInfo.mtblitz:Purpose				=  inRef.FIXferAddRq.FIXferInfo.Purpose;
--		SET fixferInfo.mtblitz:Memo					=  inRef.FIXferAddRq.FIXferInfo.Memo;
		
		SET fixferInfo.mtblitz:Memo					=  REPLACE(inRef.FIXferAddRq.FIXferInfo.Memo, '"', '&#34');
		
		DECLARE subFields REFERENCE TO fixferInfo;
		
		IF EXISTS(inRef.FIXferAddRq.FIXferInfo.SecretPrompt[]) THEN	
					
			CREATE LASTCHILD OF fixferInfo AS subFields NAMESPACE mtblitz NAME 'SecretPrompt';			
			
			SET subFields.mt:Prompt						=   inRef.FIXferAddRq.FIXferInfo.SecretPrompt.Prompt;
--			SET subFields.mt:Memo						=   inRef.FIXferAddRq.FIXferInfo.SecretPrompt.Memo;
			
			SET subFields.mt:Memo						=   REPLACE(inRef.FIXferAddRq.FIXferInfo.SecretPrompt.Memo, '"', '&#34');
		END IF;	

		CREATE LASTCHILD OF fixferInfo AS subFields NAMESPACE mtblitz NAME 'SettlementInfo';
		
		SET subFields.mtblitz:ReceiveCurCode		=   inRef.FIXferAddRq.FIXferInfo.SettlementInfo.ReceiveCurCode;
		SET subFields.mtblitz:ReceiveAmtEst 		=   inRef.FIXferAddRq.FIXferInfo.SettlementInfo.ReceiveAmtEst;
		SET subFields.mtblitz:SendAmt				=   inRef.FIXferAddRq.FIXferInfo.SettlementInfo.SendAmt;
		SET subFields.mtblitz:SendCurCode			=   inRef.FIXferAddRq.FIXferInfo.SettlementInfo.SendCurCode;
		
				
		CREATE LASTCHILD OF fixferInfo AS subFields NAMESPACE mtblitz NAME 'FeeChargeAlloc';
		
		SET subFields.mtblitz:Fee.ca:FeeType							=	inRef.FIXferAddRq.FIXferInfo.FeeChargeAlloc.Fee.FeeType;				
		SET subFields.mtblitz:Fee.ca:CurAmt.ca:Amt 						=	inRef.FIXferAddRq.FIXferInfo.FeeChargeAlloc.Fee.CurAmt.Amt;
		SET subFields.mtblitz:Fee.ca:CurAmt.ca:Reversal 				=	inRef.FIXferAddRq.FIXferInfo.FeeChargeAlloc.Fee.CurAmt.Reversal;
		SET subFields.mtblitz:Fee.ca:CurAmt.ca:CurCode					=	inRef.FIXferAddRq.FIXferInfo.FeeChargeAlloc.Fee.CurAmt.CurCode;
		SET subFields.mtblitz:Fee.ca:CurAmt.ca:CurRate	 				=	inRef.FIXferAddRq.FIXferInfo.FeeChargeAlloc.Fee.CurAmt.CurRate;
		SET subFields.mtblitz:Fee.ca:CurAmt.ca:CurConvertRule	 		=	inRef.FIXferAddRq.FIXferInfo.FeeChargeAlloc.Fee.CurAmt.CurConvertRule;
		SET subFields.mtblitz:Fee.ca:Rate								=	inRef.FIXferAddRq.FIXferInfo.FeeChargeAlloc.Fee.Rate;
		
		IF EXISTS(inRef.FIXferAddRq.FIXferInfo.FeeChargeAlloc.Fee.MinCurAmt[]) THEN
			SET subFields.mtblitz:Fee.ca:MinCurAmt.ca:Amt 					=	COALESCE(inRef.FIXferAddRq.FIXferInfo.FeeChargeAlloc.Fee.MinCurAmt.Amt, NULL);
			SET subFields.mtblitz:Fee.ca:MinCurAmt.ca:Reversal 				=	COALESCE(inRef.FIXferAddRq.FIXferInfo.FeeChargeAlloc.Fee.MinCurAmt.Reversal, NULL);
			SET subFields.mtblitz:Fee.ca:MinCurAmt.ca:CurCode				=	COALESCE(inRef.FIXferAddRq.FIXferInfo.FeeChargeAlloc.Fee.MinCurAmt.CurCode, NULL);
			SET subFields.mtblitz:Fee.ca:MinCurAmt.ca:CurRate	 			=	COALESCE(inRef.FIXferAddRq.FIXferInfo.FeeChargeAlloc.Fee.MinCurAmt.CurRate, NULL);
			SET subFields.mtblitz:Fee.ca:MinCurAmt.ca:CurConvertRule	 	=	COALESCE(inRef.FIXferAddRq.FIXferInfo.FeeChargeAlloc.Fee.MinCurAmt.CurConvertRule, NULL);
		END IF;
		
		IF EXISTS(inRef.FIXferAddRq.FIXferInfo.FeeChargeAlloc.Fee.MaxCurAmt[]) THEN
			SET subFields.mtblitz:Fee.ca:MaxCurAmt.ca:Amt 					=	COALESCE(inRef.FIXferAddRq.FIXferInfo.FeeChargeAlloc.Fee.MaxCurAmt.Amt, NULL);
			SET subFields.mtblitz:Fee.ca:MaxCurAmt.ca:Reversal 				=	COALESCE(inRef.FIXferAddRq.FIXferInfo.FeeChargeAlloc.Fee.MaxCurAmt.Reversal, NULL);
			SET subFields.mtblitz:Fee.ca:MaxCurAmt.ca:CurCode				=	COALESCE(inRef.FIXferAddRq.FIXferInfo.FeeChargeAlloc.Fee.MaxCurAmt.CurCode, NULL);
			SET subFields.mtblitz:Fee.ca:MaxCurAmt.ca:CurRate	 			=	COALESCE(inRef.FIXferAddRq.FIXferInfo.FeeChargeAlloc.Fee.MaxCurAmt.CurRate, NULL);
			SET subFields.mtblitz:Fee.ca:MaxCurAmt.ca:CurConvertRule	 	=	COALESCE(inRef.FIXferAddRq.FIXferInfo.FeeChargeAlloc.Fee.MaxCurAmt.CurConvertRule, NULL);
		END IF;
		
		SET subFields.mtblitz:Fee.ca:RateType							=	inRef.FIXferAddRq.FIXferInfo.FeeChargeAlloc.Fee.RateType;
		
		IF EXISTS(inRef.FIXferAddRq.FIXferInfo.Confirmation[]) THEN
			CREATE LASTCHILD OF fixferInfo AS subFields NAMESPACE mtblitz NAME 'Confirmation';
		
			SET subFields.mtblitz:Confirmed					=	inRef.FIXferAddRq.FIXferInfo.Confirmation.Confirmed;	

			IF COALESCE(FIELDVALUE(inRef.FIXferAddRq.FIXferInfo.Confirmation.ConfDt),'') <> '' THEN
				SET subFields.mtblitz:ConfDt				=  SUBSTRING(FIELDVALUE(inRef.FIXferAddRq.FIXferInfo.Confirmation.ConfDt) BEFORE 'T');
			END IF;

---			SET subFields.mtblitz:Memo						=	inRef.FIXferAddRq.FIXferInfo.Confirmation.Memo;
		
			SET subFields.mtblitz:Memo						=	REPLACE(inRef.FIXferAddRq.FIXferInfo.Confirmation.Memo, '"', '&#34');
		END IF;
		
		IF EXISTS(inRef.FIXferAddRq.FIXferInfo.Checksum[]) THEN
			CREATE LASTCHILD OF fixferInfo AS subFields NAMESPACE mtblitz NAME 'Checksum';
		
			SET subFields.mt:ChecksumType				=	inRef.FIXferAddRq.FIXferInfo.Checksum.ChecksumType;	
			SET subFields.mt:ChksumValue				=	inRef.FIXferAddRq.FIXferInfo.Checksum.ChksumValue;
		END IF;		
		
		/* SIGNATURE */
		DECLARE signature REFERENCE TO outRef;
		DECLARE keyInfo REFERENCE TO signature;		
		DECLARE userRole REFERENCE TO keyInfo;
				
		FOR signatureFor AS inRef.FIXferAddRq.Signature[] DO					
			CREATE LASTCHILD OF outRef AS signature NAMESPACE mtblitz NAME 'Signature';
			
			SET signature.mt:SignatureValue				=  signatureFor.SignatureValue;
			---SET signature.mt:SignedData					=  REPLACE(signatureFor.SignedData, '"', '&#34');
			
			FOR keyFor AS inRef.FIXferAddRq.Signature.KeyInfo[] DO	
				
				CREATE LASTCHILD OF signature AS keyInfo NAMESPACE mt NAME 'KeyInfo';
				
				SET keyInfo.iam:X509SubjectName		=  keyFor.X509SubjectName;	
				SET keyInfo.iam:KeyName				=  keyFor.KeyName;
				SET keyInfo.iam:RegionId			=  keyFor.RegionId;
				
				CALL FillSomeField(keyFor, keyInfo, 'iam', 'UserRole');				
				
			END FOR;
			
			FOR userFor AS inRef.FIXferAddRq.Signature.UserInfo[] DO
				
				CREATE LASTCHILD OF signature AS userInfo NAMESPACE mt NAME 'UserInfo';
				
				SET userInfo.iam:UserId			=	userFor.UserId;
				SET userInfo.iam:RegionId		=	userFor.RegionId;
				SET userInfo.iam:FullName		=	userFor.FullName;
				SET userInfo.iam:OrgId			=	userFor.OrgId;
				SET userInfo.iam:OrgName		=	userFor.OrgName;
				SET userInfo.iam:OrgUnitId		=	userFor.OrgUnitId;
				SET userInfo.iam:OrgUnitName	=	userFor.OrgUnitNam;
				SET userInfo.iam:EmployeeId		=	userFor.EmployeeId;
				SET userInfo.iam:IpAddr			=	userFor.IpAddr;
				
				FOR certFor AS inRef.FIXferAddRq.Signature.UserInfo.CertInfo[] DO
					
					CREATE LASTCHILD OF userInfo AS certInfo NAMESPACE iam NAME 'CertInfo';
					
					SET certInfo.iam:X509SubjectName	=	certFor.X509SubjectName;
					SET certInfo.iam:KeyName			=	certFor.KeyName;
					SET certInfo.iam:RegionId			=	certFor.RegionId;
					
					CALL FillSomeField(certFor, certInfo, 'iam', 'UserRole');
					
					SET certInfo.iam:Certificate		=	certFor.Certificate;
				END FOR;	
			END FOR;
		END FOR;
		
		RETURN TRUE;
	END;			
END MODULE;
/* 2-ой сервис */

/* 4-ый сервис */
CREATE COMPUTE MODULE RequestForKolibri_ConvertMDO2CRM_KZSrvBLReversalMoneyTransferRq
	CREATE FUNCTION Main() RETURNS BOOLEAN
	BEGIN
	    CALL CopyMessageHeaders(InputRoot,OutputRoot);
		
		DECLARE inRef REFERENCE TO InputRoot.XMLNSC.[<];
		DECLARE outRef REFERENCE TO OutputRoot.XMLNSC.*[<];
				
	    SET OutputRoot.MQMD.ReplyToQ	= 'ESB.QPRAGMA.OUT';
	    SET OutputRoot.MQMD.ReplyToQMgr	= 'IKAZ.ESB.OUT.GW1';				
				
		CREATE LASTCHILD OF OutputRoot DOMAIN('XMLNSC') NAME 'XMLNSC';
		CREATE LASTCHILD OF OutputRoot.XMLNSC AS outRef NAMESPACE mtblitz NAME 'FIXferRevRq'; 
		
    	SET OutputRoot.XMLNSC.mtblitz:FIXferRevRq.(XMLNSC.NamespaceDecl)xmlns:iam = iam;
		SET OutputRoot.XMLNSC.mtblitz:FIXferRevRq.(XMLNSC.NamespaceDecl)xmlns:mt = mt;		
    	SET OutputRoot.XMLNSC.mtblitz:FIXferRevRq.(XMLNSC.NamespaceDecl)xmlns:ca  = ca; 
		SET OutputRoot.XMLNSC.mtblitz:FIXferRevRq.(XMLNSC.NamespaceDecl)xmlns:mtblitz = mtblitz; 	
    	SET OutputRoot.XMLNSC.mtblitz:FIXferRevRq.(XMLNSC.NamespaceDecl)xmlns:ind = ind; 
		SET OutputRoot.XMLNSC.mtblitz:FIXferRevRq.(XMLNSC.NamespaceDecl)xmlns:orgs = orgs; 
		
		SET outRef.mt:RqUID			= inRef.RqUID;
		SET outRef.mt:RqTm			= convertFromQPtoKOLI(inRef.RqTm);
		SET outRef.mt:SPName		= 'urn:sbrfsystems:98-abs';
		SET outRef.mt:OperName		= 'SrvBLReversalMoneyTransfer';
         
        DECLARE userInfo REFERENCE TO outRef;
        
        CREATE LASTCHILD OF outRef AS userInfo NAMESPACE mtblitz NAME 'UserInfo'; 
        
        SET userInfo.iam:UserId			= inRef.FIXferRevRq.UserInfo.UserId; -- обязательное поле
        SET userInfo.iam:RegionId		= inRef.FIXferRevRq.UserInfo.RegionId; 
        SET userInfo.iam:FullName		= inRef.FIXferRevRq.UserInfo.FullName;
        
        /* userInfo.iam:PersonName */
        DECLARE personName REFERENCE TO userInfo;                	                
        
        IF EXISTS(inRef.FIXferRevRq.UserInfo.PersonName[]) THEN
        	CREATE LASTCHILD OF userInfo AS personName NAMESPACE iam NAME 'PersonName'; -- создаем PersonName с namespace iam внутри UserInfo            
        	CALL FillSomeField(inRef.FIXferRevRq.UserInfo.PersonName, personName, 'ind', 'LastName');
        END IF;
        
        SET personName.ind:FirstName = inRef.FIXferRevRq.UserInfo.PersonName.FirstName;
		
		IF EXISTS(inRef.FIXferRevRq.UserInfo.PersonName[]) THEN
			CALL FillSomeField(inRef.FIXferRevRq.UserInfo.PersonName, personName, 'ind', 'MiddleName');
		END IF;
        
        SET personName.ind:TitlePrefix 	= inRef.FIXferRevRq.UserInfo.PersonName.TitlePrefix;
        SET personName.ind:NameSuffix 	= inRef.FIXferRevRq.UserInfo.PersonName.NameSuffix;
        SET personName.ind:Nickname 	= inRef.FIXferRevRq.UserInfo.PersonName.Nickname;
        SET personName.ind:LegalName    = inRef.FIXferRevRq.UserInfo.PersonName.LegalName;
        /* userInfo.iam:PersonName */
              
		SET userInfo.iam:OrgId				= inRef.FIXferRevRq.UserInfo.OrgId;
		SET userInfo.iam:OrgName			= inRef.FIXferRevRq.UserInfo.OrgName;
		SET userInfo.iam:OrgUnitId			= inRef.FIXferRevRq.UserInfo.OrgUnitId;
		SET userInfo.iam:OrgUnitName		= inRef.FIXferRevRq.UserInfo.OrgUnitName;
		SET userInfo.iam:EmployeeId			= inRef.FIXferRevRq.UserInfo.EmployeeId;
		SET userInfo.iam:IpAddr				= inRef.FIXferRevRq.UserInfo.IpAddr;
		
		DECLARE COUNTER INTEGER 1;
		DECLARE ARRAY_USERINFO INTEGER CARDINALITY(inRef.FIXferRevRq.UserInfo.*[]);		
		
		/* userInfo.iam:CertInfo */
		DECLARE certInfo REFERENCE TO userInfo;
		
		WHILE COUNTER <= ARRAY_USERINFO DO
		
			IF FIELDNAME(inRef.FIXferRevRq.UserInfo.[COUNTER]) = 'CertInfo' THEN
				
				CREATE LASTCHILD OF userInfo AS certInfo NAMESPACE iam NAME 'CertInfo';
				
				SET certInfo.iam:X509SubjectName  =  FIELDVALUE(inRef.FIXferRevRq.UserInfo.[COUNTER].X509SubjectName);
				SET certInfo.iam:KeyName		  =  FIELDVALUE(inRef.FIXferRevRq.UserInfo.[COUNTER].KeyName);	
				SET certInfo.iam:RegionId		  =  FIELDVALUE(inRef.FIXferRevRq.UserInfo.[COUNTER].RegionId);				
				      
        		CALL FillSomeField(inRef.FIXferRevRq.UserInfo.[COUNTER], certInfo, 'iam', 'UserRole');
        		        		
        		SET certInfo.iam:Certificate		  =  FIELDVALUE(inRef.FIXferRevRq.UserInfo.[COUNTER].Certificate);
        		SET certInfo.iam:KeyValue			  =  FIELDVALUE(inRef.FIXferRevRq.UserInfo.[COUNTER].KeyValue); 
        		SET certInfo.iam:X509SerialNumber     =  FIELDVALUE(inRef.FIXferRevRq.UserInfo.[COUNTER].X509SerialNumber);
        		SET certInfo.iam:X509IssuerNumber     =  FIELDVALUE(inRef.FIXferRevRq.UserInfo.[COUNTER].X509IssuerNumber); 			
				SET certInfo.iam:X509IssuerSerial     =  FIELDVALUE(inRef.FIXferRevRq.UserInfo.[COUNTER].X509IssuerSerial);
				SET certInfo.iam:Version		      =  FIELDVALUE(inRef.FIXferRevRq.UserInfo.[COUNTER].Version);
				SET certInfo.iam:NotBefore		      =  FIELDVALUE(inRef.FIXferRevRq.UserInfo.[COUNTER].NotBefore);
				SET certInfo.iam:NotAfter			  =  FIELDVALUE(inRef.FIXferRevRq.UserInfo.[COUNTER].NotAfter);
				SET certInfo.iam:SigAlgName			  =  FIELDVALUE(inRef.FIXferRevRq.UserInfo.[COUNTER].SigAlgName);
				SET certInfo.iam:SigValue			  =  FIELDVALUE(inRef.FIXferRevRq.UserInfo.[COUNTER].SigValue);
				
				DECLARE COUNTER_CERTINFO INTEGER 1;
				DECLARE ARRAY_CERTINFO INTEGER CARDINALITY(inRef.FIXferRevRq.UserInfo.[COUNTER].*[]);
				DECLARE extensionInfo REFERENCE TO certInfo;
				
				WHILE COUNTER_CERTINFO <= ARRAY_CERTINFO DO
					IF FIELDNAME(inRef.FIXferRevRq.UserInfo.[COUNTER].[COUNTER_CERTINFO]) = 'Extension' THEN
						CREATE LASTCHILD OF certInfo AS extensionInfo NAMESPACE iam NAME 'Extension';
												
						SET extensionInfo.iam:ExtnId      = FIELDVALUE(inRef.FIXferRevRq.UserInfo.[COUNTER].[COUNTER_CERTINFO].ExtnId);
						SET extensionInfo.iam:Critical    = FIELDVALUE(inRef.FIXferRevRq.UserInfo.[COUNTER].[COUNTER_CERTINFO].Critical);
						SET extensionInfo.iam:ExtnValue   = FIELDVALUE(inRef.FIXferRevRq.UserInfo.[COUNTER].[COUNTER_CERTINFO].ExtnValue);												
					END IF;					
					SET COUNTER_CERTINFO = COUNTER_CERTINFO + 1;						
				END WHILE;
						
			END IF;
			
			SET COUNTER = COUNTER + 1;
			
		END WHILE;		
		/* userInfo.iam:CertInfo */
		
		/* FIXferInfo */
		DECLARE fixferInfo REFERENCE TO outRef;		
		CREATE LASTCHILD OF outRef AS fixferInfo NAMESPACE mtblitz NAME 'FIXferInfo';
		 
		/* OWNER */
		DECLARE owner REFERENCE TO fixferInfo;
		CREATE LASTCHILD OF fixferInfo AS owner NAMESPACE mtblitz NAME 'Owner';
		
		/* BankInfo */
		DECLARE bankInfo REFERENCE TO owner;
		CREATE LASTCHILD OF owner AS bankInfo NAMESPACE mtblitz NAME 'BankInfo';
		
		SET bankInfo.mtblitz:BankId  =  inRef.FIXferRevRq.FIXferInfo.Owner.BankInfo.BankId;
		SET bankInfo.mtblitz:Country =  inRef.FIXferRevRq.FIXferInfo.Owner.BankInfo.Country; 
		SET bankInfo.mtblitz:City    =  inRef.FIXferRevRq.FIXferInfo.Owner.BankInfo.City;				
		
		/* RECEIVER */
		DECLARE receiver REFERENCE TO fixferInfo;
		CREATE LASTCHILD OF fixferInfo AS receiver NAMESPACE mtblitz NAME 'Receiver';
		
		/* PersonInfo */
		DECLARE personInfo REFERENCE TO receiver;
		CREATE LASTCHILD OF receiver AS personInfo NAMESPACE mtblitz NAME 'PersonInfo';   
		
		SET personInfo.ind:NameAddrType  =  inRef.FIXferRevRq.FIXferInfo.Receiver.PersonInfo.NameAddrType;
		SET personInfo.ind:FullName      =  inRef.FIXferRevRq.FIXferInfo.Receiver.PersonInfo.FullName;		
		
		IF EXISTS(inRef.FIXferRevRq.FIXferInfo.Receiver.PersonInfo.PersonName[]) THEN
        	-- создаем PersonName с namespace iam внутри UserInfo
        	CREATE LASTCHILD OF personInfo AS personName NAMESPACE ind NAME 'PersonName';             
        	CALL FillSomeField(inRef.FIXferRevRq.FIXferInfo.Receiver.PersonInfo.PersonName, personName, 'ind', 'LastName');
        	
        	SET personName.ind:FirstName	=	inRef.FIXferRevRq.FIXferInfo.Receiver.PersonInfo.PersonName.FirstName;	
        	
        	IF EXISTS(inRef.FIXferRevRq.FIXferInfo.Receiver.PersonInfo.PersonName[]) THEN
				CALL FillSomeField(inRef.FIXferRevRq.FIXferInfo.Receiver.PersonInfo.PersonName, personName, 'ind', 'MiddleName');
			END IF;
        	
        	SET personName.ind:TitlePrefix	=	inRef.FIXferRevRq.FIXferInfo.Receiver.PersonInfo.PersonName.TitlePrefix;	
        	SET personName.ind:NameSuffix	=	inRef.FIXferRevRq.FIXferInfo.Receiver.PersonInfo.PersonName.NameSuffix;
        	SET personName.ind:Nickname		=	inRef.FIXferRevRq.FIXferInfo.Receiver.PersonInfo.PersonName.Nickname;
        	SET personName.ind:LegalName	=	inRef.FIXferRevRq.FIXferInfo.Receiver.PersonInfo.PersonName.LegalName;        	
        END IF;		
		
		DECLARE COUNT_CONTACTINFO INTEGER 1;
		DECLARE ARRAY_CONTACTINFO INTEGER CARDINALITY(inRef.FIXferRevRq.FIXferInfo.Receiver.PersonInfo.*[]);
		DECLARE contactInfo REFERENCE TO personInfo;
		
		/* ContactInfo */
		WHILE COUNT_CONTACTINFO <= ARRAY_CONTACTINFO DO
			IF FIELDNAME(inRef.FIXferRevRq.FIXferInfo.Receiver.PersonInfo.[COUNT_CONTACTINFO]) = 'ContactInfo' THEN
				CREATE LASTCHILD OF personInfo AS contactInfo NAMESPACE ind NAME 'ContactInfo';
				SET contactInfo.ca:ContactPref		=	FIELDVALUE(inRef.FIXferRevRq.FIXferInfo.Receiver.PersonInfo.[COUNT_CONTACTINFO].ContactPref);
				
				IF FIELDVALUE(inRef.FIXferRevRq.FIXferInfo.Receiver.PersonInfo.[COUNT_CONTACTINFO].PrefTimeStart) <> '' THEN
					SET contactInfo.ca:PrefTimeStart	=	FIELDVALUE(inRef.FIXferRevRq.FIXferInfo.Receiver.PersonInfo.[COUNT_CONTACTINFO].PrefTimeStart);
				END IF;
				
				IF FIELDVALUE(inRef.FIXferRevRq.FIXferInfo.Receiver.PersonInfo.[COUNT_CONTACTINFO].PrefTimeEnd) <> '' THEN
					SET contactInfo.ca:PrefTimeEnd		=   FIELDVALUE(inRef.FIXferRevRq.FIXferInfo.Receiver.PersonInfo.[COUNT_CONTACTINFO].PrefTimeEnd);
				END IF;
					
				DECLARE COUNT_PHONENUM INTEGER 1;
				DECLARE ARRAY_PHONENUM INTEGER CARDINALITY(inRef.FIXferRevRq.FIXferInfo.Receiver.PersonInfo.[COUNT_CONTACTINFO].*[]);
 				DECLARE phoneNum REFERENCE TO contactInfo;
 				
 				WHILE COUNT_PHONENUM <= ARRAY_CONTACTINFO DO
 					IF FIELDNAME(inRef.FIXferRevRq.FIXferInfo.Receiver.PersonInfo.[COUNT_CONTACTINFO].[COUNT_PHONENUM]) = 'PhoneNum' THEN
 						CREATE LASTCHILD OF contactInfo AS phoneNum NAMESPACE ca NAME 'PhoneNum';
 						
 						SET phoneNum.ca:PhoneType		=	FIELDVALUE(inRef.FIXferRevRq.FIXferInfo.Receiver.PersonInfo.[COUNT_CONTACTINFO].[COUNT_PHONENUM].PhoneType);
 						SET phoneNum.ca:Phone			= 	FIELDVALUE(inRef.FIXferRevRq.FIXferInfo.Receiver.PersonInfo.[COUNT_CONTACTINFO].[COUNT_PHONENUM].Phone);
 						SET phoneNum.ca:PhoneCode   	=   FIELDVALUE(inRef.FIXferRevRq.FIXferInfo.Receiver.PersonInfo.[COUNT_CONTACTINFO].[COUNT_PHONENUM].PhoneCode);
 						SET phoneNum.ca:PhoneOperName   =   FIELDVALUE(inRef.FIXferRevRq.FIXferInfo.Receiver.PersonInfo.[COUNT_CONTACTINFO].[COUNT_PHONENUM].PhoneOperName);
 						
 					END IF;	
 					SET COUNT_PHONENUM = COUNT_PHONENUM + 1; 					
 				END WHILE;
 				
 				SET contactInfo.ca:ContactName	=	FIELDVALUE(inRef.FIXferRevRq.FIXferInfo.Receiver.PersonInfo.[COUNT_CONTACTINFO].ContactName);
 				SET contactInfo.ca:EmailAddr	=	FIELDVALUE(inRef.FIXferRevRq.FIXferInfo.Receiver.PersonInfo.[COUNT_CONTACTINFO].EmailAddr);
 				SET contactInfo.ca:URL			=	FIELDVALUE(inRef.FIXferRevRq.FIXferInfo.Receiver.PersonInfo.[COUNT_CONTACTINFO].URL);
 				
 				DECLARE COUNT_CONTACTDATA INTEGER 1;
 				DECLARE ARRAY_CONTACTDATA INTEGER CARDINALITY(inRef.FIXferRevRq.FIXferInfo.Receiver.PersonInfo.[COUNT_CONTACTINFO].*[]);
 				DECLARE contactData REFERENCE TO contactInfo;
 				
 				WHILE COUNT_CONTACTDATA <= ARRAY_CONTACTDATA DO
 					IF FIELDNAME(inRef.FIXferRevRq.FIXferInfo.Receiver.PersonInfo.[COUNT_CONTACTINFO].[COUNT_CONTACTDATA]) = 'ContactData' THEN
 						CREATE LASTCHILD OF contactInfo AS contactData NAMESPACE ca NAME 'ContactData';
 						
 						SET contactData.ca:ContactType		=  FIELDVALUE(inRef.FIXferRevRq.FIXferInfo.Receiver.PersonInfo.[COUNT_CONTACTINFO].[COUNT_CONTACTDATA].ContactType);
 						SET contactData.ca:ContactValue		=  FIELDVALUE(inRef.FIXferRevRq.FIXferInfo.Receiver.PersonInfo.[COUNT_CONTACTINFO].[COUNT_CONTACTDATA].ContactValue);
 						
 						IF FIELDVALUE(inRef.FIXferRevRq.FIXferInfo.Receiver.PersonInfo.[COUNT_CONTACTINFO].[COUNT_CONTACTDATA].PrefTimeStart) <> '' THEN
 							SET contactData.ca:PrefTimeStart	=  FIELDVALUE(inRef.FIXferRevRq.FIXferInfo.Receiver.PersonInfo.[COUNT_CONTACTINFO].[COUNT_CONTACTDATA].PrefTimeStart);
 						END IF;
 						
 						IF FIELDVALUE(inRef.FIXferRevRq.FIXferInfo.Receiver.PersonInfo.[COUNT_CONTACTINFO].[COUNT_CONTACTDATA].PrefTimeEnd) <> '' THEN
 							SET contactData.ca:PrefTimeEnd		=  FIELDVALUE(inRef.FIXferRevRq.FIXferInfo.Receiver.PersonInfo.[COUNT_CONTACTINFO].[COUNT_CONTACTDATA].PrefTimeEnd);
 						END IF;	
 					END IF;	
 					SET COUNT_CONTACTDATA = COUNT_CONTACTDATA + 1;
 				END WHILE;
 				
 				DECLARE COUNT_POSTADDR INTEGER 1;
				DECLARE postAddr REFERENCE TO contactInfo;
				
				WHILE COUNT_POSTADDR <= ARRAY_CONTACTDATA DO
					IF FIELDNAME(inRef.FIXferRevRq.FIXferInfo.Receiver.PersonInfo.[COUNT_CONTACTINFO].[COUNT_POSTADDR]) = 'PostAddr' THEN
						CREATE LASTCHILD OF contactInfo AS postAddr NAMESPACE ca NAME 'PostAddr';
						
						SET postAddr.ca:Addr1			=	FIELDVALUE(inRef.FIXferRevRq.FIXferInfo.Receiver.PersonInfo.[COUNT_CONTACTINFO].[COUNT_POSTADDR].Addr1);  
						SET postAddr.ca:Addr2			=	FIELDVALUE(inRef.FIXferRevRq.FIXferInfo.Receiver.PersonInfo.[COUNT_CONTACTINFO].[COUNT_POSTADDR].Addr2);  
						SET postAddr.ca:Addr3			=	FIELDVALUE(inRef.FIXferRevRq.FIXferInfo.Receiver.PersonInfo.[COUNT_CONTACTINFO].[COUNT_POSTADDR].Addr3);  
						SET postAddr.ca:Addr4			=	FIELDVALUE(inRef.FIXferRevRq.FIXferInfo.Receiver.PersonInfo.[COUNT_CONTACTINFO].[COUNT_POSTADDR].Addr4);
						SET postAddr.ca:City			=	FIELDVALUE(inRef.FIXferRevRq.FIXferInfo.Receiver.PersonInfo.[COUNT_CONTACTINFO].[COUNT_POSTADDR].City);    
						SET postAddr.ca:CityCode		=	FIELDVALUE(inRef.FIXferRevRq.FIXferInfo.Receiver.PersonInfo.[COUNT_CONTACTINFO].[COUNT_POSTADDR].CityCode);
						SET postAddr.ca:StateProv		=	FIELDVALUE(inRef.FIXferRevRq.FIXferInfo.Receiver.PersonInfo.[COUNT_CONTACTINFO].[COUNT_POSTADDR].StateProv);
						SET postAddr.ca:StateProvCode	=	FIELDVALUE(inRef.FIXferRevRq.FIXferInfo.Receiver.PersonInfo.[COUNT_CONTACTINFO].[COUNT_POSTADDR].StateProvCode);
						SET postAddr.ca:Area			= 	FIELDVALUE(inRef.FIXferRevRq.FIXferInfo.Receiver.PersonInfo.[COUNT_CONTACTINFO].[COUNT_POSTADDR].Area);
						SET postAddr.ca:AreaCode		= 	FIELDVALUE(inRef.FIXferRevRq.FIXferInfo.Receiver.PersonInfo.[COUNT_CONTACTINFO].[COUNT_POSTADDR].AreaCode);
						SET postAddr.ca:PostalCode		= 	FIELDVALUE(inRef.FIXferRevRq.FIXferInfo.Receiver.PersonInfo.[COUNT_CONTACTINFO].[COUNT_POSTADDR].PostalCode);
						SET postAddr.ca:Country			= 	FIELDVALUE(inRef.FIXferRevRq.FIXferInfo.Receiver.PersonInfo.[COUNT_CONTACTINFO].[COUNT_POSTADDR].Country);
						SET postAddr.ca:CountryCode		= 	FIELDVALUE(inRef.FIXferRevRq.FIXferInfo.Receiver.PersonInfo.[COUNT_CONTACTINFO].[COUNT_POSTADDR].CountryCode);
						SET postAddr.ca:AddrType		= 	FIELDVALUE(inRef.FIXferRevRq.FIXferInfo.Receiver.PersonInfo.[COUNT_CONTACTINFO].[COUNT_POSTADDR].AddrType);      
						
						IF FIELDVALUE(inRef.FIXferRevRq.FIXferInfo.Receiver.PersonInfo.[COUNT_CONTACTINFO].[COUNT_POSTADDR].StartDt) <> '' THEN
							SET postAddr.ca:StartDt		= 	SUBSTRING(FIELDVALUE(inRef.FIXferRevRq.FIXferInfo.Receiver.PersonInfo.[COUNT_CONTACTINFO].[COUNT_POSTADDR].StartDt) BEFORE 'T');
						END IF;
						
						IF FIELDVALUE(inRef.FIXferRevRq.FIXferInfo.Receiver.PersonInfo.[COUNT_CONTACTINFO].[COUNT_POSTADDR].EndDt) <> '' THEN
							SET postAddr.ca:EndDt		= 	SUBSTRING(FIELDVALUE(inRef.FIXferRevRq.FIXferInfo.Receiver.PersonInfo.[COUNT_CONTACTINFO].[COUNT_POSTADDR].EndDt) BEFORE 'T');
						END IF;
						
						SET postAddr.ca:DistrictCode	= 	FIELDVALUE(inRef.FIXferRevRq.FIXferInfo.Receiver.PersonInfo.[COUNT_CONTACTINFO].[COUNT_POSTADDR].DistrictCode);
						SET postAddr.ca:District		= 	FIELDVALUE(inRef.FIXferRevRq.FIXferInfo.Receiver.PersonInfo.[COUNT_CONTACTINFO].[COUNT_POSTADDR].District);
						SET postAddr.ca:PlaсeCode		= 	FIELDVALUE(inRef.FIXferRevRq.FIXferInfo.Receiver.PersonInfo.[COUNT_CONTACTINFO].[COUNT_POSTADDR].PlaсeCode);
						SET postAddr.ca:Place			= 	FIELDVALUE(inRef.FIXferRevRq.FIXferInfo.Receiver.PersonInfo.[COUNT_CONTACTINFO].[COUNT_POSTADDR].Place);
						SET postAddr.ca:StreetCode		= 	FIELDVALUE(inRef.FIXferRevRq.FIXferInfo.Receiver.PersonInfo.[COUNT_CONTACTINFO].[COUNT_POSTADDR].StreetCode);
						SET postAddr.ca:Street			= 	FIELDVALUE(inRef.FIXferRevRq.FIXferInfo.Receiver.PersonInfo.[COUNT_CONTACTINFO].[COUNT_POSTADDR].Street);
						SET postAddr.ca:House			= 	FIELDVALUE(inRef.FIXferRevRq.FIXferInfo.Receiver.PersonInfo.[COUNT_CONTACTINFO].[COUNT_POSTADDR].House);
						SET postAddr.ca:Corpus			= 	FIELDVALUE(inRef.FIXferRevRq.FIXferInfo.Receiver.PersonInfo.[COUNT_CONTACTINFO].[COUNT_POSTADDR].Corpus);
						SET postAddr.ca:Building		= 	FIELDVALUE(inRef.FIXferRevRq.FIXferInfo.Receiver.PersonInfo.[COUNT_CONTACTINFO].[COUNT_POSTADDR].Building);
						SET postAddr.ca:Flat			= 	FIELDVALUE(inRef.FIXferRevRq.FIXferInfo.Receiver.PersonInfo.[COUNT_CONTACTINFO].[COUNT_POSTADDR].Flat);
						SET postAddr.ca:Office			= 	FIELDVALUE(inRef.FIXferRevRq.FIXferInfo.Receiver.PersonInfo.[COUNT_CONTACTINFO].[COUNT_POSTADDR].Office);
						SET postAddr.ca:RusKLADR		= 	FIELDVALUE(inRef.FIXferRevRq.FIXferInfo.Receiver.PersonInfo.[COUNT_CONTACTINFO].[COUNT_POSTADDR].RusKLADR);
						SET postAddr.ca:AddrStatus		= 	FIELDVALUE(inRef.FIXferRevRq.FIXferInfo.Receiver.PersonInfo.[COUNT_CONTACTINFO].[COUNT_POSTADDR].AddrStatus);
						
					END IF;
					SET COUNT_POSTADDR = COUNT_POSTADDR + 1;	
				END WHILE;		
 				
 				SET contactInfo.ca:ProviderCode			=	FIELDVALUE(inRef.FIXferRevRq.FIXferInfo.Receiver.PersonInfo.[COUNT_CONTACTINFO].ProviderCode);
 				
			END IF;	
			SET COUNT_CONTACTINFO = COUNT_CONTACTINFO + 1;
		END WHILE;
		
		/* PersonInfo */
		SET personInfo.ind:TINInfo.ca:TINType   =  inRef.FIXferRevRq.FIXferInfo.Receiver.PersonInfo.TINInfo.TINType;
		SET personInfo.ind:TINInfo.ca:TaxId  	=  inRef.FIXferRevRq.FIXferInfo.Receiver.PersonInfo.TINInfo.TaxId;
		SET personInfo.ind:TINInfo.ca:CertCode  =  inRef.FIXferRevRq.FIXferInfo.Receiver.PersonInfo.TINInfo.CertCode;
		
		IF COALESCE(FIELDVALUE(inRef.FIXferRevRq.FIXferInfo.Receiver.PersonInfo.BirthDt),'') <> '' THEN
			SET personInfo.ind:BirthDt				=  SUBSTRING(FIELDVALUE(inRef.FIXferRevRq.FIXferInfo.Receiver.PersonInfo.BirthDt) FROM 1 FOR 10);
		END IF;
		
		IF EXISTS(inRef.FIXferRevRq.FIXferInfo.Receiver.PersonInfo.DriversLicense[]) THEN 
			SET personInfo.ind:DriversLicense.ind:LicenseNum		=  COALESCE(inRef.FIXferRevRq.FIXferInfo.Receiver.PersonInfo.DriversLicense.LicenseNum, NULL);
			SET personInfo.ind:DriversLicense.ind:StateProv			=  COALESCE(inRef.FIXferRevRq.FIXferInfo.Receiver.PersonInfo.DriversLicense.StateProv, NULL);
			SET personInfo.ind:DriversLicense.ind:Country			=  COALESCE(inRef.FIXferRevRq.FIXferInfo.Receiver.PersonInfo.DriversLicense.Country, NULL);
		END IF;
		
		SET personInfo.ind:MotherMaidenName						=  inRef.FIXferRevRq.FIXferInfo.Receiver.PersonInfo.MotherMaidenName;
		SET personInfo.ind:SpouseName							=  inRef.FIXferRevRq.FIXferInfo.Receiver.PersonInfo.SpouseName;
		
		DECLARE COUNTER_EMPLOYMENT INTEGER 1;
		DECLARE employment REFERENCE TO personInfo;
		
		WHILE COUNTER_EMPLOYMENT <= ARRAY_CONTACTINFO DO
			IF FIELDNAME(inRef.FIXferRevRq.FIXferInfo.Receiver.PersonInfo.[COUNTER_EMPLOYMENT]) = 'EmploymentHistory' THEN
				CREATE LASTCHILD OF personInfo AS employment NAMESPACE ind NAME 'EmploymentHistory';
				
				SET employment.ind:EmploymentStatus		=	inRef.FIXferRevRq.FIXferInfo.Receiver.PersonInfo.[COUNTER_EMPLOYMENT].EmploymentStatus;				

				DECLARE orgInfo REFERENCE TO employment;
				DECLARE industId REFERENCE TO employment;
				DECLARE composite REFERENCE TO employment;
				DECLARE general REFERENCE TO employment;
								
				FOR orgFor AS inRef.FIXferRevRq.FIXferInfo.Receiver.PersonInfo.[COUNTER_EMPLOYMENT].OrgInfo[] DO
					CREATE LASTCHILD OF employment AS orgInfo NAMESPACE ind NAME 'OrgInfo';
					
					FOR industFor AS inRef.FIXferRevRq.FIXferInfo.Receiver.PersonInfo.[COUNTER_EMPLOYMENT].OrgInfo.IndustId[] DO
						CREATE LASTCHILD OF orgInfo AS industId NAMESPACE orgs NAME 'IndustId';
						
						SET industId.orgs:Org			=	industFor.Org;
						SET industId.orgs:IndustNum		=	industFor.IndustNum;
						SET industId.orgs:SubIndustrNum =   industFor.SubIndustrNum;
						SET industId.orgs:IsPrimary	    =   industFor.IsPrimary;						
					END FOR;
					
					SET orgInfo.orgs:Name 			=	orgFor.Name;	
					SET orgInfo.orgs:LegalName 		=	orgFor.LegalName;
					SET orgInfo.orgs:LegalNameEn 	=	orgFor.LegalNameEn;
					SET orgInfo.orgs:FullNameEn 	=	orgFor.FullNameEn;
					SET orgInfo.orgs:MnemonicName 	=	orgFor.MnemonicName;
					
					FOR compositeFor AS inRef.FIXferRevRq.FIXferInfo.Receiver.PersonInfo.[COUNTER_EMPLOYMENT].OrgInfo.CompositeContactInfo[] DO
						CREATE LASTCHILD OF orgInfo AS composite NAMESPACE orgs NAME 'CompositeContactInfo';
						
						SET composite.ca:ContactInfoType	=  compositeFor.ContactInfoType;
						
						FOR contactFor AS inRef.FIXferRevRq.FIXferInfo.Receiver.PersonInfo.[COUNTER_EMPLOYMENT].OrgInfo.CompositeContactInfo.ContactInfo[] DO
							CREATE LASTCHILD OF composite AS contactInfo NAMESPACE ca NAME 'ContactInfo';
							
							SET contactInfo.ca:ContactPref		=	contactFor.ContactPref;
							
							IF FIELDVALUE(contactFor.PrefTimeStart) <> '' THEN
								SET contactInfo.ca:PrefTimeStart	=	FIELDVALUE(contactFor.PrefTimeStart);
							END IF;
							
							IF FIELDVALUE(contactFor.PrefTimeEnd) <> '' THEN
								SET contactInfo.ca:PrefTimeEnd		=	FIELDVALUE(contactFor.PrefTimeEnd);
							END IF;
							
							FOR phoneFor AS inRef.FIXferRevRq.FIXferInfo.Receiver.PersonInfo.[COUNTER_EMPLOYMENT].OrgInfo.CompositeContactInfo.ContactInfo.PhoneNum[] DO		
								CREATE LASTCHILD OF contactInfo AS general NAMESPACE ca NAME 'PhoneNum';
								
								SET general.ca:PhoneType		=	phoneFor.PhoneType;
								SET general.ca:Phone			=	phoneFor.Phone;
								SET general.ca:PhoneCode		=	phoneFor.PhoneCode;
								SET general.ca:PhoneOperName	=	phoneFor.PhoneOperName;								
							END FOR;
							
							SET contactInfo.ca:ContactName		=	contactFor.ContactName;
							SET contactInfo.ca:EmailAddr		=	contactFor.EmailAddr;
							SET contactInfo.ca:URL				=	contactFor.URL;
							
							FOR contactDataFor AS inRef.FIXferRevRq.FIXferInfo.Receiver.PersonInfo.[COUNTER_EMPLOYMENT].OrgInfo.CompositeContactInfo.ContactInfo.ContactData[] DO
								CREATE LASTCHILD OF contactInfo AS general NAMESPACE ca NAME 'ContactData';
								
								SET general.ca:ContactType		=	contactDataFor.ContactType;
								SET general.ca:ContactValue		=	contactDataFor.ContactValue;
								
								IF FIELDVALUE(contactDataFor.PrefTimeStart) <> '' THEN
									SET general.ca:PrefTimeStart	=	FIELDVALUE(contactDataFor.PrefTimeStart);
								END IF;
								
								IF FIELDVALUE(contactDataFor.PrefTimeEnd) <> '' THEN	
									SET general.ca:PrefTimeEnd		=	FIELDVALUE(contactDataFor.PrefTimeEnd);
								END IF;	
							END FOR;
							
							FOR postAddrFor AS inRef.FIXferRevRq.FIXferInfo.Receiver.PersonInfo.[COUNTER_EMPLOYMENT].OrgInfo.CompositeContactInfo.ContactInfo.PostAddr[] DO
								CREATE LASTCHILD OF contactInfo AS general NAMESPACE ca NAME 'PostAddr';
								
								SET general.ca:Addr1			=	postAddrFor.Addr1;
								SET general.ca:Addr2			=	postAddrFor.Addr2;
								SET general.ca:Addr3			=	postAddrFor.Addr3;
								SET general.ca:Addr4			=	postAddrFor.Addr4;
								SET general.ca:City				=	postAddrFor.City;
								SET general.ca:CityCode			=	postAddrFor.CityCode;
								SET general.ca:StateProv		=	postAddrFor.StateProv;
								SET general.ca:StateProvCode	=	postAddrFor.StateProvCode;
								SET general.ca:Area				=	postAddrFor.Area;
								SET general.ca:AreaCode			=	postAddrFor.AreaCode;
								SET general.ca:PostalCode		=	postAddrFor.PostalCode;
								SET general.ca:Country		    =	postAddrFor.Country;
								SET general.ca:CountryCode	    =	postAddrFor.CountryCode;
								SET general.ca:AddrType		    =	postAddrFor.AddrType;
								
								IF FIELDVALUE(postAddrFor.StartDt) <> '' THEN
									SET general.ca:StartDt		    =	SUBSTRING(FIELDVALUE(postAddrFor.StartDt) BEFORE 'T');
								END IF;
								
								IF FIELDVALUE(postAddrFor.EndDt) <> '' THEN
									SET general.ca:EndDt		    =	SUBSTRING(FIELDVALUE(postAddrFor.EndDt) BEFORE 'T');
								END IF;	
								SET general.ca:DistrictCode	    =	postAddrFor.DistrictCode;
								SET general.ca:District		    =	postAddrFor.District;
								SET general.ca:PlaceCode	    =	postAddrFor.PlaceCode;
								SET general.ca:Place		    =	postAddrFor.Place;
								SET general.ca:StreetCode	    =	postAddrFor.StreetCode;
								SET general.ca:Street		    =	postAddrFor.Street;
								SET general.ca:House		    =	postAddrFor.House;
								SET general.ca:Corpus		    =	postAddrFor.Corpus;
								SET general.ca:Building		    =	postAddrFor.Building;
								SET general.ca:Flat			    =	postAddrFor.Flat;
								SET general.ca:Office		    =	postAddrFor.Office;
								SET general.ca:RusKLADR	   	 	=	postAddrFor.RusKLADR;
								SET general.ca:AddrStatus	    =	postAddrFor.AddrStatus;
							END FOR;
							
							SET contactInfo.ca:ProviderCode				=	contactFor.ProviderCode;
							
						END FOR;						
												
					END FOR;
					
					DECLARE licensesInfo REFERENCE TO orgInfo;
					CREATE LASTCHILD OF orgInfo AS licensesInfo NAMESPACE orgs NAME 'Licenses';
					DECLARE licenseInfo REFERENCE TO orgInfo;
					
					FOR licenseFor AS inRef.FIXferRevRq.FIXferInfo.Receiver.PersonInfo.[COUNTER_EMPLOYMENT].OrgInfo.Licenses.LicenseInfo[] DO
						CREATE LASTCHILD OF licensesInfo AS licenseInfo NAMESPACE orgs NAME 'LicenseInfo';
						
						SET licenseInfo.orgs:LicenseType	=	licenseFor.LicenseType;
						SET licenseInfo.orgs:LicenseStatus	=	licenseFor.LicenseStatus;
						SET licenseInfo.orgs:LicenseSerie	=	licenseFor.LicenseSerie;
						SET licenseInfo.orgs:LicenseNum		=	licenseFor.LicenseNum;
						SET licenseInfo.orgs:LicenseIssueDt	=	licenseFor.LicenseIssueDt;
						SET licenseInfo.orgs:LicenseIssueBy	=	licenseFor.LicenseIssueBy;
						
					END FOR;
										
					SET orgInfo.orgs:TINInfo.ca:TINType 			=	orgFor.TINInfo.TINType;
					SET orgInfo.orgs:TINInfo.ca:TaxId	 			=	orgFor.TINInfo.TaxId;
					SET orgInfo.orgs:TINInfo.ca:CertCode 			=	orgFor.TINInfo.CertCode;	
					
					SET orgInfo.orgs:KIOInfo.ca:TINType 			=	orgFor.KIOInfo.TINType;
					SET orgInfo.orgs:KIOInfo.ca:TaxId	 			=	orgFor.KIOInfo.TaxId;
					SET orgInfo.orgs:KIOInfo.ca:CertCode 			=	orgFor.KIOInfo.CertCode;
					
					SET orgInfo.orgs:EstablishDt		 			=	orgFor.EstablishDt;
					SET orgInfo.orgs:NumEmployees		 			=	orgFor.NumEmployees;
					SET orgInfo.orgs:EmployerCode		 			=	orgFor.EmployerCode;
					
				END FOR;
				
				SET employment.ind:Occupation			=	inRef.FIXferRevRq.FIXferInfo.Receiver.PersonInfo.[COUNTER_EMPLOYMENT].Occupation;	 	
				
				SET employment.ind:Income.ca:Amt			=	inRef.FIXferRevRq.FIXferInfo.Receiver.PersonInfo.[COUNTER_EMPLOYMENT].Income.Amt;
				SET employment.ind:Income.ca:Reversal		=	inRef.FIXferRevRq.FIXferInfo.Receiver.PersonInfo.[COUNTER_EMPLOYMENT].Income.Reversal;
				SET employment.ind:Income.ca:CurCode		=	inRef.FIXferRevRq.FIXferInfo.Receiver.PersonInfo.[COUNTER_EMPLOYMENT].Income.CurCode;	
				SET employment.ind:Income.ca:CurRate		=	inRef.FIXferRevRq.FIXferInfo.Receiver.PersonInfo.[COUNTER_EMPLOYMENT].Income.CurRate;
				SET employment.ind:Income.ca:CurConvertRule	=	inRef.FIXferRevRq.FIXferInfo.Receiver.PersonInfo.[COUNTER_EMPLOYMENT].Income.CurConvertRule; 	
				
				SET employment.ind:JobTitle			=	inRef.FIXferRevRq.FIXferInfo.Receiver.PersonInfo.[COUNTER_EMPLOYMENT].JobTitle;
				
				IF FIELDVALUE(inRef.FIXferRevRq.FIXferInfo.Receiver.PersonInfo.[COUNTER_EMPLOYMENT].StartDt) <> '' THEN	 
					SET employment.ind:StartDt			=	SUBSTRING(FIELDVALUE(inRef.FIXferRevRq.FIXferInfo.Receiver.PersonInfo.[COUNTER_EMPLOYMENT].StartDt) BEFORE 'T');
				END IF;
				
				IF FIELDVALUE(inRef.FIXferRevRq.FIXferInfo.Receiver.PersonInfo.[COUNTER_EMPLOYMENT].EndDt) <> '' THEN
					SET employment.ind:EndDt				=	SUBSTRING(FIELDVALUE(inRef.FIXferRevRq.FIXferInfo.Receiver.PersonInfo.[COUNTER_EMPLOYMENT].EndDt) BEFORE 'T');			
				END IF;
			END IF;
							
			SET COUNTER_EMPLOYMENT = COUNTER_EMPLOYMENT + 1;
		END WHILE;	
		
		IF FIELDVALUE(inRef.FIXferRevRq.FIXferInfo.Receiver.PersonInfo.Gender) <> '' THEN
			SET personInfo.ind:Gender							=  FIELDVALUE(inRef.FIXferRevRq.FIXferInfo.Receiver.PersonInfo.Gender);
		END IF;
		
		IF FIELDVALUE(inRef.FIXferRevRq.FIXferInfo.Receiver.PersonInfo.MaritalStatus) <> '' THEN
			SET personInfo.ind:MaritalStatus					=  FIELDVALUE(inRef.FIXferRevRq.FIXferInfo.Receiver.PersonInfo.MaritalStatus);
		END IF;	
		SET personInfo.ind:USAMilitaryRank					=  inRef.FIXferRevRq.FIXferInfo.Receiver.PersonInfo.USAMilitaryRank;
		SET personInfo.ind:Dependets						=  inRef.FIXferRevRq.FIXferInfo.Receiver.PersonInfo.Dependets;
		
		IF EXISTS(inRef.FIXferRevRq.FIXferInfo.Receiver.PersonInfo.Passport[]) THEN
			SET personInfo.ind:Passport.ind:PassportNumber		=  COALESCE(inRef.FIXferRevRq.FIXferInfo.Receiver.PersonInfo.Passport.PassportNumber,NULL);
			SET personInfo.ind:Passport.ind:DocSeries			=  COALESCE(inRef.FIXferRevRq.FIXferInfo.Receiver.PersonInfo.Passport.DocSeries, NULL);
			SET personInfo.ind:Passport.ind:PassportCountry		=  COALESCE(inRef.FIXferRevRq.FIXferInfo.Receiver.PersonInfo.Passport.PassportCountry, NULL);
			SET personInfo.ind:Passport.ind:IssueLoc			=  COALESCE(inRef.FIXferRevRq.FIXferInfo.Receiver.PersonInfo.Passport.IssueLoc, NULL);
			
			IF FIELDVALUE(inRef.FIXferRevRq.FIXferInfo.Receiver.PersonInfo.Passport.IssDt) <> '' THEN
				SET personInfo.ind:Passport.ind:IssDt				=  SUBSTRING(FIELDVALUE(inRef.FIXferRevRq.FIXferInfo.Receiver.PersonInfo.Passport.IssDt) BEFORE 'T');
			END IF;
			
			IF FIELDVALUE(inRef.FIXferRevRq.FIXferInfo.Receiver.PersonInfo.Passport.ExpDt) <> '' THEN
				SET personInfo.ind:Passport.ind:ExpDt				=  SUBSTRING(FIELDVALUE(inRef.FIXferRevRq.FIXferInfo.Receiver.PersonInfo.Passport.ExpDt) BEFORE 'T');
			END IF;
		END IF;
		
		SET personInfo.ind:OEDCode							=  inRef.FIXferRevRq.FIXferInfo.Receiver.PersonInfo.OEDCode;
		SET personInfo.ind:"OEDInstitution_Type"			=  inRef.FIXferRevRq.FIXferInfo.Receiver.PersonInfo."OEDInstitution_Type";
		
		IF EXISTS(inRef.FIXferRevRq.FIXferInfo.Receiver.PersonInfo.GovIssueIdent[]) THEN
			SET personInfo.ind:GovIssueIdent.ind:GovIssueIdentType	=  COALESCE(inRef.FIXferRevRq.FIXferInfo.Receiver.PersonInfo.GovIssueIdent.GovIssueIdentType, NULL);
			SET personInfo.ind:GovIssueIdent.ind:IdentSerialNum  	=  COALESCE(inRef.FIXferRevRq.FIXferInfo.Receiver.PersonInfo.GovIssueIdent.IdentSerialNum, NULL);
			SET personInfo.ind:GovIssueIdent.ind:GovOrg			 	=  COALESCE(inRef.FIXferRevRq.FIXferInfo.Receiver.PersonInfo.GovIssueIdent.GovOrg, NULL);
			SET personInfo.ind:GovIssueIdent.ind:GovOrgName		 	=  COALESCE(inRef.FIXferRevRq.FIXferInfo.Receiver.PersonInfo.GovIssueIdent.GovOrgName, NULL);
			SET personInfo.ind:GovIssueIdent.ind:GovRank		  	=  COALESCE(inRef.FIXferRevRq.FIXferInfo.Receiver.PersonInfo.GovIssueIdent.GovRank, NULL);
			SET personInfo.ind:GovIssueIdent.ind:StateProv		 	=  COALESCE(inRef.FIXferRevRq.FIXferInfo.Receiver.PersonInfo.GovIssueIdent.StateProv, NULL);
			SET personInfo.ind:GovIssueIdent.ind:Country		 	=  COALESCE(inRef.FIXferRevRq.FIXferInfo.Receiver.PersonInfo.GovIssueIdent.Country, NULL);
			SET personInfo.ind:GovIssueIdent.ind:Desc			  	=  COALESCE(inRef.FIXferRevRq.FIXferInfo.Receiver.PersonInfo.GovIssueIdent.Desc, NULL);
			
			IF FIELDVALUE(inRef.FIXferRevRq.FIXferInfo.Receiver.PersonInfo.GovIssueIdent.IssDt) <> '' THEN
				SET personInfo.ind:GovIssueIdent.ind:IssDt			  	=  SUBSTRING(FIELDVALUE(inRef.FIXferRevRq.FIXferInfo.Receiver.PersonInfo.GovIssueIdent.IssDt) BEFORE 'T');			
			END IF;
			
			IF FIELDVALUE(inRef.FIXferRevRq.FIXferInfo.Receiver.PersonInfo.GovIssueIdent.ExpDt) <> '' THEN
				SET personInfo.ind:GovIssueIdent.ind:ExpDt			  	=  SUBSTRING(FIELDVALUE(inRef.FIXferRevRq.FIXferInfo.Receiver.PersonInfo.GovIssueIdent.ExpDt) BEFORE 'T');
			END IF;
			
			SET personInfo.ind:GovIssueIdent.ind:IdentSerie		  	=  COALESCE(inRef.FIXferRevRq.FIXferInfo.Receiver.PersonInfo.GovIssueIdent.IdentSerie, NULL);
			SET personInfo.ind:GovIssueIdent.ind:GovOrgUnit		  	=  COALESCE(inRef.FIXferRevRq.FIXferInfo.Receiver.PersonInfo.GovIssueIdent.GovOrgUnit, NULL);
		END IF;
		
		IF EXISTS(inRef.FIXferRevRq.FIXferInfo.Receiver.PersonInfo.OtherIdentDoc[]) THEN
			SET personInfo.ind:OtherIdentDoc.ind:Desc			  	=  COALESCE(inRef.FIXferRevRq.FIXferInfo.Receiver.PersonInfo.OtherIdentDoc.Desc, NULL);
			SET personInfo.ind:OtherIdentDoc.ind:IdentSerialNum  	=  COALESCE(inRef.FIXferRevRq.FIXferInfo.Receiver.PersonInfo.OtherIdentDoc.IdentSerialNum, NULL);
			SET personInfo.ind:OtherIdentDoc.ind:Issuer			 	=  COALESCE(inRef.FIXferRevRq.FIXferInfo.Receiver.PersonInfo.OtherIdentDoc.Issuer, NULL);
			SET personInfo.ind:OtherIdentDoc.ind:IssueLoc		  	=  COALESCE(inRef.FIXferRevRq.FIXferInfo.Receiver.PersonInfo.OtherIdentDoc.IssueLoc, NULL);
			
			IF FIELDVALUE(inRef.FIXferRevRq.FIXferInfo.Receiver.PersonInfo.OtherIdentDoc.IssDt) <> '' THEN
				SET personInfo.ind:OtherIdentDoc.ind:IssDt			 	=  SUBSTRING(FIELDVALUE(inRef.FIXferRevRq.FIXferInfo.Receiver.PersonInfo.OtherIdentDoc.IssDt) BEFORE 'T');
			END IF;
			
			IF FIELDVALUE(inRef.FIXferRevRq.FIXferInfo.Receiver.PersonInfo.OtherIdentDoc.ExpDt) <> '' THEN
				SET personInfo.ind:OtherIdentDoc.ind:ExpDt			  	=  SUBSTRING(FIELDVALUE(inRef.FIXferRevRq.FIXferInfo.Receiver.PersonInfo.OtherIdentDoc.ExpDt) BEFORE 'T');
			END IF;
		END IF;
		
		DECLARE identityCards REFERENCE TO personInfo;
		DECLARE identityCard REFERENCE TO identityCards;
		CREATE LASTCHILD OF personInfo AS identityCards NAMESPACE ind NAME 'IdentityCards';
		
		FOR identityFor AS inRef.FIXferRevRq.FIXferInfo.Receiver.PersonInfo.IdentityCards.IdentityCard[] DO
			
			CREATE LASTCHILD OF identityCards AS identityCard NAMESPACE ind NAME 'IdentityCard';
			
			SET identityCard.ind:IdType				=	identityFor.IdType;
			SET identityCard.ind:IdStatus			=	identityFor.IdStatus;
			SET identityCard.ind:IdSeries			=	identityFor.IdSeries;
			SET identityCard.ind:IdNum				=	identityFor.IdNum;
			
			IF FIELDVALUE(identityFor.IssueDt) <> '' THEN
				SET identityCard.ind:IssueDt			=	FIELDVALUE(identityFor.IssueDt);
			END IF;
				
			SET identityCard.ind:IssuedBy			=	identityFor.IssuedBy;
			SET identityCard.ind:Code				=	identityFor.Code;
			SET identityCard.ind:IssueLoc			=	identityFor.IssueLoc;
			SET identityCard.ind:IssuedCountry		=	identityFor.IssuedCountry;
			
			IF FIELDVALUE(identityFor.IssuedRegionCode) <> '' THEN
				SET identityCard.ind:IssuedRegionCode	=	SUBSTRING(FIELDVALUE(identityFor.IssuedRegionCode) BEFORE 'T');
			END IF;	
			
			IF FIELDVALUE(identityFor.ExpDt) <> '' THEN
				SET identityCard.ind:ExpDt				=	SUBSTRING(FIELDVALUE(identityFor.ExpDt) BEFORE 'T');
			END IF;		
		END FOR;
		
		SET personInfo.ind:BirthPlace			  	=  inRef.FIXferRevRq.FIXferInfo.Receiver.PersonInfo.BirthPlace;
		SET personInfo.ind:Resident				  	=  inRef.FIXferRevRq.FIXferInfo.Receiver.PersonInfo.Resident;
		SET personInfo.ind:MilitaryDocFlag		  	=  inRef.FIXferRevRq.FIXferInfo.Receiver.PersonInfo.MilitaryDocFlag;
		SET personInfo.ind:Citizenship			  	=  inRef.FIXferRevRq.FIXferInfo.Receiver.PersonInfo.Citizenship;
		
		SET fixferInfo.mtblitz:OrigDt				=  inRef.FIXferRevRq.FIXferInfo.OrigDt;
		SET fixferInfo.mtblitz:FIXferId				=  inRef.FIXferRevRq.FIXferInfo.FIXferId;
		
		DECLARE subFields REFERENCE TO fixferInfo;
		CREATE LASTCHILD OF fixferInfo AS subFields NAMESPACE mtblitz NAME 'SettlementInfo';
		
		SET subFields.mtblitz:ReceiveCurCode		=   inRef.FIXferRevRq.FIXferInfo.SettlementInfo.ReceiveCurCode;
		SET subFields.mtblitz:ReceiveAmtEst 		=   inRef.FIXferRevRq.FIXferInfo.SettlementInfo.ReceiveAmtEst;
		SET subFields.mtblitz:SendAmt				=   inRef.FIXferRevRq.FIXferInfo.SettlementInfo.SendAmt;
		SET subFields.mtblitz:SendCurCode			=   inRef.FIXferRevRq.FIXferInfo.SettlementInfo.SendCurCode;
		
		RETURN TRUE;
	END;			
END MODULE;
/* 4-ый сервис */


/* 5-ый сервис */
CREATE COMPUTE MODULE RequestForKolibri_ConvertMDO2CRM_KZSrvBLMoneyTransferAcknowledgmentRq
	CREATE FUNCTION Main() RETURNS BOOLEAN
	BEGIN
	    CALL CopyMessageHeaders(InputRoot,OutputRoot);
		
		DECLARE verMemo CHARACTER;
		
		DECLARE inRef REFERENCE TO InputRoot.XMLNSC.[<];
		DECLARE outRef REFERENCE TO OutputRoot.XMLNSC.*[<];
				
	    SET OutputRoot.MQMD.ReplyToQ	= 'ESB.QPRAGMA.OUT';
	    SET OutputRoot.MQMD.ReplyToQMgr	= 'IKAZ.ESB.OUT.GW1';				
				
		CREATE LASTCHILD OF OutputRoot DOMAIN('XMLNSC') NAME 'XMLNSC';
		CREATE LASTCHILD OF OutputRoot.XMLNSC AS outRef NAMESPACE mtblitz NAME 'FIXferAdviseRq'; 
		
    	SET OutputRoot.XMLNSC.mtblitz:FIXferAdviseRq.(XMLNSC.NamespaceDecl)xmlns:iam = iam;
		SET OutputRoot.XMLNSC.mtblitz:FIXferAdviseRq.(XMLNSC.NamespaceDecl)xmlns:mt = mt;		
    	SET OutputRoot.XMLNSC.mtblitz:FIXferAdviseRq.(XMLNSC.NamespaceDecl)xmlns:ca  = ca; 
		SET OutputRoot.XMLNSC.mtblitz:FIXferAdviseRq.(XMLNSC.NamespaceDecl)xmlns:mtblitz = mtblitz; 	
    	SET OutputRoot.XMLNSC.mtblitz:FIXferAdviseRq.(XMLNSC.NamespaceDecl)xmlns:ind = ind; 
		
		SET outRef.mt:RqUID			= inRef.RqUID;
		SET outRef.mt:RqTm			= convertFromQPtoKOLI(inRef.RqTm);
		SET outRef.mt:SPName		= 'urn:sbrfsystems:98-abs';
		SET outRef.mt:OperName		= 'SrvBLMoneyTransferAcknowledgment';
       
    	DECLARE userInfo REFERENCE TO outRef;
        
        CREATE LASTCHILD OF outRef AS userInfo NAMESPACE mtblitz NAME 'UserInfo'; 
        
        SET userInfo.iam:UserId			= inRef.FIXferAdviseRq.UserInfo.UserId; -- обязательное поле
        SET userInfo.iam:RegionId		= inRef.FIXferAdviseRq.UserInfo.RegionId; 
        SET userInfo.iam:FullName		= inRef.FIXferAdviseRq.UserInfo.FullName;
        
        /* userInfo.iam:PersonName */
        DECLARE personName REFERENCE TO userInfo;                	                
        
        IF EXISTS(inRef.FIXferAdviseRq.UserInfo.PersonName[]) THEN
        	CREATE LASTCHILD OF userInfo AS personName NAMESPACE iam NAME 'PersonName'; -- создаем PersonName с namespace iam внутри UserInfo            
        	CALL FillSomeField(inRef.FIXferAdviseRq.UserInfo.PersonName, personName, 'ind', 'LastName');
        END IF;
        
        SET personName.ind:FirstName = inRef.FIXferAdviseRq.UserInfo.PersonName.FirstName;
		
		IF EXISTS(inRef.FIXferRevRq.UserInfo.PersonName[]) THEN
			CALL FillSomeField(inRef.FIXferRevRq.UserInfo.PersonName, personName, 'ind', 'MiddleName');
		END IF;
        
        SET personName.ind:TitlePrefix 	= inRef.FIXferAdviseRq.UserInfo.PersonName.TitlePrefix;
        SET personName.ind:NameSuffix 	= inRef.FIXferAdviseRq.UserInfo.PersonName.NameSuffix;
        SET personName.ind:Nickname 	= inRef.FIXferAdviseRq.UserInfo.PersonName.Nickname;
        SET personName.ind:LegalName    = inRef.FIXferAdviseRq.UserInfo.PersonName.LegalName;
        /* userInfo.iam:PersonName */
              
		SET userInfo.iam:OrgId				= inRef.FIXferAdviseRq.UserInfo.OrgId;
		SET userInfo.iam:OrgName			= inRef.FIXferAdviseRq.UserInfo.OrgName;
		SET userInfo.iam:OrgUnitId			= inRef.FIXferAdviseRq.UserInfo.OrgUnitId;
		SET userInfo.iam:OrgUnitName		= inRef.FIXferAdviseRq.UserInfo.OrgUnitName;
		SET userInfo.iam:EmployeeId			= inRef.FIXferAdviseRq.UserInfo.EmployeeId;
		SET userInfo.iam:IpAddr				= inRef.FIXferAdviseRq.UserInfo.IpAddr;
		
		DECLARE COUNTER INTEGER 1;
		DECLARE ARRAY_USERINFO INTEGER CARDINALITY(inRef.FIXferAdviseRq.UserInfo.*[]);		
		
		/* userInfo.iam:CertInfo */
		DECLARE certInfo REFERENCE TO userInfo;
		
		WHILE COUNTER <= ARRAY_USERINFO DO
		
			IF FIELDNAME(inRef.FIXferAdviseRq.UserInfo.[COUNTER]) = 'CertInfo' THEN
				
				CREATE LASTCHILD OF userInfo AS certInfo NAMESPACE iam NAME 'CertInfo';
				
				SET certInfo.iam:X509SubjectName  =  FIELDVALUE(inRef.FIXferAdviseRq.UserInfo.[COUNTER].X509SubjectName);
				SET certInfo.iam:KeyName		  =  FIELDVALUE(inRef.FIXferAdviseRq.UserInfo.[COUNTER].KeyName);	
				SET certInfo.iam:RegionId		  =  FIELDVALUE(inRef.FIXferAdviseRq.UserInfo.[COUNTER].RegionId);				
				      
        		CALL FillSomeField(inRef.FIXferAdviseRq.UserInfo.[COUNTER], certInfo, 'iam', 'UserRole');
        		        		
        		SET certInfo.iam:Certificate		  =  FIELDVALUE(inRef.FIXferAdviseRq.UserInfo.[COUNTER].Certificate);
        		SET certInfo.iam:KeyValue			  =  FIELDVALUE(inRef.FIXferAdviseRq.UserInfo.[COUNTER].KeyValue); 
        		SET certInfo.iam:X509SerialNumber     =  FIELDVALUE(inRef.FIXferAdviseRq.UserInfo.[COUNTER].X509SerialNumber);
        		SET certInfo.iam:X509IssuerNumber     =  FIELDVALUE(inRef.FIXferAdviseRq.UserInfo.[COUNTER].X509IssuerNumber); 			
				SET certInfo.iam:X509IssuerSerial     =  FIELDVALUE(inRef.FIXferAdviseRq.UserInfo.[COUNTER].X509IssuerSerial);
				SET certInfo.iam:Version		      =  FIELDVALUE(inRef.FIXferAdviseRq.UserInfo.[COUNTER].Version);
				SET certInfo.iam:NotBefore		      =  FIELDVALUE(inRef.FIXferAdviseRq.UserInfo.[COUNTER].NotBefore);
				SET certInfo.iam:NotAfter			  =  FIELDVALUE(inRef.FIXferAdviseRq.UserInfo.[COUNTER].NotAfter);
				SET certInfo.iam:SigAlgName			  =  FIELDVALUE(inRef.FIXferAdviseRq.UserInfo.[COUNTER].SigAlgName);
				SET certInfo.iam:SigValue			  =  FIELDVALUE(inRef.FIXferAdviseRq.UserInfo.[COUNTER].SigValue);
				
				DECLARE COUNTER_CERTINFO INTEGER 1;
				DECLARE ARRAY_CERTINFO INTEGER CARDINALITY(inRef.FIXferAdviseRq.UserInfo.[COUNTER].*[]);
				DECLARE extensionInfo REFERENCE TO certInfo;
				
				WHILE COUNTER_CERTINFO <= ARRAY_CERTINFO DO
					IF FIELDNAME(inRef.FIXferAdviseRq.UserInfo.[COUNTER].[COUNTER_CERTINFO]) = 'Extension' THEN
						CREATE LASTCHILD OF certInfo AS extensionInfo NAMESPACE iam NAME 'Extension';
												
						SET extensionInfo.iam:ExtnId      = FIELDVALUE(inRef.FIXferAdviseRq.UserInfo.[COUNTER].[COUNTER_CERTINFO].ExtnId);
						SET extensionInfo.iam:Critical    = FIELDVALUE(inRef.FIXferAdviseRq.UserInfo.[COUNTER].[COUNTER_CERTINFO].Critical);
						SET extensionInfo.iam:ExtnValue   = FIELDVALUE(inRef.FIXferAdviseRq.UserInfo.[COUNTER].[COUNTER_CERTINFO].ExtnValue);												
					END IF;					
					SET COUNTER_CERTINFO = COUNTER_CERTINFO + 1;						
				END WHILE;
						
			END IF;
			
			SET COUNTER = COUNTER + 1;
			
		END WHILE;		
		/* userInfo.iam:CertInfo */
		
		/* FIXferInfo */
		DECLARE fixferInfo REFERENCE TO outRef;		
		CREATE LASTCHILD OF outRef AS fixferInfo NAMESPACE mtblitz NAME 'FIXferInfo';							
		
		/* RECEIVER */
		DECLARE receiver REFERENCE TO fixferInfo;
		CREATE LASTCHILD OF fixferInfo AS receiver NAMESPACE mtblitz NAME 'Receiver';
		
		/* BankInfo */
		DECLARE bankInfo REFERENCE TO receiver;
		CREATE LASTCHILD OF receiver AS bankInfo NAMESPACE mtblitz NAME 'BankInfo';
		
		SET bankInfo.mtblitz:BankId  =  inRef.FIXferAdviseRq.FIXferInfo.Receiver.BankInfo.BankId;
		SET bankInfo.mtblitz:Country =  inRef.FIXferAdviseRq.FIXferInfo.Receiver.BankInfo.Country; 
		SET bankInfo.mtblitz:City    =  inRef.FIXferAdviseRq.FIXferInfo.Receiver.BankInfo.City;		
		
		SET fixferInfo.mtblitz:OrigDt				=  inRef.FIXferAdviseRq.FIXferInfo.OrigDt;

		IF COALESCE(FIELDVALUE(inRef.FIXferAdviseRq.FIXferInfo.RegDt),'') <> '' THEN
			SET fixferInfo.mtblitz:RegDt			=  SUBSTRING(COALESCE(inRef.FIXferAdviseRq.FIXferInfo.RegDt, NULL) BEFORE 'T');
		END IF;
		
		SET fixferInfo.mtblitz:FIXferId				=  inRef.FIXferAdviseRq.FIXferInfo.FIXferId;
		DECLARE subFields REFERENCE TO fixferInfo;
		CREATE LASTCHILD OF fixferInfo AS subFields NAMESPACE mtblitz NAME 'SettlementInfo';
		
		SET subFields.mtblitz:ReceiveCurCode		=   inRef.FIXferAdviseRq.FIXferInfo.SettlementInfo.ReceiveCurCode;
		SET subFields.mtblitz:ReceiveAmtEst 		=   inRef.FIXferAdviseRq.FIXferInfo.SettlementInfo.ReceiveAmtEst;
		SET subFields.mtblitz:SendAmt				=   inRef.FIXferAdviseRq.FIXferInfo.SettlementInfo.SendAmt;
		SET subFields.mtblitz:SendCurCode			=   inRef.FIXferAdviseRq.FIXferInfo.SettlementInfo.SendCurCode;
		
		CREATE LASTCHILD OF fixferInfo AS subFields NAMESPACE mtblitz NAME 'FeeChargeAlloc';
		
		SET subFields.mtblitz:Fee.ca:FeeType					=	inRef.FIXferAdviseRq.FIXferInfo.FeeChargeAlloc.Fee.FeeType;
		
		SET subFields.mtblitz:Fee.ca:CurAmt.ca:Amt 						=	inRef.FIXferAdviseRq.FIXferInfo.FeeChargeAlloc.Fee.CurAmt.Amt;
		SET subFields.mtblitz:Fee.ca:CurAmt.ca:Reversal 				=	inRef.FIXferAdviseRq.FIXferInfo.FeeChargeAlloc.Fee.CurAmt.Reversal;
		SET subFields.mtblitz:Fee.ca:CurAmt.ca:CurCode					=	inRef.FIXferAdviseRq.FIXferInfo.FeeChargeAlloc.Fee.CurAmt.CurCode;
		SET subFields.mtblitz:Fee.ca:CurAmt.ca:CurRate	 				=	inRef.FIXferAdviseRq.FIXferInfo.FeeChargeAlloc.Fee.CurAmt.CurRate;
		SET subFields.mtblitz:Fee.ca:CurAmt.ca:CurConvertRule	 		=	inRef.FIXferAdviseRq.FIXferInfo.FeeChargeAlloc.Fee.CurAmt.CurConvertRule;
		
		SET subFields.mtblitz:Fee.ca:Rate								=	inRef.FIXferAdviseRq.FIXferInfo.FeeChargeAlloc.Fee.Rate;
		
		IF EXISTS(inRef.FIXferAdviseRq.FIXferInfo.FeeChargeAlloc.Fee.MinCurAmt[]) THEN
			SET subFields.mtblitz:Fee.ca:MinCurAmt.ca:Amt 					=	COALESCE(inRef.FIXferAdviseRq.FIXferInfo.FeeChargeAlloc.Fee.MinCurAmt.Amt, NULL);
			SET subFields.mtblitz:Fee.ca:MinCurAmt.ca:Reversal 				=	COALESCE(inRef.FIXferAdviseRq.FIXferInfo.FeeChargeAlloc.Fee.MinCurAmt.Reversal, NULL);
			SET subFields.mtblitz:Fee.ca:MinCurAmt.ca:CurCode				=	COALESCE(inRef.FIXferAdviseRq.FIXferInfo.FeeChargeAlloc.Fee.MinCurAmt.CurCode, NULL);
			SET subFields.mtblitz:Fee.ca:MinCurAmt.ca:CurRate	 			=	COALESCE(inRef.FIXferAdviseRq.FIXferInfo.FeeChargeAlloc.Fee.MinCurAmt.CurRate, NULL);
			SET subFields.mtblitz:Fee.ca:MinCurAmt.ca:CurConvertRule	 	=	COALESCE(inRef.FIXferAdviseRq.FIXferInfo.FeeChargeAlloc.Fee.MinCurAmt.CurConvertRule, NULL);
		END IF;
		
		IF EXISTS(inRef.FIXferAdviseRq.FIXferInfo.FeeChargeAlloc.Fee.MaxCurAmt[]) THEN
			SET subFields.mtblitz:Fee.ca:MaxCurAmt.ca:Amt 					=	COALESCE(inRef.FIXferAdviseRq.FIXferInfo.FeeChargeAlloc.Fee.MaxCurAmt.Amt, NULL);
			SET subFields.mtblitz:Fee.ca:MaxCurAmt.ca:Reversal 				=	COALESCE(inRef.FIXferAdviseRq.FIXferInfo.FeeChargeAlloc.Fee.MaxCurAmt.Reversal, NULL);
			SET subFields.mtblitz:Fee.ca:MaxCurAmt.ca:CurCode				=	COALESCE(inRef.FIXferAdviseRq.FIXferInfo.FeeChargeAlloc.Fee.MaxCurAmt.CurCode, NULL);
			SET subFields.mtblitz:Fee.ca:MaxCurAmt.ca:CurRate	 			=	COALESCE(inRef.FIXferAdviseRq.FIXferInfo.FeeChargeAlloc.Fee.MaxCurAmt.CurRate, NULL);
			SET subFields.mtblitz:Fee.ca:MaxCurAmt.ca:CurConvertRule	 	=	COALESCE(inRef.FIXferAdviseRq.FIXferInfo.FeeChargeAlloc.Fee.MaxCurAmt.CurConvertRule, NULL);
		END IF;
		
		SET subFields.mtblitz:Fee.ca:RateType							=	inRef.FIXferAdviseRq.FIXferInfo.FeeChargeAlloc.Fee.RateType;
		
		IF EXISTS(inRef.FIXferAdviseRq.FIXferInfo.Confirmation[]) THEN
			CREATE LASTCHILD OF fixferInfo AS subFields NAMESPACE mtblitz NAME 'Confirmation';
		
			SET subFields.mtblitz:Confirmed					=	inRef.FIXferAdviseRq.FIXferInfo.Confirmation.Confirmed;	

			IF COALESCE(FIELDVALUE(inRef.FIXferAdviseRq.FIXferInfo.Confirmation.ConfDt),'') <> '' THEN       
				SET subFields.mtblitz:ConfDt			=  SUBSTRING(COALESCE(inRef.FIXferAdviseRq.FIXferInfo.Confirmation.ConfDt, NULL) BEFORE 'T');
			END IF;
			
			--SET subFields.mtblitz:Memo						=	inRef.FIXferAdviseRq.FIXferInfo.Confirmation.Memo;
			SET subFields.mtblitz:Memo						=	REPLACE(inRef.FIXferAdviseRq.FIXferInfo.Confirmation.Memo, '"', '&#34');
		END IF;
		
		/* FIXferOperInfo */
		DECLARE fixferOperation REFERENCE TO outRef;
		
		CREATE LASTCHILD OF outRef AS fixferOperation NAMESPACE mtblitz NAME 'FIXferOperInfo'; 
		
		SET fixferOperation.mtblitz:OperType	=	inRef.FIXferAdviseRq.FIXferOperInfo.OperType;

		IF COALESCE(FIELDVALUE(inRef.FIXferAdviseRq.FIXferOperInfo.OperDt),'') <> '' THEN       
			SET fixferOperation.mtblitz:OperDt			=  SUBSTRING(COALESCE(inRef.FIXferAdviseRq.FIXferOperInfo.OperDt, NULL) BEFORE 'T');
		END IF;
		
		SET fixferOperation.mtblitz:OperId		=	inRef.FIXferAdviseRq.FIXferOperInfo.OperId;
		SET fixferOperation.mtblitz:OperUID		=	inRef.FIXferAdviseRq.FIXferOperInfo.OperUID;
		SET fixferOperation.mtblitz:OperStatus	=	inRef.FIXferAdviseRq.FIXferOperInfo.OperStatus;
		---SET fixferOperation.mtblitz:Memo		=	inRef.FIXferAdviseRq.FIXferOperInfo.Memo;
		SET fixferOperation.mtblitz:Memo		=	REPLACE(inRef.FIXferAdviseRq.FIXferOperInfo.Memo, '"', '&#34');
		
		DECLARE operInfo REFERENCE TO fixferOperation;
		
		CREATE LASTCHILD OF fixferOperation AS operInfo NAMESPACE mtblitz NAME 'OperatorInfo';		
        
        SET operInfo.iam:UserId			= inRef.FIXferAdviseRq.FIXferOperInfo.OperatorInfo.UserId; -- обязательное поле
        SET operInfo.iam:RegionId		= inRef.FIXferAdviseRq.FIXferOperInfo.OperatorInfo.RegionId; 
        SET operInfo.iam:FullName		= inRef.FIXferAdviseRq.FIXferOperInfo.OperatorInfo.FullName;
        
        /* userInfo.iam:PersonName */
        
        IF EXISTS(inRef.FIXferAdviseRq.FIXferOperInfo.OperatorInfo.PersonName[]) THEN
        	CREATE LASTCHILD OF operInfo AS personName NAMESPACE iam NAME 'PersonName'; -- создаем PersonName с namespace iam внутри UserInfo            
        	CALL FillSomeField(inRef.FIXferAdviseRq.FIXferOperInfo.OperatorInfo.PersonName, personName, 'ind', 'LastName');
        END IF;
        
        SET personName.ind:FirstName = inRef.FIXferAdviseRq.FIXferOperInfo.OperatorInfo.PersonName.FirstName;
		
		IF EXISTS(inRef.FIXferRevRq.FIXferOperInfo.OperatorInfo.PersonName[]) THEN
			CALL FillSomeField(inRef.FIXferRevRq.FIXferOperInfo.OperatorInfo.PersonName, personName, 'ind', 'MiddleName');
		END IF;
        
        SET personName.ind:TitlePrefix 	= inRef.FIXferAdviseRq.FIXferOperInfo.OperatorInfo.PersonName.TitlePrefix;
        SET personName.ind:NameSuffix 	= inRef.FIXferAdviseRq.FIXferOperInfo.OperatorInfo.PersonName.NameSuffix;
        SET personName.ind:Nickname 	= inRef.FIXferAdviseRq.FIXferOperInfo.OperatorInfo.PersonName.Nickname;
        SET personName.ind:LegalName    = inRef.FIXferAdviseRq.FIXferOperInfo.OperatorInfo.PersonName.LegalName;
        /* userInfo.iam:PersonName */
              
		SET operInfo.iam:OrgId				= inRef.FIXferAdviseRq.FIXferOperInfo.OperatorInfo.OrgId;
		SET operInfo.iam:OrgName			= inRef.FIXferAdviseRq.FIXferOperInfo.OperatorInfo.OrgName;
		SET operInfo.iam:OrgUnitId			= inRef.FIXferAdviseRq.FIXferOperInfo.OperatorInfo.OrgUnitId;
		SET operInfo.iam:OrgUnitName		= inRef.FIXferAdviseRq.FIXferOperInfo.OperatorInfo.OrgUnitName;
		SET operInfo.iam:EmployeeId			= inRef.FIXferAdviseRq.FIXferOperInfo.OperatorInfo.EmployeeId;
		SET operInfo.iam:IpAddr				= inRef.FIXferAdviseRq.FIXferOperInfo.OperatorInfo.IpAddr;
		
		SET COUNTER = 1;
		SET ARRAY_USERINFO = CARDINALITY(inRef.FIXferAdviseRq.FIXferOperInfo.OperatorInfo.*[]);		
		
		/* userInfo.iam:CertInfo */
		--DECLARE certInfo REFERENCE TO operInfo;
		
		WHILE COUNTER <= ARRAY_USERINFO DO
		
			IF FIELDNAME(inRef.FIXferAdviseRq.FIXferOperInfo.OperatorInfo.[COUNTER]) = 'CertInfo' THEN
				
				CREATE LASTCHILD OF operInfo AS certInfo NAMESPACE iam NAME 'CertInfo';
				
				SET certInfo.iam:X509SubjectName  =  FIELDVALUE(inRef.FIXferAdviseRq.FIXferOperInfo.OperatorInfo.[COUNTER].X509SubjectName);
				SET certInfo.iam:KeyName		  =  FIELDVALUE(inRef.FIXferAdviseRq.FIXferOperInfo.OperatorInfo.[COUNTER].KeyName);	
				SET certInfo.iam:RegionId		  =  FIELDVALUE(inRef.FIXferAdviseRq.FIXferOperInfo.OperatorInfo.[COUNTER].RegionId);				
				      
        		CALL FillSomeField(inRef.FIXferAdviseRq.FIXferOperInfo.OperatorInfo.[COUNTER], certInfo, 'iam', 'UserRole');
        		        		
        		SET certInfo.iam:Certificate		  =  FIELDVALUE(inRef.FIXferAdviseRq.FIXferOperInfo.OperatorInfo.[COUNTER].Certificate);
        		SET certInfo.iam:KeyValue			  =  FIELDVALUE(inRef.FIXferAdviseRq.FIXferOperInfo.OperatorInfo.[COUNTER].KeyValue); 
        		SET certInfo.iam:X509SerialNumber     =  FIELDVALUE(inRef.FIXferAdviseRq.FIXferOperInfo.OperatorInfo.[COUNTER].X509SerialNumber);
        		SET certInfo.iam:X509IssuerNumber     =  FIELDVALUE(inRef.FIXferAdviseRq.FIXferOperInfo.OperatorInfo.[COUNTER].X509IssuerNumber); 			
				SET certInfo.iam:X509IssuerSerial     =  FIELDVALUE(inRef.FIXferAdviseRq.FIXferOperInfo.OperatorInfo.[COUNTER].X509IssuerSerial);
				SET certInfo.iam:Version		      =  FIELDVALUE(inRef.FIXferAdviseRq.FIXferOperInfo.OperatorInfo.[COUNTER].Version);
				SET certInfo.iam:NotBefore		      =  FIELDVALUE(inRef.FIXferAdviseRq.FIXferOperInfo.OperatorInfo.[COUNTER].NotBefore);
				SET certInfo.iam:NotAfter			  =  FIELDVALUE(inRef.FIXferAdviseRq.FIXferOperInfo.OperatorInfo.[COUNTER].NotAfter);
				SET certInfo.iam:SigAlgName			  =  FIELDVALUE(inRef.FIXferAdviseRq.FIXferOperInfo.OperatorInfo.[COUNTER].SigAlgName);
				SET certInfo.iam:SigValue			  =  FIELDVALUE(inRef.FIXferAdviseRq.FIXferOperInfo.OperatorInfo.[COUNTER].SigValue);
				
				DECLARE COUNTER_CERTINFO INTEGER 1;
				DECLARE ARRAY_CERTINFO INTEGER CARDINALITY(inRef.FIXferAdviseRq.FIXferOperInfo.OperatorInfo.[COUNTER].*[]);
				DECLARE extensionInfo REFERENCE TO certInfo;
				
				WHILE COUNTER_CERTINFO <= ARRAY_CERTINFO DO
					IF FIELDNAME(inRef.FIXferAdviseRq.FIXferOperInfo.OperatorInfo.[COUNTER].[COUNTER_CERTINFO]) = 'Extension' THEN
						CREATE LASTCHILD OF certInfo AS extensionInfo NAMESPACE iam NAME 'Extension';
												
						SET extensionInfo.iam:ExtnId      = FIELDVALUE(inRef.FIXferAdviseRq.FIXferOperInfo.OperatorInfo.[COUNTER].[COUNTER_CERTINFO].ExtnId);
						SET extensionInfo.iam:Critical    = FIELDVALUE(inRef.FIXferAdviseRq.FIXferOperInfo.OperatorInfo.[COUNTER].[COUNTER_CERTINFO].Critical);
						SET extensionInfo.iam:ExtnValue   = FIELDVALUE(inRef.FIXferAdviseRq.FIXferOperInfo.OperatorInfo.[COUNTER].[COUNTER_CERTINFO].ExtnValue);												
					END IF;					
					SET COUNTER_CERTINFO = COUNTER_CERTINFO + 1;						
				END WHILE;
						
			END IF;
			
			SET COUNTER = COUNTER + 1;
			
		END WHILE;		
		/* userInfo.iam:CertInfo */
		
		------------------------------------
        IF EXISTS(inRef.FIXferAdviseRq.FIXferOperInfo.ControllerInfo[]) THEN        	
			DECLARE controllerInfo REFERENCE TO fixferOperation;
			
			CREATE LASTCHILD OF fixferOperation AS controllerInfo NAMESPACE mtblitz NAME 'ControllerInfo';		
	        
	        SET controllerInfo.iam:UserId		= inRef.FIXferAdviseRq.FIXferOperInfo.ControllerInfo.UserId; -- обязательное поле
	        SET controllerInfo.iam:RegionId		= inRef.FIXferAdviseRq.FIXferOperInfo.ControllerInfo.RegionId; 
	        SET controllerInfo.iam:FullName		= inRef.FIXferAdviseRq.FIXferOperInfo.ControllerInfo.FullName;
	        
	        /* userInfo.iam:PersonName */
	        IF EXISTS(inRef.FIXferAdviseRq.FIXferOperInfo.ControllerInfo.PersonName[]) THEN
	        	CREATE LASTCHILD OF controllerInfo AS personName NAMESPACE iam NAME 'PersonName'; -- создаем PersonName с namespace iam внутри UserInfo            
	        	CALL FillSomeField(inRef.FIXferAdviseRq.FIXferOperInfo.ControllerInfo.PersonName, personName, 'ind', 'LastName');
	        END IF;
	        
	        SET personName.ind:FirstName = inRef.FIXferAdviseRq.FIXferOperInfo.ControllerInfo.PersonName.FirstName;
			
			IF EXISTS(inRef.FIXferRevRq.FIXferOperInfo.OperatorInfo.PersonName[]) THEN
				CALL FillSomeField(inRef.FIXferRevRq.FIXferOperInfo.OperatorInfo.PersonName, personName, 'ind', 'MiddleName');
			END IF;
	        
	        SET personName.ind:TitlePrefix 	= inRef.FIXferAdviseRq.FIXferOperInfo.ControllerInfo.PersonName.TitlePrefix;
	        SET personName.ind:NameSuffix 	= inRef.FIXferAdviseRq.FIXferOperInfo.ControllerInfo.PersonName.NameSuffix;
	        SET personName.ind:Nickname 	= inRef.FIXferAdviseRq.FIXferOperInfo.ControllerInfo.PersonName.Nickname;
	        SET personName.ind:LegalName    = inRef.FIXferAdviseRq.FIXferOperInfo.ControllerInfo.PersonName.LegalName;
	        /* userInfo.iam:PersonName */
	              
			SET controllerInfo.iam:OrgId				= inRef.FIXferAdviseRq.FIXferOperInfo.ControllerInfo.OrgId;
			SET controllerInfo.iam:OrgName				= inRef.FIXferAdviseRq.FIXferOperInfo.ControllerInfo.OrgName;
			SET controllerInfo.iam:OrgUnitId			= inRef.FIXferAdviseRq.FIXferOperInfo.ControllerInfo.OrgUnitId;
			SET controllerInfo.iam:OrgUnitName			= inRef.FIXferAdviseRq.FIXferOperInfo.controllerInfo.OrgUnitName;
			SET controllerInfo.iam:EmployeeId			= inRef.FIXferAdviseRq.FIXferOperInfo.ControllerInfo.EmployeeId;
			SET controllerInfo.iam:IpAddr				= inRef.FIXferAdviseRq.FIXferOperInfo.ControllerInfo.IpAddr;
			
			SET COUNTER = 1;
			SET ARRAY_USERINFO = CARDINALITY(inRef.FIXferAdviseRq.FIXferOperInfo.ControllerInfo.*[]);		
			
			/* userInfo.iam:CertInfo */
			--DECLARE certInfo REFERENCE TO operInfo;
			
			WHILE COUNTER <= ARRAY_USERINFO DO
			
				IF FIELDNAME(inRef.FIXferAdviseRq.FIXferOperInfo.ControllerInfo.[COUNTER]) = 'CertInfo' THEN
					
					CREATE LASTCHILD OF controllerInfo AS certInfo NAMESPACE iam NAME 'CertInfo';
					
					SET certInfo.iam:X509SubjectName  =  FIELDVALUE(inRef.FIXferAdviseRq.FIXferOperInfo.ControllerInfo.[COUNTER].X509SubjectName);
					SET certInfo.iam:KeyName		  =  FIELDVALUE(inRef.FIXferAdviseRq.FIXferOperInfo.ControllerInfo.[COUNTER].KeyName);	
					SET certInfo.iam:RegionId		  =  FIELDVALUE(inRef.FIXferAdviseRq.FIXferOperInfo.ControllerInfo.[COUNTER].RegionId);				
					      
	        		CALL FillSomeField(inRef.FIXferAdviseRq.FIXferOperInfo.ControllerInfo.[COUNTER], certInfo, 'iam', 'UserRole');
	        		        		
	        		SET certInfo.iam:Certificate		  =  FIELDVALUE(inRef.FIXferAdviseRq.FIXferOperInfo.ControllerInfo.[COUNTER].Certificate);
	        		SET certInfo.iam:KeyValue			  =  FIELDVALUE(inRef.FIXferAdviseRq.FIXferOperInfo.ControllerInfo.[COUNTER].KeyValue); 
	        		SET certInfo.iam:X509SerialNumber     =  FIELDVALUE(inRef.FIXferAdviseRq.FIXferOperInfo.ControllerInfo.[COUNTER].X509SerialNumber);
	        		SET certInfo.iam:X509IssuerNumber     =  FIELDVALUE(inRef.FIXferAdviseRq.FIXferOperInfo.ControllerInfo.[COUNTER].X509IssuerNumber); 			
					SET certInfo.iam:X509IssuerSerial     =  FIELDVALUE(inRef.FIXferAdviseRq.FIXferOperInfo.ControllerInfo.[COUNTER].X509IssuerSerial);
					SET certInfo.iam:Version		      =  FIELDVALUE(inRef.FIXferAdviseRq.FIXferOperInfo.ControllerInfo.[COUNTER].Version);
					SET certInfo.iam:NotBefore		      =  FIELDVALUE(inRef.FIXferAdviseRq.FIXferOperInfo.ControllerInfo.[COUNTER].NotBefore);
					SET certInfo.iam:NotAfter			  =  FIELDVALUE(inRef.FIXferAdviseRq.FIXferOperInfo.ControllerInfo.[COUNTER].NotAfter);
					SET certInfo.iam:SigAlgName			  =  FIELDVALUE(inRef.FIXferAdviseRq.FIXferOperInfo.ControllerInfo.[COUNTER].SigAlgName);
					SET certInfo.iam:SigValue			  =  FIELDVALUE(inRef.FIXferAdviseRq.FIXferOperInfo.ControllerInfo.[COUNTER].SigValue);
					
					DECLARE COUNTER_CERTINFO INTEGER 1;
					DECLARE ARRAY_CERTINFO INTEGER CARDINALITY(inRef.FIXferAdviseRq.FIXferOperInfo.ControllerInfo.[COUNTER].*[]);
					DECLARE extensionInfo REFERENCE TO certInfo;
					
					WHILE COUNTER_CERTINFO <= ARRAY_CERTINFO DO
						IF FIELDNAME(inRef.FIXferAdviseRq.FIXferOperInfo.ControllerInfo.[COUNTER].[COUNTER_CERTINFO]) = 'Extension' THEN
							CREATE LASTCHILD OF certInfo AS extensionInfo NAMESPACE iam NAME 'Extension';
													
							SET extensionInfo.iam:ExtnId      = FIELDVALUE(inRef.FIXferAdviseRq.FIXferOperInfo.ControllerInfo.[COUNTER].[COUNTER_CERTINFO].ExtnId);
							SET extensionInfo.iam:Critical    = FIELDVALUE(inRef.FIXferAdviseRq.FIXferOperInfo.ControllerInfo.[COUNTER].[COUNTER_CERTINFO].Critical);
							SET extensionInfo.iam:ExtnValue   = FIELDVALUE(inRef.FIXferAdviseRq.FIXferOperInfo.ControllerInfo.[COUNTER].[COUNTER_CERTINFO].ExtnValue);												
						END IF;					
						SET COUNTER_CERTINFO = COUNTER_CERTINFO + 1;						
					END WHILE;
							
				END IF;
				
				SET COUNTER = COUNTER + 1;
				
			END WHILE;		
			/* userInfo.iam:CertInfo */

        END IF;        	
		------------------------------------
		
		DECLARE confirmation REFERENCE TO fixferOperation;
		
		CREATE LASTCHILD OF fixferOperation AS confirmation NAMESPACE mtblitz NAME 'Confirmation';
		
		SET confirmation.mtblitz:Confirmed		=	inRef.FIXferAdviseRq.FIXferOperInfo.Confirmation.Confirmed;

		IF COALESCE(FIELDVALUE(inRef.FIXferAdviseRq.FIXferOperInfo.Confirmation.ConfDt),'') <> '' THEN       
			SET confirmation.mtblitz:ConfDt			=  SUBSTRING(COALESCE(inRef.FIXferAdviseRq.FIXferOperInfo.Confirmation.ConfDt, NULL) BEFORE 'T');
		END IF;
		
--		SET confirmation.mtblitz:Memo			=	inRef.FIXferAdviseRq.FIXferOperInfo.Confirmation.Memo;
		
		SET verMemo = REPLACE(inRef.FIXferAdviseRq.FIXferOperInfo.Confirmation.Memo, '"', '&#34');
		SET confirmation.mtblitz:Memo	        = verMemo;		
		
		---SET fixferOperation.mtblitz:SignedData	=	REPLACE(inRef.FIXferAdviseRq.FIXferOperInfo.SignedData, '"', '&#34');
		
		RETURN TRUE;
	END;			
END MODULE;
/* 5-ый сервис */

/* 3-ий сервис */
CREATE COMPUTE MODULE RequestForKolibri_ConvertMDO2CRM_KZSrvBLGetMoneyTransferRq
	CREATE FUNCTION Main() RETURNS BOOLEAN
	BEGIN 
		CALL CopyMessageHeaders(InputRoot,OutputRoot);
		
		DECLARE inRef REFERENCE TO InputRoot.XMLNSC.[<];
		DECLARE outRef REFERENCE TO OutputRoot.XMLNSC.*[<];
				
	    SET OutputRoot.MQMD.ReplyToQ	= 'ESB.QPRAGMA.OUT';
	    SET OutputRoot.MQMD.ReplyToQMgr	= 'IKAZ.ESB.OUT.GW1';				
				
		CREATE LASTCHILD OF OutputRoot DOMAIN('XMLNSC') NAME 'XMLNSC';
		CREATE LASTCHILD OF OutputRoot.XMLNSC AS outRef NAMESPACE mtblitz NAME 'FIXferRcvRq'; 
		
    	SET OutputRoot.XMLNSC.mtblitz:FIXferRcvRq.(XMLNSC.NamespaceDecl)xmlns:iam = iam;
		SET OutputRoot.XMLNSC.mtblitz:FIXferRcvRq.(XMLNSC.NamespaceDecl)xmlns:mt = mt;		
    	SET OutputRoot.XMLNSC.mtblitz:FIXferRcvRq.(XMLNSC.NamespaceDecl)xmlns:ca  = ca; 
		SET OutputRoot.XMLNSC.mtblitz:FIXferRcvRq.(XMLNSC.NamespaceDecl)xmlns:mtblitz = mtblitz; 	
    	SET OutputRoot.XMLNSC.mtblitz:FIXferRcvRq.(XMLNSC.NamespaceDecl)xmlns:ind = ind; 
		SET OutputRoot.XMLNSC.mtblitz:FIXferRcvRq.(XMLNSC.NamespaceDecl)xmlns:orgs = orgs; 
		
		SET outRef.mt:RqUID			= inRef.RqUID;
		SET outRef.mt:RqTm			= convertFromQPtoKOLI(inRef.RqTm);
		SET outRef.mt:SPName		= 'urn:sbrfsystems:98-abs';
		SET outRef.mt:OperName		= 'SrvBLGetMoneyTransferRq';
        
        DECLARE userInfo REFERENCE TO outRef;
        
        CREATE LASTCHILD OF outRef AS userInfo NAMESPACE mtblitz NAME 'UserInfo'; 
        
        SET userInfo.iam:UserId			= inRef.FIXferRcvRq.UserInfo.UserId; -- обязательное поле
        SET userInfo.iam:RegionId		= inRef.FIXferRcvRq.UserInfo.RegionId; 
        SET userInfo.iam:FullName		= inRef.FIXferRcvRq.UserInfo.FullName;
        
        /* userInfo.iam:PersonName */
        DECLARE personName REFERENCE TO userInfo;                	                
        
        IF EXISTS(inRef.FIXferRcvRq.UserInfo.PersonName[]) THEN
        	CREATE LASTCHILD OF userInfo AS personName NAMESPACE iam NAME 'PersonName'; -- создаем PersonName с namespace iam внутри UserInfo            
        	CALL FillSomeField(inRef.FIXferRcvRq.UserInfo.PersonName, personName, 'ind', 'LastName');
        END IF;
        
        SET personName.ind:FirstName = inRef.FIXferRcvRq.UserInfo.PersonName.FirstName;
		
		IF EXISTS(inRef.FIXferRcvRq.UserInfo.PersonName[]) THEN
			CALL FillSomeField(inRef.FIXferRcvRq.UserInfo.PersonName, personName, 'ind', 'MiddleName');
		END IF;
        
        SET personName.ind:TitlePrefix 	= inRef.FIXferRcvRq.UserInfo.PersonName.TitlePrefix;
        SET personName.ind:NameSuffix 	= inRef.FIXferRcvRq.UserInfo.PersonName.NameSuffix;
        SET personName.ind:Nickname 	= inRef.FIXferRcvRq.UserInfo.PersonName.Nickname;
        SET personName.ind:LegalName    = inRef.FIXferRcvRq.UserInfo.PersonName.LegalName;
        /* userInfo.iam:PersonName */
              
		SET userInfo.iam:OrgId				= inRef.FIXferRcvRq.UserInfo.OrgId;
		SET userInfo.iam:OrgName			= inRef.FIXferRcvRq.UserInfo.OrgName;
		SET userInfo.iam:OrgUnitId			= inRef.FIXferRcvRq.UserInfo.OrgUnitId;
		SET userInfo.iam:OrgUnitName		= inRef.FIXferRcvRq.UserInfo.OrgUnitName;
		SET userInfo.iam:EmployeeId			= inRef.FIXferRcvRq.UserInfo.EmployeeId;
		SET userInfo.iam:IpAddr				= inRef.FIXferRcvRq.UserInfo.IpAddr;
		
		DECLARE COUNTER INTEGER 1;
		DECLARE ARRAY_USERINFO INTEGER CARDINALITY(inRef.FIXferRcvRq.UserInfo.*[]);		
		
		/* userInfo.iam:CertInfo */
		DECLARE certInfo REFERENCE TO userInfo;
		
		WHILE COUNTER <= ARRAY_USERINFO DO
		
			IF FIELDNAME(inRef.FIXferRcvRq.UserInfo.[COUNTER]) = 'CertInfo' THEN
				
				CREATE LASTCHILD OF userInfo AS certInfo NAMESPACE iam NAME 'CertInfo';
				
				SET certInfo.iam:X509SubjectName  =  FIELDVALUE(inRef.FIXferRcvRq.UserInfo.[COUNTER].X509SubjectName);
				SET certInfo.iam:KeyName		  =  FIELDVALUE(inRef.FIXferRcvRq.UserInfo.[COUNTER].KeyName);	
				SET certInfo.iam:RegionId		  =  FIELDVALUE(inRef.FIXferRcvRq.UserInfo.[COUNTER].RegionId);				
				      
        		CALL FillSomeField(inRef.FIXferRcvRq.UserInfo.[COUNTER], certInfo, 'iam', 'UserRole');
        		        		
        		SET certInfo.iam:Certificate		  =  FIELDVALUE(inRef.FIXferRcvRq.UserInfo.[COUNTER].Certificate);
        		SET certInfo.iam:KeyValue			  =  FIELDVALUE(inRef.FIXferRcvRq.UserInfo.[COUNTER].KeyValue); 
        		SET certInfo.iam:X509SerialNumber     =  FIELDVALUE(inRef.FIXferRcvRq.UserInfo.[COUNTER].X509SerialNumber);
        		SET certInfo.iam:X509IssuerNumber     =  FIELDVALUE(inRef.FIXferRcvRq.UserInfo.[COUNTER].X509IssuerNumber); 			
				SET certInfo.iam:X509IssuerSerial     =  FIELDVALUE(inRef.FIXferRcvRq.UserInfo.[COUNTER].X509IssuerSerial);
				SET certInfo.iam:Version		      =  FIELDVALUE(inRef.FIXferRcvRq.UserInfo.[COUNTER].Version);
				SET certInfo.iam:NotBefore		      =  FIELDVALUE(inRef.FIXferRcvRq.UserInfo.[COUNTER].NotBefore);
				SET certInfo.iam:NotAfter			  =  FIELDVALUE(inRef.FIXferRcvRq.UserInfo.[COUNTER].NotAfter);
				SET certInfo.iam:SigAlgName			  =  FIELDVALUE(inRef.FIXferRcvRq.UserInfo.[COUNTER].SigAlgName);
				SET certInfo.iam:SigValue			  =  FIELDVALUE(inRef.FIXferRcvRq.UserInfo.[COUNTER].SigValue);
				
				DECLARE COUNTER_CERTINFO INTEGER 1;
				DECLARE ARRAY_CERTINFO INTEGER CARDINALITY(inRef.FIXferRcvRq.UserInfo.[COUNTER].*[]);
				DECLARE extensionInfo REFERENCE TO certInfo;
				
				WHILE COUNTER_CERTINFO <= ARRAY_CERTINFO DO
					IF FIELDNAME(inRef.FIXferRcvRq.UserInfo.[COUNTER].[COUNTER_CERTINFO]) = 'Extension' THEN
						CREATE LASTCHILD OF certInfo AS extensionInfo NAMESPACE iam NAME 'Extension';
												
						SET extensionInfo.iam:ExtnId      = FIELDVALUE(inRef.FIXferRcvRq.UserInfo.[COUNTER].[COUNTER_CERTINFO].ExtnId);
						SET extensionInfo.iam:Critical    = FIELDVALUE(inRef.FIXferRcvRq.UserInfo.[COUNTER].[COUNTER_CERTINFO].Critical);
						SET extensionInfo.iam:ExtnValue   = FIELDVALUE(inRef.FIXferRcvRq.UserInfo.[COUNTER].[COUNTER_CERTINFO].ExtnValue);												
					END IF;					
					SET COUNTER_CERTINFO = COUNTER_CERTINFO + 1;						
				END WHILE;
						
			END IF;
			
			SET COUNTER = COUNTER + 1;
			
		END WHILE;		
		/* userInfo.iam:CertInfo */
		
		/* FIXferInfo */
		DECLARE fixferInfo REFERENCE TO outRef;		
		CREATE LASTCHILD OF outRef AS fixferInfo NAMESPACE mtblitz NAME 'FIXferInfo';
		 
		/* OWNER */
		DECLARE owner REFERENCE TO fixferInfo;
		CREATE LASTCHILD OF fixferInfo AS owner NAMESPACE mtblitz NAME 'Owner';
		
		/* BankInfo */
		DECLARE bankInfo REFERENCE TO owner;
		CREATE LASTCHILD OF owner AS bankInfo NAMESPACE mtblitz NAME 'BankInfo';
		
		SET bankInfo.mtblitz:BankId  =  inRef.FIXferRcvRq.FIXferInfo.Owner.BankInfo.BankId;
		SET bankInfo.mtblitz:Country =  inRef.FIXferRcvRq.FIXferInfo.Owner.BankInfo.Country; 
		SET bankInfo.mtblitz:City    =  inRef.FIXferRcvRq.FIXferInfo.Owner.BankInfo.City;				
		
		/* RECEIVER */
		DECLARE receiver REFERENCE TO fixferInfo;
		CREATE LASTCHILD OF fixferInfo AS receiver NAMESPACE mtblitz NAME 'Receiver';
		
		/* PersonInfo */
		DECLARE personInfo REFERENCE TO receiver;
		CREATE LASTCHILD OF receiver AS personInfo NAMESPACE mtblitz NAME 'PersonInfo';   
		
		SET personInfo.ind:NameAddrType  =  inRef.FIXferRcvRq.FIXferInfo.Receiver.PersonInfo.NameAddrType;
		SET personInfo.ind:FullName      =  inRef.FIXferRcvRq.FIXferInfo.Receiver.PersonInfo.FullName;		
		
		IF EXISTS(inRef.FIXferRcvRq.FIXferInfo.Receiver.PersonInfo.PersonName[]) THEN
        	-- создаем PersonName с namespace iam внутри UserInfo
        	CREATE LASTCHILD OF personInfo AS personName NAMESPACE ind NAME 'PersonName';             
        	CALL FillSomeField(inRef.FIXferRcvRq.FIXferInfo.Receiver.PersonInfo.PersonName, personName, 'ind', 'LastName');
        	
        	SET personName.ind:FirstName	=	inRef.FIXferRcvRq.FIXferInfo.Receiver.PersonInfo.PersonName.FirstName;	
        	
        	IF EXISTS(inRef.FIXferRcvRq.FIXferInfo.Receiver.PersonInfo.PersonName[]) THEN
				CALL FillSomeField(inRef.FIXferRcvRq.FIXferInfo.Receiver.PersonInfo.PersonName, personName, 'ind', 'MiddleName');
			END IF;
        	
        	SET personName.ind:TitlePrefix	=	inRef.FIXferRcvRq.FIXferInfo.Receiver.PersonInfo.PersonName.TitlePrefix;	
        	SET personName.ind:NameSuffix	=	inRef.FIXferRcvRq.FIXferInfo.Receiver.PersonInfo.PersonName.NameSuffix;
        	SET personName.ind:Nickname		=	inRef.FIXferRcvRq.FIXferInfo.Receiver.PersonInfo.PersonName.Nickname;
        	SET personName.ind:LegalName	=	inRef.FIXferRcvRq.FIXferInfo.Receiver.PersonInfo.PersonName.LegalName;        	
        END IF;		
		
		DECLARE COUNT_CONTACTINFO INTEGER 1;
		DECLARE ARRAY_CONTACTINFO INTEGER CARDINALITY(inRef.FIXferRcvRq.FIXferInfo.Receiver.PersonInfo.*[]);
		DECLARE contactInfo REFERENCE TO personInfo;
		
		/* ContactInfo */
		WHILE COUNT_CONTACTINFO <= ARRAY_CONTACTINFO DO
			IF FIELDNAME(inRef.FIXferRcvRq.FIXferInfo.Receiver.PersonInfo.[COUNT_CONTACTINFO]) = 'ContactInfo' THEN
				CREATE LASTCHILD OF personInfo AS contactInfo NAMESPACE ind NAME 'ContactInfo';
				/*SET contactInfo.ca:ContactPref		=	FIELDVALUE(inRef.FIXferRcvRq.FIXferInfo.Receiver.PersonInfo.[COUNT_CONTACTINFO].ContactPref);
				
				IF FIELDVALUE(inRef.FIXferRcvRq.FIXferInfo.Receiver.PersonInfo.[COUNT_CONTACTINFO].PrefTimeStart) <> '' THEN
					SET contactInfo.ca:PrefTimeStart	=	FIELDVALUE(inRef.FIXferRcvRq.FIXferInfo.Receiver.PersonInfo.[COUNT_CONTACTINFO].PrefTimeStart);
				END IF;
				
				IF FIELDVALUE(inRef.FIXferRcvRq.FIXferInfo.Receiver.PersonInfo.[COUNT_CONTACTINFO].PrefTimeEnd) <> '' THEN	
					SET contactInfo.ca:PrefTimeEnd		=   FIELDVALUE(inRef.FIXferRcvRq.FIXferInfo.Receiver.PersonInfo.[COUNT_CONTACTINFO].PrefTimeEnd);
				END IF;	*/
				
				DECLARE COUNT_PHONENUM INTEGER 1;
				DECLARE ARRAY_PHONENUM INTEGER CARDINALITY(inRef.FIXferRcvRq.FIXferInfo.Receiver.PersonInfo.[COUNT_CONTACTINFO].*[]);
 				DECLARE phoneNum REFERENCE TO contactInfo;
 				
 				WHILE COUNT_PHONENUM <= ARRAY_CONTACTINFO DO
 					IF FIELDNAME(inRef.FIXferRcvRq.FIXferInfo.Receiver.PersonInfo.[COUNT_CONTACTINFO].[COUNT_PHONENUM]) = 'PhoneNum' THEN
 						CREATE LASTCHILD OF contactInfo AS phoneNum NAMESPACE ca NAME 'PhoneNum';
 						
 						--SET phoneNum.ca:PhoneType		=	FIELDVALUE(inRef.FIXferRcvRq.FIXferInfo.Receiver.PersonInfo.[COUNT_CONTACTINFO].[COUNT_PHONENUM].PhoneType);
 						SET phoneNum.ca:Phone			= 	FIELDVALUE(inRef.FIXferRcvRq.FIXferInfo.Receiver.PersonInfo.[COUNT_CONTACTINFO].[COUNT_PHONENUM].Phone);
 						--SET phoneNum.ca:PhoneCode   	=   FIELDVALUE(inRef.FIXferRcvRq.FIXferInfo.Receiver.PersonInfo.[COUNT_CONTACTINFO].[COUNT_PHONENUM].PhoneCode);
 						--SET phoneNum.ca:PhoneOperName   =   FIELDVALUE(inRef.FIXferRcvRq.FIXferInfo.Receiver.PersonInfo.[COUNT_CONTACTINFO].[COUNT_PHONENUM].PhoneOperName);
 						
 					END IF;	
 					SET COUNT_PHONENUM = COUNT_PHONENUM + 1; 					
 				END WHILE;
 				/*
 				SET contactInfo.ca:ContactName	=	FIELDVALUE(inRef.FIXferRcvRq.FIXferInfo.Receiver.PersonInfo.[COUNT_CONTACTINFO].ContactName);
 				SET contactInfo.ca:EmailAddr	=	FIELDVALUE(inRef.FIXferRcvRq.FIXferInfo.Receiver.PersonInfo.[COUNT_CONTACTINFO].EmailAddr);
 				SET contactInfo.ca:URL			=	FIELDVALUE(inRef.FIXferRcvRq.FIXferInfo.Receiver.PersonInfo.[COUNT_CONTACTINFO].URL);
 				*/
 				DECLARE COUNT_CONTACTDATA INTEGER 1;
 				DECLARE ARRAY_CONTACTDATA INTEGER CARDINALITY(inRef.FIXferRcvRq.FIXferInfo.Receiver.PersonInfo.[COUNT_CONTACTINFO].*[]);
 				DECLARE contactData REFERENCE TO contactInfo;
 				/*
 				WHILE COUNT_CONTACTDATA <= ARRAY_CONTACTDATA DO
 					IF FIELDNAME(inRef.FIXferRcvRq.FIXferInfo.Receiver.PersonInfo.[COUNT_CONTACTINFO].[COUNT_CONTACTDATA]) = 'ContactData' THEN
 						CREATE LASTCHILD OF contactInfo AS contactData NAMESPACE ca NAME 'ContactData';
 						
 						SET contactData.ca:ContactType		=  FIELDVALUE(inRef.FIXferRcvRq.FIXferInfo.Receiver.PersonInfo.[COUNT_CONTACTINFO].[COUNT_CONTACTDATA].ContactType);
 						SET contactData.ca:ContactValue		=  FIELDVALUE(inRef.FIXferRcvRq.FIXferInfo.Receiver.PersonInfo.[COUNT_CONTACTINFO].[COUNT_CONTACTDATA].ContactValue);
 						
 						IF FIELDVALUE(inRef.FIXferRcvRq.FIXferInfo.Receiver.PersonInfo.[COUNT_CONTACTINFO].[COUNT_CONTACTDATA].PrefTimeStart) <> '' THEN	
 							SET contactData.ca:PrefTimeStart	=  FIELDVALUE(inRef.FIXferRcvRq.FIXferInfo.Receiver.PersonInfo.[COUNT_CONTACTINFO].[COUNT_CONTACTDATA].PrefTimeStart);
 						END IF;
 						
 						IF FIELDVALUE(inRef.FIXferRcvRq.FIXferInfo.Receiver.PersonInfo.[COUNT_CONTACTINFO].[COUNT_CONTACTDATA].PrefTimeEnd) <> '' THEN	
 							SET contactData.ca:PrefTimeEnd		=  FIELDVALUE(inRef.FIXferRcvRq.FIXferInfo.Receiver.PersonInfo.[COUNT_CONTACTINFO].[COUNT_CONTACTDATA].PrefTimeEnd);
 						END IF;	
 						
 					END IF;	
 					SET COUNT_CONTACTDATA = COUNT_CONTACTDATA + 1;
 				END WHILE;
 				*/
 				DECLARE COUNT_POSTADDR INTEGER 1;
				DECLARE postAddr REFERENCE TO contactInfo;
				
				WHILE COUNT_POSTADDR <= ARRAY_CONTACTDATA DO
					IF FIELDNAME(inRef.FIXferRcvRq.FIXferInfo.Receiver.PersonInfo.[COUNT_CONTACTINFO].[COUNT_POSTADDR]) = 'PostAddr' THEN
						CREATE LASTCHILD OF contactInfo AS postAddr NAMESPACE ca NAME 'PostAddr';
						
						SET postAddr.ca:Addr1			=	FIELDVALUE(inRef.FIXferRcvRq.FIXferInfo.Receiver.PersonInfo.[COUNT_CONTACTINFO].[COUNT_POSTADDR].Addr1);  
						/*SET postAddr.ca:Addr2			=	FIELDVALUE(inRef.FIXferRcvRq.FIXferInfo.Receiver.PersonInfo.[COUNT_CONTACTINFO].[COUNT_POSTADDR].Addr2);  
						SET postAddr.ca:Addr3			=	FIELDVALUE(inRef.FIXferRcvRq.FIXferInfo.Receiver.PersonInfo.[COUNT_CONTACTINFO].[COUNT_POSTADDR].Addr3);  
						SET postAddr.ca:Addr4			=	FIELDVALUE(inRef.FIXferRcvRq.FIXferInfo.Receiver.PersonInfo.[COUNT_CONTACTINFO].[COUNT_POSTADDR].Addr4);
						SET postAddr.ca:City			=	FIELDVALUE(inRef.FIXferRcvRq.FIXferInfo.Receiver.PersonInfo.[COUNT_CONTACTINFO].[COUNT_POSTADDR].City);    
						SET postAddr.ca:CityCode		=	FIELDVALUE(inRef.FIXferRcvRq.FIXferInfo.Receiver.PersonInfo.[COUNT_CONTACTINFO].[COUNT_POSTADDR].CityCode);
						SET postAddr.ca:StateProv		=	FIELDVALUE(inRef.FIXferRcvRq.FIXferInfo.Receiver.PersonInfo.[COUNT_CONTACTINFO].[COUNT_POSTADDR].StateProv);
						SET postAddr.ca:StateProvCode	=	FIELDVALUE(inRef.FIXferRcvRq.FIXferInfo.Receiver.PersonInfo.[COUNT_CONTACTINFO].[COUNT_POSTADDR].StateProvCode);
						SET postAddr.ca:Area			= 	FIELDVALUE(inRef.FIXferRcvRq.FIXferInfo.Receiver.PersonInfo.[COUNT_CONTACTINFO].[COUNT_POSTADDR].Area);
						SET postAddr.ca:AreaCode		= 	FIELDVALUE(inRef.FIXferRcvRq.FIXferInfo.Receiver.PersonInfo.[COUNT_CONTACTINFO].[COUNT_POSTADDR].AreaCode);
						SET postAddr.ca:PostalCode		= 	FIELDVALUE(inRef.FIXferRcvRq.FIXferInfo.Receiver.PersonInfo.[COUNT_CONTACTINFO].[COUNT_POSTADDR].PostalCode);
						SET postAddr.ca:Country			= 	FIELDVALUE(inRef.FIXferRcvRq.FIXferInfo.Receiver.PersonInfo.[COUNT_CONTACTINFO].[COUNT_POSTADDR].Country);
						SET postAddr.ca:CountryCode		= 	FIELDVALUE(inRef.FIXferRcvRq.FIXferInfo.Receiver.PersonInfo.[COUNT_CONTACTINFO].[COUNT_POSTADDR].CountryCode);
						SET postAddr.ca:AddrType		= 	FIELDVALUE(inRef.FIXferRcvRq.FIXferInfo.Receiver.PersonInfo.[COUNT_CONTACTINFO].[COUNT_POSTADDR].AddrType);      
						
						IF FIELDVALUE(inRef.FIXferRcvRq.FIXferInfo.Receiver.PersonInfo.[COUNT_CONTACTINFO].[COUNT_POSTADDR].StartDt) <> '' THEN	
							SET postAddr.ca:StartDt		= 	SUBSTRING(FIELDVALUE(inRef.FIXferRcvRq.FIXferInfo.Receiver.PersonInfo.[COUNT_CONTACTINFO].[COUNT_POSTADDR].StartDt) BEFORE 'T');
						END IF;
						
						IF FIELDVALUE(inRef.FIXferRcvRq.FIXferInfo.Receiver.PersonInfo.[COUNT_CONTACTINFO].[COUNT_POSTADDR].EndDt) <> '' THEN	
							SET postAddr.ca:EndDt			= 	SUBSTRING(FIELDVALUE(inRef.FIXferRcvRq.FIXferInfo.Receiver.PersonInfo.[COUNT_CONTACTINFO].[COUNT_POSTADDR].EndDt) BEFORE 'T');
						END IF;
						
						SET postAddr.ca:DistrictCode	= 	FIELDVALUE(inRef.FIXferRcvRq.FIXferInfo.Receiver.PersonInfo.[COUNT_CONTACTINFO].[COUNT_POSTADDR].DistrictCode);
						SET postAddr.ca:District		= 	FIELDVALUE(inRef.FIXferRcvRq.FIXferInfo.Receiver.PersonInfo.[COUNT_CONTACTINFO].[COUNT_POSTADDR].District);
						SET postAddr.ca:PlaсeCode		= 	FIELDVALUE(inRef.FIXferRcvRq.FIXferInfo.Receiver.PersonInfo.[COUNT_CONTACTINFO].[COUNT_POSTADDR].PlaсeCode);
						SET postAddr.ca:Place			= 	FIELDVALUE(inRef.FIXferRcvRq.FIXferInfo.Receiver.PersonInfo.[COUNT_CONTACTINFO].[COUNT_POSTADDR].Place);
						SET postAddr.ca:StreetCode		= 	FIELDVALUE(inRef.FIXferRcvRq.FIXferInfo.Receiver.PersonInfo.[COUNT_CONTACTINFO].[COUNT_POSTADDR].StreetCode);
						SET postAddr.ca:Street			= 	FIELDVALUE(inRef.FIXferRcvRq.FIXferInfo.Receiver.PersonInfo.[COUNT_CONTACTINFO].[COUNT_POSTADDR].Street);
						SET postAddr.ca:House			= 	FIELDVALUE(inRef.FIXferRcvRq.FIXferInfo.Receiver.PersonInfo.[COUNT_CONTACTINFO].[COUNT_POSTADDR].House);
						SET postAddr.ca:Corpus			= 	FIELDVALUE(inRef.FIXferRcvRq.FIXferInfo.Receiver.PersonInfo.[COUNT_CONTACTINFO].[COUNT_POSTADDR].Corpus);
						SET postAddr.ca:Building		= 	FIELDVALUE(inRef.FIXferRcvRq.FIXferInfo.Receiver.PersonInfo.[COUNT_CONTACTINFO].[COUNT_POSTADDR].Building);
						SET postAddr.ca:Flat			= 	FIELDVALUE(inRef.FIXferRcvRq.FIXferInfo.Receiver.PersonInfo.[COUNT_CONTACTINFO].[COUNT_POSTADDR].Flat);
						SET postAddr.ca:Office			= 	FIELDVALUE(inRef.FIXferRcvRq.FIXferInfo.Receiver.PersonInfo.[COUNT_CONTACTINFO].[COUNT_POSTADDR].Office);
						SET postAddr.ca:RusKLADR		= 	FIELDVALUE(inRef.FIXferRcvRq.FIXferInfo.Receiver.PersonInfo.[COUNT_CONTACTINFO].[COUNT_POSTADDR].RusKLADR);
						SET postAddr.ca:AddrStatus		= 	FIELDVALUE(inRef.FIXferRcvRq.FIXferInfo.Receiver.PersonInfo.[COUNT_CONTACTINFO].[COUNT_POSTADDR].AddrStatus);*/
						
					END IF;
					SET COUNT_POSTADDR = COUNT_POSTADDR + 1;	
				END WHILE;		
 				
 				--SET contactInfo.ca:ProviderCode			=	FIELDVALUE(inRef.FIXferRcvRq.FIXferInfo.Receiver.PersonInfo.[COUNT_CONTACTINFO].ProviderCode);
 				
			END IF;	
			SET COUNT_CONTACTINFO = COUNT_CONTACTINFO + 1;
		END WHILE;
		
		/* PersonInfo */
		/*SET personInfo.ind:TINInfo.ca:TINType   =  inRef.FIXferRcvRq.FIXferInfo.Receiver.PersonInfo.TINInfo.TINType;
		SET personInfo.ind:TINInfo.ca:TaxId  	=  inRef.FIXferRcvRq.FIXferInfo.Receiver.PersonInfo.TINInfo.TaxId;
		SET personInfo.ind:TINInfo.ca:CertCode  =  inRef.FIXferRcvRq.FIXferInfo.Receiver.PersonInfo.TINInfo.CertCode;*/
		
		/*IF COALESCE(FIELDVALUE(inRef.FIXferRcvRq.FIXferInfo.Receiver.PersonInfo.BirthDt),'') <> '' THEN
			SET personInfo.ind:BirthDt			=  SUBSTRING(COALESCE(inRef.FIXferRcvRq.FIXferInfo.Receiver.PersonInfo.BirthDt, NULL) FROM 1 FOR 10);
		END IF;*/
		
		IF EXISTS(inRef.FIXferRcvRq.FIXferInfo.Receiver.PersonInfo.DriversLicense[]) THEN 
			SET personInfo.ind:DriversLicense.ind:LicenseNum		=  COALESCE(inRef.FIXferRcvRq.FIXferInfo.Receiver.PersonInfo.DriversLicense.LicenseNum, NULL);
			SET personInfo.ind:DriversLicense.ind:StateProv			=  COALESCE(inRef.FIXferRcvRq.FIXferInfo.Receiver.PersonInfo.DriversLicense.StateProv, NULL);
			SET personInfo.ind:DriversLicense.ind:Country			=  COALESCE(inRef.FIXferRcvRq.FIXferInfo.Receiver.PersonInfo.DriversLicense.Country, NULL);
		END IF;
		
		SET personInfo.ind:MotherMaidenName						=  inRef.FIXferRcvRq.FIXferInfo.Receiver.PersonInfo.MotherMaidenName;
		SET personInfo.ind:SpouseName							=  inRef.FIXferRcvRq.FIXferInfo.Receiver.PersonInfo.SpouseName;
		
		DECLARE COUNTER_EMPLOYMENT INTEGER 1;
		DECLARE employment REFERENCE TO personInfo;
		
		WHILE COUNTER_EMPLOYMENT <= ARRAY_CONTACTINFO DO
			IF FIELDNAME(inRef.FIXferRcvRq.FIXferInfo.Receiver.PersonInfo.[COUNTER_EMPLOYMENT]) = 'EmploymentHistory' THEN
				CREATE LASTCHILD OF personInfo AS employment NAMESPACE ind NAME 'EmploymentHistory';
				
				SET employment.ind:EmploymentStatus		=	inRef.FIXferRcvRq.FIXferInfo.Receiver.PersonInfo.[COUNTER_EMPLOYMENT].EmploymentStatus;				

				DECLARE orgInfo REFERENCE TO employment;
				DECLARE industId REFERENCE TO employment;
				DECLARE composite REFERENCE TO employment;
				DECLARE general REFERENCE TO employment;
								
				FOR orgFor AS inRef.FIXferRcvRq.FIXferInfo.Receiver.PersonInfo.[COUNTER_EMPLOYMENT].OrgInfo[] DO
					CREATE LASTCHILD OF employment AS orgInfo NAMESPACE ind NAME 'OrgInfo';
					
					FOR industFor AS inRef.FIXferRcvRq.FIXferInfo.Receiver.PersonInfo.[COUNTER_EMPLOYMENT].OrgInfo.IndustId[] DO
						CREATE LASTCHILD OF orgInfo AS industId NAMESPACE orgs NAME 'IndustId';
						
						SET industId.orgs:Org			=	industFor.Org;
						SET industId.orgs:IndustNum		=	industFor.IndustNum;
						SET industId.orgs:SubIndustrNum =   industFor.SubIndustrNum;
						SET industId.orgs:IsPrimary	    =   industFor.IsPrimary;						
					END FOR;
					
					SET orgInfo.orgs:Name 			=	orgFor.Name;	
					SET orgInfo.orgs:LegalName 		=	orgFor.LegalName;
					SET orgInfo.orgs:LegalNameEn 	=	orgFor.LegalNameEn;
					SET orgInfo.orgs:FullNameEn 	=	orgFor.FullNameEn;
					SET orgInfo.orgs:MnemonicName 	=	orgFor.MnemonicName;
					
					FOR compositeFor AS inRef.FIXferRcvRq.FIXferInfo.Receiver.PersonInfo.[COUNTER_EMPLOYMENT].OrgInfo.CompositeContactInfo[] DO
						CREATE LASTCHILD OF orgInfo AS composite NAMESPACE orgs NAME 'CompositeContactInfo';
						
						SET composite.ca:ContactInfoType	=  compositeFor.ContactInfoType;
						
						FOR contactFor AS inRef.FIXferRcvRq.FIXferInfo.Receiver.PersonInfo.[COUNTER_EMPLOYMENT].OrgInfo.CompositeContactInfo.ContactInfo[] DO
							CREATE LASTCHILD OF composite AS contactInfo NAMESPACE ca NAME 'ContactInfo';
							
							SET contactInfo.ca:ContactPref		=	contactFor.ContactPref;
							
							IF FIELDVALUE(contactFor.PrefTimeStart) <> '' THEN	
								SET contactInfo.ca:PrefTimeStart	=	FIELDVALUE(contactFor.PrefTimeStart);
							END IF;
							
							IF FIELDVALUE(contactFor.PrefTimeEnd) <> '' THEN	 
								SET contactInfo.ca:PrefTimeEnd		=	FIELDVALUE(contactFor.PrefTimeEnd);
							END IF;
							
							FOR phoneFor AS inRef.FIXferRcvRq.FIXferInfo.Receiver.PersonInfo.[COUNTER_EMPLOYMENT].OrgInfo.CompositeContactInfo.ContactInfo.PhoneNum[] DO		
								CREATE LASTCHILD OF contactInfo AS general NAMESPACE ca NAME 'PhoneNum';
								
								SET general.ca:PhoneType		=	phoneFor.PhoneType;
								SET general.ca:Phone			=	phoneFor.Phone;
								SET general.ca:PhoneCode		=	phoneFor.PhoneCode;
								SET general.ca:PhoneOperName	=	phoneFor.PhoneOperName;								
							END FOR;
							
							SET contactInfo.ca:ContactName		=	contactFor.ContactName;
							SET contactInfo.ca:EmailAddr		=	contactFor.EmailAddr;
							SET contactInfo.ca:URL				=	contactFor.URL;
							
							FOR contactDataFor AS inRef.FIXferRcvRq.FIXferInfo.Receiver.PersonInfo.[COUNTER_EMPLOYMENT].OrgInfo.CompositeContactInfo.ContactInfo.ContactData[] DO
								CREATE LASTCHILD OF contactInfo AS general NAMESPACE ca NAME 'ContactData';
								
								SET general.ca:ContactType		=	contactDataFor.ContactType;
								SET general.ca:ContactValue		=	contactDataFor.ContactValue;
								
								IF FIELDVALUE(contactDataFor.PrefTimeStart) <> '' THEN	
									SET general.ca:PrefTimeStart	=	FIELDVALUE(contactDataFor.PrefTimeStart);
								END IF;
								
								IF FIELDVALUE(contactDataFor.PrefTimeEnd) <> '' THEN	 	
									SET general.ca:PrefTimeEnd		=	FIELDVALUE(contactDataFor.PrefTimeEnd);
								END IF;		
								
							END FOR;
							
							FOR postAddrFor AS inRef.FIXferRcvRq.FIXferInfo.Receiver.PersonInfo.[COUNTER_EMPLOYMENT].OrgInfo.CompositeContactInfo.ContactInfo.PostAddr[] DO
								CREATE LASTCHILD OF contactInfo AS general NAMESPACE ca NAME 'PostAddr';
								
								SET general.ca:Addr1			=	postAddrFor.Addr1;
								SET general.ca:Addr2			=	postAddrFor.Addr2;
								SET general.ca:Addr3			=	postAddrFor.Addr3;
								SET general.ca:Addr4			=	postAddrFor.Addr4;
								SET general.ca:City				=	postAddrFor.City;
								SET general.ca:CityCode			=	postAddrFor.CityCode;
								SET general.ca:StateProv		=	postAddrFor.StateProv;
								SET general.ca:StateProvCode	=	postAddrFor.StateProvCode;
								SET general.ca:Area				=	postAddrFor.Area;
								SET general.ca:AreaCode			=	postAddrFor.AreaCode;
								SET general.ca:PostalCode		=	postAddrFor.PostalCode;
								SET general.ca:Country		    =	postAddrFor.Country;
								SET general.ca:CountryCode	    =	postAddrFor.CountryCode;
								SET general.ca:AddrType		    =	postAddrFor.AddrType;
								
								IF FIELDVALUE(postAddrFor.StartDt) <> '' THEN
									SET general.ca:StartDt		    =	SUBSTRING(FIELDVALUE(postAddrFor.StartDt) BEFORE 'T');
								END IF;	
								
								IF FIELDVALUE(postAddrFor.EndDt) <> '' THEN
									SET general.ca:EndDt		    =	SUBSTRING(FIELDVALUE(postAddrFor.EndDt) BEFORE 'T');
								END IF;	
								
								SET general.ca:DistrictCode	    =	postAddrFor.DistrictCode;
								SET general.ca:District		    =	postAddrFor.District;
								SET general.ca:PlaceCode	    =	postAddrFor.PlaceCode;
								SET general.ca:Place		    =	postAddrFor.Place;
								SET general.ca:StreetCode	    =	postAddrFor.StreetCode;
								SET general.ca:Street		    =	postAddrFor.Street;
								SET general.ca:House		    =	postAddrFor.House;
								SET general.ca:Corpus		    =	postAddrFor.Corpus;
								SET general.ca:Building		    =	postAddrFor.Building;
								SET general.ca:Flat			    =	postAddrFor.Flat;
								SET general.ca:Office		    =	postAddrFor.Office;
								SET general.ca:RusKLADR	   	 	=	postAddrFor.RusKLADR;
								SET general.ca:AddrStatus	    =	postAddrFor.AddrStatus;
							END FOR;
							
							SET contactInfo.ca:ProviderCode				=	contactFor.ProviderCode;
							
						END FOR;						
												
					END FOR;
					
					DECLARE licensesInfo REFERENCE TO orgInfo;
					CREATE LASTCHILD OF orgInfo AS licensesInfo NAMESPACE orgs NAME 'Licenses';
					DECLARE licenseInfo REFERENCE TO orgInfo;
					
					FOR licenseFor AS inRef.FIXferRcvRq.FIXferInfo.Receiver.PersonInfo.[COUNTER_EMPLOYMENT].OrgInfo.Licenses.LicenseInfo[] DO
						CREATE LASTCHILD OF licensesInfo AS licenseInfo NAMESPACE orgs NAME 'LicenseInfo';
						
						SET licenseInfo.orgs:LicenseType	=	licenseFor.LicenseType;
						SET licenseInfo.orgs:LicenseStatus	=	licenseFor.LicenseStatus;
						SET licenseInfo.orgs:LicenseSerie	=	licenseFor.LicenseSerie;
						SET licenseInfo.orgs:LicenseNum		=	licenseFor.LicenseNum;
--						SET licenseInfo.orgs:LicenseIssueDt	=	licenseFor.LicenseIssueDt;

						IF COALESCE(FIELDVALUE(licenseFor.LicenseIssueDt),'') <> '' THEN       
						   SET licenseInfo.orgs:LicenseIssueDt             = SUBSTRING(FIELDVALUE(licenseFor.LicenseIssueDt) BEFORE 'T');
						END IF;       
						
						SET licenseInfo.orgs:LicenseIssueBy	=	licenseFor.LicenseIssueBy;						
					END FOR;
										
					SET orgInfo.orgs:TINInfo.ca:TINType 			=	orgFor.TINInfo.TINType;
					SET orgInfo.orgs:TINInfo.ca:TaxId	 			=	orgFor.TINInfo.TaxId;
					SET orgInfo.orgs:TINInfo.ca:CertCode 			=	orgFor.TINInfo.CertCode;	
					
					SET orgInfo.orgs:KIOInfo.ca:TINType 			=	orgFor.KIOInfo.TINType;
					SET orgInfo.orgs:KIOInfo.ca:TaxId	 			=	orgFor.KIOInfo.TaxId;
					SET orgInfo.orgs:KIOInfo.ca:CertCode 			=	orgFor.KIOInfo.CertCode;
					
					SET orgInfo.orgs:EstablishDt		 			=	orgFor.EstablishDt;
					SET orgInfo.orgs:NumEmployees		 			=	orgFor.NumEmployees;
					SET orgInfo.orgs:EmployerCode		 			=	orgFor.EmployerCode;					
				END FOR;
				
				SET employment.ind:Occupation			=	inRef.FIXferRcvRq.FIXferInfo.Receiver.PersonInfo.[COUNTER_EMPLOYMENT].Occupation;	 	
				
				SET employment.ind:Income.ca:Amt			=	inRef.FIXferRcvRq.FIXferInfo.Receiver.PersonInfo.[COUNTER_EMPLOYMENT].Income.Amt;
				SET employment.ind:Income.ca:Reversal		=	inRef.FIXferRcvRq.FIXferInfo.Receiver.PersonInfo.[COUNTER_EMPLOYMENT].Income.Reversal;
				SET employment.ind:Income.ca:CurCode		=	inRef.FIXferRcvRq.FIXferInfo.Receiver.PersonInfo.[COUNTER_EMPLOYMENT].Income.CurCode;	
				SET employment.ind:Income.ca:CurRate		=	inRef.FIXferRcvRq.FIXferInfo.Receiver.PersonInfo.[COUNTER_EMPLOYMENT].Income.CurRate;
				SET employment.ind:Income.ca:CurConvertRule	=	inRef.FIXferRcvRq.FIXferInfo.Receiver.PersonInfo.[COUNTER_EMPLOYMENT].Income.CurConvertRule; 	
				
				SET employment.ind:JobTitle			=	inRef.FIXferRcvRq.FIXferInfo.Receiver.PersonInfo.[COUNTER_EMPLOYMENT].JobTitle;	 
				
				IF FIELDVALUE(inRef.FIXferRcvRq.FIXferInfo.Receiver.PersonInfo.[COUNTER_EMPLOYMENT].StartDt) <> '' THEN
					SET employment.ind:StartDt			=	SUBSTRING(FIELDVALUE(inRef.FIXferRcvRq.FIXferInfo.Receiver.PersonInfo.[COUNTER_EMPLOYMENT].StartDt) BEFORE 'T');
				END IF;
				
				IF FIELDVALUE(inRef.FIXferRcvRq.FIXferInfo.Receiver.PersonInfo.[COUNTER_EMPLOYMENT].EndDt) <> '' THEN	
					SET employment.ind:EndDt			=	SUBSTRING(FIELDVALUE(inRef.FIXferRcvRq.FIXferInfo.Receiver.PersonInfo.[COUNTER_EMPLOYMENT].EndDt) BEFORE 'T');			
				END IF;					
			END IF;
							
			SET COUNTER_EMPLOYMENT = COUNTER_EMPLOYMENT + 1;
		END WHILE;	
		/*
		IF FIELDVALUE(inRef.FIXferRcvRq.FIXferInfo.Receiver.PersonInfo.Gender) <> '' THEN 
			SET personInfo.ind:Gender							=  inRef.FIXferRcvRq.FIXferInfo.Receiver.PersonInfo.Gender;
		END IF;*/
		
		IF FIELDVALUE(inRef.FIXferRcvRq.FIXferInfo.Receiver.PersonInfo.MaritalStatus) <> '' THEN
			SET personInfo.ind:MaritalStatus					=  inRef.FIXferRcvRq.FIXferInfo.Receiver.PersonInfo.MaritalStatus;
		END IF;
		
		SET personInfo.ind:USAMilitaryRank					=  inRef.FIXferRcvRq.FIXferInfo.Receiver.PersonInfo.USAMilitaryRank;
		SET personInfo.ind:Dependets						=  inRef.FIXferRcvRq.FIXferInfo.Receiver.PersonInfo.Dependets;
		
		IF EXISTS(inRef.FIXferRcvRq.FIXferInfo.Receiver.PersonInfo.Passport[]) THEN
			SET personInfo.ind:Passport.ind:PassportNumber		=  COALESCE(inRef.FIXferRcvRq.FIXferInfo.Receiver.PersonInfo.Passport.PassportNumber,NULL);
			SET personInfo.ind:Passport.ind:DocSeries			=  COALESCE(inRef.FIXferRcvRq.FIXferInfo.Receiver.PersonInfo.Passport.DocSeries, NULL);
			SET personInfo.ind:Passport.ind:PassportCountry		=  COALESCE(inRef.FIXferRcvRq.FIXferInfo.Receiver.PersonInfo.Passport.PassportCountry, NULL);
			SET personInfo.ind:Passport.ind:IssueLoc			=  COALESCE(inRef.FIXferRcvRq.FIXferInfo.Receiver.PersonInfo.Passport.IssueLoc, NULL);
			
			IF FIELDVALUE(inRef.FIXferRcvRq.FIXferInfo.Receiver.PersonInfo.Passport.IssDt) <> '' THEN 
				SET personInfo.ind:Passport.ind:IssDt			=  SUBSTRING(FIELDVALUE(inRef.FIXferRcvRq.FIXferInfo.Receiver.PersonInfo.Passport.IssDt) BEFORE 'T');
			END IF;
			
			IF FIELDVALUE(inRef.FIXferRcvRq.FIXferInfo.Receiver.PersonInfo.Passport.ExpDt) <> '' THEN 	
				SET personInfo.ind:Passport.ind:ExpDt			=  SUBSTRING(FIELDVALUE(inRef.FIXferRcvRq.FIXferInfo.Receiver.PersonInfo.Passport.ExpDt) BEFORE 'T');
			END IF;	
		END IF;
		
		SET personInfo.ind:OEDCode							=  inRef.FIXferRcvRq.FIXferInfo.Receiver.PersonInfo.OEDCode;
		SET personInfo.ind:"OEDInstitution_Type"			=  inRef.FIXferRcvRq.FIXferInfo.Receiver.PersonInfo."OEDInstitution_Type";
		
		IF EXISTS(inRef.FIXferRcvRq.FIXferInfo.Receiver.PersonInfo.GovIssueIdent[]) THEN
			SET personInfo.ind:GovIssueIdent.ind:GovIssueIdentType	=  COALESCE(inRef.FIXferRcvRq.FIXferInfo.Receiver.PersonInfo.GovIssueIdent.GovIssueIdentType, NULL);
			SET personInfo.ind:GovIssueIdent.ind:IdentSerialNum  	=  COALESCE(inRef.FIXferRcvRq.FIXferInfo.Receiver.PersonInfo.GovIssueIdent.IdentSerialNum, NULL);
			SET personInfo.ind:GovIssueIdent.ind:GovOrg			 	=  COALESCE(inRef.FIXferRcvRq.FIXferInfo.Receiver.PersonInfo.GovIssueIdent.GovOrg, NULL);
			SET personInfo.ind:GovIssueIdent.ind:GovOrgName		 	=  COALESCE(inRef.FIXferRcvRq.FIXferInfo.Receiver.PersonInfo.GovIssueIdent.GovOrgName, NULL);
			SET personInfo.ind:GovIssueIdent.ind:GovRank		  	=  COALESCE(inRef.FIXferRcvRq.FIXferInfo.Receiver.PersonInfo.GovIssueIdent.GovRank, NULL);
			SET personInfo.ind:GovIssueIdent.ind:StateProv		 	=  COALESCE(inRef.FIXferRcvRq.FIXferInfo.Receiver.PersonInfo.GovIssueIdent.StateProv, NULL);
			SET personInfo.ind:GovIssueIdent.ind:Country		 	=  COALESCE(inRef.FIXferRcvRq.FIXferInfo.Receiver.PersonInfo.GovIssueIdent.Country, NULL);
			SET personInfo.ind:GovIssueIdent.ind:Desc			  	=  COALESCE(inRef.FIXferRcvRq.FIXferInfo.Receiver.PersonInfo.GovIssueIdent.Desc, NULL);
			
			IF FIELDVALUE(inRef.FIXferRcvRq.FIXferInfo.Receiver.PersonInfo.GovIssueIdent.IssDt) <> '' THEN
				SET personInfo.ind:GovIssueIdent.ind:IssDt			  	=  SUBSTRING(FIELDVALUE(inRef.FIXferRcvRq.FIXferInfo.Receiver.PersonInfo.GovIssueIdent.IssDt) BEFORE 'T');
			END IF;	
			
			IF FIELDVALUE(inRef.FIXferRcvRq.FIXferInfo.Receiver.PersonInfo.GovIssueIdent.ExpDt) <> '' THEN
				SET personInfo.ind:GovIssueIdent.ind:ExpDt			  	=  SUBSTRING(FIELDVALUE(inRef.FIXferRcvRq.FIXferInfo.Receiver.PersonInfo.GovIssueIdent.ExpDt) BEFORE 'T');
			END IF;
			
			SET personInfo.ind:GovIssueIdent.ind:IdentSerie		  	=  COALESCE(inRef.FIXferRcvRq.FIXferInfo.Receiver.PersonInfo.GovIssueIdent.IdentSerie, NULL);
			SET personInfo.ind:GovIssueIdent.ind:GovOrgUnit		  	=  COALESCE(inRef.FIXferRcvRq.FIXferInfo.Receiver.PersonInfo.GovIssueIdent.GovOrgUnit, NULL);
		END IF;
		
		IF EXISTS(inRef.FIXferRcvRq.FIXferInfo.Receiver.PersonInfo.OtherIdentDoc[]) THEN
			SET personInfo.ind:OtherIdentDoc.ind:Desc			  	=  COALESCE(inRef.FIXferRcvRq.FIXferInfo.Receiver.PersonInfo.OtherIdentDoc.Desc, NULL);
			SET personInfo.ind:OtherIdentDoc.ind:IdentSerialNum  	=  COALESCE(inRef.FIXferRcvRq.FIXferInfo.Receiver.PersonInfo.OtherIdentDoc.IdentSerialNum, NULL);
			SET personInfo.ind:OtherIdentDoc.ind:Issuer			 	=  COALESCE(inRef.FIXferRcvRq.FIXferInfo.Receiver.PersonInfo.OtherIdentDoc.Issuer, NULL);
			SET personInfo.ind:OtherIdentDoc.ind:IssueLoc		  	=  COALESCE(inRef.FIXferRcvRq.FIXferInfo.Receiver.PersonInfo.OtherIdentDoc.IssueLoc, NULL);
			
			IF FIELDVALUE(inRef.FIXferRcvRq.FIXferInfo.Receiver.PersonInfo.OtherIdentDoc.IssDt) <> '' THEN
				SET personInfo.ind:OtherIdentDoc.ind:IssDt		 	=  SUBSTRING(FIELDVALUE(inRef.FIXferRcvRq.FIXferInfo.Receiver.PersonInfo.OtherIdentDoc.IssDt) BEFORE 'T');
			END IF;
			
			IF FIELDVALUE(inRef.FIXferRcvRq.FIXferInfo.Receiver.PersonInfo.OtherIdentDoc.ExpDt) <> '' THEN
				SET personInfo.ind:OtherIdentDoc.ind:ExpDt			=  SUBSTRING(FIELDVALUE(inRef.FIXferRcvRq.FIXferInfo.Receiver.PersonInfo.OtherIdentDoc.ExpDt) BEFORE 'T');
			END IF;
		END IF;
		
		DECLARE identityCards REFERENCE TO personInfo;
		DECLARE identityCard REFERENCE TO identityCards;
		
		IF EXISTS(inRef.FIXferRcvRq.FIXferInfo.Receiver.PersonInfo.IdentityCards.IdentityCard.*[]) THEN
			CREATE LASTCHILD OF personInfo AS identityCards NAMESPACE ind NAME 'IdentityCards';
			
			FOR identityFor AS inRef.FIXferRcvRq.FIXferInfo.Receiver.PersonInfo.IdentityCards.IdentityCard[] DO
				
				CREATE LASTCHILD OF identityCards AS identityCard NAMESPACE ind NAME 'IdentityCard';
				
				SET identityCard.ind:IdType				=	identityFor.IdType;
				/*SET identityCard.ind:IdStatus			=	identityFor.IdStatus;
				SET identityCard.ind:IdSeries			=	identityFor.IdSeries;*/
				SET identityCard.ind:IdNum				=	identityFor.IdNum;
				
				IF COALESCE(FIELDVALUE(identityFor.IssueDt),'') <> '' THEN       
					SET identityCard.ind:IssueDt             = identityFor.IssueDt;       
				END IF;       

				IF COALESCE(FIELDVALUE(identityFor.IssueDt),'') <> '' THEN
					SET identityCard.ind:IssueDt		=	FIELDVALUE(identityFor.IssueDt);
				END IF;
					
				SET identityCard.ind:IssuedBy			=	identityFor.IssuedBy;
				/*SET identityCard.ind:Code				=	identityFor.Code;
				SET identityCard.ind:IssueLoc			=	identityFor.IssueLoc;
				SET identityCard.ind:IssuedCountry		=	identityFor.IssuedCountry;

				IF COALESCE(FIELDVALUE(identityFor.IssuedRegionCode),'') <> '' THEN
					SET identityCard.ind:IssuedRegionCode	=	FIELDVALUE(identityFor.IssuedRegionCode);
				END IF;
				
				IF COALESCE(FIELDVALUE(identityFor.ExpDt),'') <> '' THEN
					SET identityCard.ind:ExpDt			=	SUBSTRING(FIELDVALUE(identityFor.ExpDt) BEFORE 'T');	
				END IF;*/
			END FOR;
		
		END IF;
		SET personInfo.ind:BirthPlace			  	=  inRef.FIXferRcvRq.FIXferInfo.Receiver.PersonInfo.BirthPlace;
		--SET personInfo.ind:Resident				  	=  inRef.FIXferRcvRq.FIXferInfo.Receiver.PersonInfo.Resident;
		SET personInfo.ind:MilitaryDocFlag		  	=  inRef.FIXferRcvRq.FIXferInfo.Receiver.PersonInfo.MilitaryDocFlag;
		SET personInfo.ind:Citizenship			  	=  inRef.FIXferRcvRq.FIXferInfo.Receiver.PersonInfo.Citizenship;
		
		SET fixferInfo.mtblitz:OrigDt				=  FIELDVALUE(inRef.FIXferRcvRq.FIXferInfo.OrigDt);
		SET fixferInfo.mtblitz:FIXferId				=  inRef.FIXferRcvRq.FIXferInfo.FIXferId;
		DECLARE subFields REFERENCE TO fixferInfo;
		CREATE LASTCHILD OF fixferInfo AS subFields NAMESPACE mtblitz NAME 'SettlementInfo';
		
		SET subFields.mtblitz:ReceiveCurCode		=   inRef.FIXferRcvRq.FIXferInfo.SettlementInfo.ReceiveCurCode;
		SET subFields.mtblitz:ReceiveAmtEst 		=   inRef.FIXferRcvRq.FIXferInfo.SettlementInfo.ReceiveAmtEst;
		SET subFields.mtblitz:SendAmt				=   inRef.FIXferRcvRq.FIXferInfo.SettlementInfo.SendAmt;
		SET subFields.mtblitz:SendCurCode			=   inRef.FIXferRcvRq.FIXferInfo.SettlementInfo.SendCurCode;
		
		RETURN TRUE;
	END;
END MODULE;
/* 3-ий сервис */
